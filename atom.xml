<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>rex note</title>
  <subtitle>é›¨è¿‡ï¼Œäº‘è¿‡</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://bestlixiang.site/"/>
  <updated>2018-09-04T01:24:17.117Z</updated>
  <id>http://bestlixiang.site/</id>
  
  <author>
    <name>rex</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JDKæºç åˆ†æâ€”â€”HashMap</title>
    <link href="http://bestlixiang.site/2018/09/03/JDK%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/JDK%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E2%80%94%E2%80%94HashMap/"/>
    <id>http://bestlixiang.site/2018/09/03/JDKæºç åˆ†æ/JDKæºç åˆ†æâ€”â€”HashMap/</id>
    <published>2018-09-03T04:01:02.000Z</published>
    <updated>2018-09-04T01:24:17.117Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šåœ¨Collectionæ¥å£ä¸­ç”¨çš„æœ€å¤šçš„æ˜¯ArrayListï¼Œåœ¨Mapæ¥å£ä¸­ç”¨çš„æœ€å¤šçš„ä¸€å®šæ˜¯HashMapï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥çœ‹çœ‹HashMapï¼<a id="more"></a></p>
<p>è¯¦ç»†æ³¨é‡Šï¼š<a href="https://github.com/todorex/JDK" target="_blank" rel="external">æºç åˆ†æåœ°å€</a></p>
<h1 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h1><p>å®ƒæ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„Mapæ¥å£ï¼Œå…è®¸nullçš„å€¼å’Œnullé”®ã€‚</p>
<p>HashMapçš„ä¸€ä¸ªå®ä¾‹æœ‰ä¸¤ä¸ªå½±å“å…¶æ€§èƒ½çš„å‚æ•°ï¼š åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚å®¹é‡æ˜¯å“ˆå¸Œè¡¨ä¸­çš„æ¡¶æ•°ï¼Œåˆå§‹å®¹é‡åªæ˜¯åˆ›å»ºå“ˆå¸Œè¡¨æ—¶çš„å®¹é‡ã€‚ è´Ÿè½½å› å­æ˜¯åœ¨å®¹é‡è‡ªåŠ¨å¢åŠ ä¹‹å‰å…è®¸å“ˆå¸Œè¡¨å……æ»¡ç¨‹åº¦çš„åº¦é‡ã€‚ å½“åœ¨æ•£åˆ—è¡¨ä¸­çš„æ¡ç›®çš„æ•°é‡è¶…è¿‡äº†è´Ÿè½½å› æ•°å’Œå®¹é‡çš„ä¹˜ç§¯ï¼Œå“ˆå¸Œè¡¨å°†è¢«é‡æ–°æ•£åˆ— ï¼ˆå³å†…éƒ¨æ•°æ®ç»“æ„è¢«é‡å»ºï¼‰ï¼Œä½¿å¾—å“ˆå¸Œè¡¨å…·æœ‰æ¡¶çš„å¤§çº¦ä¸¤å€ã€‚</p>
<p>ä½œä¸ºä¸€èˆ¬è§„åˆ™ï¼Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰æä¾›äº†æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´çš„è‰¯å¥½æŠ˜ä¸­ã€‚ æ›´é«˜çš„å€¼ä¼šé™ä½ç©ºé—´å¼€é”€ï¼Œä½†ä¼šå¢åŠ æŸ¥æ‰¾æˆæœ¬ï¼ˆåæ˜ åœ¨HashMapç±»çš„å¤§éƒ¨åˆ†æ“ä½œä¸­ï¼ŒåŒ…æ‹¬getå’Œput ï¼‰ã€‚ åœ¨è®¾ç½®å…¶åˆå§‹å®¹é‡æ—¶ï¼Œåº”è€ƒè™‘Mapä¸­é¢„æœŸçš„æ¡ç›®æ•°åŠå…¶è´Ÿè½½å› å­ï¼Œä»¥ä¾¿æœ€å°åŒ–é‡æ–°æ•£åˆ—æ“ä½œçš„æ•°é‡ã€‚ å¦‚æœåˆå§‹å®¹é‡å¤§äºæœ€å¤§æ¡ç›®æ•°é™¤ä»¥è´Ÿè½½å› å­ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿé‡æ–°æ•£åˆ—æ“ä½œã€‚</p>
<p>æ³¨æ„ï¼ŒHashMapä¸åŒæ­¥ã€‚ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å“ˆå¸Œæ˜ å°„ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ç»“æ„ä¸Šä¿®æ”¹äº†æ˜ å°„ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨å¤–éƒ¨è¿›è¡ŒåŒæ­¥ã€‚ ï¼ˆç»“æ„ä¿®æ”¹æ˜¯æ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ˜ å°„çš„ä»»ä½•æ“ä½œ;ä»…æ”¹å˜ä¸å®ä¾‹å·²ç»åŒ…å«çš„Keyç›¸å…³è”çš„å€¼ä¸æ˜¯ç»“æ„ä¿®æ”¹ã€‚ï¼‰è¿™é€šå¸¸é€šè¿‡å¯¹è‡ªç„¶åœ°å°è£…æ˜ å°„çš„ä¸€äº›å¯¹è±¡ï¼ˆConcurrentMapç­‰ï¼‰è¿›è¡ŒåŒæ­¥æ¥å®ç°ã€‚ å¦‚æœæ²¡æœ‰è¿™æ ·çš„å¯¹è±¡å­˜åœ¨ï¼Œåº”è¯¥ä½¿ç”¨Collections.synchronizedMapæ–¹æ³•â€œåŒ…è£…â€ã€‚</p>
<p>æ‰€æœ‰è¿™ä¸ªç±»çš„æ–¹æ³•è¿”å›çš„è¿­ä»£å™¨éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ ï¼šå¦‚æœæ˜ å°„åœ¨è¿­ä»£å™¨åˆ›å»ºä¹‹åçš„ä»»ä½•æ—¶é—´è¢«ç»“æ„åœ°ä¿®æ”¹ï¼Œé™¤äº†é€šè¿‡è¿­ä»£å™¨è‡ªå·±çš„removeæ–¹æ³•ä¹‹å¤–ï¼Œè¿­ä»£å™¨å°†æŠ›å‡ºä¸€ä¸ªConcurrentModificationException ã€‚</p>
<h1 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h1><p>åœ¨æ„é€ æ–¹æ³•ä¸­ä¸»è¦å°±æ˜¯è®¾ç½®åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ï¼Œå¦‚ä¸‹é¢ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æœ€å¤§å®¹é‡</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</div><div class="line"><span class="comment">// é»˜è®¤åˆå§‹å®¹é‡ï¼Œä¸€å®šæ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™é‡Œæ˜¯16</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>;</div><div class="line"><span class="comment">// é»˜è®¤è´Ÿè½½å› å­ï¼Œè¿™é‡Œæ˜¯0.75</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</div><div class="line"><span class="comment">// è¿™é‡Œæ˜¯Mapå­˜æ”¾æ¡ç›®çš„é˜ˆå€¼</span></div><div class="line"><span class="keyword">int</span> threshold;</div><div class="line"><span class="comment">// åˆå§‹çš„èŠ‚ç‚¹æ•°ç»„ï¼Œè¿™é‡ŒNodeæ˜¯ä¸ªåŒå‘èŠ‚ç‚¹é“¾è¡¨ï¼ˆä¸‹é¢æ³¨é‡Šä¸­ä¼šç›´æ¥è¯´tableï¼‰</span></div><div class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</div><div class="line">    <span class="comment">// ...                                  </span></div><div class="line">    <span class="keyword">this</span>.loadFactor = loadFactor;</div><div class="line">    <span class="comment">// å¯èƒ½å¤§å®¶è§‰å¾—é˜ˆå€¼åº”è¯¥éœ€è¦ä¹˜ä»¥è´Ÿè½½å› å­ï¼Œå…ˆåˆ«æ€¥ï¼Œå¾€åçœ‹</span></div><div class="line">    <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</div><div class="line">&#125;</div><div class="line"><span class="comment">// æ ¹æ®æ‰€ç»™çš„ç›®æ ‡å®¹é‡è¿”å›å¤§äºæˆ–ç­‰äº2çš„å¹‚æ¬¡æ–¹</span></div><div class="line"><span class="comment">// æ„Ÿè§‰è¿™é‡ŒåŠç‚¸å¤©ï¼Œçœ‹ä¸æ‡‚çš„å¯ä»¥çœ‹åé¢å‚è€ƒçš„åšå®¢</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œä¸€å®šè¦å‡1ï¼Œä¸ç„¶å¯¹äºæœ¬æ¥å°±æ˜¯2çš„å¹‚æ¬¡æ–¹çš„æ•°ï¼Œä¼šå˜æˆåŸæ¥çš„ä¸¤å€</span></div><div class="line">    <span class="keyword">int</span> n = cap - <span class="number">1</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</div><div class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œè§£ç­”ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Ÿé¦–å…ˆæä¸€ä¸ªä¸œè¥¿å°±æ˜¯æ•£åˆ—åˆ°HashMapä¸­æ˜¯é€šè¿‡ä¸‹é¢çš„å…¬å¼ï¼š<br><code>hash &amp;(cap-1)</code></p>
<p>å‡è®¾capå®¹é‡ä¸º15ã€16ï¼Œé‚£ä¹ˆä»–ä»¬å‡1ä¹‹åçš„äºŒè¿›åˆ¶è¡¨è¾¾ä¸º1110ã€1111ï¼Œé‚£ä¹ˆ0001ã€0011ã€0101ã€0111, 1001ã€1011ã€1101è¿™äº›æ¡¶å°†æ°¸è¿œä¸ä¼šè¢«ç”¨åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦2çš„å¹‚æ¬¡æ–¹ã€‚</p>
<p>è¿™é‡Œæ—¢ç„¶çœ‹åˆ°äº†hashæˆ‘ä»¬å°±çœ‹ä¸€ä¸‹HashMapçš„hashå‡½æ•°ä¼˜åŒ–ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> h;</div><div class="line">    <span class="comment">// è¿™é‡Œå«æ‰°åŠ¨å‡½æ•°(åŠ å…¥é«˜ä½ç‰¹å¾)ï¼Œå‡å°‘hashç¢°æ’ï¼Œå…·ä½“çš„å¯ä»¥çœ‹åé¢å‚è€ƒé‡Œçš„æ–‡ç« </span></div><div class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h1><p>è¿™é‡Œä¼šæœ‰å¾ˆå¤šç»†èŠ‚ï¼Œéœ€è¦è€å¿ƒæ…¢æ…¢çœ‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// hashå†²çªçš„é“¾è¡¨æ ‘åŒ–é˜ˆå€¼ï¼ˆè‡³å°‘ä¸º8ï¼‰</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</div><div class="line"><span class="comment">// ä»æ ‘è¿˜åŸä¸ºé“¾è¡¨é˜ˆå€¼ï¼ˆå°äº6ï¼‰</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</div><div class="line"></div><div class="line"><span class="comment">// å¢åŠ é”®å€¼å¯¹ï¼Œå¦‚æœkeyå·²å­˜åœ¨ï¼Œåˆ™è¦†ç›–</span></div><div class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿”å›ç”Ÿæˆçš„èŠ‚ç‚¹</span></div><div class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></div><div class="line">               <span class="keyword">boolean</span> evict) &#123;</div><div class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</div><div class="line">    <span class="comment">// åˆå§‹èŠ‚ç‚¹æ•°ç»„tableä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0</span></div><div class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</div><div class="line">        <span class="comment">// ç”ŸæˆèŠ‚ç‚¹æ•°ç»„ï¼ˆè¿™é‡Œä¼šæ¶‰åŠåˆ°åˆå§‹åŒ–tableæˆ–æ‰©å®¹ï¼Œä¸‹é¢ä¼šè¯´ï¼‰ï¼Œå¹¶è¿”å›é•¿åº¦</span></div><div class="line">        n = (tab = resize()).length;</div><div class="line">    <span class="comment">// //å¦‚æœæ–°å­˜æ”¾çš„hashå€¼æ²¡æœ‰å†²çªï¼Œåˆ™æ”¾å…¥tab</span></div><div class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</div><div class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// å¦åˆ™å°±æ˜¯äº§ç”Ÿäº†hashå†²çª</span></div><div class="line">        Node&lt;K,V&gt; e; K k;</div><div class="line">        <span class="comment">// å¦‚æœhashå€¼ç›¸ç­‰ä¸”keyå€¼ç›¸ç­‰, åˆ™ä»¤eæŒ‡å‘å†²çªçš„å¤´èŠ‚ç‚¹</span></div><div class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</div><div class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">            e = p;</div><div class="line">        <span class="comment">// å¦‚æœå¤´èŠ‚ç‚¹çš„keyå€¼ä¸æ–°æ’å…¥çš„keyå€¼ä¸ç­‰, å¹¶ä¸”å¤´ç»“ç‚¹æ˜¯TreeNodeç±»å‹,è¯´æ˜è¯¥hashå€¼å†²çªæ˜¯é‡‡ç”¨çº¢é»‘æ ‘è¿›è¡Œå¤„ç†</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</div><div class="line">            <span class="comment">// å¼ºè½¬ä¸ºTreeNodeï¼Œæ’å…¥é»‘çº¢æ ‘(æœ¬ç¯‡æ–‡ç« ä¸è°ˆé»‘çº¢æ ‘çš„æ“ä½œï¼Œå…·ä½“çš„é»‘çº¢æ ‘æ“ä½œçœ‹åç»­åšæ–‡ï¼Œä¸‹åŒ)</span></div><div class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</div><div class="line">        <span class="comment">// å¦åˆ™å°±æ˜¯é‡‡ç”¨é“¾è¡¨å¤„ç†hashå€¼å†²çª</span></div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// éå†å†²çªé“¾è¡¨, binCountè®°å½•hashå€¼å†²çªé“¾è¡¨ä¸­èŠ‚ç‚¹ä¸ªæ•°</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</div><div class="line">                <span class="comment">// //å½“éå†åˆ°å†²çªé“¾è¡¨çš„å°¾éƒ¨æ—¶</span></div><div class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</div><div class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</div><div class="line">                    <span class="comment">// å†²çªé“¾è¡¨èŠ‚ç‚¹å¤§äº8ä¸ª</span></div><div class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></div><div class="line">                        <span class="comment">// çº¢é»‘æ ‘åŒ–</span></div><div class="line">                        treeifyBin(tab, hash);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//å¦‚æœåœ¨å†²çªé“¾è¡¨ä¸­æ‰¾åˆ°ç›¸åŒkeyå€¼çš„èŠ‚ç‚¹ï¼Œç›´æ¥ç”¨æ–°çš„valueè¦†ç›–åŸæ¥çš„valueå€¼å³å¯</span></div><div class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</div><div class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                p = e;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></div><div class="line">            V oldValue = e.value;</div><div class="line">            <span class="comment">// åˆ¤æ–­onlyIfAbsentæ˜¯å¦è¦†ç›–</span></div><div class="line">            <span class="comment">// trueè¡¨ç¤ºä»…å½“&lt;key,value&gt;ä¸å­˜åœ¨æ—¶è¿›è¡Œæ’å…¥, ä¸ºfalseè¡¨ç¤ºå¼ºåˆ¶è¦†ç›–</span></div><div class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</div><div class="line">                e.value = value;</div><div class="line">            <span class="comment">// å¤„ç†è®¿é—®å›è°ƒåŠ¨ä½œ</span></div><div class="line">            afterNodeAccess(e);</div><div class="line">            <span class="keyword">return</span> oldValue;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ä¿®æ”¹æ¬¡æ•°è‡ªå¢</span></div><div class="line">    ++modCount;</div><div class="line">    <span class="comment">// å½“é”®å€¼å¯¹æ•°é‡sizeè¾¾åˆ°ä¸´ç•Œå€¼threholdå, éœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œ</span></div><div class="line">    <span class="keyword">if</span> (++size &gt; threshold)</div><div class="line">        resize();</div><div class="line">    <span class="comment">// å¤„ç†æ’å…¥å›è°ƒåŠ¨ä½œ</span></div><div class="line">    afterNodeInsertion(evict);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åˆå§‹åŒ–tableæˆ–è€…å¯¹tableè¿›è¡Œæ‰©å®¹(é»˜è®¤2å€)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</div><div class="line">    <span class="comment">// //oldTabå˜é‡æŒ‡å‘åŸæ¥çš„æ•°ç»„</span></div><div class="line">    Node&lt;K,V&gt;[] oldTab = table;</div><div class="line">    <span class="comment">// ç”¨æ¥åˆ¤æ–­æ˜¯æ‰©å®¹è¿˜æ˜¯åˆå§‹åŒ–</span></div><div class="line">    <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</div><div class="line">    <span class="comment">// oldThrå˜é‡ä¿å­˜åŸæ¥æ•°ç»„çš„é˜ˆå€¼</span></div><div class="line">    <span class="keyword">int</span> oldThr = threshold;</div><div class="line">    <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</div><div class="line">    <span class="comment">// å¦‚æœåŸæ¥å°±æœ‰ä¸œè¥¿ï¼Œå°±è¿›è¡Œæ‰©å®¹æ“ä½œ</span></div><div class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// å½“å¤§äºæœ€å¤§å®¹é‡æ—¶ï¼Œä¸æ‰©å®¹ï¼Œåªæ˜¯æ”¹å˜é˜ˆå€¼</span></div><div class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</div><div class="line">            threshold = Integer.MAX_VALUE;</div><div class="line">            <span class="keyword">return</span> oldTab;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// &lt;&lt; è¡¨ç¤ºä¹˜ä»¥2ï¼Œå˜ä¸ºåŸæ¥çš„2å€ï¼ˆåœ¨æ“ä½œé»˜è®¤å¤§å°çš„æƒ…å†µä¸‹ï¼‰</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</div><div class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</div><div class="line">            <span class="comment">// æ–°é˜ˆå€¼ä¹Ÿå˜ä¸ºåŸæ¥çš„2å€</span></div><div class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// oldCap=0, è¯´æ˜åŸæ¥çš„tableæ•°ç»„ä¸ºnullï¼Œå¼€å§‹åˆå§‹åŒ–</span></div><div class="line">    <span class="comment">// æ–°åˆ›å»ºçš„å®¹å™¨å®¹é‡ä¸ºåŸæ¥å®¹å™¨ä¸­è®¾å®šçš„ä¸´ç•Œå€¼ï¼ˆ16ï¼‰</span></div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></div><div class="line">        newCap = oldThr;</div><div class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></div><div class="line">        <span class="comment">// åœ¨æ²¡æœ‰è®¾ç½®é˜ˆå€¼çš„æƒ…å†µä¸‹</span></div><div class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</div><div class="line">        <span class="comment">// åˆå§‹é˜ˆå€¼=é»˜è®¤è´Ÿè½½å› å­*é»˜è®¤åˆå§‹åŒ–å®¹é‡</span></div><div class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// è¿™é‡Œå¯¹åº”çš„è®¾ç½®äº†é˜ˆå€¼çš„æƒ…å†µä¸‹çš„åˆå§‹åŒ–ï¼Œè®¾ç½®é˜ˆå€¼</span></div><div class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</div><div class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</div><div class="line">                  (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ç»™thresholdå¤åˆ¶ï¼Œè¿™é‡Œåº”è¯¥ä¹Ÿå°±è§£ç­”äº†å†æ„é€ é‚£èŠ‚æå‡ºçš„ç–‘é—®äº†</span></div><div class="line">    threshold = newThr;</div><div class="line">    <span class="comment">// åˆ›å»ºæ–°æ•°ç»„</span></div><div class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</div><div class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</div><div class="line">    table = newTab;</div><div class="line">    <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// å¦‚æœåŸæ¥çš„æ•°ç»„ä¸­å­˜åœ¨å€¼, éœ€è¦å°†åŸæ¥æ•°ç»„ä¸­çš„å€¼ä¿å­˜åˆ°æ–°æ•°ç»„ä¸­</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</div><div class="line">            Node&lt;K,V&gt; e;</div><div class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;ã€</div><div class="line">                <span class="comment">// é‡Šæ”¾çš„å¯¹è±¡åŠæ—¶ç½®ç©ºï¼Œç­‰å¾…gcå›æ”¶</span></div><div class="line">                oldTab[j] = <span class="keyword">null</span>;</div><div class="line">                <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</div><div class="line">                    <span class="comment">// é‡æ–°hashè¿›å…¥æ–°çš„æ•°ç»„</span></div><div class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</div><div class="line">                    <span class="comment">//å¦‚æœåŸæ¥è¿™ä¸ªèŠ‚ç‚¹å·²ç»è½¬åŒ–ä¸ºçº¢é»‘æ ‘äº†ï¼Œ</span></div><div class="line">                    <span class="comment">//é‚£ä¹ˆæˆ‘ä»¬å»å°†æ ‘ä¸Šçš„èŠ‚ç‚¹rehashä¹‹åæ ¹æ®hashå€¼æ”¾åˆ°æ–°åœ°æ–¹</span></div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</div><div class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</div><div class="line">                <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></div><div class="line">                    <span class="comment">// è¿™è¯´æ˜åŸæ¥æ•°ç»„ä¸­ä¿å­˜çš„hashå€¼å­˜åœ¨å†²çª, ä½†æ˜¯å¹¶æ²¡æœ‰é‡‡ç”¨çº¢é»‘æ ‘å¯¹å†²çªçš„Hashå€¼è¿›è¡Œç®¡ç†, è€Œæ˜¯é‡‡ç”¨Nodeé“¾è¡¨è¿›è¡Œç®¡ç†</span></div><div class="line">                    Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</div><div class="line">                    Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</div><div class="line">                    Node&lt;K,V&gt; next;</div><div class="line">                    <span class="keyword">do</span> &#123;</div><div class="line">                        next = e.next;</div><div class="line">                        <span class="comment">// å¦‚æœä¸ºçœŸï¼Œè¡¨æ˜åœ¨æ‰©å®¹å(e.hash &amp; (newCap - 1))è¿˜ä¼šå’Œe.hash &amp; (oldCap - 1)ä¸€æ ·</span></div><div class="line">                        <span class="comment">// å¦‚æœä¸ºå‡ï¼Œè¡¨åè¿™äº›èŠ‚ç‚¹å°†hashåœ¨ï¼ˆå½“å‰ä¸‹æ ‡ + oldCapï¼‰ä¸‹</span></div><div class="line">                        <span class="comment">// ä¸æ‡‚çš„å¯ä»¥åœ¨æ€è€ƒğŸ¤”ä¸€ä¸‹,ä½¿ç”¨è¿™ç§æ“ä½œï¼Œå¯ä»¥å‡å°‘é‡æ–°Hashè®¡ç®—</span></div><div class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</div><div class="line">                            <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</div><div class="line">                                loHead = e;</div><div class="line">                            <span class="keyword">else</span></div><div class="line">                                loTail.next = e;</div><div class="line">                            loTail = e;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">else</span> &#123;</div><div class="line">                            <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</div><div class="line">                                hiHead = e;</div><div class="line">                            <span class="keyword">else</span></div><div class="line">                                hiTail.next = e;</div><div class="line">                            hiTail = e;</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</div><div class="line">                    <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</div><div class="line">                        loTail.next = <span class="keyword">null</span>;</div><div class="line">                        newTab[j] = loHead;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</div><div class="line">                        hiTail.next = <span class="keyword">null</span>;</div><div class="line">                        newTab[j + oldCap] = hiHead;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// //è¿”å›æ–°æ•°ç»„çš„å¼•ç”¨</span></div><div class="line">    <span class="keyword">return</span> newTab;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//åˆ é™¤keyå¯¹åº”çš„é”®å€¼å¯¹</span></div><div class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</div><div class="line">    Node&lt;K,V&gt; e;</div><div class="line">    <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>)) == <span class="keyword">null</span> ?</div><div class="line">        <span class="keyword">null</span> : e.value;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// åˆ é™¤èŠ‚ç‚¹</span></div><div class="line"><span class="comment">// å‚æ•°hashä¸ºkeyçš„hashå€¼;</span></div><div class="line"><span class="comment">// å‚æ•°keyä¸ºè¦åˆ é™¤çš„keyé”®;</span></div><div class="line"><span class="comment">// å‚æ•°valueä¸ºkeyå¯¹åº”çš„value;</span></div><div class="line"><span class="comment">// å‚æ•°matchValueä¸ºtrueè¡¨æ˜åªæœ‰keyåœ¨HashMapä¸­å¯¹åº”å€¼ä¸ºvalueæ—¶æ‰åˆ é™¤; ä¸ºfalseè¡¨ç¤ºå¼ºåˆ¶åˆ é™¤;</span></div><div class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> hash, Object key, Object value,</span></span></div><div class="line">                           <span class="keyword">boolean</span> matchValue, <span class="keyword">boolean</span> movable) &#123;</div><div class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, index;</div><div class="line">    <span class="comment">// åœ¨tableä¸­æŸ¥æ‰¾å¯¹åº”hashå€¼</span></div><div class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</div><div class="line">        (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</div><div class="line">        Node&lt;K,V&gt; node = <span class="keyword">null</span>, e; K k; V v;</div><div class="line">        <span class="comment">// å½“å¤´èŠ‚ç‚¹å°±åŒ¹é…åˆ°äº†</span></div><div class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</div><div class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">            node = p;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// å¦‚æœå¤´èŠ‚ç‚¹æ˜¯ä¸ªæ ‘èŠ‚ç‚¹</span></div><div class="line">            <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</div><div class="line">                <span class="comment">// ä»çº¢é»‘æ ‘ä¸­æ‰¾å–èŠ‚ç‚¹</span></div><div class="line">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// ä»é“¾è¡¨ä¸­æ‰¾å–èŠ‚ç‚¹</span></div><div class="line">                <span class="keyword">do</span> &#123;</div><div class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</div><div class="line">                        ((k = e.key) == key ||</div><div class="line">                         (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123;</div><div class="line">                        node = e;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                    p = e;</div><div class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// åŒ¹é…æ‰¾åˆ°çš„èŠ‚ç‚¹çš„å€¼</span></div><div class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</div><div class="line">                             (value != <span class="keyword">null</span> &amp;&amp; value.equals(v)))) &#123;</div><div class="line">            <span class="comment">// æ ‘ä¸­</span></div><div class="line">            <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</div><div class="line">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="keyword">this</span>, tab, movable);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</div><div class="line">                <span class="comment">// é¦–èŠ‚ç‚¹</span></div><div class="line">                tab[index] = node.next;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                <span class="comment">// é“¾è¡¨ä¸­</span></div><div class="line">                p.next = node.next;</div><div class="line">            ++modCount;</div><div class="line">            --size;</div><div class="line">            afterNodeRemoval(node);</div><div class="line">            <span class="comment">// è¿”å›åˆ é™¤çš„èŠ‚ç‚¹</span></div><div class="line">            <span class="keyword">return</span> node;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h1><p>æ”¹å˜å¯¹åº”keyçš„å€¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replace</span><span class="params">(K key, V oldValue, V newValue)</span> </span>&#123;</div><div class="line">    Node&lt;K,V&gt; e; V v;</div><div class="line">    <span class="comment">// æ ¹æ®keyæ‰¾å‡ºèŠ‚ç‚¹</span></div><div class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="keyword">null</span> &amp;&amp;</div><div class="line">        ((v = e.value) == oldValue || (v != <span class="keyword">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</div><div class="line">        e.value = newValue;</div><div class="line">        afterNodeAccess(e);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</div><div class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</div><div class="line">    <span class="comment">// æ‰¾å‡ºæ¡¶çš„å¤´ç»“ç‚¹</span></div><div class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</div><div class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// åˆ¤æ–­å¤´èŠ‚ç‚¹</span></div><div class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></div><div class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">            <span class="keyword">return</span> first;</div><div class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// åœ¨æ ‘ä¸­æ‰¾</span></div><div class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</div><div class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</div><div class="line">            <span class="comment">// åœ¨é“¾è¡¨ä¸­æ‰¾</span></div><div class="line">            <span class="keyword">do</span> &#123;</div><div class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</div><div class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">                    <span class="keyword">return</span> e;</div><div class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h1><p>æ ¹æ®keyæŸ¥æ‰¾å€¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</div><div class="line">    Node&lt;K,V&gt; e;</div><div class="line">    <span class="comment">// è¿™é‡Œçš„getNodeå’Œä¸Šé¢è§£æçš„ä¸€æ ·</span></div><div class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://blog.csdn.net/fan2012huan/article/details/51097331" target="_blank" rel="external">HashMapæºç æ³¨è§£ ä¹‹ é™æ€å·¥å…·æ–¹æ³•hash()ã€tableSizeFor()ï¼ˆå››ï¼‰</a></li>
<li><a href="https://www.cnblogs.com/zhengwang/p/8136164.html" target="_blank" rel="external">HashMapä¸­çš„hashå‡½æ•°</a></li>
<li><a href="https://blog.csdn.net/carson_ho/article/details/79373134" target="_blank" rel="external">å¼ºæ¨ğŸ‘ï¼šJavaæºç åˆ†æï¼šå…³äº HashMap 1.8 çš„é‡å¤§æ›´æ–°</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šåœ¨Collectionæ¥å£ä¸­ç”¨çš„æœ€å¤šçš„æ˜¯ArrayListï¼Œåœ¨Mapæ¥å£ä¸­ç”¨çš„æœ€å¤šçš„ä¸€å®šæ˜¯HashMapï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥çœ‹çœ‹HashMapï¼
    
    </summary>
    
      <category term="JDKæºç åˆ†æ" scheme="http://bestlixiang.site/categories/JDK%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="HashMap" scheme="http://bestlixiang.site/tags/HashMap/"/>
    
  </entry>
  
  <entry>
    <title>JDKæºç åˆ†æâ€”â€”ArrayList</title>
    <link href="http://bestlixiang.site/2018/09/02/JDK%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/JDK%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E2%80%94%E2%80%94ArrayList/"/>
    <id>http://bestlixiang.site/2018/09/02/JDKæºç åˆ†æ/JDKæºç åˆ†æâ€”â€”ArrayList/</id>
    <published>2018-09-02T02:16:31.000Z</published>
    <updated>2018-09-02T05:03:20.173Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šå¤§å®¶åœ¨é›†åˆæ¡†æ¶ä¸­ç”¨çš„æœ€å¤šä¸€å®šæ˜¯ArrayListå§ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä¸€æ¢ç©¶ç«Ÿï¼<a id="more"></a></p>
<p>è¯¦ç»†æ³¨é‡Šï¼š<a href="https://github.com/todorex/JDK" target="_blank" rel="external">æºç åˆ†æåœ°å€</a></p>
<h1 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h1><p>ArrayListæ˜¯åŸºäºå¯å˜æ•°ç»„å®ç°äº†ï¼Œå…è®¸åŒ…æ‹¬ null åœ¨å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<p>æ¯ä¸ª ArrayList å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå®¹é‡ã€‚è¯¥å®¹é‡æ˜¯æŒ‡ç”¨æ¥å­˜å‚¨åˆ—è¡¨å…ƒç´ çš„æ•°ç»„çš„å¤§å°ã€‚å®ƒæ€»æ˜¯è‡³å°‘ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚éšç€å‘ ArrayList ä¸­ä¸æ–­æ·»åŠ å…ƒç´ ï¼Œå…¶å®¹é‡ä¹Ÿè‡ªåŠ¨å¢é•¿ã€‚</p>
<p>åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ ensureCapacity æ“ä½œæ¥å¢åŠ  ArrayList å®ä¾‹çš„å®¹é‡ã€‚è¿™å¯ä»¥å‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> æ­¤å®ç°ä¸æ˜¯åŒæ­¥çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ª ArrayList å®ä¾‹ï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚ï¼ˆç»“æ„ä¸Šçš„ä¿®æ”¹æ˜¯æŒ‡ä»»ä½•æ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„æ“ä½œï¼Œæˆ–è€…æ˜¾å¼è°ƒæ•´åº•å±‚æ•°ç»„çš„å¤§å°ï¼›ä»…ä»…è®¾ç½®å…ƒç´ çš„å€¼ä¸æ˜¯ç»“æ„ä¸Šçš„ä¿®æ”¹ã€‚ï¼‰è¿™ä¸€èˆ¬é€šè¿‡å¯¹è‡ªç„¶å°è£…è¯¥åˆ—è¡¨çš„å¯¹è±¡è¿›è¡ŒåŒæ­¥æ“ä½œæ¥å®Œæˆã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å¯¹è±¡ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ Collections.synchronizedList æ–¹æ³•å°†è¯¥åˆ—è¡¨â€œåŒ…è£…â€èµ·æ¥ã€‚è¿™æœ€å¥½åœ¨åˆ›å»ºæ—¶å®Œæˆï¼Œä»¥é˜²æ­¢æ„å¤–å¯¹åˆ—è¡¨è¿›è¡Œä¸åŒæ­¥çš„è®¿é—®ã€‚</p>
<p>æ­¤ç±»çš„ iterator å’Œ listIterator æ–¹æ³•è¿”å›çš„è¿­ä»£å™¨æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼šåœ¨åˆ›å»ºè¿­ä»£å™¨ä¹‹åï¼Œé™¤éé€šè¿‡è¿­ä»£å™¨è‡ªèº«çš„ remove æˆ– add æ–¹æ³•ä»ç»“æ„ä¸Šå¯¹åˆ—è¡¨è¿›è¡Œä¿®æ”¹ï¼Œå¦åˆ™åœ¨ä»»ä½•æ—¶é—´ä»¥ä»»ä½•æ–¹å¼å¯¹åˆ—è¡¨è¿›è¡Œä¿®æ”¹ï¼Œè¿­ä»£å™¨éƒ½ä¼šæŠ›å‡º ConcurrentModificationExceptionã€‚</p>
<p>ArrayListä»ç±» java.util.AbstractList ç»§æ‰¿äº†å­—æ®µ modCountï¼Œåœ¨è¿›è¡Œåºåˆ—åŒ–æˆ–è€…è¿­ä»£ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦æ¯”è¾ƒæ“ä½œå‰å modCount æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜äº†éœ€è¦æŠ›å‡º ConcurrentModificationExceptionã€‚</p>
<h1 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// é»˜è®¤æ•°ç»„åˆå§‹å¤§å°ä¸º10</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// è¿”å›ç©ºæ•°ç»„</span></div><div class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span> + initialCapacity);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ–°å¢å…ƒç´ </span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç¡®ä¿å®¹é‡è¶³å¤Ÿ</span></div><div class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></div><div class="line">    elementData[size++] = e;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</div><div class="line">    <span class="comment">// å¦‚æœæ˜¯é»˜è®¤åˆ›å»ºçš„æ•°ç»„ï¼Œåˆ™å’Œå®¹é‡é»˜è®¤å€¼æ¯”è¾ƒ</span></div><div class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</div><div class="line">        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ç¡®ä¿å®¹é‡è¶³å¤Ÿ</span></div><div class="line">    ensureExplicitCapacity(minCapacity);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</div><div class="line">    <span class="comment">// ä¿®æ”¹æ“ä½œåŠ 1</span></div><div class="line">    modCount++;</div><div class="line">    <span class="comment">// overflow-conscious code</span></div><div class="line">    <span class="comment">// å¦‚æœéœ€è¦çš„å®¹é‡æ¯”æ•°ç»„é•¿åº¦å¤§ï¼Œåˆ™è¿›è¡Œæ‰©å®¹</span></div><div class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>) grow(minCapacity);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</div><div class="line">    <span class="comment">// overflow-conscious code</span></div><div class="line">    <span class="comment">// æ–°å®¹é‡å°†ä½¿åŸæ¥çš„1.5å€</span></div><div class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</div><div class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</div><div class="line">    <span class="comment">// 1.5å€è¿˜ä¸å¤Ÿçš„è¯ï¼Œå°±å°†å®¹é‡è®¾ç½®ä¸ºéœ€è¦çš„å¤§å°</span></div><div class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>) newCapacity = minCapacity;</div><div class="line">    <span class="comment">// å¦‚æœæ–°å®¹é‡æ¯”æœ€å¤§çš„æ•°ç»„å®¹é‡ï¼ˆInteger.MAX_VALUE - 8;ï¼‰è¿˜è¦å¤§ï¼Œåˆ™åˆ›å»ºæ›´å¤§çš„å®¹é‡ï¼ˆInteger.MAX_VALUEï¼‰</span></div><div class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>) newCapacity = hugeCapacity(minCapacity);</div><div class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></div><div class="line">    <span class="comment">// Arrays.copyOf() æ˜¯æŠŠåŸæ•°ç»„æ•´ä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„ï¼Œè¿™ä¸ªä»£ä»·å¾ˆé«˜</span></div><div class="line">    <span class="comment">// å› æ­¤æœ€å¥½åœ¨åˆ›å»º ArrayList å¯¹è±¡æ—¶å°±æŒ‡å®šå¤§æ¦‚çš„å®¹é‡å¤§å°ï¼Œå‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°</span></div><div class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</div><div class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</div><div class="line">        Integer.MAX_VALUE :</div><div class="line">        MAX_ARRAY_SIZE;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h1><p>åˆ é™¤éœ€è¦å°† index+1 åé¢çš„å…ƒç´ éƒ½å¤åˆ¶åˆ° index ä½ç½®ä¸Šï¼Œè¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œæ‰€ä»¥ArrayList åˆ é™¤å…ƒç´ çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">    <span class="comment">// éªŒè¯indexæ˜¯å¦è¶…å‡ºsizeå¤§å°</span></div><div class="line">    rangeCheck(index);</div><div class="line"></div><div class="line">    modCount++;</div><div class="line">    <span class="comment">// æ‹¿åˆ°å€¼</span></div><div class="line">    E oldValue = elementData(index);</div><div class="line">    <span class="comment">// ç»Ÿè®¡è¦ç§»åŠ¨çš„ä½æ•°</span></div><div class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</div><div class="line">        <span class="comment">// è°ƒç”¨ç³»ç»Ÿæ–¹æ³•å¼€å§‹æ‹·è´</span></div><div class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</div><div class="line">                         numMoved);</div><div class="line">    <span class="comment">// å³æ—¶æ”¾å¼€å¼•ç”¨ï¼Œç­‰å¾…GC</span></div><div class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></div><div class="line">    <span class="comment">// è¿”å›è¢«åˆ é™¤çš„å…ƒç´ </span></div><div class="line">    <span class="keyword">return</span> oldValue;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</div><div class="line">    <span class="comment">// éªŒè¯indexæ˜¯å¦è¶…å‡ºsizeå¤§å°</span></div><div class="line">    rangeCheck(index);</div><div class="line">    <span class="comment">// æ‹¿å‡ºåŸå€¼</span></div><div class="line">    E oldValue = elementData(index);</div><div class="line">    <span class="comment">// è®¾ç½®æ–°å€¼</span></div><div class="line">    elementData[index] = element;</div><div class="line">    <span class="comment">// è¿”å›è¢«æ›¿æ¢çš„å€¼</span></div><div class="line">    <span class="keyword">return</span> oldValue;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">    <span class="comment">// éªŒè¯indexæ˜¯å¦è¶…å‡ºsizeå¤§å°</span></div><div class="line">    rangeCheck(index);</div><div class="line">    <span class="keyword">return</span> elementData(index);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">E <span class="title">elementData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">    <span class="comment">// æ‹¿å‡ºå€¼</span></div><div class="line">    <span class="keyword">return</span> (E) elementData[index];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1><p>ArrayList åŸºäºæ•°ç»„å®ç°ï¼Œå¹¶ä¸”å…·æœ‰åŠ¨æ€æ‰©å®¹ç‰¹æ€§ï¼Œå› æ­¤ä¿å­˜å…ƒç´ çš„æ•°ç»„ä¸ä¸€å®šéƒ½ä¼šè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦å…¨éƒ¨è¿›è¡Œåºåˆ—åŒ–ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ä¿å­˜å…ƒç´ çš„æ•°ç»„ elementData ä½¿ç”¨ transient ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–</span></div><div class="line"><span class="keyword">transient</span> Object[] elementData;</div><div class="line"></div><div class="line"><span class="comment">// åºåˆ—åŒ–</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></div><div class="line">    <span class="keyword">throws</span> java.io.IOException&#123;</div><div class="line">    <span class="comment">// Write out element count, and any hidden stuff</span></div><div class="line">    <span class="comment">// è®°å½•ä¿®æ”¹æ¬¡æ•°ï¼Œåé¢å¯ä»¥æ ¹æ®ä»–åˆ¤æ–­ç»“æ„æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–</span></div><div class="line">    <span class="keyword">int</span> expectedModCount = modCount;</div><div class="line">    <span class="comment">// å†™å…¥éé™æ€ï¼Œéæš‚æ—¶æ•°æ®åˆ°æµä¸­</span></div><div class="line">    s.defaultWriteObject();</div><div class="line"></div><div class="line">    <span class="comment">// Write out size as capacity for behavioural compatibility with clone()</span></div><div class="line">    <span class="comment">// å†™å…¥å…ƒç´ ä¸ªæ•°</span></div><div class="line">    s.writeInt(size);</div><div class="line"></div><div class="line">    <span class="comment">// Write out all elements in the proper order.</span></div><div class="line">    <span class="comment">// å†™å…¥å…ƒç´ </span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</div><div class="line">        s.writeObject(elementData[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æ¯”è¾ƒæ“ä½œå‰å modCount æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜äº†éœ€è¦æŠ›å‡º ConcurrentModificationExceptionã€‚</span></div><div class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ååºåˆ—åŒ–</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></div><div class="line">    <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;</div><div class="line">    elementData = EMPTY_ELEMENTDATA;</div><div class="line"></div><div class="line">    <span class="comment">// Read in size, and any hidden stuff</span></div><div class="line">    s.defaultReadObject();</div><div class="line"></div><div class="line">    <span class="comment">// Read in capacity</span></div><div class="line">    s.readInt(); <span class="comment">// ignored</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// be like clone(), allocate array based upon size not capacity</span></div><div class="line">        ensureCapacityInternal(size);</div><div class="line"></div><div class="line">        Object[] a = elementData;</div><div class="line">        <span class="comment">// Read in all elements in the proper order.</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</div><div class="line">            a[i] = s.readObject();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šå¤§å®¶åœ¨é›†åˆæ¡†æ¶ä¸­ç”¨çš„æœ€å¤šä¸€å®šæ˜¯ArrayListå§ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä¸€æ¢ç©¶ç«Ÿï¼
    
    </summary>
    
      <category term="JDKæºç åˆ†æ" scheme="http://bestlixiang.site/categories/JDK%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="ArrayList" scheme="http://bestlixiang.site/tags/ArrayList/"/>
    
  </entry>
  
  <entry>
    <title>Javaé›†åˆæ¡†æ¶ç±»å›¾</title>
    <link href="http://bestlixiang.site/2018/09/02/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E7%B1%BB%E5%9B%BE/"/>
    <id>http://bestlixiang.site/2018/09/02/JavaåŸºç¡€/Javaé›†åˆæ¡†æ¶ç±»å›¾/</id>
    <published>2018-09-02T00:27:20.000Z</published>
    <updated>2018-09-02T00:54:16.648Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šåœ¨é˜…è¯»é›†åˆæºç ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆç†è§£å…¶ä¸­å„ä¸ªæ¥å£ä»¥åŠç±»å›¾çš„å…³ç³»ã€‚åªè¦ç†æ¸…äº†å„ç§å…³ç³»ï¼Œä½ å¤§è‡´çš„å½±å“å°±æœ‰äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ·±å…¥æºç ï¼Œå»çœ‹å…·ä½“å®ç°ã€‚<a id="more"></a></p>
<h1 id="é›†åˆæ¥å£å›¾"><a href="#é›†åˆæ¥å£å›¾" class="headerlink" title="é›†åˆæ¥å£å›¾"></a>é›†åˆæ¥å£å›¾</h1><p><img src="http://o6plzvjf2.bkt.clouddn.com//java-collection/collection-implement.png" alt="collection-implement"></p>
<h1 id="é›†åˆç±»å›¾"><a href="#é›†åˆç±»å›¾" class="headerlink" title="é›†åˆç±»å›¾"></a>é›†åˆç±»å›¾</h1><p><img src="http://o6plzvjf2.bkt.clouddn.com//java-collection/collection-class.png" alt="collection-class"></p>
<h1 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h1><p>åé¢æˆ‘ä¹Ÿå°†å›´ç»•è¿™äº›ç±»åŠå‘¨è¾¹ç±»åšå‡ºJDkæºç åˆ†æï¼ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šåœ¨é˜…è¯»é›†åˆæºç ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆç†è§£å…¶ä¸­å„ä¸ªæ¥å£ä»¥åŠç±»å›¾çš„å…³ç³»ã€‚åªè¦ç†æ¸…äº†å„ç§å…³ç³»ï¼Œä½ å¤§è‡´çš„å½±å“å°±æœ‰äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ·±å…¥æºç ï¼Œå»çœ‹å…·ä½“å®ç°ã€‚
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://bestlixiang.site/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="Java" scheme="http://bestlixiang.site/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>RPCçŸ¥è¯†</title>
    <link href="http://bestlixiang.site/2018/08/10/%E5%BE%AE%E6%9C%8D%E5%8A%A1/RPC%E7%9F%A5%E8%AF%86/"/>
    <id>http://bestlixiang.site/2018/08/10/å¾®æœåŠ¡/RPCçŸ¥è¯†/</id>
    <published>2018-08-10T06:17:52.000Z</published>
    <updated>2018-08-10T06:22:16.008Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šè½¬è‡ª<a href="https://www.cnkirito.moe" target="_blank" rel="external">å¾é–å³°|ä¸ªäººåšå®¢</a>çš„<a href="https://www.cnkirito.moe/categories/RPC/" target="_blank" rel="external">RPCä¸“æ </a>ï¼Œäº†è§£è¿™äº›æ‰èƒ½å»çœ‹çœ‹RPCæ¡†æ¶ï¼ï¼ï¼<a id="more"></a></p>
<h1 id="RPCç³»åˆ—åšå®¢"><a href="#RPCç³»åˆ—åšå®¢" class="headerlink" title="RPCç³»åˆ—åšå®¢"></a>RPCç³»åˆ—åšå®¢</h1><ol>
<li><a href="https://www.cnkirito.moe/easy-know-rpc/" target="_blank" rel="external">ç®€å•äº†è§£RPCå®ç°åŸç†</a></li>
<li><a href="https://www.cnkirito.moe/rpc-serialize-1/" target="_blank" rel="external">æ·±å…¥ç†è§£RPCä¹‹åºåˆ—åŒ–ç¯‡â€“Kryo</a></li>
<li><a href="æ·±å…¥ç†è§£RPCä¹‹åºåˆ—åŒ–ç¯‡--æ€»ç»“ç¯‡">æ·±å…¥ç†è§£RPCä¹‹åºåˆ—åŒ–ç¯‡â€“æ€»ç»“ç¯‡</a></li>
<li><a href="https://www.cnkirito.moe/rpc-dynamic-proxy/" target="_blank" rel="external">æ·±å…¥ç†è§£RPCä¹‹åŠ¨æ€ä»£ç†ç¯‡</a></li>
<li><a href="https://www.cnkirito.moe/rpc-transport/" target="_blank" rel="external">æ·±å…¥ç†è§£ RPC ä¹‹ä¼ è¾“ç¯‡</a></li>
<li><a href="https://www.cnkirito.moe/motan-async/" target="_blank" rel="external">Motanä¸­ä½¿ç”¨å¼‚æ­¥RPCæ¥å£</a></li>
<li><a href="https://www.cnkirito.moe/rpc-protocol/" target="_blank" rel="external">æ·±å…¥ç†è§£RPCä¹‹åè®®ç¯‡</a></li>
<li><a href="https://www.cnkirito.moe/rpc-registry/" target="_blank" rel="external">æ·±å…¥ç†è§£RPCä¹‹æœåŠ¡æ³¨å†Œä¸å‘ç°ç¯‡</a></li>
<li><a href="https://www.cnkirito.moe/rpc-cluster/" target="_blank" rel="external">æ·±å…¥ç†è§£ RPC ä¹‹é›†ç¾¤ç¯‡</a></li>
<li><a href="https://www.cnkirito.moe/rpc-interface-design/" target="_blank" rel="external">è®¾è®¡RPCæ¥å£æ—¶ï¼Œä½ æœ‰è€ƒè™‘è¿‡è¿™äº›å—ï¼Ÿ</a></li>
</ol>
<h1 id="ç®€å•RPC"><a href="#ç®€å•RPC" class="headerlink" title="ç®€å•RPC"></a>ç®€å•RPC</h1><p>å¯ä»¥å‚è€ƒ<a href="https://github.com/todorex/rex_rpc" target="_blank" rel="external">todorex/rex_rpc</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šè½¬è‡ª&lt;a href=&quot;https://www.cnkirito.moe&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å¾é–å³°|ä¸ªäººåšå®¢&lt;/a&gt;çš„&lt;a href=&quot;https://www.cnkirito.moe/categories/RPC/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RPCä¸“æ &lt;/a&gt;ï¼Œäº†è§£è¿™äº›æ‰èƒ½å»çœ‹çœ‹RPCæ¡†æ¶ï¼ï¼ï¼
    
    </summary>
    
      <category term="å¾®æœåŠ¡" scheme="http://bestlixiang.site/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="rpc" scheme="http://bestlixiang.site/tags/rpc/"/>
    
  </entry>
  
  <entry>
    <title>Nettyæºç ä¹‹ç¼–ç å™¨</title>
    <link href="http://bestlixiang.site/2018/08/06/Netty%E6%BA%90%E7%A0%81/Netty%E6%BA%90%E7%A0%81%E4%B9%8B%E7%BC%96%E7%A0%81%E5%99%A8/"/>
    <id>http://bestlixiang.site/2018/08/06/Nettyæºç /Nettyæºç ä¹‹ç¼–ç å™¨/</id>
    <published>2018-08-06T08:07:52.000Z</published>
    <updated>2018-08-06T08:19:22.107Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šä¸Šä¸€ç¯‡åšæ–‡è®²äº†è§£ç å™¨å¯¹åº”äº†è¯»äº‹ä»¶ï¼Œè¿™æ¬¡å°±è®²ä¸€ä¸‹ç¼–ç å™¨ï¼Œå¯¹åº”äº†å†™äº‹ä»¶ã€‚<a id="more"></a></p>
<h1 id="ç¼–ç å™¨åŸºç±»"><a href="#ç¼–ç å™¨åŸºç±»" class="headerlink" title="ç¼–ç å™¨åŸºç±»"></a>ç¼–ç å™¨åŸºç±»</h1><p>åœ¨Nettyä¸­è§£ç å™¨çš„åŸºç±»æ˜¯<strong>MessageToByteEncoder<i> </i></strong>ï¼Œç„¶åæˆ‘ä»¬è¦æ˜ç™½çš„æ˜¯MessageToByteEncoderå…¶å®æ˜¯ä¸€ä¸ªChannelOutboundHandlerAdapterã€‚</p>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ä¸»è¦å°±æ˜¯è¦†å†™å®ƒçš„encodeæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">encode</span><span class="params">(ChannelHandlerContext ctx, I msg, ByteBuf out)</span> <span class="keyword">throws</span> Exception</span>;</div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªç¼–ç å™¨ç¼–ç çš„è¿‡ç¨‹ä¸»è¦æœ‰å¦‚ä¸‹6ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åŒ¹é…å¯¹è±¡</li>
<li>åˆ†é…å†…å­˜</li>
<li>ç¼–ç å®ç°</li>
<li>é‡Šæ”¾å¯¹è±¡</li>
<li>ä¼ æ’­æ•°æ®</li>
<li>é‡Šæ”¾å†…å­˜</li>
</ol>
<p>å½“æˆ‘ä»¬çŸ¥é“MessageToByteEncoderæ˜¯ä¸€ä¸ªHandlerçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šå»æ‰¾å®ƒå¯¹äº‹ä»¶çš„å¤„ç†æ–¹æ³•ï¼Œä¸»è¦æ˜¯å†™äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°å†™äº‹ä»¶å¤„ç†æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    ByteBuf buf = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿå¤„ç†è¯¥å¯¹è±¡</span></div><div class="line">        <span class="comment">// step 2</span></div><div class="line">        <span class="keyword">if</span> (acceptOutboundMessage(msg)) &#123;</div><div class="line">            <span class="comment">// èƒ½å¤„ç†</span></div><div class="line">            I cast = (I) msg;</div><div class="line">            <span class="comment">// å†…å­˜åˆ†é…(é»˜è®¤åˆ†é…å †å¤–å†…å­˜ )</span></div><div class="line">            buf = allocateBuffer(ctx, cast, preferDirect);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">// å¼€å§‹è°ƒç”¨æˆ‘ä»¬è¦†å†™çš„encodeæ–¹æ³•äº†</span></div><div class="line">                encode(ctx, cast, buf);</div><div class="line">            &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                <span class="comment">// é‡Šæ”¾å¯¹è±¡</span></div><div class="line">                ReferenceCountUtil.release(cast);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (buf.isReadable()) &#123;</div><div class="line">                <span class="comment">// ä¼ æ’­æ•°æ®ï¼Œä¸€ç›´ä¼ æ’­åˆ°headèŠ‚ç‚¹å¤„ç†</span></div><div class="line">                ctx.write(buf, promise);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// å¦‚æœç¼–ç æ²¡æœ‰æˆåŠŸï¼Œåˆ™æ˜¯å¦å†…å­˜</span></div><div class="line">                buf.release();</div><div class="line">                ctx.write(Unpooled.EMPTY_BUFFER, promise);</div><div class="line">            &#125;</div><div class="line">            buf = <span class="keyword">null</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// ä¸èƒ½å¤„ç†ï¼Œåˆ™ç»§ç»­ä¼ æ’­</span></div><div class="line">            ctx.write(msg, promise);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span>(EncoderException e) &#123;</div><div class="line">        <span class="keyword">throw</span> e;</div><div class="line">    &#125; <span class="keyword">catch</span>(Throwable e) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> EncoderException(e);</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        <span class="keyword">if</span> (buf != <span class="keyword">null</span>) &#123;</div><div class="line">            buf.release();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> TypeParameterMatcher matcher;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">acceptOutboundMessage</span><span class="params">(Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">return</span> matcher.match(msg);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// ä¸»è¦å°±æ˜¯åˆ¤æ–­msgæ˜¯å¦æ˜¯MessageToByteEncoder&lt;I&gt;ä¸­çš„Iç±»å‹</span></div><div class="line">    <span class="keyword">return</span> type.isInstance(msg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="write"><a href="#write" class="headerlink" title="write()"></a>write()</h1><p>ä¹‹å‰è‡ªå·±åœ¨ChannelPipelineé‚£ç« åˆ†æåˆ°HeadContextçš„writeæ–¹æ³•ï¼Œæ²¡æœ‰ç»§ç»­å¾€ä¸‹åˆ†æï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåˆ†æï¼š</p>
<p>å®ƒä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªè¿‡ç¨‹ï¼š</p>
<ol>
<li>directåŒ–ByteBuf</li>
<li>æ’å…¥å†™é“¾è¡¨</li>
<li>è®¾ç½®å†™çŠ¶æ€</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    unsafe.write(msg, promise);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Object msg, ChannelPromise promise)</span> </span>&#123;</div><div class="line">	<span class="comment">// è¯¥å¯¹è±¡è´Ÿè´£ç¼“å†²å†™è¿›æ¥çš„æ•°æ®</span></div><div class="line">    ä¼°ç®—å‡ºéœ€è¦å†™å…¥çš„ByteBufçš„size outboundBuffer = <span class="keyword">this</span>.outboundBuffer;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">    <span class="keyword">int</span> size;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// å°†å¾…å†™å…¥çš„å¯¹è±¡è¿‡æ»¤,æŠŠæ‰€æœ‰çš„éç›´æ¥å†…å­˜è½¬æ¢æˆç›´æ¥å†…å­˜DirectBuffer</span></div><div class="line">        <span class="comment">// step 3</span></div><div class="line">        msg = filterOutboundMessage(msg);</div><div class="line">        <span class="comment">// ä¼°ç®—å‡ºéœ€è¦å†™å…¥çš„ByteBufçš„size</span></div><div class="line">        size = pipeline.estimatorHandle().size(msg);</div><div class="line">        <span class="keyword">if</span> (size &lt; <span class="number">0</span>) &#123;</div><div class="line">            size = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span>(Throwable t) &#123;</div><div class="line">        safeSetFailure(promise, t);</div><div class="line">        ReferenceCountUtil.release(msg);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">	<span class="comment">// å°†ä¿¡æ¯æ·»åŠ åˆ°ä¼°ç®—å‡ºéœ€è¦å†™å…¥çš„ByteBufçš„size</span></div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    outboundBuffer.addMessage(msg, size, promise);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> Object <span class="title">filterOutboundMessage</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> ByteBuf) &#123;</div><div class="line">        ByteBuf buf = (ByteBuf) msg;</div><div class="line">        <span class="keyword">if</span> (buf.isDirect()) &#123;</div><div class="line">            <span class="keyword">return</span> msg;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// è½¬æ¢æˆç›´æ¥å†…å­˜DirectBuffer</span></div><div class="line">        <span class="keyword">return</span> newDirectBuffer(buf);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> FileRegion) &#123;</div><div class="line">        <span class="keyword">return</span> msg;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4 ChannelOutboundBuffer</span></div><div class="line"><span class="comment">// ä¸€ä¸ªé“¾è¡¨</span></div><div class="line"><span class="comment">// Entry(flushedEntry) --&gt; ... Entry(unflushedEntry) --&gt; ... Entry(tailEntry)</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// æŒ‡å‘ç¬¬ä¸€ä¸ªå·²ç»flushçš„èŠ‚ç‚¹</span></div><div class="line"><span class="keyword">private</span> Entry flushedEntry;</div><div class="line"><span class="comment">// æŒ‡å‘ç¬¬ä¸€ä¸ªæœªflushçš„èŠ‚ç‚¹</span></div><div class="line"><span class="keyword">private</span> Entry unflushedEntry;</div><div class="line"><span class="comment">// æŒ‡å‘æœ«å°¾èŠ‚ç‚¹</span></div><div class="line"><span class="keyword">private</span> Entry tailEntry;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMessage</span><span class="params">(Object msg, <span class="keyword">int</span> size, ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// å…³æ³¨è¿™ä¸‰ä¸ªæŒ‡é’ˆtailEntryã€tailEntryã€unflushedEntry</span></div><div class="line">    <span class="comment">// å…ˆåŒ…è£…æˆä¸€ä¸ªEntry</span></div><div class="line">    Entry entry = Entry.newInstance(msg, size, total(msg), promise);</div><div class="line">    <span class="comment">// æ’å…¥é“¾è¡¨</span></div><div class="line">    <span class="keyword">if</span> (tailEntry == <span class="keyword">null</span>) &#123;</div><div class="line">        flushedEntry = <span class="keyword">null</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        Entry tail = tailEntry;</div><div class="line">        tail.next = entry;</div><div class="line">    &#125;</div><div class="line">    tailEntry = entry;</div><div class="line">    <span class="keyword">if</span> (unflushedEntry == <span class="keyword">null</span>) &#123;</div><div class="line">        unflushedEntry = entry;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ç»Ÿè®¡å½“å‰éœ€è¦å†™å…¥åˆ°Socketç¼“å­˜åŒºçš„å­—èŠ‚</span></div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    incrementPendingOutboundBytes(entry.pendingSize, <span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">incrementPendingOutboundBytes</span><span class="params">(<span class="keyword">long</span> size, <span class="keyword">boolean</span> invokeLater)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">long</span> newWriteBufferSize = TOTAL_PENDING_SIZE_UPDATER.addAndGet(<span class="keyword">this</span>, size);</div><div class="line">    <span class="comment">// é»˜è®¤ç¼“å†²åŒºä¸èƒ½è¶…è¿‡64ä¸ªå­—èŠ‚</span></div><div class="line">    <span class="keyword">if</span> (newWriteBufferSize &gt; channel.config().getWriteBufferHighWaterMark()) &#123;</div><div class="line">        <span class="comment">// è®¾ç½®å†™çŠ¶æ€</span></div><div class="line">        setUnwritable(invokeLater);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setUnwritable</span><span class="params">(<span class="keyword">boolean</span> invokeLater)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> oldValue = unwritable;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> newValue = oldValue | <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (UNWRITABLE_UPDATER.compareAndSet(<span class="keyword">this</span>, oldValue, newValue)) &#123;</div><div class="line">            <span class="keyword">if</span> (oldValue == <span class="number">0</span> &amp;&amp; newValue != <span class="number">0</span>) &#123;</div><div class="line">                <span class="comment">// ä¼ æ’­ä¸èƒ½å†™äº‹ä»¶</span></div><div class="line">                fireChannelWritabilityChanged(invokeLater);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="flush"><a href="#flush" class="headerlink" title="flush()"></a>flush()</h1><p>writeä¸èƒ½å†™äº†å°±éœ€è¦flushäº†ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿä»HeadContextçš„flushæ–¹æ³•å¼€å§‹åˆ†æï¼š</p>
<p>å®ƒä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>æ·»åŠ åˆ·æ–°æ ‡å¿—å¹¶è®¾ç½®å†™çŠ¶æ€</li>
<li>éå†bufferé˜Ÿåˆ—ï¼Œè¿‡æ»¤ByteBuf</li>
<li>è°ƒç”¨JDKåº•å±‚çš„APIè¿›è¡Œè‡ªæ—‹å†™</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flush</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    unsafe.flush();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123;</div><div class="line">    ChannelOutboundBuffer outboundBuffer = <span class="keyword">this</span>.outboundBuffer;</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    outboundBuffer.addFlush();</div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    flush0();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFlush</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// æŒ‡å‘unflushedEntry</span></div><div class="line">    Entry entry = unflushedEntry;</div><div class="line">    <span class="keyword">if</span> (entry != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (flushedEntry == <span class="keyword">null</span>) &#123;</div><div class="line">            flushedEntry = entry;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">do</span> &#123;</div><div class="line">            <span class="comment">// è®¾ç½®flushçš„æ•°é‡</span></div><div class="line">            flushed++;</div><div class="line">            <span class="keyword">if</span> (!entry.promise.setUncancellable()) &#123;</div><div class="line">                <span class="keyword">int</span> pending = entry.cancel();</div><div class="line">                <span class="comment">// step 4</span></div><div class="line">                decrementPendingOutboundBytes(pending, <span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line">            &#125;</div><div class="line">            entry = entry.next;</div><div class="line">        &#125; <span class="keyword">while</span> ( entry != <span class="keyword">null</span> );</div><div class="line">		<span class="comment">// å°†unflushedEntryè®¾ç½®ä¸ºnull</span></div><div class="line">        unflushedEntry = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">decrementPendingOutboundBytes</span><span class="params">(<span class="keyword">long</span> size, <span class="keyword">boolean</span> invokeLater, <span class="keyword">boolean</span> notifyWritability)</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> newWriteBufferSize = TOTAL_PENDING_SIZE_UPDATER.addAndGet(<span class="keyword">this</span>, -size);</div><div class="line">    <span class="comment">// é»˜è®¤ç¼“å†²åŒºä½äº32ä¸ªå­—èŠ‚ï¼Œåˆ™å¯è®¾ç½®å¯å†™</span></div><div class="line">    <span class="keyword">if</span> (notifyWritability &amp;&amp; newWriteBufferSize &lt; channel.config().getWriteBufferLowWaterMark()) &#123;</div><div class="line">        <span class="comment">// è®¾ç½®å¯å†™çŠ¶æ€</span></div><div class="line">        setWritable(invokeLater);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">flush0</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> ChannelOutboundBuffer outboundBuffer = <span class="keyword">this</span>.outboundBuffer;</div><div class="line">    <span class="keyword">if</span> (outboundBuffer == <span class="keyword">null</span> || outboundBuffer.isEmpty()) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">    <span class="comment">// step 6</span></div><div class="line">    doWrite(outboundBuffer);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6 NioSocketChannel</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doWrite</span><span class="params">(ChannelOutboundBuffer in)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// æ‹¿åˆ°åº•å±‚çš„SocketChannelå‡†å¤‡å¼€å§‹åº•å±‚çš„æ“ä½œ</span></div><div class="line">    SocketChannel ch = javaChannel();</div><div class="line">    <span class="comment">// è·å–å¾ªç¯æ¬¡æ•°ï¼Œç›¸å½“äºä¸€ä¸ªè‡ªæ—‹é”ï¼Œé»˜è®¤16</span></div><div class="line">    <span class="keyword">int</span> writeSpinCount = config().getWriteSpinCount();</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        <span class="comment">// å¦‚æœbufferé‡Œç©ºçš„</span></div><div class="line">        <span class="keyword">if</span> ( in .isEmpty()) &#123;</div><div class="line">            <span class="comment">// æ¸…ç†OP_WRITEï¼Œé˜²æ­¢Reacotrçº¿ç¨‹å†æ¬¡å¤„ç†è¿™ä¸ªChannel</span></div><div class="line">            clearOpWrite();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// è·å–èšåˆå†™çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œé»˜è®¤Integer.MAX_VALUE</span></div><div class="line">        <span class="keyword">int</span> maxBytesPerGatheringWrite = ((NioSocketChannelConfig) config).getMaxBytesPerGatheringWrite();</div><div class="line">        <span class="comment">// æŠŠByteBufé‡Œçš„æ•°æ®å†™åˆ°åŸç”ŸBufferé‡Œ</span></div><div class="line">        <span class="comment">// step 7</span></div><div class="line">        ByteBuffer[] nioBuffers = in.nioBuffers(<span class="number">1024</span>, maxBytesPerGatheringWrite);</div><div class="line">        <span class="keyword">int</span> nioBufferCnt = in.nioBufferCount();</div><div class="line">        <span class="comment">// å¯¹éBufferå¯¹è±¡ï¼ˆFileRegionï¼‰çš„æ•°æ®è¿›è¡Œæ™®é€šçš„è¯»å†™</span></div><div class="line">        <span class="keyword">switch</span> (nioBufferCnt) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">0</span>:    </div><div class="line">            <span class="comment">// æ²¡æˆåŠŸï¼Œè‡ªæ—‹ä¸€æ¬¡</span></div><div class="line">            writeSpinCount -= doWrite0( in );</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                <span class="comment">// JDK NIO æ”¯æŒä¸€æ¬¡å†™å•ä¸ªByteBuffer ä»¥åŠ ä¸€æ¬¡å†™å¤šä¸ªByteBufferçš„èšé›†å†™æ¨¡å¼</span></div><div class="line">                <span class="comment">// å¦‚æœåªæœ‰ä¸€ä¸ªbufferçš„æƒ…å†µä¸‹ï¼Œç›´æ¥æŠŠè¿™ä¸ªbufferå†™è¿›å»</span></div><div class="line">                ByteBuffer buffer = nioBuffers[<span class="number">0</span>];</div><div class="line">                <span class="keyword">int</span> attemptedBytes = buffer.remaining();</div><div class="line">                <span class="comment">// è°ƒç”¨JDKåº•å±‚çš„APIè¿›è¡Œå†™ï¼Œå®Œæ¯•</span></div><div class="line">                <span class="keyword">final</span> <span class="keyword">int</span> localWrittenBytes = ch.write(buffer);</div><div class="line">                <span class="keyword">if</span> (localWrittenBytes &lt;= <span class="number">0</span>) &#123;</div><div class="line">                    incompleteWrite(<span class="keyword">true</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                adjustMaxBytesPerGatheringWrite(attemptedBytes, localWrittenBytes, maxBytesPerGatheringWrite);</div><div class="line">                <span class="comment">// é‡Šæ”¾ç¼“å­˜å¯¹è±¡</span></div><div class="line">                in.removeBytes(localWrittenBytes);</div><div class="line">                --writeSpinCount;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            &#123;</div><div class="line">                 <span class="comment">// å¤šä¸ªbufferçš„æƒ…å†µä¸‹ï¼Œå†™nioBufferCntä¸ªbufferè¿›å»</span></div><div class="line">                <span class="keyword">long</span> attemptedBytes = in.nioBufferSize();</div><div class="line">                <span class="keyword">final</span> <span class="keyword">long</span> localWrittenBytes = ch.write(nioBuffers, <span class="number">0</span>, nioBufferCnt);</div><div class="line">                <span class="keyword">if</span> (localWrittenBytes &lt;= <span class="number">0</span>) &#123;</div><div class="line">                    incompleteWrite(<span class="keyword">true</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                adjustMaxBytesPerGatheringWrite((<span class="keyword">int</span>) attemptedBytes, (<span class="keyword">int</span>) localWrittenBytes, maxBytesPerGatheringWrite); in .removeBytes(localWrittenBytes); --writeSpinCount;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">while</span> ( writeSpinCount &gt; <span class="number">0</span> );</div><div class="line"></div><div class="line">    incompleteWrite(writeSpinCount &lt; <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çŸ¥é“writeå’Œflushé‚£ä¹ˆå°±å¾ˆå®¹æ˜“ç†è§£writeAndFlushå•¦ï¼ï¼</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.jianshu.com/p/feaeaab2ce56" target="_blank" rel="external">ettyæºç åˆ†æä¹‹writeAndFlushå…¨è§£æ</a></li>
<li><a href="http://wyj.shiwuliang.com/2018/06/28/Netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E2%80%94%E2%80%94flush%E6%B5%81%E7%A8%8B/" target="_blank" rel="external">Nettyæºç åˆ†æâ€”â€”flushæµç¨‹</a></li>
<li><a href="https://www.jianshu.com/p/a3443cacd081" target="_blank" rel="external">Netty æºç è§£æ â€”â€”â€” writeAndFlushæµç¨‹åˆ†æ</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šä¸Šä¸€ç¯‡åšæ–‡è®²äº†è§£ç å™¨å¯¹åº”äº†è¯»äº‹ä»¶ï¼Œè¿™æ¬¡å°±è®²ä¸€ä¸‹ç¼–ç å™¨ï¼Œå¯¹åº”äº†å†™äº‹ä»¶ã€‚
    
    </summary>
    
      <category term="Nettyæºç " scheme="http://bestlixiang.site/categories/Netty%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="Netty" scheme="http://bestlixiang.site/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>Nettyæºç ä¹‹è§£ç å™¨</title>
    <link href="http://bestlixiang.site/2018/08/06/Netty%E6%BA%90%E7%A0%81/Netty%E6%BA%90%E7%A0%81%E4%B9%8B%E8%A7%A3%E7%A0%81%E5%99%A8/"/>
    <id>http://bestlixiang.site/2018/08/06/Nettyæºç /Nettyæºç ä¹‹è§£ç å™¨/</id>
    <published>2018-08-06T08:07:37.000Z</published>
    <updated>2018-08-06T08:14:29.964Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šNettyåœ¨å¸®æˆ‘ä»¬è§£å†³æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿæä¾›äº†ä¸°å¯Œçš„ç¼–è§£ç å™¨æ¥ä¸ºæˆ‘ä»¬ä¸šåŠ¡ä¸Šæä¾›ä¾¿åˆ©ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±æ¥çœ‹çœ‹Nettyçš„è§£ç å™¨ã€‚<a id="more"></a></p>
<h1 id="è§£ç å™¨åŸºç±»"><a href="#è§£ç å™¨åŸºç±»" class="headerlink" title="è§£ç å™¨åŸºç±»"></a>è§£ç å™¨åŸºç±»</h1><p><strong>è§£ç ï¼š</strong>å°±æ˜¯å°†äºŒè¿›åˆ¶æ•°æ®æµè§£ç ä¸ºè‡ªå®šä¹‰æ•°æ®åŒ…ã€‚</p>
<p>åœ¨Nettyä¸­è§£ç å™¨çš„åŸºç±»æ˜¯<strong>ByteToMessageDecoder</strong>ï¼Œç„¶åæˆ‘ä»¬è¦æ˜ç™½çš„æ˜¯ByteToMessageDecoderå…¶å®æ˜¯ä¸€ä¸ªChannelInboundHandlerAdapterã€‚</p>
<p>ä¸€ä¸ªè§£ç å™¨è§£ç çš„è¿‡ç¨‹ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ç´¯åŠ å­—èŠ‚æµ</li>
<li>è°ƒç”¨å­ç±»çš„decodeæ–¹æ³•è¿›è¡Œè§£æ</li>
<li>å°†è§£æåˆ°çš„ByteBufå‘ä¸‹ä¼ æ’­</li>
</ol>
<p>å½“æˆ‘ä»¬çŸ¥é“ByteToMessageDecoderæ˜¯ä¸€ä¸ªHandlerçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šå»æ‰¾å®ƒå¯¹äº‹ä»¶çš„å¤„ç†æ–¹æ³•ï¼Œä¸»è¦æ˜¯è¯»äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°è¯»äº‹ä»¶å¤„ç†æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line">ByteBuf cumulation;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// è§£ç å™¨æ˜¯ç›¸å¯¹äºByteBufè¿›è¡Œè§£ç çš„(åœ¨å…¥ç«™çš„æ—¶å€™å·²ç»å°è£…å¥½äº†ï¼Œå¯ä»¥å‚è€ƒè‡ªå·±ä¹‹å‰å…³äºPipelineçš„åšæ–‡)</span></div><div class="line">    <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> ByteBuf) &#123;</div><div class="line">        <span class="comment">// å­˜å‚¨è§£ç åçš„æ•°æ® List</span></div><div class="line">        CodecOutputList out = CodecOutputList.newInstance();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ByteBuf data = (ByteBuf) msg;</div><div class="line">            <span class="comment">// æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡ç´¯åŠ </span></div><div class="line">            first = cumulation == <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (first) &#123;</div><div class="line">                <span class="comment">// ç¬¬ä¸€æ¬¡</span></div><div class="line">                cumulation = data;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// ä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œåˆ™è¿›è¡Œç´¯åŠ </span></div><div class="line">                <span class="comment">// æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªç´¯åŠ å™¨çš„cumulateæ–¹æ³• step 2</span></div><div class="line">                cumulation = cumulator.cumulate(ctx.alloc(), cumulation, data);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// è°ƒç”¨å­ç±»çš„decodeæ–¹æ³•è¿›è¡Œè§£æ</span></div><div class="line">            <span class="comment">// step 3</span></div><div class="line">            callDecode(ctx, cumulation, out);</div><div class="line">        &#125; <span class="keyword">catch</span>(DecoderException e) &#123;</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> DecoderException(e);</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">int</span> size = out.size();</div><div class="line">            decodeWasNull = !out.insertSinceRecycled();</div><div class="line">            <span class="comment">// å°†è§£æåˆ°çš„å¯¹è±¡å‘ä¸‹ç»§ç»­ä¼ æ’­</span></div><div class="line">            <span class="comment">// step 5</span></div><div class="line">            fireChannelRead(ctx, out, size);</div><div class="line">            <span class="comment">// å›æ”¶list</span></div><div class="line">            out.recycle();</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// ä¸æ˜¯ByteBufå°±ç›´æ¥å‘ä¸‹ä¼ æ’­</span></div><div class="line">        ctx.fireChannelRead(msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">public</span> ByteBuf <span class="title">cumulate</span><span class="params">(ByteBufAllocator alloc, ByteBuf cumulation, ByteBuf in )</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> ByteBuf buffer;</div><div class="line">    <span class="comment">// å½“bufçš„æ•°æ®å¤§äºcumulationçš„å‰©ä½™å®¹é‡æ—¶</span></div><div class="line">    <span class="keyword">if</span> (cumulation.writerIndex() &gt; cumulation.maxCapacity() - in.readableBytes() || cumulation.refCnt() &gt; <span class="number">1</span> || cumulation.isReadOnly()) &#123;</div><div class="line">		<span class="comment">// è¿›è¡Œæ‰©å®¹(æ‰©å®¹å…¶å®å°±æ˜¯ä¸€ä¸ªå†…å­˜æ‹·è´æ“ä½œ)</span></div><div class="line">        buffer = expandCumulation(alloc, cumulation, in.readableBytes());</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// ä¸ç„¶å°±ä¸æ‰©å®¹</span></div><div class="line">        buffer = cumulation;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å°†æ•°æ®å†™å…¥buf</span></div><div class="line">    buffer.writeBytes(in);</div><div class="line">    <span class="comment">// é‡Šæ”¾ä¼ å…¥çš„buf</span></div><div class="line">    in.release();</div><div class="line">    <span class="keyword">return</span> buffer;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">callDecode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in , List &lt; Object &gt; out)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span> ( in .isReadable()) &#123;</div><div class="line">        <span class="keyword">int</span> outSize = out.size();</div><div class="line">        <span class="comment">// çœ‹listæ˜¯å¦æœ‰å¯¹è±¡</span></div><div class="line">        <span class="keyword">if</span> (outSize &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// æœ‰å¯¹è±¡åˆ™å°†listä¼ æ’­å‡ºå»</span></div><div class="line">            fireChannelRead(ctx, out, outSize);</div><div class="line">            <span class="comment">// å¹¶æ¸…ç©ºlist</span></div><div class="line">            out.clear();</div><div class="line">            outSize = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// è®°å½•å¯è¯»é•¿åº¦</span></div><div class="line">        <span class="keyword">int</span> oldInputLength = in.readableBytes();</div><div class="line">        <span class="comment">// å¼€å§‹è°ƒç”¨decodeæ–¹æ³•äº†</span></div><div class="line">        <span class="comment">// step 4</span></div><div class="line">        decodeRemovalReentryProtection(ctx, in, out);</div><div class="line">        <span class="comment">// ä»€ä¹ˆéƒ½æ²¡æœ‰è§£æå‡ºæ¥æ—¶</span></div><div class="line">        <span class="keyword">if</span> (outSize == out.size()) &#123;</div><div class="line">            <span class="comment">// ä»£è¡¨å½“å‰çš„æ•°æ®ä¸èƒ½æ‹¼è£…æˆä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ï¼Œbreakå‡†å¤‡ç­‰å¾…ä¸‹ä¸€æ¬¡æ•°æ®åŒ…</span></div><div class="line">            <span class="keyword">if</span> (oldInputLength == in.readableBytes()) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">decodeRemovalReentryProtection</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in , List &lt; Object &gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">    <span class="comment">// å¼€å§‹è°ƒç”¨è§£ç å™¨å­ç±»çš„decodeæ–¹æ³•äº†</span></div><div class="line">    decode(ctx, in, out);</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// step 5</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fireChannelRead</span><span class="params">(ChannelHandlerContext ctx, CodecOutputList msgs, <span class="keyword">int</span> numElements)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numElements; i++) &#123;</div><div class="line">        <span class="comment">// msgs.getUnsafe(i)ä¿è¯æˆbyteBuf</span></div><div class="line">        <span class="comment">// è¿™é‡Œå¯èƒ½å°±ä¼šä¼ æ’­åˆ°ä¸šåŠ¡çš„å¤„ç†å™¨</span></div><div class="line">        ctx.fireChannelRead(msgs.getUnsafe(i));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="LineBasedFrameDecoder"><a href="#LineBasedFrameDecoder" class="headerlink" title="LineBasedFrameDecoder"></a>LineBasedFrameDecoder</h1><p>æˆ‘ä»¬æŒ‘é€‰äº†åŸºäºåˆ†éš”ç¬¦è§£ç å™¨LineBasedFrameDecoderæ¥åˆ†æï¼Œå®ƒå¯ä»¥åŒæ—¶å¤„ç† \nä»¥åŠ\r\nä¸¤ç§ç±»å‹çš„è¡Œåˆ†éš”ç¬¦ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒçš„decodeæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 (è§£ç å™¨æ¨¡æ¿)</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in , List &lt; Object &gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    Object decoded = decode(ctx, in);</div><div class="line">    <span class="keyword">if</span> (decoded != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// æ‹†é™¤ä¸€ä¸ªæ•°æ®åŒ…å°±æ”¾è¿›Listé‡Œ</span></div><div class="line">        out.add(decoded);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2 LineBasedFrameDecoder</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> discarding;</div><div class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf buffer)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// æ‰¾åˆ°æ¢è¡Œç¬¦ä½ç½®</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> eol = findEndOfLine(buffer);</div><div class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡æ‹†åŒ…ä¸åœ¨ä¸¢å¼ƒæ¨¡å¼ä¸‹</span></div><div class="line">    <span class="keyword">if</span> (!discarding) &#123;</div><div class="line">        <span class="comment">// éä¸¢å¼ƒæ¨¡å¼ä¸‹</span></div><div class="line">        <span class="comment">// æ‰¾åˆ°åˆ†éš”ç¬¦</span></div><div class="line">        <span class="keyword">if</span> (eol &gt;= <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">final</span> ByteBuf frame;</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> length = eol - buffer.readerIndex();</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> delimLength = buffer.getByte(eol) == <span class="string">'\r'</span> ? <span class="number">2</span> : <span class="number">1</span>;</div><div class="line">			<span class="comment">// åˆ¤æ–­æ‹†åŒ…çš„é•¿åº¦æ˜¯å¦å¤§äºå…è®¸çš„æœ€å¤§é•¿åº¦ï¼ŒmaxLengthæ„é€ æ—¶ä¼ å…¥</span></div><div class="line">            <span class="keyword">if</span> (length &gt; maxLength) &#123;</div><div class="line">                <span class="comment">// è¶…å‡ºæœ€å¤§é•¿åº¦åˆ™ä¸¢å¼ƒè¿™æ®µæ•°æ®ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></div><div class="line">                buffer.readerIndex(eol + delimLength);</div><div class="line">                fail(ctx, length);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">			<span class="comment">// è§£ç æ•°æ®æ˜¯å¦è¦åŒ…å«åˆ†éš”ç¬¦</span></div><div class="line">            <span class="keyword">if</span> (stripDelimiter) &#123;</div><div class="line">                <span class="comment">// ä¸åŒ…å«</span></div><div class="line">                frame = buffer.readRetainedSlice(length);</div><div class="line">                buffer.skipBytes(delimLength);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// åŒ…å«</span></div><div class="line">                frame = buffer.readRetainedSlice(length + delimLength);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// è¿”å›æ‹†åŒ…åå°è£…æˆçš„å¸§</span></div><div class="line">            <span class="keyword">return</span> frame;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// æ²¡æ‰¾åˆ°åˆ†éš”ç¬¦</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> length = buffer.readableBytes();</div><div class="line">            <span class="keyword">if</span> (length &gt; maxLength) &#123;</div><div class="line">                <span class="comment">// å¦‚æœå¤§äºæœ€å¤§é•¿åº¦ï¼Œè¿›å…¥ä¸¢å¼ƒæ¨¡å¼</span></div><div class="line">                <span class="comment">// ä¿å­˜ä¸¢å¼ƒé•¿åº¦</span></div><div class="line">                discardedBytes = length;</div><div class="line">                buffer.readerIndex(buffer.writerIndex());</div><div class="line">                discarding = <span class="keyword">true</span>;</div><div class="line">                offset = <span class="number">0</span>;</div><div class="line">                <span class="keyword">if</span> (failFast) &#123;</div><div class="line">                    fail(ctx, <span class="string">"over "</span> + discardedBytes);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// ä¸å¤§äºï¼Œåˆ™è¿”å›null</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// ä¸¢å¼ƒæ¨¡å¼ä¸‹</span></div><div class="line">        <span class="keyword">if</span> (eol &gt;= <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// æ‰¾åˆ°åˆ†å‰²ç¬¦</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> length = discardedBytes + eol - buffer.readerIndex();</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> delimLength = buffer.getByte(eol) == <span class="string">'\r'</span> ? <span class="number">2</span> : <span class="number">1</span>;</div><div class="line">            buffer.readerIndex(eol + delimLength);</div><div class="line">            discardedBytes = <span class="number">0</span>;</div><div class="line">            discarding = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">if</span> (!failFast) &#123;</div><div class="line">                fail(ctx, length);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// ä¿å­˜ä¸¢å¼ƒé•¿åº¦</span></div><div class="line">            discardedBytes += buffer.readableBytes();</div><div class="line">            <span class="comment">// æ”¹å˜è¯»æŒ‡é’ˆä½ç½®</span></div><div class="line">            buffer.readerIndex(buffer.writerIndex());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶ä»–çš„è§£ç å™¨ä¹Ÿå¯ä»¥æ ¹æ®LineBasedFrameDecoderçš„æ€è·¯å»åˆ†æã€‚å½“ç„¶æˆ‘ä»¬æœ€éœ€è¦å…³æ³¨çš„è¿˜æ˜¯æ•´ä¸ªè§£ç å™¨çš„è®¾è®¡æ€æƒ³ã€‚å­¦ä¼šå»æŠ½è±¡ä¸€ç±»ä¸œè¥¿ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.jianshu.com/p/dc26e944da95" target="_blank" rel="external">nettyæºç åˆ†æä¹‹æ‹†åŒ…å™¨çš„å¥¥ç§˜</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šNettyåœ¨å¸®æˆ‘ä»¬è§£å†³æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿæä¾›äº†ä¸°å¯Œçš„ç¼–è§£ç å™¨æ¥ä¸ºæˆ‘ä»¬ä¸šåŠ¡ä¸Šæä¾›ä¾¿åˆ©ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±æ¥çœ‹çœ‹Nettyçš„è§£ç å™¨ã€‚
    
    </summary>
    
      <category term="Nettyæºç " scheme="http://bestlixiang.site/categories/Netty%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="Netty" scheme="http://bestlixiang.site/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>Nettyæºç ä¹‹ChannelPipeline</title>
    <link href="http://bestlixiang.site/2018/08/06/Netty%E6%BA%90%E7%A0%81/Netty%E6%BA%90%E7%A0%81%E4%B9%8BChannelPipeline/"/>
    <id>http://bestlixiang.site/2018/08/06/Nettyæºç /Nettyæºç ä¹‹ChannelPipeline/</id>
    <published>2018-08-06T08:07:14.000Z</published>
    <updated>2018-08-06T08:13:59.182Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šå…¶å®å‰é¢å°±å¤šæ¬¡æåˆ°äº†ChannelPipelineï¼Œä½†æ˜¯éƒ½æ²¡æœ‰è¯¦ç»†è¯´æ˜ChannelPipelineæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å…·ä½“çœ‹çœ‹è¿™ä¸ªç®¡ç†å¤„ç†é€»è¾‘çš„æŠ½è±¡ä»¥åŠå¤„ç†é€»è¾‘çš„æŠ½è±¡ChannelHandlerã€‚<a id="more"></a></p>
<h1 id="ChannelPipelineçš„åˆ›å»º"><a href="#ChannelPipelineçš„åˆ›å»º" class="headerlink" title="ChannelPipelineçš„åˆ›å»º"></a>ChannelPipelineçš„åˆ›å»º</h1><p>é€šè¿‡å‰é¢çš„è®²è§£ï¼Œæˆ‘ä»¬åº”è¯¥è¿˜è®°å¾—ä¸€ä¸ªChannelå¯¹åº”äº†ä¸€ä¸ªChannelPipelineï¼Œè€ŒChannelPipelineä¹Ÿå°±æ˜¯åœ¨åˆ›å»ºChannelçš„æ—¶å€™éšä¹‹åˆ›å»ºçš„ã€‚æˆ‘ä»¬å°±ä»é‚£é‡Œå¼€å§‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 AbstractChannelçš„åˆ›å»º</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractChannel</span><span class="params">(Channel parent)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.parent = parent;</div><div class="line">    id = newId();</div><div class="line">    unsafe = newUnsafe();</div><div class="line">    <span class="comment">// step 2 ChannelPipelineçš„åˆ›å»º</span></div><div class="line">    pipeline = newChannelPipeline();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">protected</span> DefaultChannelPipeline <span class="title">newChannelPipeline</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultChannelPipeline(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">DefaultChannelPipeline</span><span class="params">(Channel channel)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šchannel</span></div><div class="line">    <span class="keyword">this</span>.channel = ObjectUtil.checkNotNull(channel, <span class="string">"channel"</span>);</div><div class="line">    <span class="comment">// é»˜è®¤åˆ›å»ºä¸€ä¸ªç”±å¤´å°¾èŠ‚ç‚¹çš„åŒå‘é“¾è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹èŠ‚ç‚¹çš„ç±»å‹</span></div><div class="line">    tail = <span class="keyword">new</span> TailContext(<span class="keyword">this</span>);</div><div class="line">    head = <span class="keyword">new</span> HeadContext(<span class="keyword">this</span>);</div><div class="line">    head.next = tail;</div><div class="line">    tail.prev = head;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ChannelPipelineåˆ›å»ºå®Œæ¯•ï¼ï¼</p>
<h1 id="èŠ‚ç‚¹çš„æ·»åŠ "><a href="#èŠ‚ç‚¹çš„æ·»åŠ " class="headerlink" title="èŠ‚ç‚¹çš„æ·»åŠ "></a>èŠ‚ç‚¹çš„æ·»åŠ </h1><p>èŠ‚ç‚¹çš„æ·»åŠ æˆ‘ä»¬å¿…ç„¶è¦ä»æˆ‘ä»¬è§è¿‡çš„ChannelPipelineçš„addLast(handler)æ–¹æ³•å¼€å§‹åˆ†æï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">addLast</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    <span class="keyword">return</span> addLast(<span class="keyword">null</span>, handler);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">addLast</span><span class="params">(String name, ChannelHandler handler)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">return</span> addLast(<span class="keyword">null</span>, name, handler);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">addLast</span><span class="params">(EventExecutorGroup group, String name, ChannelHandler handler)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> AbstractChannelHandlerContext newCtx;</div><div class="line">    <span class="comment">// åŒæ­¥</span></div><div class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</div><div class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤èŠ‚ç‚¹</span></div><div class="line">        checkMultiplicity(handler);</div><div class="line">        <span class="comment">// å°†handleråŒ…è£…æˆèŠ‚ç‚¹ä¸Šä¸‹æ–‡ DefaultChannelHandlerContext</span></div><div class="line">        <span class="comment">// step 4</span></div><div class="line">        newCtx = newContext(group, filterName(name, handler), handler);</div><div class="line">        <span class="comment">// æ·»åŠ èŠ‚ç‚¹ step 7</span></div><div class="line">        addLast0(newCtx);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å›è°ƒå¤„ç†å™¨è¢«æ·»åŠ çš„æ–¹æ³•</span></div><div class="line">    callHandlerAdded0(newCtx);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">newContext</span><span class="params">(EventExecutorGroup group, String name, ChannelHandler handler)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultChannelHandlerContext(<span class="keyword">this</span>, childExecutor(group), name, handler);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5</span></div><div class="line">DefaultChannelHandlerContext(DefaultChannelPipeline pipeline, EventExecutor executor, String name, ChannelHandler handler) &#123;</div><div class="line">    <span class="comment">// step 6 isInBound,isOutBountå·²ç»ç¡®å®šäº†</span></div><div class="line">    <span class="keyword">super</span>(pipeline, executor, name, isInbound(handler), isOutbound(handler));</div><div class="line">	<span class="comment">// ç»‘å®šhandler</span></div><div class="line">    <span class="keyword">this</span>.handler = handler;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6</span></div><div class="line">AbstractChannelHandlerContext(DefaultChannelPipeline pipeline, EventExecutor executor, String name, <span class="keyword">boolean</span> inbound, <span class="keyword">boolean</span> outbound) &#123;</div><div class="line">    <span class="comment">// è®¾å®šåå­—</span></div><div class="line">    <span class="keyword">this</span>.name = ObjectUtil.checkNotNull(name, <span class="string">"name"</span>);</div><div class="line">    <span class="comment">// ç»‘å®špipeline</span></div><div class="line">    <span class="keyword">this</span>.pipeline = pipeline;</div><div class="line">    <span class="comment">// ç»‘å®šNioEventLoop</span></div><div class="line">    <span class="keyword">this</span>.executor = executor;</div><div class="line">    <span class="comment">// è¡¨ç¤ºè‡ªå·±æ˜¯inboundå¤„ç†å™¨è¿˜æ˜¯outboundå¤„ç†å™¨ï¼Œåé¢æ ¹æ®è¿™ä¸ªå€¼æ¥åˆ¤æ–­</span></div><div class="line">    <span class="keyword">this</span>.inbound = inbound;</div><div class="line">    <span class="keyword">this</span>.outbound = outbound;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addLast0</span><span class="params">(AbstractChannelHandlerContext newCtx)</span> </span>&#123;</div><div class="line">    <span class="comment">// æ·»åŠ åˆ°Pipelineçš„é‚£ä¸ªåŒå‘é“¾è¡¨ä¸­</span></div><div class="line">    AbstractChannelHandlerContext prev = tail.prev;</div><div class="line">    newCtx.prev = prev;</div><div class="line">    newCtx.next = tail;</div><div class="line">    prev.next = newCtx;</div><div class="line">    tail.prev = newCtx;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="èŠ‚ç‚¹çš„åˆ é™¤"><a href="#èŠ‚ç‚¹çš„åˆ é™¤" class="headerlink" title="èŠ‚ç‚¹çš„åˆ é™¤"></a>èŠ‚ç‚¹çš„åˆ é™¤</h1><p>å’ŒChannelPipelineçš„addLast(handler)ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ChannelPipelineçš„remove(handler)æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">remove</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</div><div class="line">    <span class="comment">// æˆ‘ä»¬çŸ¥é“èŠ‚ç‚¹æ˜¯ä¿è¯äº†handlerçš„AbstractChannelHandlerContext</span></div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    remove(getContextOrDie(handler));</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">remove</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext ctx)</span> </span>&#123;</div><div class="line">    <span class="keyword">assert</span> ctx != head &amp;&amp; ctx != tail;</div><div class="line">	<span class="comment">// åŒæ­¥</span></div><div class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</div><div class="line">        <span class="comment">// step 3</span></div><div class="line">        remove0(ctx);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å›è°ƒèŠ‚ç‚¹çš„åˆ é™¤æ–¹æ³•</span></div><div class="line">    callHandlerRemoved0(ctx);</div><div class="line">    <span class="keyword">return</span> ctx;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remove0</span><span class="params">(AbstractChannelHandlerContext ctx)</span> </span>&#123;</div><div class="line">    <span class="comment">// å°±æ˜¯åŒå‘é“¾è¡¨çš„åˆ é™¤</span></div><div class="line">    AbstractChannelHandlerContext prev = ctx.prev;</div><div class="line">    AbstractChannelHandlerContext next = ctx.next;</div><div class="line">    prev.next = next;</div><div class="line">    next.prev = prev;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="å…¥ç«™äº‹ä»¶çš„ä¼ æ’­"><a href="#å…¥ç«™äº‹ä»¶çš„ä¼ æ’­" class="headerlink" title="å…¥ç«™äº‹ä»¶çš„ä¼ æ’­"></a>å…¥ç«™äº‹ä»¶çš„ä¼ æ’­</h1><p>å…¶å®æˆ‘ä»¬åº”è¯¥å·²ç»ç»å†è¿‡äº†ï¼Œæºå¤´éƒ½æ˜¯åœ¨ä»Unsafeå¯¹è±¡(å®ƒè´Ÿè´£æœ€åº•å±‚çš„IOæ“ä½œ)å‡ºå‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»NioEventLoopçš„è¿™ä¸€æ®µä»£ç å‡ºå‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKey</span><span class="params">(SelectionKey k, AbstractNioChannel ch)</span> </span>&#123;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">    <span class="keyword">if</span> ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != <span class="number">0</span> || readyOps == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// æ¥å—IOäº‹ä»¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨SeverSocketChannelå’ŒSocketChannelå¤„ç†çš„äº‹ä»¶æ˜¯ä¸ä¸€æ ·çš„</span></div><div class="line">        <span class="comment">// æˆ‘ä»¬ä¸»è¦åˆ†æSocketChannelçš„è¯»äº‹ä»¶ï¼Œå¯¹åº”çš„Unsafeå¯¹è±¡æ˜¯NioByteUnSafe</span></div><div class="line">        <span class="comment">// step 2</span></div><div class="line">        unsafe.read();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2 AbstractNioByteChannelçš„NioByteUnSafe</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> ChannelConfig config = config();</div><div class="line">    <span class="keyword">final</span> ChannelPipeline pipeline = pipeline();</div><div class="line">    <span class="comment">// åˆ›å»ºByteBufåˆ†é…å™¨</span></div><div class="line">    <span class="keyword">final</span> ByteBufAllocator allocator = config.getAllocator();</div><div class="line">    <span class="comment">// æ§åˆ¶è¿æ¥æ•°</span></div><div class="line">    <span class="keyword">final</span> RecvByteBufAllocator.Handle allocHandle = recvBufAllocHandle();</div><div class="line">    allocHandle.reset(config);</div><div class="line"></div><div class="line">    ByteBuf byteBuf = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        <span class="comment">// åˆ†é…ä¸€ä¸ªbyteBuf</span></div><div class="line">        byteBuf = allocHandle.allocate(allocator);</div><div class="line">        <span class="comment">// è¯»æ•°æ®</span></div><div class="line">        allocHandle.lastBytesRead(doReadBytes(byteBuf));</div><div class="line">        allocHandle.incMessagesRead(<span class="number">1</span>);</div><div class="line">        readPending = <span class="keyword">false</span>;</div><div class="line">        <span class="comment">// è§¦å‘è¯»äº‹ä»¶ï¼Œè¿™æ˜¯æˆ‘ä»¬è¦å…³æ³¨çš„é‡ç‚¹</span></div><div class="line">        <span class="comment">// step 3</span></div><div class="line">        pipeline.fireChannelRead(byteBuf);</div><div class="line">        byteBuf = <span class="keyword">null</span>;</div><div class="line">    &#125; <span class="keyword">while</span> ( allocHandle . continueReading ());</div><div class="line"></div><div class="line">    allocHandle.readComplete();</div><div class="line">    <span class="comment">// è§¦å‘è¯»å®Œæˆäº‹ä»¶</span></div><div class="line">    pipeline.fireChannelReadComplete();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">fireChannelRead</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// å‡ºå‘å¤´èŠ‚ç‚¹çš„è¯»äº‹ä»¶</span></div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    AbstractChannelHandlerContext.invokeChannelRead(head, msg);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">invokeChannelRead</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext next, Object msg)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, <span class="string">"msg"</span>), next);</div><div class="line">    <span class="comment">// è°ƒç”¨å¤´èŠ‚ç‚¹çš„channelReadæ–¹æ³•</span></div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    next.invokeChannelRead(m);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeChannelRead</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// è°ƒç”¨å¤´èŠ‚ç‚¹çš„channelReadæ–¹æ³•</span></div><div class="line">    <span class="comment">// step 6</span></div><div class="line">    ((ChannelInboundHandler) handler()).channelRead(<span class="keyword">this</span>, msg);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// ç»§ç»­ä¼ é€’è¯»äº‹ä»¶</span></div><div class="line">    <span class="comment">// step 7</span></div><div class="line">    ctx.fireChannelRead(msg);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelHandlerContext <span class="title">fireChannelRead</span><span class="params">(<span class="keyword">final</span> Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// æ‰¾åˆ°ä¸‹ä¸€ä¸ªå…¥ç«™èŠ‚ç‚¹</span></div><div class="line">    <span class="comment">// step 8 findContextInbound</span></div><div class="line">    <span class="comment">// step 9 ä¼šé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œå¦‚æœæ¶ˆæ¯æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆå°†ä¸€ç›´ä¼ é€’åˆ°tailèŠ‚ç‚¹(æœ€åä¸€ä¸ªinboundèŠ‚ç‚¹public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span></div><div class="line">    onUnhandledInboundMessage(msg);</div><div class="line">&#125;)</div><div class="line">    invokeChannelRead(findContextInbound(), msg);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 8</span></div><div class="line"><span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">findContextInbound</span><span class="params">()</span> </span>&#123;</div><div class="line">    AbstractChannelHandlerContext ctx = <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        ctx = ctx.next;</div><div class="line">        <span class="comment">// å¯ä»¥çœ‹åˆ°æ˜¯æ ¹æ®æ ‡å¿—ä½æ¥åˆ¤å®šçš„</span></div><div class="line">    &#125; <span class="keyword">while</span> (! ctx . inbound );</div><div class="line">    <span class="keyword">return</span> ctx;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 9 DefaultChannelPipelineçš„TailContext</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// step 10</span></div><div class="line">    onUnhandledInboundMessage(msg);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onUnhandledInboundMessage</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// å¦‚æœæ¶ˆæ¯ä¸€ç›´æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå°†åœ¨tailèŠ‚ç‚¹è¢«é‡Šæ”¾</span></div><div class="line">    ReferenceCountUtil.release(msg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="å‡ºç«™äº‹ä»¶çš„ä¼ æ’­"><a href="#å‡ºç«™äº‹ä»¶çš„ä¼ æ’­" class="headerlink" title="å‡ºç«™äº‹ä»¶çš„ä¼ æ’­"></a>å‡ºç«™äº‹ä»¶çš„ä¼ æ’­</h1><p>å‡ºç«™äº‹ä»¶ä¸€èˆ¬æ˜¯å†™äº‹ä»¶ï¼Œæœ‰ä¸¤ç§å†™éœ€è¦åŒºåˆ«ä¸€ä¸‹ï¼šï¼ˆæ¥è‡ªnettyæºç ä¸­telnetä¾‹å­ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ChannelFuture future = ctx.channel().write(response);   <span class="comment">// 1</span></div><div class="line">ChannelFuture future = ctx.write(response); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸€ç§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, String request)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    ChannelFuture future = ctx.channel().write(response);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2 AbstractChannel</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">return</span> pipeline.write(msg);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3 DefaultChannelPipeline</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç›´æ¥è°ƒç”¨tailçš„å†™æ–¹æ³•</span></div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    <span class="keyword">return</span> tail.write(msg);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5 AbstractChannelHandlerContext</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 6</span></div><div class="line">    <span class="keyword">return</span> write(msg, newPromise());</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6 AbstractChannelHandlerContext</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">write</span><span class="params">(<span class="keyword">final</span> Object msg, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// åŠ ä¸Šæ˜¯å¦flushçš„ä¿¡æ¯</span></div><div class="line">    <span class="comment">// step 7</span></div><div class="line">    write(msg, <span class="keyword">false</span>, promise);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Object msg, <span class="keyword">boolean</span> flush, ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// å’Œè¿›ç«™ç›¸è¯†ï¼Œè¿™é‡Œæ‰¾çš„å‡ºç«™èŠ‚ç‚¹</span></div><div class="line">    AbstractChannelHandlerContext next = findContextOutbound();</div><div class="line">    <span class="keyword">final</span> Object m = pipeline.touch(msg, next);</div><div class="line">    EventExecutor executor = next.executor();</div><div class="line">    <span class="keyword">if</span> (flush) &#123;</div><div class="line">        next.invokeWriteAndFlush(m, promise);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// è°ƒç”¨ä¸‹ä¸€ä¸ªå‡ºç«™èŠ‚ç‚¹çš„å†™æ–¹æ³•</span></div><div class="line">        next.invokeWrite(m, promise);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeWrite</span><span class="params">(Object msg, ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 8    </span></div><div class="line">    invokeWrite0(msg, promise);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 8</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeWrite0</span><span class="params">(Object msg, ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 9 ä¼šç›´æ¥è°ƒç”¨åˆ°HeadContextçš„writeæ–¹æ³•</span></div><div class="line">    ((ChannelOutboundHandler) handler()).write(<span class="keyword">this</span>, msg, promise);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 9</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// åˆ©ç”¨unsafeå†™å…¥(æ˜ç™½æµç¨‹å°±å¥½ï¼Œå…³äºå…·ä½“æ€ä¹ˆå†™å…¥å°†æ”¾åˆ°ç¼–ç å™¨çš„åšæ–‡ä¸Š)</span></div><div class="line">    unsafe.write(msg, promise);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æƒ…å†µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, String request)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    ChannelFuture future = ctx.write(response);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">write</span><span class="params">(<span class="keyword">final</span> Object msg, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">	<span class="comment">// ç›´æ¥ä»å½“å‰èŠ‚ç‚¹å†™ï¼Œåé¢å°±å’Œç¬¬ä¸€ç§æƒ…å†µä¸€æ ·äº†</span></div><div class="line">    write(msg, <span class="keyword">false</span>, promise);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.jianshu.com/p/6efa9c5fa702" target="_blank" rel="external">nettyæºç åˆ†æä¹‹pipeline(ä¸€)</a></li>
<li><a href="https://www.jianshu.com/p/087b7e9a27a2" target="_blank" rel="external">nettyæºç åˆ†æä¹‹pipeline(äºŒ)</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šå…¶å®å‰é¢å°±å¤šæ¬¡æåˆ°äº†ChannelPipelineï¼Œä½†æ˜¯éƒ½æ²¡æœ‰è¯¦ç»†è¯´æ˜ChannelPipelineæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å…·ä½“çœ‹çœ‹è¿™ä¸ªç®¡ç†å¤„ç†é€»è¾‘çš„æŠ½è±¡ä»¥åŠå¤„ç†é€»è¾‘çš„æŠ½è±¡ChannelHandlerã€‚
    
    </summary>
    
      <category term="Nettyæºç " scheme="http://bestlixiang.site/categories/Netty%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="Netty" scheme="http://bestlixiang.site/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>Nettyæºç ä¹‹æ–°è¿æ¥æ¥å…¥</title>
    <link href="http://bestlixiang.site/2018/08/06/Netty%E6%BA%90%E7%A0%81/Netty%E6%BA%90%E7%A0%81%E4%B9%8B%E6%96%B0%E8%BF%9E%E6%8E%A5%E6%8E%A5%E5%85%A5/"/>
    <id>http://bestlixiang.site/2018/08/06/Nettyæºç /Nettyæºç ä¹‹æ–°è¿æ¥æ¥å…¥/</id>
    <published>2018-08-06T08:06:57.000Z</published>
    <updated>2018-08-06T08:13:39.318Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šä¹‹å‰å¯¹æœåŠ¡ç«¯å’ŒNioEventLoopéƒ½æœ‰äº†ä¸€å®šçš„åˆ†æï¼Œç›¸ä¿¡å¤§å®¶çš„æœåŠ¡ç«¯åº”è¯¥å·²ç»è™šä½ä»¥å¾…äº†ã€‚å¥½çš„ï¼Œæˆ‘ä»¬ç°åœ¨å°±å¼€å§‹åˆ†æ<strong>æ–°è¿æ¥æ¥å…¥</strong>ã€‚<a id="more"></a></p>
<h1 id="æ–°è¿æ¥æ£€æµ‹"><a href="#æ–°è¿æ¥æ£€æµ‹" class="headerlink" title="æ–°è¿æ¥æ£€æµ‹"></a>æ–°è¿æ¥æ£€æµ‹</h1><p>ç”¨è¿‡NIOçš„äººéƒ½ä¼šçŸ¥é“æ–°è¿æ¥æ£€æµ‹åº”è¯¥åœ¨å¤„ç†selectå‡ºæ¥çš„SelectedKeyä¸­å‡ºç°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä»è¿™å¼€å§‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKey</span><span class="params">(SelectionKey k, AbstractNioChannel ch)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> AbstractNioChannel.NioUnsafe unsafe = ch.unsafe();</div><div class="line">    eventLoop = ch.eventLoop();</div><div class="line">    <span class="keyword">int</span> readyOps = k.readyOps();</div><div class="line">    <span class="keyword">if</span> ((readyOps &amp; SelectionKey.OP_CONNECT) != <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">int</span> ops = k.interestOps();</div><div class="line">        ops &amp;= ~SelectionKey.OP_CONNECT;</div><div class="line">        k.interestOps(ops);</div><div class="line">        unsafe.finishConnect();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> ((readyOps &amp; SelectionKey.OP_WRITE) != <span class="number">0</span>) &#123;</div><div class="line">        ch.unsafe().forceFlush();</div><div class="line">    &#125;</div><div class="line">	<span class="comment">// ä¼šè¿›å…¥åˆ°è¿™é‡Œ(æ¥æ”¶è¿æ¥)</span></div><div class="line">    <span class="keyword">if</span> ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != <span class="number">0</span> || readyOps == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// step 2</span></div><div class="line">        unsafe.read();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2 AbstractNioMessageChannel</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> ChannelConfig config = config();</div><div class="line">    <span class="keyword">final</span> ChannelPipeline pipeline = pipeline();</div><div class="line">    <span class="comment">// æ§åˆ¶è¯»å–è¿æ¥çš„é€Ÿç‡ï¼Œé»˜è®¤ä¸€æ¬¡è¯»å–16ä¸ªè¿æ¥</span></div><div class="line">    <span class="keyword">final</span> RecvByteBufAllocator.Handle allocHandle = unsafe().recvBufAllocHandle();</div><div class="line">    allocHandle.reset(config);</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">        <span class="comment">// step 3</span></div><div class="line">        <span class="keyword">int</span> localRead = doReadMessages(readBuf);</div><div class="line">        <span class="comment">// å¯¹è¿æ¥æ•°å¢åŠ </span></div><div class="line">        allocHandle.incMessagesRead(localRead);</div><div class="line">    &#125; <span class="keyword">while</span> ( allocHandle . continueReading ());</div><div class="line"></div><div class="line">    <span class="keyword">int</span> size = readBuf.size();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">        readPending = <span class="keyword">false</span>;</div><div class="line">        <span class="comment">// è§¦å‘è¯»äº‹ä»¶ï¼Œç»‘å®šåˆ°NioEventLoop</span></div><div class="line">        pipeline.fireChannelRead(readBuf.get(i));</div><div class="line">    &#125;</div><div class="line">    readBuf.clear();</div><div class="line">    allocHandle.readComplete();</div><div class="line">    pipeline.fireChannelReadComplete();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">doReadMessages</span><span class="params">(List &lt; Object &gt; buf)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// ç†Ÿæ‚‰çš„acceptæ–¹æ³•ï¼Œç†Ÿæ‚‰çš„javaChannel()æ‹¿åˆ°serverSocketChannel</span></div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    SocketChannel ch = SocketUtils.accept(javaChannel());</div><div class="line">    <span class="comment">// å°è£…æˆNioSocketChannelï¼Œè¿›å…¥åˆ›å»ºéƒ¨åˆ†</span></div><div class="line">    buf.add(<span class="keyword">new</span> NioSocketChannel(<span class="keyword">this</span>, ch));</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SocketChannel <span class="title">accept</span><span class="params">(<span class="keyword">final</span> ServerSocketChannel serverSocketChannel)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    	<span class="comment">// è¿”å›SocketChannel(æ–°å‡ºæ¥çš„AccessControllerè¿˜éœ€è¦ç ”ç©¶)</span></div><div class="line">        <span class="keyword">return</span> AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedExceptionAction &lt; SocketChannel &gt; () &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> SocketChannel <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">                <span class="keyword">return</span> serverSocketChannel.accept();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ£€æµ‹å®Œæ¯•ï¼ï¼ï¼</p>
<h1 id="åˆ›å»ºChannel"><a href="#åˆ›å»ºChannel" class="headerlink" title="åˆ›å»ºChannel"></a>åˆ›å»ºChannel</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 NioSocketChannel</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioSocketChannel</span><span class="params">(Channel parent, SocketChannel socket)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(parent, socket);</div><div class="line">    <span class="comment">// åŒæ ·åˆ›å»ºä¸€ä¸ªconfigï¼Œè¿™é‡Œè®¾ç½®äº†ç¦æ­¢Nagleç®—æ³•(è®©æ•°æ®å°½å¿«å‘å‡ºå»ï¼Œè€Œä¸æ˜¯è®©å°æ•°æ®åŒ…å˜å¤§å†å‘)</span></div><div class="line">    config = <span class="keyword">new</span> NioSocketChannelConfig(<span class="keyword">this</span>, socket.socket());</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2 AbstractNioByteChannel</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractNioByteChannel</span><span class="params">(Channel parent, SelectableChannel ch)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œè¦å‡†å¤‡ç»‘å®šè¯»äº‹ä»¶äº†</span></div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">super</span>(parent, ch, SelectionKey.OP_READ);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractNioChannel</span><span class="params">(Channel parent, SelectableChannel ch, <span class="keyword">int</span> readInterestOp)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    <span class="keyword">super</span>(parent);</div><div class="line">    <span class="keyword">this</span>.ch = ch;</div><div class="line">    <span class="comment">// è®¾å®šä¸ºå¯¹è¯»äº‹ä»¶æ„Ÿå…´è¶£</span></div><div class="line">    <span class="keyword">this</span>.readInterestOp = readInterestOp;</div><div class="line">	<span class="comment">// è®¾ç½®ä¸ºéé˜»å¡</span></div><div class="line">    ch.configureBlocking(<span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractChannel</span><span class="params">(Channel parent)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.parent = parent;</div><div class="line">    <span class="comment">// ä¹Ÿç»™è‡ªå·±åˆ†é…è¿™äº›ä¸œè¥¿</span></div><div class="line">    id = newId();</div><div class="line">    unsafe = newUnsafe();</div><div class="line">    pipeline = newChannelPipeline();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Channelæ³¨å†Œç»‘å®š"><a href="#Channelæ³¨å†Œç»‘å®š" class="headerlink" title="Channelæ³¨å†Œç»‘å®š"></a>Channelæ³¨å†Œç»‘å®š</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 DefaultChannelPipeline</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">fireChannelRead</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    AbstractChannelHandlerContext.invokeChannelRead(head, msg);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">invokeChannelRead</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext next, Object msg)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, <span class="string">"msg"</span>), next);</div><div class="line">    <span class="comment">// è¿˜æ˜¯é‚£ä¸ªçº¿ç¨‹ç”Ÿæˆå™¨</span></div><div class="line">    EventExecutor executor = next.executor();</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    next.invokeChannelRead(m);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeChannelRead</span><span class="params">(Object msg)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 4 å®ƒä¼šä¸€ç›´è®²äº‹ä»¶ä¼ æ’­åˆ°å†æœåŠ¡ç«¯å¯åŠ¨è¿‡ç¨‹ä¸­æ·»åŠ åˆ°Pipelineçš„ServerBootstrapAcceptor</span></div><div class="line">    ((ChannelInboundHandler) handler()).channelRead(<span class="keyword">this</span>, msg);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4 ServerBootstrapé‡Œçš„ServerBootstrapAcceptor</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Channel child = (Channel) msg;</div><div class="line">	<span class="comment">// è®¾ç½®ä¸€ç³»åˆ—ä¿¡æ¯</span></div><div class="line">    child.pipeline().addLast(childHandler);</div><div class="line">    setChannelOptions(child, childOptions, logger);</div><div class="line">    <span class="keyword">for</span> (Entry &lt; AttributeKey &lt; ?&gt;, Object &gt; e: childAttrs) &#123;</div><div class="line">        child.attr((AttributeKey &lt; Object &gt; ) e.getKey()).set(e.getValue());</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å¿½ç•¥ç»†èŠ‚ï¼Œå…³æ³¨registeræ–¹æ³•(è¿™é‡Œæ˜¯childGroup)</span></div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    childGroup.register(child);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5 MultithreadEventLoopGroup</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">register</span><span class="params">(Channel channel)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œçš„nextæ–¹æ³•ä¼šå»æ‹¿åˆ°ä¹‹å‰ServerChannelåˆå§‹åŒ–çš„EventLoopæ•°ç»„çš„ä¸€ä¸ª</span></div><div class="line">    <span class="comment">// step 6</span></div><div class="line">    <span class="keyword">return</span> next().register(channel);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6 SingleThreadEventLoop</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">register</span><span class="params">(Channel channel)</span> </span>&#123;</div><div class="line">    <span class="comment">// çœ‹åˆ°è¿™é‡Œä¼šå‘ç°æ³¨å†Œæµç¨‹åŸºæœ¬å’ŒServerSocketChanneæ˜¯ä¸€æ ·çš„</span></div><div class="line">    <span class="comment">// step 7</span></div><div class="line">    <span class="keyword">return</span> register(<span class="keyword">new</span> DefaultChannelPromise(channel, <span class="keyword">this</span>));</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">register</span><span class="params">(<span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// çœ‹åˆ°è¿™é‡Œï¼Œå‰©ä¸‹çš„åŸºæœ¬ä¸Šå°±å¯ä»¥å‚è€ƒæœåŠ¡ç«¯å¯åŠ¨æµç¨‹äº†</span></div><div class="line">    promise.channel().unsafe().register(<span class="keyword">this</span>, promise);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li><code>ServerSocketChannel</code>ç»‘å®šçš„EventLoopè½®è¯¢åˆ°æœ‰æ–°çš„è¿æ¥è¿›å…¥</li>
<li>é€šè¿‡å°è£…jdkåº•å±‚çš„channelåˆ›å»º <code>NioSocketChannel</code>ä»¥åŠä¸€ç³»åˆ—çš„nettyæ ¸å¿ƒç»„ä»¶</li>
<li>å°†è¯¥cahnnelé€šè¿‡chooserï¼Œé€‰æ‹©ä¸€ä¸ªEventLoopç»‘å®šä¸Šå»</li>
<li>æ³¨å†Œè¯»äº‹ä»¶ï¼Œå¼€å§‹æ–°è¿æ¥çš„è¯»å†™ï¼ˆå¯ä»¥å‚è€ƒæœåŠ¡ç«¯å¯åŠ¨æµç¨‹ï¼‰</li>
</ol>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.jianshu.com/p/0242b1d4dd21" target="_blank" rel="external">nettyæºç åˆ†æä¹‹æ–°è¿æ¥æ¥å…¥å…¨è§£æ</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šä¹‹å‰å¯¹æœåŠ¡ç«¯å’ŒNioEventLoopéƒ½æœ‰äº†ä¸€å®šçš„åˆ†æï¼Œç›¸ä¿¡å¤§å®¶çš„æœåŠ¡ç«¯åº”è¯¥å·²ç»è™šä½ä»¥å¾…äº†ã€‚å¥½çš„ï¼Œæˆ‘ä»¬ç°åœ¨å°±å¼€å§‹åˆ†æ&lt;strong&gt;æ–°è¿æ¥æ¥å…¥&lt;/strong&gt;ã€‚
    
    </summary>
    
      <category term="Nettyæºç " scheme="http://bestlixiang.site/categories/Netty%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="Netty" scheme="http://bestlixiang.site/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>Nettyæºç ä¹‹NioEventLoop</title>
    <link href="http://bestlixiang.site/2018/08/06/Netty%E6%BA%90%E7%A0%81/Netty%E6%BA%90%E7%A0%81%E4%B9%8BNioEventLoop/"/>
    <id>http://bestlixiang.site/2018/08/06/Nettyæºç /Nettyæºç ä¹‹NioEventLoop/</id>
    <published>2018-08-06T08:06:40.000Z</published>
    <updated>2018-08-06T08:12:39.114Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šè°ˆåˆ°Nettyå°±é¿å…ä¸äº†å»è°ˆReactoræ¨¡å¼ï¼Œä¸æ‡‚çš„åŒå­¦åŒè‡ªè¡Œé¢å‘æœç´¢å¼•æ“ã€‚åœ¨Nettyä¸­çš„Reactorçº¿ç¨‹çš„å…·ä½“å®ç°å°±æ˜¯NioEventLoopã€‚<a id="more"></a></p>
<h1 id="NioEventLoopåˆ›å»º"><a href="#NioEventLoopåˆ›å»º" class="headerlink" title="NioEventLoopåˆ›å»º"></a>NioEventLoopåˆ›å»º</h1><p>æˆ‘ä»¬å…ˆæ€»ç»“è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹ï¼š</p>
<ol>
<li>è®¾ç½®EventLoopæ•°é‡</li>
<li>åˆ›å»ºçº¿ç¨‹åˆ›å»ºå™¨</li>
<li>åˆ›å»ºNioEventLoopï¼ˆé…ç½®selectorå’ŒtaskQueueç­‰å‚æ•°ï¼‰</li>
<li>åˆ›å»ºçº¿ç¨‹é€‰æ‹©å™¨</li>
</ol>
<p>æˆ‘ä»¬å›åˆ°ä¸Šä¸€ä¸ªä¾‹å­çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>); <span class="comment">// ç”¨äºå¤„ç†serverChannel</span></div><div class="line">EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup(); <span class="comment">// ç”¨äºå¤„ç†channel</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿›å…¥åˆ°NioEventLoopGroupçš„æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</div><div class="line">    <span class="comment">// æ²¡æœ‰ä¼ é€’çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸º0</span></div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    <span class="keyword">this</span>(nThreads, (Executor) <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šé»˜è®¤çš„SelectorProvider</span></div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">this</span>(nThreads, executor, SelectorProvider.provider());</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor, <span class="keyword">final</span> SelectorProvider selectorProvider)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šé»˜è®¤çš„Selectorç­–ç•¥å·¥å‚ï¼Œå¯èƒ½select()é˜»å¡æˆ–è€…é‡è¯•</span></div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    <span class="keyword">this</span>(nThreads, executor, selectorProvider, DefaultSelectStrategyFactory.INSTANCE);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor, <span class="keyword">final</span> SelectorProvider selectorProvider, <span class="keyword">final</span> SelectStrategyFactory selectStrategyFactory)</span> </span>&#123;</div><div class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»MultithreadEventLoopGroupæ„é€ æ–¹æ³•ï¼Œç»‘å®šRejectedExecutionHandler(ï¼Ÿï¼Ÿ)</span></div><div class="line">    <span class="comment">// step 6</span></div><div class="line">    <span class="keyword">super</span>(nThreads, executor, selectorProvider, selectStrategyFactory, RejectedExecutionHandlers.reject());</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6 MultithreadEventLoopGroup</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">MultithreadEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor, Object...args)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 7 æŸ¥çœ‹é»˜è®¤çº¿ç¨‹ä¸ªæ•°</span></div><div class="line">    <span class="comment">// step 8</span></div><div class="line">    <span class="keyword">super</span>(nThreads == <span class="number">0</span> ? DEFAULT_EVENT_LOOP_THREADS: nThreads, executor, args);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">    <span class="comment">// æˆ‘ä»¬å‘ç°æ˜¯ä¸¤å€çš„CPUæ ¸æ•°(å½“ç„¶è¿™é‡Œæ˜¯workGroup)</span></div><div class="line">    DEFAULT_EVENT_LOOP_THREADS = Math.max(<span class="number">1</span>, SystemPropertyUtil.getInt(<span class="string">"io.netty.eventLoopThreads"</span>, NettyRuntime.availableProcessors() * <span class="number">2</span>));</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 8</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">MultithreadEventExecutorGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor, Object...args)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šäº†DefaultEventExecutorChooserå·¥å‚(è¯¥å·¥å‚é»˜è®¤è½®è¯¢ç­–ç•¥)</span></div><div class="line">    <span class="comment">// step 9</span></div><div class="line">    <span class="keyword">this</span>(nThreads, executor, DefaultEventExecutorChooserFactory.INSTANCE, args);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 9</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">MultithreadEventExecutorGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor, EventExecutorChooserFactory chooserFactory, Object...args)</span> </span>&#123;</div><div class="line">    <span class="comment">// ** åˆ›å»ºçº¿ç¨‹å™¨ç”Ÿæˆå™¨</span></div><div class="line">    <span class="comment">// step 10</span></div><div class="line">    executor = <span class="keyword">new</span> ThreadPerTaskExecutor(newDefaultThreadFactory());</div><div class="line">    <span class="comment">// äº‹ä»¶æ‰§è¡Œå™¨æ•°ç»„</span></div><div class="line">    children = <span class="keyword">new</span> EventExecutor[nThreads];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nThreads; i++) &#123;  </div><div class="line">        <span class="comment">// ** åˆ›å»º NioEventLoop</span></div><div class="line">        <span class="comment">// step 11</span></div><div class="line">        children[i] = newChild(executor, args);</div><div class="line">    &#125;</div><div class="line">	<span class="comment">// ** åˆ›å»ºçº¿ç¨‹é€‰æ‹©å™¨</span></div><div class="line">    <span class="comment">// step 15</span></div><div class="line">    chooser = chooserFactory.newChooser(children);</div><div class="line">    Set &lt; EventExecutor &gt; childrenSet = <span class="keyword">new</span> LinkedHashSet &lt; EventExecutor &gt; (children.length);</div><div class="line">    Collections.addAll(childrenSet, children);</div><div class="line">    readonlyChildren = Collections.unmodifiableSet(childrenSet);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 10</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPerTaskExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ThreadFactory threadFactory;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPerTaskExecutor</span><span class="params">(ThreadFactory threadFactory)</span> </span>&#123;</div><div class="line">		<span class="comment">// ç»‘å®šçº¿ç¨‹å·¥å‚</span></div><div class="line">        <span class="keyword">this</span>.threadFactory = threadFactory;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</div><div class="line">        threadFactory.newThread(command).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 11</span></div><div class="line"><span class="function"><span class="keyword">protected</span> EventLoop <span class="title">newChild</span><span class="params">(Executor executor, Object...args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šSelectStrategyå’ŒRejectedExecutionHandler</span></div><div class="line">    <span class="comment">// step 12</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> NioEventLoop(<span class="keyword">this</span>, executor, (SelectorProvider) args[<span class="number">0</span>], ((SelectStrategyFactory) args[<span class="number">1</span>]).newSelectStrategy(), (RejectedExecutionHandler) args[<span class="number">2</span>]);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 12 NioEventLoop</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> ioRatio = <span class="number">50</span>;</div><div class="line">NioEventLoop(NioEventLoopGroup parent, Executor executor, SelectorProvider selectorProvider, SelectStrategy strategy, RejectedExecutionHandler rejectedExecutionHandler) &#123;</div><div class="line">    <span class="keyword">super</span>(parent, executor, <span class="keyword">false</span>, DEFAULT_MAX_PENDING_TASKS, rejectedExecutionHandler);</div><div class="line">    <span class="comment">// ä¿å­˜selectorProvider</span></div><div class="line">    provider = selectorProvider;</div><div class="line">    <span class="comment">// è¿™é‡Œåˆ›å»ºselectorï¼Œé‡Œé¢åˆ›å»ºäº†SelectedSelectionKeySet</span></div><div class="line">    <span class="keyword">final</span> SelectorTuple selectorTuple = openSelector();</div><div class="line">    <span class="comment">// ä¿å­˜selector ä¸€ä¸ªselectorä¼šä¸ä¸€ä¸ªEventLoopåšå”¯ä¸€çš„ç»‘å®š</span></div><div class="line">    selector = selectorTuple.selector;</div><div class="line">    <span class="comment">// ä¿å­˜unwrappedSelector(è¿™ä¸ªåœ¨å‰ä¸€ç¯‡åšæ–‡çš„æ—¶å€™ç”¨åˆ°äº†)</span></div><div class="line">    unwrappedSelector = selectorTuple.unwrappedSelector;</div><div class="line">    selectStrategy = strategy;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 13 SingleThreadEventLoop</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">SingleThreadEventLoop</span><span class="params">(EventLoopGroup parent, Executor executor, <span class="keyword">boolean</span> addTaskWakesUp, <span class="keyword">int</span> maxPendingTasks, RejectedExecutionHandler rejectedExecutionHandler)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 14</span></div><div class="line">    <span class="keyword">super</span>(parent, executor, addTaskWakesUp, maxPendingTasks, rejectedExecutionHandler);</div><div class="line">    <span class="comment">// ä¿å­˜äº†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—</span></div><div class="line">    tailTasks = newTaskQueue(maxPendingTasks);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 14 SingleThreadEventExecutor</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">SingleThreadEventExecutor</span><span class="params">(EventExecutorGroup parent, Executor executor, <span class="keyword">boolean</span> addTaskWakesUp, <span class="keyword">int</span> maxPendingTasks, RejectedExecutionHandler rejectedHandler)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(parent);</div><div class="line">    <span class="keyword">this</span>.addTaskWakesUp = addTaskWakesUp;</div><div class="line">    <span class="keyword">this</span>.maxPendingTasks = Math.max(<span class="number">16</span>, maxPendingTasks);</div><div class="line">    <span class="comment">// ä¿å­˜ çº¿ç¨‹å™¨ç”Ÿæˆå™¨</span></div><div class="line">    <span class="keyword">this</span>.executor = ObjectUtil.checkNotNull(executor, <span class="string">"executor"</span>);</div><div class="line">    <span class="comment">// ä»»åŠ¡é˜Ÿåˆ—</span></div><div class="line">    taskQueue = newTaskQueue(<span class="keyword">this</span>.maxPendingTasks);</div><div class="line">    rejectedExecutionHandler = ObjectUtil.checkNotNull(rejectedHandler, <span class="string">"rejectedHandler"</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 15</span></div><div class="line"><span class="function"><span class="keyword">public</span> EventExecutorChooser <span class="title">newChooser</span><span class="params">(EventExecutor[] executors)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œæ ¹æ®eventLoopçš„ä¸ªæ•°è¿›è¡Œäº†ä¼˜åŒ–(è‡ªè¡Œäº†è§£)</span></div><div class="line">    <span class="keyword">if</span> (isPowerOfTwo(executors.length)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PowerOfTwoEventExecutorChooser(executors);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> GenericEventExecutorChooser(executors);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ›å»ºå®Œæˆï¼ï¼ï¼</p>
<h1 id="NioEventLoopå¯åŠ¨"><a href="#NioEventLoopå¯åŠ¨" class="headerlink" title="NioEventLoopå¯åŠ¨"></a>NioEventLoopå¯åŠ¨</h1><p>å®ƒçš„ç¬¬ä¸€æ¬¡å¯åŠ¨è¿˜æ˜¯è¦å›åˆ°å‰ä¸€ç¯‡åšæ–‡çš„è¿™ä¸€ä¸ªæ­¥éª¤ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 AbstractBootstrap</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(EventLoop eventLoop, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line"> 	<span class="comment">// æ‹¿åˆ°ä¹‹å‰ç»‘å®šçš„eventLoop</span></div><div class="line">    AbstractChannel.<span class="keyword">this</span>.eventLoop = eventLoop;</div><div class="line">    <span class="comment">// step 2 è¿›å…¥inEventLoopæ–¹æ³•ä¸­</span></div><div class="line">    <span class="keyword">if</span> (eventLoop.inEventLoop()) &#123;</div><div class="line">        register0(promise);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// æ‰€ä»¥è¿›å…¥è¿™é‡Œäº†</span></div><div class="line">        <span class="comment">// step 4</span></div><div class="line">        eventLoop.execute(<span class="keyword">new</span> Runnable() &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                register0(promise);</div><div class="line">              &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2 AbstractEventExecutor</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">inEventLoop</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™ä¸ªæ—¶å€™å½“å‰çº¿ç¨‹ä¸ºä¸»çº¿ç¨‹</span></div><div class="line">    <span class="comment">// step 3     </span></div><div class="line">    <span class="keyword">return</span> inEventLoop(Thread.currentThread());</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3 SingleThreadEventExecutor</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">inEventLoop</span><span class="params">(Thread thread)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¯¥ç±»ä¸­çš„threadä¸ºnullï¼Œæ‰€æœ‰è¿”å›false</span></div><div class="line">    <span class="keyword">return</span> thread == <span class="keyword">this</span>.thread;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿˜æ˜¯ä¸»çº¿ç¨‹ï¼Œè¿˜æ˜¯false</span></div><div class="line">    <span class="keyword">boolean</span> inEventLoop = inEventLoop();</div><div class="line">    <span class="comment">// å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—</span></div><div class="line">    addTask(task);</div><div class="line">    <span class="keyword">if</span> (!inEventLoop) &#123;</div><div class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></div><div class="line">        <span class="comment">// step 4</span></div><div class="line">        startThread();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!addTaskWakesUp &amp;&amp; wakesUpForTask(task)) &#123;</div><div class="line">        wakeup(inEventLoop);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startThread</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// state é»˜è®¤ä¸ºST_NOT_STARTEDæ²¡æœ‰å¯åŠ¨</span></div><div class="line">    <span class="keyword">if</span> (state == ST_NOT_STARTED) &#123;</div><div class="line">        <span class="comment">// åŸå­æ›´æ–°ä¸ºå¼€å§‹</span></div><div class="line">        <span class="keyword">if</span> (STATE_UPDATER.compareAndSet(<span class="keyword">this</span>, ST_NOT_STARTED, ST_STARTED)) &#123;</div><div class="line">            <span class="comment">// step 5</span></div><div class="line">            doStartThread();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doStartThread</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿˜è®°å¾—é‚£ä¸ªexecutorå—ï¼Œå°±æ˜¯é‚£ä¸ªçº¿ç¨‹ç”Ÿæˆå™¨</span></div><div class="line">    <span class="comment">// step 6</span></div><div class="line">    executor.execute(<span class="keyword">new</span> Runnable() &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            thread = Thread.currentThread();</div><div class="line">        	<span class="comment">// æ‰§è¡Œè‡ªå·±çš„runæ–¹æ³•</span></div><div class="line">        	<span class="comment">// step 8</span></div><div class="line">            SingleThreadEventExecutor.<span class="keyword">this</span>.run();            </div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6 ThreadPerTaskExecutor</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</div><div class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹å¹¶å¼€å¯çº¿ç¨‹</span></div><div class="line">    <span class="comment">// step 7 newThread()</span></div><div class="line">    <span class="comment">// start() è¿”å›åˆ°run() step 6</span></div><div class="line">    threadFactory.newThread(command).start();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™é‡Œå¯ä»¥çœ‹å‡ºä¸¤ç‚¹ï¼Œ1ï¼Œè¿”å›äº†ä¸€ä¸ªä¼˜åŒ–è¿‡çš„FastThreadLocalRunnableï¼›2ï¼Œçœ‹åˆ°äº†çº¿ç¨‹å</span></div><div class="line">    <span class="comment">// çº¿ç¨‹åçš„ç”±æ¥å¯ä»¥ç™¾åº¦</span></div><div class="line">    Thread t = newThread(FastThreadLocalRunnable.wrap(r), prefix + nextId.incrementAndGet());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯åŠ¨å®Œæ¯•äº†ï¼ï¼ï¼</p>
<h1 id="NioEventLoopæ‰§è¡Œ"><a href="#NioEventLoopæ‰§è¡Œ" class="headerlink" title="NioEventLoopæ‰§è¡Œ"></a>NioEventLoopæ‰§è¡Œ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 è¿™é‡Œå°±æ˜¯çœŸçš„reactorçº¿ç¨‹çœŸæ­£å¼€å§‹å¹²æ´»çš„åœ°æ–¹</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// æ­»å¾ªç¯ï¼Œå¹²ä¸‰ä»¶äº‹</span></div><div class="line">    <span class="comment">// 1. select</span></div><div class="line">    <span class="comment">// 2. process selected keys</span></div><div class="line">    <span class="comment">// 3. run tasks</span></div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// è¿˜æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œç­‰ç€ï¼Œæ²¡æœ‰äº†ï¼Œå°±å¼€å§‹select</span></div><div class="line">            <span class="keyword">switch</span> (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123;</div><div class="line">            <span class="keyword">case</span> SelectStrategy.CONTINUE:</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">case</span> SelectStrategy.SELECT:</div><div class="line">                <span class="comment">// 1. è½®è¯¢æ³¨å†Œåˆ°EventLoopçš„Selectorä¸Šçš„æ‰€æœ‰channelIOäº‹ä»¶</span></div><div class="line">                <span class="comment">// wakenUp è¡¨ç¤ºæ˜¯å¦åº”è¯¥å”¤é†’æ­£åœ¨é˜»å¡çš„selectæ“ä½œï¼Œæ¯æ¬¡å¼€å§‹éƒ½ç½®ä¸ºfalse</span></div><div class="line">                <span class="comment">// step 2</span></div><div class="line">                select(wakenUp.getAndSet(<span class="keyword">false</span>));</div><div class="line">                <span class="keyword">if</span> (wakenUp.get()) &#123;</div><div class="line">                    selector.wakeup();</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// fall through</span></div><div class="line">            <span class="keyword">default</span>:</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 2. å¤„ç†äº§ç”ŸIOäº‹ä»¶çš„channel</span></div><div class="line">            <span class="comment">// step 3</span></div><div class="line">            processSelectedKeys();</div><div class="line">            <span class="comment">// 3. å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡ä¸€ä¸ªæ—¶é—´</span></div><div class="line">            <span class="comment">// step 8</span></div><div class="line">            runAllTasks(ioTime * (<span class="number">100</span> - ioRatio) / ioRatio);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;    </div><div class="line"></div><div class="line"><span class="comment">// step 2 è½®è¯¢æ³¨å†Œåˆ°EventLoopçš„Selectorä¸Šçš„æ‰€æœ‰channelIOäº‹ä»¶</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">(<span class="keyword">boolean</span> oldWakenUp)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    Selector selector = <span class="keyword">this</span>.selector;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">int</span> selectCnt = <span class="number">0</span>;</div><div class="line">        <span class="keyword">long</span> currentTimeNanos = System.nanoTime();</div><div class="line">        <span class="comment">// è®¾ç½®æˆªæ­¢æ—¶é—´(å½“å‰æ—¶é—´ + å®šæ—¶ä»»åŠ¡çš„å°†è¦æˆªæ­¢çš„æ—¶é—´)</span></div><div class="line">        <span class="comment">// nettyé‡Œé¢å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—æ˜¯æŒ‰ç…§å»¶è¿Ÿæ—¶é—´ä»å°åˆ°å¤§è¿›è¡Œæ’åº</span></div><div class="line">       	<span class="comment">// delayNanos(currentTimeNanos)æ–¹æ³•å³å–å‡ºç¬¬ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„å»¶è¿Ÿæ—¶é—´</span></div><div class="line">        <span class="keyword">long</span> selectDeadLineNanos = currentTimeNanos + delayNanos(currentTimeNanos);</div><div class="line">        <span class="keyword">for</span> (;;) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">long</span> timeoutMillis = (selectDeadLineNanos - currentTimeNanos + <span class="number">500000L</span>) / <span class="number">1000000L</span>;</div><div class="line">            <span class="comment">// å¦‚æœè¶…å‡ºæˆªæ­¢æ—¶é—´0.5ms</span></div><div class="line">            <span class="keyword">if</span> (timeoutMillis &lt;= <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">if</span> (selectCnt == <span class="number">0</span>) &#123;</div><div class="line">                    <span class="comment">// å¦‚æœåœ¨è·³å‡ºä¹‹å‰å‘ç°è¿˜æ²¡æœ‰è¿›è¡Œè¿‡selectæ“ä½œå°±æ‰§è¡Œä¸€æ¬¡selectNow()(ä¸ä¼šé˜»å¡)</span></div><div class="line">                    selector.selectNow();</div><div class="line">                    selectCnt = <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// è½®è¯¢è¿‡ç¨‹ä¸­å‘ç°æœ‰ä»»åŠ¡åŠ å…¥ï¼Œä¸­æ–­æœ¬æ¬¡è½®è¯¢</span></div><div class="line">            <span class="keyword">if</span> (hasTasks() &amp;&amp; wakenUp.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>)) &#123;</div><div class="line">                selector.selectNow();</div><div class="line">                selectCnt = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">			<span class="comment">// é˜»å¡æ—¶è½®è¯¢</span></div><div class="line">            <span class="keyword">int</span> selectedKeys = selector.select(timeoutMillis);</div><div class="line">            selectCnt++;</div><div class="line">            <span class="keyword">if</span> (selectedKeys != <span class="number">0</span> || oldWakenUp || wakenUp.get() || hasTasks() || hasScheduledTasks()) &#123;</div><div class="line">                <span class="comment">// è¿™é‡Œè¿˜æä¾›äº†4ç§æ–¹å¼æ¥ä¸­æ–­è½®è¯¢</span></div><div class="line">                <span class="comment">// - è½®è¯¢åˆ°ioäº‹ä»¶,</span></div><div class="line">                <span class="comment">// - ç”¨æˆ·ä¸»åŠ¨å”¤é†’</span></div><div class="line">                <span class="comment">// - ä»»åŠ¡é˜Ÿåˆ—æœ‰ä»»åŠ¡</span></div><div class="line">                <span class="comment">// - æœ‰å®šæ—¶ä»»åŠ¡éœ€è¦è¢«å¤„ç†</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;            </div><div class="line">			<span class="comment">// è¿™é‡Œå°±å¾ˆé‡è¦äº†ï¼Œçœ‹çœ‹Nettyæ˜¯æ€ä¹ˆè§£å†³JDK NIOçš„ç©ºè½®è®­bugçš„</span></div><div class="line">            <span class="keyword">long</span> time = System.nanoTime();</div><div class="line">            <span class="keyword">if</span> (time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) &gt;= currentTimeNanos) &#123;</div><div class="line">                <span class="comment">// æœ‰æ•ˆè½®è¯¢ï¼Œé‡ç½®æ ‡å¿—ä½</span></div><div class="line">                selectCnt = <span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (SELECTOR_AUTO_REBUILD_THRESHOLD &gt; <span class="number">0</span> &amp;&amp; selectCnt &gt;= SELECTOR_AUTO_REBUILD_THRESHOLD) &#123;</div><div class="line">				<span class="comment">// å½“ç©ºè½®è®­çš„æ¬¡æ•°è¶…è¿‡SELECTOR_AUTO_REBUILD_THRESHOLD(é»˜è®¤512)æ—¶ï¼Œå°±å¼€å§‹é‡å»ºSelector</span></div><div class="line">                <span class="comment">// step 3</span></div><div class="line">                rebuildSelector();</div><div class="line">                selector = <span class="keyword">this</span>.selector;</div><div class="line">                <span class="comment">// Select again to populate selectedKeys.</span></div><div class="line">                selector.selectNow();</div><div class="line">                selectCnt = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            currentTimeNanos = time;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;      </div><div class="line"></div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rebuildSelector</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    rebuildSelector0();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rebuildSelector0</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Selector oldSelector = selector;</div><div class="line">    <span class="keyword">final</span> SelectorTuple newSelectorTuple;</div><div class="line">	<span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„selector</span></div><div class="line">    newSelectorTuple = openSelector();</div><div class="line">    <span class="keyword">int</span> nChannels = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (SelectionKey key: oldSelector.keys()) &#123;</div><div class="line">        Object a = key.attachment();</div><div class="line">		<span class="keyword">int</span> interestOps = key.interestOps();</div><div class="line">        <span class="comment">// å–æ¶ˆkeyåœ¨æ—§çš„selectorä¸Šçš„äº‹ä»¶æ³¨å†Œ</span></div><div class="line">		key.cancel();</div><div class="line">		<span class="comment">// å°†æ‰€æœ‰channelé‡æ–°æ³¨å†Œåˆ°æ–°çš„selectorä¸Š</span></div><div class="line">		SelectionKeynewKey = key.channel().register(newSelectorTuple.unwrappedSelector, 		interestOps, a);</div><div class="line">		nChannels++;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// eventLoopç»‘å®šæ–°çš„seletor</span></div><div class="line">    selector = newSelectorTuple.selector;</div><div class="line">    unwrappedSelector = newSelectorTuple.unwrappedSelector;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKeys</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// å¯å®šä¸ä¸ºç©ºï¼Œå› ä¸ºåœ¨NioEventLoop çš„ openSelectoræ–¹æ³•ä¸­åˆ›å»ºäº†</span></div><div class="line">    <span class="keyword">if</span> (selectedKeys != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// ä¸ºä»€ä¹ˆè¯´SelectedKeysæ˜¯ä¼˜åŒ–è¿‡çš„ï¼Œæ˜¯å› ä¸ºåŸç”Ÿçš„SelectedKeysæ˜¯Setï¼Œæ·»åŠ ä¸€ä¸ªäº‹ä»¶ä¸ºO(logn)</span></div><div class="line">        <span class="comment">// ä¼˜åŒ–è¿‡åä½¿ç”¨æ•°ç»„æ¥æ“ä½œï¼Œæ·»åŠ ä¸€ä¸ªäº‹ä»¶ä¸ºO(1)</span></div><div class="line">        <span class="comment">// å…·ä½“çš„å¯ä»¥å‚è€ƒé—ªç”µä¾ çš„åšå®¢ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¤šè¯´äº†</span></div><div class="line">        <span class="comment">// step 6</span></div><div class="line">        processSelectedKeysOptimized();</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        processSelectedKeysPlain(selector.selectedKeys());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKeysOptimized</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; selectedKeys.size; ++i) &#123;</div><div class="line">        <span class="keyword">final</span> SelectionKey k = selectedKeys.keys[i];</div><div class="line">        <span class="comment">// è®©å¯¹è±¡å¯ä»¥è¢«GC</span></div><div class="line">        selectedKeys.keys[i] = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">final</span> Object a = k.attachment();</div><div class="line">        <span class="keyword">if</span> (a <span class="keyword">instanceof</span> AbstractNioChannel) &#123;</div><div class="line">            <span class="comment">// æ‹¿åˆ°æºå¸¦çš„channel</span></div><div class="line">            <span class="comment">// step 7</span></div><div class="line">            processSelectedKey(k, (AbstractNioChannel) a);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) NioTask &lt; SelectableChannel &gt; task = (NioTask &lt; SelectableChannel &gt; ) a;</div><div class="line">            processSelectedKey(k, task);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (needsToSelectAgain) &#123;</div><div class="line">            selectedKeys.reset(i + <span class="number">1</span>);</div><div class="line"></div><div class="line">            selectAgain();</div><div class="line">            i = -<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKey</span><span class="params">(SelectionKey k, AbstractNioChannel ch)</span> </span>&#123;</div><div class="line">    <span class="comment">// æ‹¿åˆ°NioEventLoopçš„Unsafeå¯¹è±¡</span></div><div class="line">    <span class="keyword">final</span> AbstractNioChannel.NioUnsafe unsafe = ch.unsafe();</div><div class="line">    <span class="comment">// æ‹¿åˆ°NioEventLoopçš„eventLoopå¯¹è±¡</span></div><div class="line">    eventLoop = ch.eventLoop();</div><div class="line">    <span class="comment">// æ‹¿åˆ°äº‹ä»¶</span></div><div class="line">    <span class="keyword">int</span> readyOps = k.readyOps();</div><div class="line">    <span class="comment">// è¿æ¥äº‹ä»¶å¤„ç†</span></div><div class="line">    <span class="keyword">if</span> ((readyOps &amp; SelectionKey.OP_CONNECT) != <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">int</span> ops = k.interestOps();</div><div class="line">        <span class="comment">// è·å¾—æ„Ÿå…´è¶£çš„äº‹ä»¶</span></div><div class="line">        ops &amp;= ~SelectionKey.OP_CONNECT;</div><div class="line">        <span class="comment">// é‡æ–°æ³¨å†Œ</span></div><div class="line">        k.interestOps(ops);</div><div class="line">        <span class="comment">// å®Œæˆé“¾æ¥</span></div><div class="line">        unsafe.finishConnect();</div><div class="line">    &#125;</div><div class="line">	<span class="comment">// å†™äº‹ä»¶å¤„ç†</span></div><div class="line">    <span class="keyword">if</span> ((readyOps &amp; SelectionKey.OP_WRITE) != <span class="number">0</span>) &#123;</div><div class="line">        ch.unsafe().forceFlush();</div><div class="line">    &#125;</div><div class="line">	<span class="comment">// è¯»äº‹ä»¶(work)æˆ–è€…å»ºç«‹è¿æ¥äº‹ä»¶ï¼ˆbossï¼‰å¤„ç†</span></div><div class="line">    <span class="keyword">if</span> ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != <span class="number">0</span> || readyOps == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// éƒ½æ˜¯readæ–¹æ³•ï¼Œåªæ˜¯å®ç°ä¸åŒ</span></div><div class="line">        unsafe.read();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 8 å¤„ç†ä»»åŠ¡é˜Ÿåˆ—</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">runAllTasks</span><span class="params">(<span class="keyword">long</span> timeoutNanos)</span> </span>&#123;</div><div class="line">    <span class="comment">// å°†å®šæ—¶ä»»åŠ¡æ”¾å…¥æ™®é€šä»»åŠ¡é˜Ÿåˆ—(å®ƒæ˜¯ä¸€ä¸ªå¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…é˜Ÿåˆ—)</span></div><div class="line">    <span class="comment">// step 9</span></div><div class="line">    fetchFromScheduledTaskQueue();</div><div class="line">    <span class="comment">// æ‹¿å‡ºä¸€ä¸ªæ™®é€šä»»åŠ¡</span></div><div class="line">    Runnable task = pollTask();</div><div class="line">    <span class="keyword">if</span> (task == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// è¿è¡Œæ”¶å°¾ä»»åŠ¡é˜Ÿåˆ—tailTasks</span></div><div class="line">        afterRunningAllTasks();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// è®¡ç®—å‡ºæœ¬æ¬¡å¾ªç¯çš„èƒ½å¤Ÿè¿è¡Œçš„æœ€å¤šæ—¶é—´</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">long</span> deadline = ScheduledFutureTask.nanoTime() + timeoutNanos;</div><div class="line">    <span class="keyword">long</span> runTasks = <span class="number">0</span>;</div><div class="line">    <span class="keyword">long</span> lastExecutionTime;</div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        <span class="comment">// æ‰§è¡Œä»»åŠ¡(è¿™é‡Œä¸€å®šè¦å¤šè°ƒè¯•å‡ æ¬¡æ‰ä¼šæœ‰æ„Ÿè§‰ï¼Œä»»åŠ¡é˜Ÿåˆ—çš„æ„Ÿè§‰ä¸€ä¸‹å­å°±å‡ºæ¥äº†)</span></div><div class="line">        <span class="comment">// step 10</span></div><div class="line">        safeExecute(task);</div><div class="line">        runTasks++;</div><div class="line">        <span class="comment">// ç”±äºScheduledFutureTask.nanoTime()æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥æ²¡64æ¬¡æ¯”è¾ƒä¸€æ¬¡æ˜¯å¦è¶…æ—¶</span></div><div class="line">        <span class="keyword">if</span> ((runTasks &amp; <span class="number">0x3F</span>) == <span class="number">0</span>) &#123;</div><div class="line">            lastExecutionTime = ScheduledFutureTask.nanoTime();</div><div class="line">            <span class="keyword">if</span> (lastExecutionTime &gt;= deadline) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        task = pollTask();</div><div class="line">        <span class="keyword">if</span> (task == <span class="keyword">null</span>) &#123;</div><div class="line">            lastExecutionTime = ScheduledFutureTask.nanoTime();</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    afterRunningAllTasks();</div><div class="line">    <span class="keyword">this</span>.lastExecutionTime = lastExecutionTime;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 9</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">fetchFromScheduledTaskQueue</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> nanoTime = AbstractScheduledEventExecutor.nanoTime();</div><div class="line">    <span class="comment">// å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå¹¶ä¸”ä»»åŠ¡å®ç°äº†compareToæ–¹æ³•ï¼Œå¯ä»¥è¿”å›å¿«éœ€è¦è¢«æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡</span></div><div class="line">    Runnable scheduledTask = pollScheduledTask(nanoTime);</div><div class="line">    <span class="keyword">while</span> (scheduledTask != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (!taskQueue.offer(scheduledTask)) &#123;</div><div class="line">			<span class="comment">// å¦‚æœæ™®é€šé˜Ÿåˆ—æ»¡äº†ï¼Œå°±åˆæ”¾å›å»</span></div><div class="line">            scheduledTaskQueue().add((ScheduledFutureTask &lt; ?&gt;) scheduledTask);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// æ‹¿åˆ°å®šæ—¶ä»»åŠ¡</span></div><div class="line">        scheduledTask = pollScheduledTask(nanoTime);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 10</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">safeExecute</span><span class="params">(Runnable task)</span> </span>&#123;</div><div class="line">    <span class="comment">// å°±åªæ˜¯è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯ä¸€ä¸ªå‡ºé”™äº†ï¼Œä¹Ÿä¼šç»§ç»­è¿›è¡Œä¸‹å»</span></div><div class="line">   	task.run();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰§è¡Œå®Œæ¯•ï¼ï¼ï¼</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è™½ç„¶è¿˜æ˜¯æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰è°ƒè¯•åˆ°ï¼Œä½†æ˜¯å¤§æ¦‚çš„æµç¨‹åº”è¯¥éƒ½èµ°äº†ä¸€éï¼Œå¸Œæœ›å¤šè°ƒè¯•ï¼Œç„¶åæ‰ä¼šæ·±æ„ŸEventLoopçš„åŠï¼ï¼</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.jianshu.com/p/0d0eece6d467" target="_blank" rel="external">nettyæºç åˆ†æä¹‹æ­å¼€reactorçº¿ç¨‹çš„é¢çº±ï¼ˆä¸€ï¼‰</a></li>
<li><a href="https://www.jianshu.com/p/467a9b41833e" target="_blank" rel="external">nettyæºç åˆ†æä¹‹æ­å¼€reactorçº¿ç¨‹çš„é¢çº±ï¼ˆäºŒï¼‰</a></li>
<li><a href="https://www.jianshu.com/p/58fad8e42379" target="_blank" rel="external">nettyæºç åˆ†æä¹‹æ­å¼€reactorçº¿ç¨‹çš„é¢çº±ï¼ˆä¸‰ï¼‰</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šè°ˆåˆ°Nettyå°±é¿å…ä¸äº†å»è°ˆReactoræ¨¡å¼ï¼Œä¸æ‡‚çš„åŒå­¦åŒè‡ªè¡Œé¢å‘æœç´¢å¼•æ“ã€‚åœ¨Nettyä¸­çš„Reactorçº¿ç¨‹çš„å…·ä½“å®ç°å°±æ˜¯NioEventLoopã€‚
    
    </summary>
    
      <category term="Nettyæºç " scheme="http://bestlixiang.site/categories/Netty%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="Netty" scheme="http://bestlixiang.site/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>Nettyæºç ä¹‹æœåŠ¡ç«¯å¯åŠ¨</title>
    <link href="http://bestlixiang.site/2018/08/06/Netty%E6%BA%90%E7%A0%81/Netty%E6%BA%90%E7%A0%81%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8/"/>
    <id>http://bestlixiang.site/2018/08/06/Nettyæºç /Nettyæºç ä¹‹æœåŠ¡ç«¯å¯åŠ¨/</id>
    <published>2018-08-06T08:05:45.000Z</published>
    <updated>2018-08-06T08:17:52.344Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šNettyå¯åŠ¨å•¦ï¼å¼€å¿ƒè„¸ï¼ä½†æ˜¯è¿™åˆå¯èƒ½æ˜¯ä¸€ç¯‡åˆè‡­åˆé•¿ç”±ç»•çš„æ–‡ç« ï¼Œéœ€è¦ç‚¹è€å¿ƒï¼Œéœ€è¦ç‚¹åŠ¨æ‰‹èƒ½åŠ›ã€‚æ— å¥ˆè„¸ï¼ï¼ï¼<a id="more"></a></p>
<h1 id="Netty-Example"><a href="#Netty-Example" class="headerlink" title="Netty Example"></a>Netty Example</h1><p>æˆ‘é€‰æ‹©äº†Nettyæºç ä¸­çš„EchoServeræ¥ä½œä¸ºä¾‹å­ï¼Œå®ƒåœ¨<code>io.netty.example.echo</code>åŒ…ä¸‹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼ˆå¿½ç•¥ç»†èŠ‚ï¼Œä¸“æ³¨æ ¸å¿ƒï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PORT = Integer.parseInt(System.getProperty(<span class="string">"port"</span>, <span class="string">"8007"</span>));</div><div class="line">        <span class="comment">// é…ç½®Serverç«¯</span></div><div class="line">        <span class="comment">// AbstractBootstrapçš„group</span></div><div class="line">        EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</div><div class="line">        <span class="comment">// ServerBootstrapçš„childGroup</span></div><div class="line">        EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</div><div class="line">        <span class="keyword">final</span> EchoServerHandler serverHandler = <span class="keyword">new</span> EchoServerHandler();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// åœ¨å®ƒåˆ›å»ºçš„è¿‡ç¨‹ä¸­ä¼šç»‘å®šä¸€ä¸ªServerBootstrapConfigä¿å­˜å®ƒçš„å±æ€§</span></div><div class="line">            ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</div><div class="line">            <span class="comment">// æ–¹æ³•é“¾é…ç½®ç±»ï¼Œå¯ä»¥å­¦ä¹ </span></div><div class="line">            <span class="comment">// æœåŠ¡ç«¯çš„Bootstrapæ‰æœ‰ä¸¤ä¸ªå‚æ•°çš„groupæ–¹æ³•</span></div><div class="line">            b.group(bossGroup, workerGroup)</div><div class="line">                <span class="comment">// è®¾ç½®AbstractBootstrapçš„channelFactoryå‚æ•°</span></div><div class="line">             .channel(NioServerSocketChannel.class)</div><div class="line">                <span class="comment">// è®¾ç½®AbstractBootstrapçš„optionså‚æ•°(å¸¸é‡æ± å®ç°ï¼ŒConcurrentMap),å¯ä»¥å­¦ä¹ </span></div><div class="line">             .option(ChannelOption.SO_BACKLOG, <span class="number">100</span>)</div><div class="line">                <span class="comment">// è®¾ç½®AbstractBootstrapçš„handlerå‚æ•°ï¼Œè¿™é‡Œé…ç½®äº†ä¸€ä¸ªæ—¥å¿—å¤„ç†ç±»</span></div><div class="line">             .handler(<span class="keyword">new</span> LoggingHandler(LogLevel.INFO))</div><div class="line">                <span class="comment">// è®¾ç½®ServerBootstrapçš„childHandlerå‚æ•°</span></div><div class="line">             .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</div><div class="line">                 <span class="meta">@Override</span></div><div class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                     ChannelPipeline p = ch.pipeline();</div><div class="line">                     p.addLast(serverHandler);</div><div class="line">                 &#125;</div><div class="line">             &#125;);</div><div class="line">			<span class="comment">// æœåŠ¡ç«¯å¯åŠ¨(ä¸€åˆ‡åˆ†æçš„æºå¤´)</span></div><div class="line">            ChannelFuture f = b.bind(PORT).sync();</div><div class="line">            <span class="comment">// ç­‰å¾…æœåŠ¡ç«¯å…³é—­socket</span></div><div class="line">            f.channel().closeFuture().sync();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="comment">// ä¼˜é›…å…³é—­ä¸¤ç»„æ­»å¾ªç¯</span></div><div class="line">            bossGroup.shutdownGracefully();</div><div class="line">            workerGroup.shutdownGracefully();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><p>ä¸Šé¢çš„ä¾‹å­çš„æ³¨é‡Šå·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œåœ¨å¯åŠ¨ä¹‹å‰ä¸»è¦å°±æ˜¯åœ¨é…ç½®å¯åŠ¨ç±»ServerBootstrapã€‚ç°åœ¨æˆ‘å°±ä¸‹é¢çš„å¯åŠ¨æ–¹æ³•å¼€å§‹æ·±å…¥åˆ†æ(debugï¼Œä»£ç å±•ç¤ºä¼šå¿½ç•¥ç»†èŠ‚)ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ChannelFuture f = b.bind(PORT).sync();</div></pre></td></tr></table></figure>
<h2 id="Bootstrapç›¸å…³"><a href="#Bootstrapç›¸å…³" class="headerlink" title="Bootstrapç›¸å…³"></a>Bootstrapç›¸å…³</h2><p>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸ªç±»å¹²äº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">bind</span><span class="params">(<span class="keyword">int</span> inetPort)</span> </span>&#123;</div><div class="line">    <span class="comment">// é€šè¿‡ç«¯å£ç”Ÿæˆä¸€ä¸ªInetSocketAddress</span></div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    <span class="keyword">return</span> bind(<span class="keyword">new</span> InetSocketAddress(inetPort));</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">bind</span><span class="params">(SocketAddress localAddress)</span> </span>&#123;</div><div class="line">    <span class="comment">// éªŒè¯groupå’ŒchannelFactoryæ˜¯å¦ä¼ è¿›æ¥äº†</span></div><div class="line">    validate();</div><div class="line">    <span class="comment">// éç©ºåˆ¤æ–­ï¼Œè¿™é‡Œåªè¯´ä¸€æ¬¡ï¼Œå¤§çš„å·¥ç¨‹é¡¹ç›®ï¼Œå¿…é¡»é€šè¿‡é˜²å¾¡æ€§ç¼–ç¨‹æ¥å¢å¼ºé²æ£’æ€§</span></div><div class="line">    <span class="keyword">if</span> (localAddress == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"localAddress"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">return</span> doBind(localAddress);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">private</span> ChannelFuture <span class="title">doBind</span><span class="params">(<span class="keyword">final</span> SocketAddress localAddress)</span> </span>&#123;</div><div class="line">    <span class="comment">// åˆå§‹åŒ–serverChannelï¼Œå¹¶å°†eventloopæ³¨å†Œåˆ°serverChannelä¸Š</span></div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    <span class="keyword">final</span> ChannelFuture regFuture = initAndRegister();</div><div class="line">    <span class="comment">// è·å–åˆšåˆšåˆ›å»ºçš„serverChannelï¼Œç”±äºä¹‹åéƒ½ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨finalä¿®é¥°</span></div><div class="line">    <span class="keyword">final</span> Channel channel = regFuture.channel();</div><div class="line">    <span class="comment">// ç»‘å®šåœ°å€</span></div><div class="line">	doBind0(regFuture, channel, localAddress, promise);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">final</span> ChannelFuture <span class="title">initAndRegister</span><span class="params">()</span> </span>&#123;</div><div class="line">    Channel channel = <span class="keyword">null</span>;</div><div class="line">    <span class="comment">// ç”Ÿæˆä¸€ä¸ªserverChannel</span></div><div class="line">    <span class="comment">// è¿™é‡Œçš„channelFactoryæˆ‘ä»¬åœ¨ä¾‹å­ä»‹ç»è¿‡ï¼Œå…¶å®å°±æ˜¯åœ¨å·¥å‚ä¸­åˆ©ç”¨åå°„ç”Ÿæˆå¯¹åº”çš„channel</span></div><div class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨NioServerSocketChannelç±»ä¸­åˆ†æå®ƒæ„é€ æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ(å¯ä»¥ç›´æ¥è·³è¿‡å»çœ‹)</span></div><div class="line">    channel = channelFactory.newChannel();</div><div class="line">    <span class="comment">// åˆå§‹åŒ–serverChannel</span></div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    init(channel);</div><div class="line">    <span class="comment">// config().group()å°±æ˜¯é€šè¿‡ServerBootstrapConfigæ‹¿åˆ°bossGroupæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨registeræ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥EventLoopGroupåˆ†æ(å¯ä»¥ç›´æ¥è·³è¿‡å»çœ‹)</span></div><div class="line">    <span class="comment">// MultithreadEventLoopGroupçš„ step 1</span></div><div class="line">    ChannelFuture regFuture = config().group().register(channel);</div><div class="line">    <span class="keyword">return</span> regFuture;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 5 ServerBootstrapå…·ä½“å®ç°</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map &lt; ChannelOption &lt; ?&gt;,Object &gt; childOptions;</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map &lt; AttributeKey &lt; ?&gt;,Object &gt; childOptions;</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> ServerBootstrapConfig config = <span class="keyword">new</span> ServerBootstrapConfig(<span class="keyword">this</span>);</div><div class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> EventLoopGroup childGroup;</div><div class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> ChannelHandler childHandler;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// æ‹¿åˆ°è®¾ç½®çš„AbstractBootstrapçš„options</span></div><div class="line">    <span class="keyword">final</span> Map &lt; ChannelOption &lt; ?&gt;,</div><div class="line">    Object &gt; options = options0();</div><div class="line">    <span class="comment">// åŒæ­¥</span></div><div class="line">    <span class="keyword">synchronized</span>(options) &#123;</div><div class="line">        <span class="comment">// è®¾ç½®optionsï¼Œè·Ÿä¸‹å»æˆ‘ä»¬ä¼šå‘ç°å°†optionsæ”¾å…¥NioServerSocketChannelConfigä¸­</span></div><div class="line">        setChannelOptions(channel, options, logger);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// åŒoptionsè®¾ç½®</span></div><div class="line">    <span class="keyword">final</span> Map &lt; AttributeKey &lt; ?&gt;,</div><div class="line">    Object &gt; attrs = attrs0();</div><div class="line">    <span class="keyword">synchronized</span>(attrs) &#123;</div><div class="line">        <span class="keyword">for</span> (Entry &lt; AttributeKey &lt; ?&gt;, Object &gt; e: attrs.entrySet()) &#123;<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) AttributeKey &lt; Object &gt; key = (AttributeKey &lt; Object &gt; ) e.getKey();</div><div class="line">            channel.attr(key).set(e.getValue());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æ‹¿åˆ°ChannelPipeline</span></div><div class="line">    ChannelPipeline p = channel.pipeline();</div><div class="line">    <span class="comment">// æ‹¿åˆ°ä¹‹å‰æ³¨å…¥çš„childGroupå’ŒchildHandler</span></div><div class="line">    <span class="keyword">final</span> EventLoopGroup currentChildGroup = childGroup;</div><div class="line">    <span class="keyword">final</span> ChannelHandler currentChildHandler = childHandler;</div><div class="line">    <span class="comment">// è®¾ç½®childOptionså’ŒchildOptionsï¼Œè¿™äº›æ˜¯åº”ç”¨äºä»¥åæ–°æ¥å…¥çš„channel</span></div><div class="line">    <span class="keyword">final</span> Entry &lt; ChannelOption &lt; ?&gt;,</div><div class="line">    Object &gt; [] currentChildOptions;</div><div class="line">    <span class="keyword">final</span> Entry &lt; AttributeKey &lt; ?&gt;,</div><div class="line">    Object &gt; [] currentChildAttrs;</div><div class="line">    <span class="keyword">synchronized</span>(childOptions) &#123;</div><div class="line">        currentChildOptions = childOptions.entrySet().toArray(newOptionArray(<span class="number">0</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">synchronized</span>(childAttrs) &#123;</div><div class="line">        currentChildAttrs = childAttrs.entrySet().toArray(newAttrArray(<span class="number">0</span>));</div><div class="line">    &#125;</div><div class="line">	<span class="comment">// åŠ å…¥æ–°è¿æ¥å¤„ç†å™¨</span></div><div class="line">    p.addLast(<span class="keyword">new</span> ChannelInitializer &lt; Channel &gt; () &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(<span class="keyword">final</span> Channel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">            <span class="keyword">final</span> ChannelPipeline pipeline = ch.pipeline();</div><div class="line">        	<span class="comment">// å°†ä¼šè·å¾—æœ€æ—©ä¹‹å‰è®¾ç½®çš„new LoggingHandler(LogLevel.INFO)</span></div><div class="line">            ChannelHandler handler = config.handler();</div><div class="line">			<span class="comment">// æ–°å¢ä¸€ä¸ªæ–°è¿æ¥æ¥å…¥å™¨ServerBootstrapAcceptorï¼Œå…·ä½“çš„å¯ä»¥çœ‹ä¹‹åçš„åšæ–‡</span></div><div class="line">            ch.eventLoop().execute(<span class="keyword">new</span> Runnable() &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                    pipeline.addLast(<span class="keyword">new</span> ServerBootstrapAcceptor(ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs));</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doBind0</span><span class="params">(<span class="keyword">final</span> ChannelFuture regFuture, <span class="keyword">final</span> Channel channel, <span class="keyword">final</span> SocketAddress localAddress, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// åˆæ˜¯å¼‚æ­¥ä»»åŠ¡ï¼ŒNettyéšå¤„å¯è§</span></div><div class="line">    channel.eventLoop().execute(<span class="keyword">new</span> Runnable() &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (regFuture.isSuccess()) &#123;</div><div class="line">                <span class="comment">// AbstractChannel step 11</span></div><div class="line">                channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                promise.setFailure(regFuture.cause());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Channelç›¸å…³"><a href="#Channelç›¸å…³" class="headerlink" title="Channelç›¸å…³"></a>Channelç›¸å…³</h2><p>åˆ›å»ºä¸€ä¸ªNioServerSocketChannelå¯¹è±¡ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SelectorProvider DEFAULT_SELECTOR_PROVIDER = SelectorProvider.provider();</div><div class="line"><span class="comment">// ServerSocketChannelçš„ä¸€ç³»åˆ—é…ç½®å±æ€§</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> ServerSocketChannelConfig config;</div><div class="line"><span class="comment">// step 1(é»˜è®¤æ„é€ å‡½æ•°)</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioServerSocketChannel</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// step 2ï¼Œstep 3</span></div><div class="line">    <span class="keyword">this</span>(newSocket(DEFAULT_SELECTOR_PROVIDER));</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 2</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ServerSocketChannel <span class="title">newSocket</span><span class="params">(SelectorProvider provider)</span> </span>&#123;</div><div class="line">	<span class="comment">// åˆ©ç”¨JDK NIO åˆ›å»ºçš„SeveSocketrChannel</span></div><div class="line">    <span class="keyword">return</span> provider.openServerSocketChannel();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioServerSocketChannel</span><span class="params">(ServerSocketChannel channel)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 4</span></div><div class="line">    <span class="keyword">super</span>(<span class="keyword">null</span>, channel, SelectionKey.OP_ACCEPT);</div><div class="line">    <span class="comment">// é…ç½®NioServerSocketChannelConfig(åˆå§‹åŒ–ä¼šç”¨åˆ°)</span></div><div class="line">    config = <span class="keyword">new</span> NioServerSocketChannelConfig(<span class="keyword">this</span>, javaChannel().socket());</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4 AbstractNioMessageChannel</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractNioMessageChannel</span><span class="params">(Channel parent, SelectableChannel ch, <span class="keyword">int</span> readInterestOp)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 5</span></div><div class="line">    <span class="keyword">super</span>(parent, ch, readInterestOp);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 5 AbstractNioChannel</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> SelectableChannel ch;</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> readInterestOp;</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractNioChannel</span><span class="params">(Channel parent, SelectableChannel ch, <span class="keyword">int</span> readInterestOp)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 6</span></div><div class="line">    <span class="keyword">super</span>(parent);</div><div class="line">    <span class="comment">// ä¿å­˜åŸç”Ÿçš„ServerSocketChannel</span></div><div class="line">    <span class="keyword">this</span>.ch = ch;</div><div class="line">    <span class="comment">// ä¿å­˜æ„Ÿå…´è¶£çš„äº‹ä»¶(SelectionKey.OP_ACCEPTï¼Œ1&lt;&lt;4)</span></div><div class="line">    <span class="keyword">this</span>.readInterestOp = readInterestOp;</div><div class="line">    <span class="comment">// å°†Channelè®¾ç½®ä¸ºéé˜»å¡</span></div><div class="line">    ch.configureBlocking(<span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 6 AbstractChannel</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Channel parent;</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> ChannelId id;</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Unsafe unsafe;</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> DefaultChannelPipeline pipeline;</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractChannel</span><span class="params">(Channel parent)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.parent = parent;</div><div class="line">    <span class="comment">// ç”Ÿæˆchannelçš„å”¯ä¸€æ ‡è¯†ï¼Œè‡ªå·±å¯ä»¥å»çœ‹çœ‹å®ç°</span></div><div class="line">    id = newId();</div><div class="line">    <span class="comment">// ç”Ÿæˆunsafeå¯¹è±¡(è¿›è¡Œåº•å±‚çš„IOæ“ä½œ)ï¼Œä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦å…·ä½“å®ç°ï¼Œå®ƒçš„æŠ½è±¡ç±»ä¹Ÿåœ¨AbstractChannelä¸­</span></div><div class="line">    unsafe = newUnsafe();</div><div class="line">    <span class="comment">// ç”ŸæˆChannelPipeline</span></div><div class="line">    <span class="comment">// step 7</span></div><div class="line">    pipeline = newChannelPipeline();</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7</span></div><div class="line"><span class="function"><span class="keyword">protected</span> DefaultChannelPipeline <span class="title">newChannelPipeline</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// æˆ‘ä»¬å°†åœ¨DefaultChannelPipelineåˆ†æ</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultChannelPipeline(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 8 AbstractChannel</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(EventLoop eventLoop, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šäº†eventLoop</span></div><div class="line">    AbstractChannel.<span class="keyword">this</span>.eventLoop = eventLoop;</div><div class="line">	<span class="comment">// ... ä¸“æ³¨äºæ ¸å¿ƒ</span></div><div class="line">    <span class="comment">// step 9</span></div><div class="line">    register0(promise);</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// step 9</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">register0</span><span class="params">(ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// å½“ç„¶æ˜¯ç¬¬ä¸€æ¬¡æ³¨å†Œï¼Œtrue    </span></div><div class="line">    <span class="keyword">boolean</span> firstRegistration = neverRegistered;</div><div class="line">    <span class="comment">// step 10    </span></div><div class="line">    doRegister();</div><div class="line">    <span class="comment">// æ³¨å†Œä¹‹åè®¾ç½®æ ‡å¿—ä½</span></div><div class="line">    neverRegistered = <span class="keyword">false</span>;    </div><div class="line">    registered = <span class="keyword">true</span>;</div><div class="line">    <span class="comment">// pipelineä¹‹åçš„åšæ–‡ä¼šè¯´    </span></div><div class="line">    pipeline.invokeHandlerAddedIfNeeded();</div><div class="line">    safeSetSuccess(promise);</div><div class="line">    <span class="comment">// è§¦å‘æ³¨å†Œå®Œæˆäº‹ä»¶ï¼Œè¿˜ä¼šä¼ æ’­pipeline.fireChannelActive();</span></div><div class="line">    pipeline.fireChannelRegistered();</div><div class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ç»‘å®šï¼Œä¼šè°ƒç”¨åº•å±‚NIOåˆ›å»ºçš„channelï¼Œåº”è¯¥ä¸ºfalse</span></div><div class="line">    <span class="comment">// é‚£ä¹ˆä»€ä¹ˆæ—¶å€™å»ºç«‹è¿æ¥çš„å‘¢ï¼Œæ€ä¹ˆæ‰¾ï¼Œå¯ä»¥å‚è€ƒåé¢åˆ—å‡ºçš„é—ªç”µä¾ çš„åšæ–‡ï¼Œè¿™ä¸ªå‡½æ•°åˆ†æå®Œäº†</span></div><div class="line">    <span class="comment">// æˆ‘ä»¬åº”è¯¥å›åˆ°AbstractBootstrapçš„ step 6 ç»§ç»­åˆ†æ</span></div><div class="line">    <span class="keyword">if</span> (isActive()) &#123;</div><div class="line">        <span class="keyword">if</span> (firstRegistration) &#123;</div><div class="line">            pipeline.fireChannelActive();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config().isAutoRead()) &#123;</div><div class="line">            beginRead();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 10</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doRegister</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// åˆ©ç”¨jdkåº•å±‚å°†channelæ³¨å†Œåˆ°selectorä¸Šï¼Œ0è¡¨ç¤ºä¸å…³å¿ƒä»»ä½•äº‹ä»¶ï¼Œthisæ˜¯ä¸ºäº†å½“NIOæ£€æµ‹åˆ°äº‹ä»¶æ—¶å¯ä»¥å¯¹nettyçš„channelè¿›è¡Œæ“ä½œ</span></div><div class="line">    selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), <span class="number">0</span>, <span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 11</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// DefaultChannelPipeline step 2</span></div><div class="line">    <span class="keyword">return</span> pipeline.bind(localAddress, promise);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 12</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(<span class="keyword">final</span> SocketAddress localAddress, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// è‚¯å®šè¿˜æ²¡æœ‰å»ºç«‹è¿æ¥</span></div><div class="line">    <span class="keyword">boolean</span> wasActive = isActive();</div><div class="line">    <span class="comment">// step 13    </span></div><div class="line">    doBind(localAddress);</div><div class="line">	<span class="comment">// è¿™é‡ŒisActive()åº”è¯¥è¦è¿”å›trueäº†</span></div><div class="line">    <span class="keyword">if</span> (!wasActive &amp;&amp; isActive()) &#123;</div><div class="line">        invokeLater(<span class="keyword">new</span> Runnable() &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            	<span class="comment">// è§¦å‘ç«¯å£ç»‘å®šäº‹ä»¶ï¼Œæˆ‘ä»¬å°†ä¼šè§¦å‘HeadContextçš„channelActiveæ–¹æ³•</span></div><div class="line">            	<span class="comment">// ChannelPipeline step 5</span></div><div class="line">                pipeline.fireChannelActive();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    safeSetSuccess(promise);</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 13</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doBind</span><span class="params">(SocketAddress localAddress)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// åˆ°è¿™é‡Œå°±æ˜¯è¿›è¡Œåº•å±‚çš„ç»‘å®š</span></div><div class="line">    <span class="keyword">if</span> (PlatformDependent.javaVersion() &gt;= <span class="number">7</span>) &#123;</div><div class="line">        javaChannel().bind(localAddress, config.getBacklog());</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        javaChannel().socket().bind(localAddress, config.getBacklog());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 14 AbstractChannel</span></div><div class="line"><span class="function"><span class="keyword">public</span> Channel <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// DefaultChannelPipeline step 7</span></div><div class="line">    pipeline.read();</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 16 AbstractNioChannelçš„AbstractNioUnsafe</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doBeginRead</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// è¿˜è®°å¾—åœ¨åˆå§‹åŒ–AbstractNioChannelæ—¶ä¿å­˜çš„readInterestOpå’Œåœ¨channelæ³¨å†Œè¿‡ç¨‹ä¸­çš„selectionKeyå—ï¼Œä¸è®°å¾—å¾€ä¸Šçœ‹ä¸€çœ‹</span></div><div class="line">    <span class="keyword">final</span> SelectionKey selectionKey = <span class="keyword">this</span>.selectionKey;</div><div class="line">	<span class="comment">// éœ€è¦è¯»</span></div><div class="line">    readPending = <span class="keyword">true</span>;</div><div class="line">	<span class="comment">// æ‹¿åˆ°å…·ä½“çš„å€¼ï¼Œ1&lt;&lt;4=16</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> interestOps = selectionKey.interestOps();</div><div class="line">    <span class="keyword">if</span> ((interestOps &amp; readInterestOp) == <span class="number">0</span>) &#123;</div><div class="line">		<span class="comment">// å‡†å¤‡å‘Šè¯‰Selectoréœ€è¦å…³æ³¨SelectionKey.OP_ACCEPTäº‹ä»¶</span></div><div class="line">        selectionKey.interestOps(interestOps | readInterestOp);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ChannelPipelineç›¸å…³"><a href="#ChannelPipelineç›¸å…³" class="headerlink" title="ChannelPipelineç›¸å…³"></a>ChannelPipelineç›¸å…³</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 DefaultChannelPipeline</span></div><div class="line"><span class="keyword">final</span> AbstractChannelHandlerContext head;</div><div class="line"><span class="keyword">final</span> AbstractChannelHandlerContext tail;</div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Channel channel;</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">DefaultChannelPipeline</span><span class="params">(Channel channel)</span> </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šchannel(å¦‚æœä¸ºç©ºåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå­¦ä¹ å†™å·¥å…·ç±»)</span></div><div class="line">    <span class="keyword">this</span>.channel = ObjectUtil.checkNotNull(channel, <span class="string">"channel"</span>);</div><div class="line">	<span class="comment">// é»˜è®¤çš„ä¸¤ä¸ªèŠ‚ç‚¹</span></div><div class="line">    tail = <span class="keyword">new</span> TailContext(<span class="keyword">this</span>);</div><div class="line">    head = <span class="keyword">new</span> HeadContext(<span class="keyword">this</span>);</div><div class="line">	<span class="comment">// å½¢æˆåŒå‘é“¾è¡¨</span></div><div class="line">    head.next = tail;</div><div class="line">    tail.prev = head;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 2 DefaultChannelPipeline</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelFuture <span class="title">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// è¿™ä¸ªtailä¹‹å‰å°±è®¾ç½®è¿‡äº†</span></div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">return</span> tail.bind(localAddress, promise);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 3 AbstractChannelHandlerContext</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">bind</span><span class="params">(<span class="keyword">final</span> SocketAddress localAddress, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// å¯»æ‰¾tailä¹‹å‰çš„ä¸€ä¸ªèŠ‚ç‚¹</span></div><div class="line">    <span class="keyword">final</span> AbstractChannelHandlerContext next = findContextOutbound();</div><div class="line">    EventExecutor executor = next.executor();</div><div class="line">    <span class="keyword">if</span> (executor.inEventLoop()) &#123;</div><div class="line">        <span class="comment">// è°ƒç”¨ä¸‹ä¸€ä¸ªAbstractChannelHandlerContextçš„invokeBindæ–¹æ³•ï¼Œä¸€ç›´åˆ°æ‰¾åˆ°HeadContext</span></div><div class="line">        <span class="comment">// step 4</span></div><div class="line">        next.invokeBind(localAddress, promise);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        safeExecute(executor, <span class="keyword">new</span> Runnable() &#123;<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                next.invokeBind(localAddress, promise);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        promise, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> promise;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 4</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(ChannelHandlerContext ctx, SocketAddress localAddress, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// çœ‹åˆ°unsafeå°±çŸ¥é“è¦è¿›è¡Œåº•å±‚æ“ä½œçš„</span></div><div class="line">    <span class="comment">// è¿›å…¥ AbstractChannelçš„Unsafe step 12</span></div><div class="line">    unsafe.bind(localAddress, promise);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 5 DefaultChannelPipelineçš„HeadContext</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="comment">// ç»‘å®šæ—¶é—´å°†ä¼šä¸€ç›´ä¼ æ’­ä¸‹å»</span></div><div class="line">    ctx.fireChannelActive();</div><div class="line">    <span class="comment">// step 6 æ·±å…¥åˆ†æ</span></div><div class="line">    readIfIsAutoRead();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step 6 DefaultChannelPipelineçš„HeadContext</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readIfIsAutoRead</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹åˆ°isAutoRead()æ–¹æ³•é»˜è®¤è¿”å›ä¸º1</span></div><div class="line">    <span class="keyword">if</span> (channel.config().isAutoRead()) &#123;</div><div class="line">        <span class="comment">// è¿›å…¥ AbstractChannel step 14</span></div><div class="line">        <span class="comment">// å¯¹äºæœåŠ¡ç«¯channelçš„è¯»æ¥è¯´å°±è¯´å¯ä»¥ç»‘å®šè¿æ¥äº†</span></div><div class="line">        channel.read();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 7 DefaultChannelPipeline</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// ä»tailèŠ‚ç‚¹ä¸€ç›´è¿½å¯»åˆ°headï¼Œæ‰¾åˆ° unsafe.beginRead()</span></div><div class="line">    <span class="comment">// step 8</span></div><div class="line">    tail.read();</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 8 DefaultChannelPipelineçš„HeadContext</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">beginRead</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// ä¼šä¸€ç›´æ‰¾åˆ°AbstractNioChannelçš„AbstractNioUnsafeçš„doBeginRead step 16</span></div><div class="line">    doBeginRead();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="EventLoopç›¸å…³"><a href="#EventLoopç›¸å…³" class="headerlink" title="EventLoopç›¸å…³"></a>EventLoopç›¸å…³</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// step 1 MultithreadEventLoopGroup</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">register</span><span class="params">(Channel channel)</span> </span>&#123;</div><div class="line">    <span class="comment">// next()å°†ä¼šé€šè¿‡é€‰æ‹©å™¨ï¼ˆä¹‹åçš„åšæ–‡ä¼šè®²åˆ°ï¼‰æ‹¿åˆ°ä¸€ä¸ªEventLoop</span></div><div class="line">    <span class="comment">// step 2</span></div><div class="line">    <span class="keyword">return</span> next().register(channel);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// step2 SingleThreadEventLoop</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">register</span><span class="params">(Channel channel)</span> </span>&#123;</div><div class="line">    <span class="comment">// step 3</span></div><div class="line">    <span class="keyword">return</span> register(<span class="keyword">new</span> DefaultChannelPromise(channel, <span class="keyword">this</span>));</div><div class="line">&#125;</div><div class="line"><span class="comment">// step 3</span></div><div class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">register</span><span class="params">(<span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</div><div class="line">    <span class="comment">// é€šè¿‡unsafe()æ–¹æ³•å¾—åˆ°Unsafeå¯¹è±¡ï¼ˆç»‘å®šåœ¨channelä¸Šçš„é‚£ä¸ªï¼‰æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå®ƒè¦å¼€å§‹åº•å±‚æ“ä½œæ³¨å†Œäº†</span></div><div class="line">    <span class="comment">// æˆ‘ä»¬æˆ‘ä»¬åˆè¦å›åˆ°AbstractChannelå»äº†ï¼Œçœ‹çœ‹å®ƒçš„registeræ³¨å†Œæ–¹æ³•</span></div><div class="line">    <span class="comment">// Channel step 8</span></div><div class="line">    promise.channel().unsafe().register(<span class="keyword">this</span>, promise);</div><div class="line">    <span class="keyword">return</span> promise;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>è®¾ç½®å¯åŠ¨ç±»å‚æ•°</li>
<li>åˆ›å»ºæœåŠ¡ç«¯Channelï¼ŒåŒæ—¶åˆ›å»ºChannelConfig,ChannelId,ChannelPipeline,ChannelHandler,Unsafeç­‰</li>
<li>åˆå§‹åŒ–æœåŠ¡ç«¯Channelï¼Œè®¾ç½®ä¸€äº›attrï¼Œoptionï¼Œä»¥åŠè®¾ç½®å­channelçš„attrï¼Œoptionï¼Œç»™æœåŠ¡ç«¯channelæ·»åŠ æ–°channelæ¥å…¥å™¨</li>
<li>å°†Channelæ³¨å†Œåˆ°Selectorï¼Œå¹¶è§¦å‘addHandler,registerç­‰äº‹ä»¶</li>
<li>è¿›è¡Œç«¯å£ç»‘å®šï¼Œå¹¶è§¦å‘activeäº‹ä»¶ï¼ŒåŒæ—¶æ³¨å†ŒACCEPTäº‹ä»¶</li>
</ol>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.jianshu.com/p/c5068caab217" target="_blank" rel="external">nettyæºç åˆ†æä¹‹æœåŠ¡ç«¯å¯åŠ¨å…¨è§£æ</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šNettyå¯åŠ¨å•¦ï¼å¼€å¿ƒè„¸ï¼ä½†æ˜¯è¿™åˆå¯èƒ½æ˜¯ä¸€ç¯‡åˆè‡­åˆé•¿ç”±ç»•çš„æ–‡ç« ï¼Œéœ€è¦ç‚¹è€å¿ƒï¼Œéœ€è¦ç‚¹åŠ¨æ‰‹èƒ½åŠ›ã€‚æ— å¥ˆè„¸ï¼ï¼ï¼
    
    </summary>
    
      <category term="Nettyæºç " scheme="http://bestlixiang.site/categories/Netty%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="Netty" scheme="http://bestlixiang.site/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>æ‘†è„±çƒ‚ä»£ç ä¹‹Effective Java Third Edition</title>
    <link href="http://bestlixiang.site/2018/07/23/%E6%91%86%E8%84%B1%E7%83%82%E4%BB%A3%E7%A0%81/%E6%91%86%E8%84%B1%E7%83%82%E4%BB%A3%E7%A0%81%E4%B9%8BEffective-Java-Third-Edition/"/>
    <id>http://bestlixiang.site/2018/07/23/æ‘†è„±çƒ‚ä»£ç /æ‘†è„±çƒ‚ä»£ç ä¹‹Effective-Java-Third-Edition/</id>
    <published>2018-07-23T06:29:10.000Z</published>
    <updated>2018-07-23T11:26:42.834Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šè¶Šå­¦è¶Šè¿·èŒ«ï¼Œæœ‰æ‰€è°“çš„é‡ç‚¹å—ï¼Ÿæˆ‘åæ­£ç°åœ¨è¿˜å¼„ä¸æ¸…æ¥šï¼Œæ—¢ç„¶å¼„ä¸æ¸…æ¥šï¼Œé‚£å°±å¥½å¥½ä¸“æ³¨äºè„šä¸‹å§ã€‚æˆ‘æ›¾ç»çœ‹è¿‡ä¸€éEffective Javaç¬¬äºŒç‰ˆï¼Œå¯èƒ½é‚£ä¸ªæ—¶å€™çš„ä»£ç é‡è¿˜ä¸å¤Ÿå§ï¼Œä¸èƒ½ç†è§£å…¶ç²¾é«“ï¼Œç°åœ¨çœ‹çœ‹æ‰èƒ½å›å‘³ä¸€ç‚¹ã€‚åˆšå¥½ä»Šå¹´å¹´åˆç¬¬ä¸‰ç‰ˆï¼ˆè‹±æ–‡ç‰ˆï¼‰ä¹Ÿå‡ºæ¥ï¼Œæ–°å¢äº†Java7ã€8ã€9çš„ä¸€äº›æ¡ç›®ï¼Œè¿™é‡Œä¹Ÿå°±æƒ³åˆ—ä¸€äº›ç¬¬ä¸‰ç‰ˆçš„ç›®å½•ï¼Œä¾›è‡ªå·±æŸ¥æ‰¾ä¸å®è·µï¼Œå¸Œæœ›è‡ªå·±èƒ½å¤Ÿçœ‹åˆ°æ¡ç›®å°±èƒ½è¯´å‡ºæ‰€ä»¥ç„¶æ¥ï¼Œä¹Ÿæƒ³ç¿»è¯‘ä¸€ä¸‹æ–°å¢çš„ä¸€äº›æ¡ç›®ã€‚å¤§å®¶ä¹Ÿå¯ä»¥äº’ç›¸äº¤æµã€‚<a id="more"></a></p>
<h3 id="ç¬¬ä¸€ç« -å¼•è¨€ï¼ˆé‡è¦ï¼‰"><a href="#ç¬¬ä¸€ç« -å¼•è¨€ï¼ˆé‡è¦ï¼‰" class="headerlink" title="ç¬¬ä¸€ç«  å¼•è¨€ï¼ˆé‡è¦ï¼‰"></a>ç¬¬ä¸€ç«  å¼•è¨€ï¼ˆé‡è¦ï¼‰</h3><h3 id="ç¬¬äºŒç« -åˆ›å»ºå’Œé”€æ¯å¯¹è±¡"><a href="#ç¬¬äºŒç« -åˆ›å»ºå’Œé”€æ¯å¯¹è±¡" class="headerlink" title="ç¬¬äºŒç«  åˆ›å»ºå’Œé”€æ¯å¯¹è±¡"></a>ç¬¬äºŒç«  åˆ›å»ºå’Œé”€æ¯å¯¹è±¡</h3><h4 id="ç¬¬1æ¡-è€ƒè™‘ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨ï¼ˆJava8ï¼Œ9-æ›´æ–°ï¼‰"><a href="#ç¬¬1æ¡-è€ƒè™‘ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨ï¼ˆJava8ï¼Œ9-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬1æ¡ è€ƒè™‘ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨ï¼ˆJava8ï¼Œ9 æ›´æ–°ï¼‰"></a>ç¬¬1æ¡ è€ƒè™‘ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨ï¼ˆJava8ï¼Œ9 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬2æ¡-é‡åˆ°å¤šä¸ªæ„é€ å™¨å‚æ•°æ—¶è¦è€ƒè™‘ç”¨å»ºé€ è€…æ¨¡å¼"><a href="#ç¬¬2æ¡-é‡åˆ°å¤šä¸ªæ„é€ å™¨å‚æ•°æ—¶è¦è€ƒè™‘ç”¨å»ºé€ è€…æ¨¡å¼" class="headerlink" title="ç¬¬2æ¡ é‡åˆ°å¤šä¸ªæ„é€ å™¨å‚æ•°æ—¶è¦è€ƒè™‘ç”¨å»ºé€ è€…æ¨¡å¼"></a>ç¬¬2æ¡ é‡åˆ°å¤šä¸ªæ„é€ å™¨å‚æ•°æ—¶è¦è€ƒè™‘ç”¨å»ºé€ è€…æ¨¡å¼</h4><h4 id="ç¬¬3æ¡-é€šè¿‡ç§æœ‰æ„é€ å™¨æˆ–è€…æšä¸¾ç±»å‹å¼ºåŒ–å•ä¾‹å±æ€§"><a href="#ç¬¬3æ¡-é€šè¿‡ç§æœ‰æ„é€ å™¨æˆ–è€…æšä¸¾ç±»å‹å¼ºåŒ–å•ä¾‹å±æ€§" class="headerlink" title="ç¬¬3æ¡ é€šè¿‡ç§æœ‰æ„é€ å™¨æˆ–è€…æšä¸¾ç±»å‹å¼ºåŒ–å•ä¾‹å±æ€§"></a>ç¬¬3æ¡ é€šè¿‡ç§æœ‰æ„é€ å™¨æˆ–è€…æšä¸¾ç±»å‹å¼ºåŒ–å•ä¾‹å±æ€§</h4><h4 id="ç¬¬4æ¡-é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›"><a href="#ç¬¬4æ¡-é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›" class="headerlink" title="ç¬¬4æ¡ é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›"></a>ç¬¬4æ¡ é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›</h4><h4 id="ç¬¬5æ¡-ä¾èµ–æ³¨å…¥ä¼˜å…ˆç¡¬è¿æ¥èµ„æºï¼ˆæ–°å¢ï¼‰"><a href="#ç¬¬5æ¡-ä¾èµ–æ³¨å…¥ä¼˜å…ˆç¡¬è¿æ¥èµ„æºï¼ˆæ–°å¢ï¼‰" class="headerlink" title="ç¬¬5æ¡ ä¾èµ–æ³¨å…¥ä¼˜å…ˆç¡¬è¿æ¥èµ„æºï¼ˆæ–°å¢ï¼‰"></a>ç¬¬5æ¡ ä¾èµ–æ³¨å…¥ä¼˜å…ˆç¡¬è¿æ¥èµ„æºï¼ˆæ–°å¢ï¼‰</h4><h4 id="ç¬¬6æ¡-é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼ˆJava9-æ›´æ–°ï¼‰"><a href="#ç¬¬6æ¡-é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼ˆJava9-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬6æ¡ é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼ˆJava9 æ›´æ–°ï¼‰"></a>ç¬¬6æ¡ é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼ˆJava9 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬7æ¡-æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨"><a href="#ç¬¬7æ¡-æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨" class="headerlink" title="ç¬¬7æ¡ æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨"></a>ç¬¬7æ¡ æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨</h4><h4 id="ç¬¬8æ¡-é¿å…ä½¿ç”¨æ€»ç»“æ–¹æ³•å’Œæ¸…ç†å™¨ï¼ˆJava-7ï¼Œ9-æ›´æ–°ï¼‰"><a href="#ç¬¬8æ¡-é¿å…ä½¿ç”¨æ€»ç»“æ–¹æ³•å’Œæ¸…ç†å™¨ï¼ˆJava-7ï¼Œ9-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬8æ¡ é¿å…ä½¿ç”¨æ€»ç»“æ–¹æ³•å’Œæ¸…ç†å™¨ï¼ˆJava 7ï¼Œ9 æ›´æ–°ï¼‰"></a>ç¬¬8æ¡ é¿å…ä½¿ç”¨æ€»ç»“æ–¹æ³•å’Œæ¸…ç†å™¨ï¼ˆJava 7ï¼Œ9 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬9æ¡-try-with-resourcesä¼˜å…ˆtry-finallyï¼ˆJava-7-æ–°å¢ï¼‰"><a href="#ç¬¬9æ¡-try-with-resourcesä¼˜å…ˆtry-finallyï¼ˆJava-7-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬9æ¡ try-with-resourcesä¼˜å…ˆtry-finallyï¼ˆJava 7 æ–°å¢ï¼‰"></a>ç¬¬9æ¡ try-with-resourcesä¼˜å…ˆtry-finallyï¼ˆJava 7 æ–°å¢ï¼‰</h4><h3 id="ç¬¬ä¸‰ç« -æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•"><a href="#ç¬¬ä¸‰ç« -æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•" class="headerlink" title="ç¬¬ä¸‰ç«  æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•"></a>ç¬¬ä¸‰ç«  æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•</h3><h4 id="ç¬¬10æ¡-è¦†å†™equalsæ—¶å€™è¯·éµå®ˆé€šç”¨è§„å®š"><a href="#ç¬¬10æ¡-è¦†å†™equalsæ—¶å€™è¯·éµå®ˆé€šç”¨è§„å®š" class="headerlink" title="ç¬¬10æ¡ è¦†å†™equalsæ—¶å€™è¯·éµå®ˆé€šç”¨è§„å®š"></a>ç¬¬10æ¡ è¦†å†™equalsæ—¶å€™è¯·éµå®ˆé€šç”¨è§„å®š</h4><h4 id="ç¬¬11æ¡-è¦†å†™equalsæ—¶å€™æ€»è¦è¦†å†™hashCode"><a href="#ç¬¬11æ¡-è¦†å†™equalsæ—¶å€™æ€»è¦è¦†å†™hashCode" class="headerlink" title="ç¬¬11æ¡ è¦†å†™equalsæ—¶å€™æ€»è¦è¦†å†™hashCode"></a>ç¬¬11æ¡ è¦†å†™equalsæ—¶å€™æ€»è¦è¦†å†™hashCode</h4><h4 id="ç¬¬12æ¡-å§‹ç»ˆè¦†å†™toString"><a href="#ç¬¬12æ¡-å§‹ç»ˆè¦†å†™toString" class="headerlink" title="ç¬¬12æ¡ å§‹ç»ˆè¦†å†™toString"></a>ç¬¬12æ¡ å§‹ç»ˆè¦†å†™toString</h4><h4 id="ç¬¬13æ¡-è°¨æ…å¾—è¦†å†™clone"><a href="#ç¬¬13æ¡-è°¨æ…å¾—è¦†å†™clone" class="headerlink" title="ç¬¬13æ¡ è°¨æ…å¾—è¦†å†™clone"></a>ç¬¬13æ¡ è°¨æ…å¾—è¦†å†™clone</h4><h4 id="ç¬¬14æ¡-è€ƒè™‘å®ç°Comparableæ¥å£"><a href="#ç¬¬14æ¡-è€ƒè™‘å®ç°Comparableæ¥å£" class="headerlink" title="ç¬¬14æ¡ è€ƒè™‘å®ç°Comparableæ¥å£"></a>ç¬¬14æ¡ è€ƒè™‘å®ç°Comparableæ¥å£</h4><h3 id="ç¬¬å››ç« -ç±»å’Œæ¥å£"><a href="#ç¬¬å››ç« -ç±»å’Œæ¥å£" class="headerlink" title="ç¬¬å››ç«  ç±»å’Œæ¥å£"></a>ç¬¬å››ç«  ç±»å’Œæ¥å£</h3><h4 id="ç¬¬15æ¡-ä½¿ç±»å’Œæˆå‘˜å¯è®¿é—®æ€§æœ€å°åŒ–ï¼ˆJava9-æ›´æ–°ï¼‰"><a href="#ç¬¬15æ¡-ä½¿ç±»å’Œæˆå‘˜å¯è®¿é—®æ€§æœ€å°åŒ–ï¼ˆJava9-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬15æ¡ ä½¿ç±»å’Œæˆå‘˜å¯è®¿é—®æ€§æœ€å°åŒ–ï¼ˆJava9 æ›´æ–°ï¼‰"></a>ç¬¬15æ¡ ä½¿ç±»å’Œæˆå‘˜å¯è®¿é—®æ€§æœ€å°åŒ–ï¼ˆJava9 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬16æ¡-åœ¨å…¬æœ‰ç±»ä¸­ä½¿ç”¨è®¿é—®æ–¹æ³•è€Œéå…¬æœ‰åŸŸ"><a href="#ç¬¬16æ¡-åœ¨å…¬æœ‰ç±»ä¸­ä½¿ç”¨è®¿é—®æ–¹æ³•è€Œéå…¬æœ‰åŸŸ" class="headerlink" title="ç¬¬16æ¡ åœ¨å…¬æœ‰ç±»ä¸­ä½¿ç”¨è®¿é—®æ–¹æ³•è€Œéå…¬æœ‰åŸŸ"></a>ç¬¬16æ¡ åœ¨å…¬æœ‰ç±»ä¸­ä½¿ç”¨è®¿é—®æ–¹æ³•è€Œéå…¬æœ‰åŸŸ</h4><h4 id="ç¬¬17æ¡-ä½¿å¯å˜æ€§æœ€å°åŒ–"><a href="#ç¬¬17æ¡-ä½¿å¯å˜æ€§æœ€å°åŒ–" class="headerlink" title="ç¬¬17æ¡ ä½¿å¯å˜æ€§æœ€å°åŒ–"></a>ç¬¬17æ¡ ä½¿å¯å˜æ€§æœ€å°åŒ–</h4><h4 id="ç¬¬18æ¡-å¤åˆä¼˜å…ˆäºç»§æ‰¿"><a href="#ç¬¬18æ¡-å¤åˆä¼˜å…ˆäºç»§æ‰¿" class="headerlink" title="ç¬¬18æ¡ å¤åˆä¼˜å…ˆäºç»§æ‰¿"></a>ç¬¬18æ¡ å¤åˆä¼˜å…ˆäºç»§æ‰¿</h4><h4 id="ç¬¬19æ¡-è¦ä¹ˆä¸ºç»§æ‰¿è€Œè®¾è®¡å¹¶æä¾›æ–‡æ¡£ï¼Œè¦ä¹ˆç¦æ­¢ç»§æ‰¿ï¼ˆJava8ï¼Œ9-æ›´æ–°ï¼‰"><a href="#ç¬¬19æ¡-è¦ä¹ˆä¸ºç»§æ‰¿è€Œè®¾è®¡å¹¶æä¾›æ–‡æ¡£ï¼Œè¦ä¹ˆç¦æ­¢ç»§æ‰¿ï¼ˆJava8ï¼Œ9-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬19æ¡ è¦ä¹ˆä¸ºç»§æ‰¿è€Œè®¾è®¡å¹¶æä¾›æ–‡æ¡£ï¼Œè¦ä¹ˆç¦æ­¢ç»§æ‰¿ï¼ˆJava8ï¼Œ9 æ›´æ–°ï¼‰"></a>ç¬¬19æ¡ è¦ä¹ˆä¸ºç»§æ‰¿è€Œè®¾è®¡å¹¶æä¾›æ–‡æ¡£ï¼Œè¦ä¹ˆç¦æ­¢ç»§æ‰¿ï¼ˆJava8ï¼Œ9 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬20æ¡-æ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»"><a href="#ç¬¬20æ¡-æ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»" class="headerlink" title="ç¬¬20æ¡ æ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»"></a>ç¬¬20æ¡ æ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»</h4><h4 id="ç¬¬21æ¡-ä¸ºåä»£è®¾è®¡æ¥å£ï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬21æ¡-ä¸ºåä»£è®¾è®¡æ¥å£ï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬21æ¡ ä¸ºåä»£è®¾è®¡æ¥å£ï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬21æ¡ ä¸ºåä»£è®¾è®¡æ¥å£ï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬22æ¡-æ¥å£åªç”¨äºå®šä¹‰ç±»å‹"><a href="#ç¬¬22æ¡-æ¥å£åªç”¨äºå®šä¹‰ç±»å‹" class="headerlink" title="ç¬¬22æ¡ æ¥å£åªç”¨äºå®šä¹‰ç±»å‹"></a>ç¬¬22æ¡ æ¥å£åªç”¨äºå®šä¹‰ç±»å‹</h4><h4 id="ç¬¬23æ¡-ç±»å±‚æ¬¡ä¼˜å…ˆäºæ ‡ç­¾ç±»"><a href="#ç¬¬23æ¡-ç±»å±‚æ¬¡ä¼˜å…ˆäºæ ‡ç­¾ç±»" class="headerlink" title="ç¬¬23æ¡ ç±»å±‚æ¬¡ä¼˜å…ˆäºæ ‡ç­¾ç±»"></a>ç¬¬23æ¡ ç±»å±‚æ¬¡ä¼˜å…ˆäºæ ‡ç­¾ç±»</h4><h4 id="ç¬¬24æ¡-ä¼˜å…ˆè€ƒè™‘é™æ€æˆå‘˜ç±»è€Œä¸æ˜¯éé™æ€æˆå‘˜ç±»"><a href="#ç¬¬24æ¡-ä¼˜å…ˆè€ƒè™‘é™æ€æˆå‘˜ç±»è€Œä¸æ˜¯éé™æ€æˆå‘˜ç±»" class="headerlink" title="ç¬¬24æ¡ ä¼˜å…ˆè€ƒè™‘é™æ€æˆå‘˜ç±»è€Œä¸æ˜¯éé™æ€æˆå‘˜ç±»"></a>ç¬¬24æ¡ ä¼˜å…ˆè€ƒè™‘é™æ€æˆå‘˜ç±»è€Œä¸æ˜¯éé™æ€æˆå‘˜ç±»</h4><h4 id="ç¬¬25æ¡-å°†æºæ–‡ä»¶é™åˆ¶ä¸ºå•ä¸ªé¡¶å±‚ç±»ï¼ˆæ–°å¢ï¼‰"><a href="#ç¬¬25æ¡-å°†æºæ–‡ä»¶é™åˆ¶ä¸ºå•ä¸ªé¡¶å±‚ç±»ï¼ˆæ–°å¢ï¼‰" class="headerlink" title="ç¬¬25æ¡ å°†æºæ–‡ä»¶é™åˆ¶ä¸ºå•ä¸ªé¡¶å±‚ç±»ï¼ˆæ–°å¢ï¼‰"></a>ç¬¬25æ¡ å°†æºæ–‡ä»¶é™åˆ¶ä¸ºå•ä¸ªé¡¶å±‚ç±»ï¼ˆæ–°å¢ï¼‰</h4><h3 id="ç¬¬äº”ç« -æ³›å‹"><a href="#ç¬¬äº”ç« -æ³›å‹" class="headerlink" title="ç¬¬äº”ç«  æ³›å‹"></a>ç¬¬äº”ç«  æ³›å‹</h3><h4 id="ç¬¬26æ¡-ä¸è¦ä½¿ç”¨åŸç”Ÿç±»å‹"><a href="#ç¬¬26æ¡-ä¸è¦ä½¿ç”¨åŸç”Ÿç±»å‹" class="headerlink" title="ç¬¬26æ¡ ä¸è¦ä½¿ç”¨åŸç”Ÿç±»å‹"></a>ç¬¬26æ¡ ä¸è¦ä½¿ç”¨åŸç”Ÿç±»å‹</h4><h4 id="ç¬¬27æ¡-æ¶ˆé™¤éé¦–æ£€è­¦å‘Š"><a href="#ç¬¬27æ¡-æ¶ˆé™¤éé¦–æ£€è­¦å‘Š" class="headerlink" title="ç¬¬27æ¡ æ¶ˆé™¤éé¦–æ£€è­¦å‘Š"></a>ç¬¬27æ¡ æ¶ˆé™¤éé¦–æ£€è­¦å‘Š</h4><h4 id="ç¬¬28æ¡-åˆ—è¡¨ä¼˜å…ˆäºæ•°ç»„"><a href="#ç¬¬28æ¡-åˆ—è¡¨ä¼˜å…ˆäºæ•°ç»„" class="headerlink" title="ç¬¬28æ¡ åˆ—è¡¨ä¼˜å…ˆäºæ•°ç»„"></a>ç¬¬28æ¡ åˆ—è¡¨ä¼˜å…ˆäºæ•°ç»„</h4><h4 id="ç¬¬29æ¡-ä¼˜å…ˆè€ƒè™‘æ³›å‹"><a href="#ç¬¬29æ¡-ä¼˜å…ˆè€ƒè™‘æ³›å‹" class="headerlink" title="ç¬¬29æ¡ ä¼˜å…ˆè€ƒè™‘æ³›å‹"></a>ç¬¬29æ¡ ä¼˜å…ˆè€ƒè™‘æ³›å‹</h4><h4 id="ç¬¬30æ¡-ä¼˜å…ˆè€ƒè™‘æ³›å‹æ–¹æ³•"><a href="#ç¬¬30æ¡-ä¼˜å…ˆè€ƒè™‘æ³›å‹æ–¹æ³•" class="headerlink" title="ç¬¬30æ¡ ä¼˜å…ˆè€ƒè™‘æ³›å‹æ–¹æ³•"></a>ç¬¬30æ¡ ä¼˜å…ˆè€ƒè™‘æ³›å‹æ–¹æ³•</h4><h4 id="ç¬¬31æ¡-ä½¿ç”¨æœ‰ç•Œé€šé…ç¬¦æå‡APIçµæ´»æ€§"><a href="#ç¬¬31æ¡-ä½¿ç”¨æœ‰ç•Œé€šé…ç¬¦æå‡APIçµæ´»æ€§" class="headerlink" title="ç¬¬31æ¡ ä½¿ç”¨æœ‰ç•Œé€šé…ç¬¦æå‡APIçµæ´»æ€§"></a>ç¬¬31æ¡ ä½¿ç”¨æœ‰ç•Œé€šé…ç¬¦æå‡APIçµæ´»æ€§</h4><h4 id="ç¬¬32æ¡-è°¨æ…ç»„åˆæ³›å‹å’Œå¯å˜å‚æ•°ï¼ˆJava-7ï¼Œ9-æ–°å¢ï¼‰"><a href="#ç¬¬32æ¡-è°¨æ…ç»„åˆæ³›å‹å’Œå¯å˜å‚æ•°ï¼ˆJava-7ï¼Œ9-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬32æ¡ è°¨æ…ç»„åˆæ³›å‹å’Œå¯å˜å‚æ•°ï¼ˆJava 7ï¼Œ9 æ–°å¢ï¼‰"></a>ç¬¬32æ¡ è°¨æ…ç»„åˆæ³›å‹å’Œå¯å˜å‚æ•°ï¼ˆJava 7ï¼Œ9 æ–°å¢ï¼‰</h4><h4 id="ç¬¬33æ¡-ä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨çš„å¼‚æ„å®¹å™¨"><a href="#ç¬¬33æ¡-ä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨çš„å¼‚æ„å®¹å™¨" class="headerlink" title="ç¬¬33æ¡ ä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨çš„å¼‚æ„å®¹å™¨"></a>ç¬¬33æ¡ ä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨çš„å¼‚æ„å®¹å™¨</h4><h3 id="ç¬¬å…­ç« -æšä¸¾å’Œæ³¨è§£"><a href="#ç¬¬å…­ç« -æšä¸¾å’Œæ³¨è§£" class="headerlink" title="ç¬¬å…­ç«  æšä¸¾å’Œæ³¨è§£"></a>ç¬¬å…­ç«  æšä¸¾å’Œæ³¨è§£</h3><h4 id="ç¬¬34æ¡-ç”¨enumä»£æ›¿intå¸¸é‡"><a href="#ç¬¬34æ¡-ç”¨enumä»£æ›¿intå¸¸é‡" class="headerlink" title="ç¬¬34æ¡ ç”¨enumä»£æ›¿intå¸¸é‡"></a>ç¬¬34æ¡ ç”¨enumä»£æ›¿intå¸¸é‡</h4><h4 id="ç¬¬35æ¡-ç”¨å®ä¾‹åŸŸä»£æ›¿åºæ•°"><a href="#ç¬¬35æ¡-ç”¨å®ä¾‹åŸŸä»£æ›¿åºæ•°" class="headerlink" title="ç¬¬35æ¡ ç”¨å®ä¾‹åŸŸä»£æ›¿åºæ•°"></a>ç¬¬35æ¡ ç”¨å®ä¾‹åŸŸä»£æ›¿åºæ•°</h4><h4 id="ç¬¬36æ¡-ç”¨EnumSetä»£æ›¿ä½åŸŸ"><a href="#ç¬¬36æ¡-ç”¨EnumSetä»£æ›¿ä½åŸŸ" class="headerlink" title="ç¬¬36æ¡ ç”¨EnumSetä»£æ›¿ä½åŸŸ"></a>ç¬¬36æ¡ ç”¨EnumSetä»£æ›¿ä½åŸŸ</h4><h4 id="ç¬¬37æ¡-ç”¨EnumMapä»£æ›¿åºæ•°ç´¢å¼•"><a href="#ç¬¬37æ¡-ç”¨EnumMapä»£æ›¿åºæ•°ç´¢å¼•" class="headerlink" title="ç¬¬37æ¡ ç”¨EnumMapä»£æ›¿åºæ•°ç´¢å¼•"></a>ç¬¬37æ¡ ç”¨EnumMapä»£æ›¿åºæ•°ç´¢å¼•</h4><h4 id="ç¬¬38æ¡-ç”¨æ¥å£æ¨¡æ‹Ÿå¯æ‰©å±•çš„æšä¸¾"><a href="#ç¬¬38æ¡-ç”¨æ¥å£æ¨¡æ‹Ÿå¯æ‰©å±•çš„æšä¸¾" class="headerlink" title="ç¬¬38æ¡ ç”¨æ¥å£æ¨¡æ‹Ÿå¯æ‰©å±•çš„æšä¸¾"></a>ç¬¬38æ¡ ç”¨æ¥å£æ¨¡æ‹Ÿå¯æ‰©å±•çš„æšä¸¾</h4><h4 id="ç¬¬39æ¡-æ³¨è§£ä¼˜äºå‘½åæ¨¡å¼"><a href="#ç¬¬39æ¡-æ³¨è§£ä¼˜äºå‘½åæ¨¡å¼" class="headerlink" title="ç¬¬39æ¡ æ³¨è§£ä¼˜äºå‘½åæ¨¡å¼"></a>ç¬¬39æ¡ æ³¨è§£ä¼˜äºå‘½åæ¨¡å¼</h4><h4 id="ç¬¬40æ¡-åšæŒä½¿ç”¨Overrideæ³¨è§£"><a href="#ç¬¬40æ¡-åšæŒä½¿ç”¨Overrideæ³¨è§£" class="headerlink" title="ç¬¬40æ¡ åšæŒä½¿ç”¨Overrideæ³¨è§£"></a>ç¬¬40æ¡ åšæŒä½¿ç”¨Overrideæ³¨è§£</h4><h4 id="ç¬¬41æ¡-æ ‡è®°æ¥å£å®šä¹‰ç±»å‹"><a href="#ç¬¬41æ¡-æ ‡è®°æ¥å£å®šä¹‰ç±»å‹" class="headerlink" title="ç¬¬41æ¡ æ ‡è®°æ¥å£å®šä¹‰ç±»å‹"></a>ç¬¬41æ¡ æ ‡è®°æ¥å£å®šä¹‰ç±»å‹</h4><h3 id="ç¬¬ä¸ƒç« -Lambdaè¡¨è¾¾å¼å’Œæµ"><a href="#ç¬¬ä¸ƒç« -Lambdaè¡¨è¾¾å¼å’Œæµ" class="headerlink" title="ç¬¬ä¸ƒç«  Lambdaè¡¨è¾¾å¼å’Œæµ"></a>ç¬¬ä¸ƒç«  Lambdaè¡¨è¾¾å¼å’Œæµ</h3><h4 id="ç¬¬42æ¡-Lambdaè¡¨è¾¾å¼ä¼˜äºåŒ¿åç±»ï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬42æ¡-Lambdaè¡¨è¾¾å¼ä¼˜äºåŒ¿åç±»ï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬42æ¡ Lambdaè¡¨è¾¾å¼ä¼˜äºåŒ¿åç±»ï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬42æ¡ Lambdaè¡¨è¾¾å¼ä¼˜äºåŒ¿åç±»ï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬43æ¡-æ–¹æ³•å¼•ç”¨ä¼˜äºLambdaè¡¨è¾¾å¼ï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬43æ¡-æ–¹æ³•å¼•ç”¨ä¼˜äºLambdaè¡¨è¾¾å¼ï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬43æ¡ æ–¹æ³•å¼•ç”¨ä¼˜äºLambdaè¡¨è¾¾å¼ï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬43æ¡ æ–¹æ³•å¼•ç”¨ä¼˜äºLambdaè¡¨è¾¾å¼ï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬44æ¡-ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å‡½æ•°å¼æ¥å£ï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬44æ¡-ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å‡½æ•°å¼æ¥å£ï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬44æ¡ ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å‡½æ•°å¼æ¥å£ï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬44æ¡ ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å‡½æ•°å¼æ¥å£ï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬45æ¡-è°¨æ…ä½¿ç”¨æµï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬45æ¡-è°¨æ…ä½¿ç”¨æµï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬45æ¡ è°¨æ…ä½¿ç”¨æµï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬45æ¡ è°¨æ…ä½¿ç”¨æµï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬46æ¡-åœ¨æµä¸­ä¼˜å…ˆä½¿ç”¨æ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬46æ¡-åœ¨æµä¸­ä¼˜å…ˆä½¿ç”¨æ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬46æ¡ åœ¨æµä¸­ä¼˜å…ˆä½¿ç”¨æ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬46æ¡ åœ¨æµä¸­ä¼˜å…ˆä½¿ç”¨æ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬47æ¡-åœ¨è¿”å›ç±»å‹ä¸­Collectionä¼˜å…ˆäºStreamï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬47æ¡-åœ¨è¿”å›ç±»å‹ä¸­Collectionä¼˜å…ˆäºStreamï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬47æ¡ åœ¨è¿”å›ç±»å‹ä¸­Collectionä¼˜å…ˆäºStreamï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬47æ¡ åœ¨è¿”å›ç±»å‹ä¸­Collectionä¼˜å…ˆäºStreamï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬48æ¡-ä½¿ç”¨å¹¶è¡Œæµçš„æ—¶å€™è¦å°å¿ƒï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬48æ¡-ä½¿ç”¨å¹¶è¡Œæµçš„æ—¶å€™è¦å°å¿ƒï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬48æ¡ ä½¿ç”¨å¹¶è¡Œæµçš„æ—¶å€™è¦å°å¿ƒï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬48æ¡ ä½¿ç”¨å¹¶è¡Œæµçš„æ—¶å€™è¦å°å¿ƒï¼ˆJava8 æ–°å¢ï¼‰</h4><h3 id="ç¬¬å…«ç« -æ–¹æ³•"><a href="#ç¬¬å…«ç« -æ–¹æ³•" class="headerlink" title="ç¬¬å…«ç«  æ–¹æ³•"></a>ç¬¬å…«ç«  æ–¹æ³•</h3><h4 id="ç¬¬49æ¡-æ£€æŸ¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼ˆJava7-æ›´æ–°ï¼‰"><a href="#ç¬¬49æ¡-æ£€æŸ¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼ˆJava7-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬49æ¡ æ£€æŸ¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼ˆJava7 æ›´æ–°ï¼‰"></a>ç¬¬49æ¡ æ£€æŸ¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼ˆJava7 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬50æ¡-å¿…è¦æ—¶è¿›è¡Œä¿æŠ¤æ€§æ‹·è´ï¼ˆJava8-æ›´æ–°ï¼‰"><a href="#ç¬¬50æ¡-å¿…è¦æ—¶è¿›è¡Œä¿æŠ¤æ€§æ‹·è´ï¼ˆJava8-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬50æ¡ å¿…è¦æ—¶è¿›è¡Œä¿æŠ¤æ€§æ‹·è´ï¼ˆJava8 æ›´æ–°ï¼‰"></a>ç¬¬50æ¡ å¿…è¦æ—¶è¿›è¡Œä¿æŠ¤æ€§æ‹·è´ï¼ˆJava8 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬51æ¡-è°¨æ…è®¾è®¡æ–¹æ³•ç­¾å"><a href="#ç¬¬51æ¡-è°¨æ…è®¾è®¡æ–¹æ³•ç­¾å" class="headerlink" title="ç¬¬51æ¡ è°¨æ…è®¾è®¡æ–¹æ³•ç­¾å"></a>ç¬¬51æ¡ è°¨æ…è®¾è®¡æ–¹æ³•ç­¾å</h4><h4 id="ç¬¬52æ¡-æ…ç”¨é‡è½½"><a href="#ç¬¬52æ¡-æ…ç”¨é‡è½½" class="headerlink" title="ç¬¬52æ¡ æ…ç”¨é‡è½½"></a>ç¬¬52æ¡ æ…ç”¨é‡è½½</h4><h4 id="ç¬¬53æ¡-æ…ç”¨å¯å˜å‚æ•°"><a href="#ç¬¬53æ¡-æ…ç”¨å¯å˜å‚æ•°" class="headerlink" title="ç¬¬53æ¡ æ…ç”¨å¯å˜å‚æ•°"></a>ç¬¬53æ¡ æ…ç”¨å¯å˜å‚æ•°</h4><h4 id="ç¬¬54æ¡-è¿”å›ç©ºé›†åˆæˆ–è€…æ•°ç»„ï¼Œè€Œä¸æ˜¯null"><a href="#ç¬¬54æ¡-è¿”å›ç©ºé›†åˆæˆ–è€…æ•°ç»„ï¼Œè€Œä¸æ˜¯null" class="headerlink" title="ç¬¬54æ¡ è¿”å›ç©ºé›†åˆæˆ–è€…æ•°ç»„ï¼Œè€Œä¸æ˜¯null"></a>ç¬¬54æ¡ è¿”å›ç©ºé›†åˆæˆ–è€…æ•°ç»„ï¼Œè€Œä¸æ˜¯null</h4><h4 id="ç¬¬55æ¡-è°¨æ…è¿”å›Optionalï¼ˆJava8-æ–°å¢ï¼‰"><a href="#ç¬¬55æ¡-è°¨æ…è¿”å›Optionalï¼ˆJava8-æ–°å¢ï¼‰" class="headerlink" title="ç¬¬55æ¡ è°¨æ…è¿”å›Optionalï¼ˆJava8 æ–°å¢ï¼‰"></a>ç¬¬55æ¡ è°¨æ…è¿”å›Optionalï¼ˆJava8 æ–°å¢ï¼‰</h4><h4 id="ç¬¬56æ¡-ä¸ºæ‰€æœ‰å¯¼å‡ºçš„APIå…ƒç´ å†™æ–‡æ¡£æ³¨é‡Šï¼ˆJava7ï¼Œ8ï¼Œ9-æ›´æ–°ï¼‰"><a href="#ç¬¬56æ¡-ä¸ºæ‰€æœ‰å¯¼å‡ºçš„APIå…ƒç´ å†™æ–‡æ¡£æ³¨é‡Šï¼ˆJava7ï¼Œ8ï¼Œ9-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬56æ¡ ä¸ºæ‰€æœ‰å¯¼å‡ºçš„APIå…ƒç´ å†™æ–‡æ¡£æ³¨é‡Šï¼ˆJava7ï¼Œ8ï¼Œ9 æ›´æ–°ï¼‰"></a>ç¬¬56æ¡ ä¸ºæ‰€æœ‰å¯¼å‡ºçš„APIå…ƒç´ å†™æ–‡æ¡£æ³¨é‡Šï¼ˆJava7ï¼Œ8ï¼Œ9 æ›´æ–°ï¼‰</h4><h3 id="ç¬¬ä¹ç« -é€šç”¨ç¨‹åºè®¾è®¡"><a href="#ç¬¬ä¹ç« -é€šç”¨ç¨‹åºè®¾è®¡" class="headerlink" title="ç¬¬ä¹ç«  é€šç”¨ç¨‹åºè®¾è®¡"></a>ç¬¬ä¹ç«  é€šç”¨ç¨‹åºè®¾è®¡</h3><h4 id="ç¬¬57æ¡-å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–"><a href="#ç¬¬57æ¡-å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–" class="headerlink" title="ç¬¬57æ¡ å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–"></a>ç¬¬57æ¡ å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–</h4><h4 id="ç¬¬58æ¡-for-eachå¾ªç¯ä¼˜å…ˆäºä¼ ç»Ÿforå¾ªç¯"><a href="#ç¬¬58æ¡-for-eachå¾ªç¯ä¼˜å…ˆäºä¼ ç»Ÿforå¾ªç¯" class="headerlink" title="ç¬¬58æ¡ for-eachå¾ªç¯ä¼˜å…ˆäºä¼ ç»Ÿforå¾ªç¯"></a>ç¬¬58æ¡ for-eachå¾ªç¯ä¼˜å…ˆäºä¼ ç»Ÿforå¾ªç¯</h4><h4 id="ç¬¬59æ¡-äº†è§£å’Œä½¿ç”¨ç±»åº“ï¼ˆJava7ï¼Œ9-æ›´æ–°ï¼‰"><a href="#ç¬¬59æ¡-äº†è§£å’Œä½¿ç”¨ç±»åº“ï¼ˆJava7ï¼Œ9-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬59æ¡ äº†è§£å’Œä½¿ç”¨ç±»åº“ï¼ˆJava7ï¼Œ9 æ›´æ–°ï¼‰"></a>ç¬¬59æ¡ äº†è§£å’Œä½¿ç”¨ç±»åº“ï¼ˆJava7ï¼Œ9 æ›´æ–°ï¼‰</h4><h4 id="ç¬¬60æ¡-å¦‚æœéœ€è¦ç²¾ç¡®çš„ç­”æ¡ˆï¼Œè¯·é¿å…ä½¿ç”¨floatå’Œdouble"><a href="#ç¬¬60æ¡-å¦‚æœéœ€è¦ç²¾ç¡®çš„ç­”æ¡ˆï¼Œè¯·é¿å…ä½¿ç”¨floatå’Œdouble" class="headerlink" title="ç¬¬60æ¡ å¦‚æœéœ€è¦ç²¾ç¡®çš„ç­”æ¡ˆï¼Œè¯·é¿å…ä½¿ç”¨floatå’Œdouble"></a>ç¬¬60æ¡ å¦‚æœéœ€è¦ç²¾ç¡®çš„ç­”æ¡ˆï¼Œè¯·é¿å…ä½¿ç”¨floatå’Œdouble</h4><h4 id="ç¬¬61æ¡-åŸºæœ¬ç±»å‹ä¼˜å…ˆäºè£…ç®±åŸºæœ¬ç±»å‹"><a href="#ç¬¬61æ¡-åŸºæœ¬ç±»å‹ä¼˜å…ˆäºè£…ç®±åŸºæœ¬ç±»å‹" class="headerlink" title="ç¬¬61æ¡ åŸºæœ¬ç±»å‹ä¼˜å…ˆäºè£…ç®±åŸºæœ¬ç±»å‹"></a>ç¬¬61æ¡ åŸºæœ¬ç±»å‹ä¼˜å…ˆäºè£…ç®±åŸºæœ¬ç±»å‹</h4><h4 id="ç¬¬62æ¡-å¦‚æœæœ‰å…¶ä»–ç±»å‹æ›´åˆé€‚ï¼Œåˆ™å°½é‡é¿å…ä½¿ç”¨String"><a href="#ç¬¬62æ¡-å¦‚æœæœ‰å…¶ä»–ç±»å‹æ›´åˆé€‚ï¼Œåˆ™å°½é‡é¿å…ä½¿ç”¨String" class="headerlink" title="ç¬¬62æ¡ å¦‚æœæœ‰å…¶ä»–ç±»å‹æ›´åˆé€‚ï¼Œåˆ™å°½é‡é¿å…ä½¿ç”¨String"></a>ç¬¬62æ¡ å¦‚æœæœ‰å…¶ä»–ç±»å‹æ›´åˆé€‚ï¼Œåˆ™å°½é‡é¿å…ä½¿ç”¨String</h4><h4 id="ç¬¬63æ¡-å½“å¿ƒStringè¿æ¥çš„æ€§èƒ½"><a href="#ç¬¬63æ¡-å½“å¿ƒStringè¿æ¥çš„æ€§èƒ½" class="headerlink" title="ç¬¬63æ¡ å½“å¿ƒStringè¿æ¥çš„æ€§èƒ½"></a>ç¬¬63æ¡ å½“å¿ƒStringè¿æ¥çš„æ€§èƒ½</h4><h4 id="ç¬¬64æ¡-é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡"><a href="#ç¬¬64æ¡-é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡" class="headerlink" title="ç¬¬64æ¡ é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡"></a>ç¬¬64æ¡ é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡</h4><h4 id="ç¬¬65æ¡-æ¥å£ä¼˜å…ˆäºåå°„æœºåˆ¶"><a href="#ç¬¬65æ¡-æ¥å£ä¼˜å…ˆäºåå°„æœºåˆ¶" class="headerlink" title="ç¬¬65æ¡ æ¥å£ä¼˜å…ˆäºåå°„æœºåˆ¶"></a>ç¬¬65æ¡ æ¥å£ä¼˜å…ˆäºåå°„æœºåˆ¶</h4><h4 id="ç¬¬66æ¡-è°¨æ…ä½¿ç”¨æœ¬åœ°æ–¹æ³•"><a href="#ç¬¬66æ¡-è°¨æ…ä½¿ç”¨æœ¬åœ°æ–¹æ³•" class="headerlink" title="ç¬¬66æ¡ è°¨æ…ä½¿ç”¨æœ¬åœ°æ–¹æ³•"></a>ç¬¬66æ¡ è°¨æ…ä½¿ç”¨æœ¬åœ°æ–¹æ³•</h4><h4 id="ç¬¬67æ¡-è°¨æ…åœ°è¿›è¡Œä¼˜åŒ–"><a href="#ç¬¬67æ¡-è°¨æ…åœ°è¿›è¡Œä¼˜åŒ–" class="headerlink" title="ç¬¬67æ¡ è°¨æ…åœ°è¿›è¡Œä¼˜åŒ–"></a>ç¬¬67æ¡ è°¨æ…åœ°è¿›è¡Œä¼˜åŒ–</h4><h4 id="ç¬¬68æ¡-éµå®ˆæ™®éæ¥å—çš„å‘½åæƒ¯ä¾‹"><a href="#ç¬¬68æ¡-éµå®ˆæ™®éæ¥å—çš„å‘½åæƒ¯ä¾‹" class="headerlink" title="ç¬¬68æ¡ éµå®ˆæ™®éæ¥å—çš„å‘½åæƒ¯ä¾‹"></a>ç¬¬68æ¡ éµå®ˆæ™®éæ¥å—çš„å‘½åæƒ¯ä¾‹</h4><h3 id="ç¬¬åç« -å¼‚å¸¸"><a href="#ç¬¬åç« -å¼‚å¸¸" class="headerlink" title="ç¬¬åç«  å¼‚å¸¸"></a>ç¬¬åç«  å¼‚å¸¸</h3><h4 id="ç¬¬69æ¡-åªé’ˆå¯¹å¼‚å¸¸çš„æƒ…å†µæ‰ä½¿ç”¨å¼‚å¸¸"><a href="#ç¬¬69æ¡-åªé’ˆå¯¹å¼‚å¸¸çš„æƒ…å†µæ‰ä½¿ç”¨å¼‚å¸¸" class="headerlink" title="ç¬¬69æ¡ åªé’ˆå¯¹å¼‚å¸¸çš„æƒ…å†µæ‰ä½¿ç”¨å¼‚å¸¸"></a>ç¬¬69æ¡ åªé’ˆå¯¹å¼‚å¸¸çš„æƒ…å†µæ‰ä½¿ç”¨å¼‚å¸¸</h4><h4 id="ç¬¬70æ¡-å¯¹å¯æ¢å¤çš„æƒ…å†µä½¿ç”¨å—æ£€å¼‚å¸¸ï¼Œå¯¹ç¼–ç¨‹é”™è¯¯ä½¿ç”¨è¿è¡Œæ—¶å¼‚å¸¸"><a href="#ç¬¬70æ¡-å¯¹å¯æ¢å¤çš„æƒ…å†µä½¿ç”¨å—æ£€å¼‚å¸¸ï¼Œå¯¹ç¼–ç¨‹é”™è¯¯ä½¿ç”¨è¿è¡Œæ—¶å¼‚å¸¸" class="headerlink" title="ç¬¬70æ¡ å¯¹å¯æ¢å¤çš„æƒ…å†µä½¿ç”¨å—æ£€å¼‚å¸¸ï¼Œå¯¹ç¼–ç¨‹é”™è¯¯ä½¿ç”¨è¿è¡Œæ—¶å¼‚å¸¸"></a>ç¬¬70æ¡ å¯¹å¯æ¢å¤çš„æƒ…å†µä½¿ç”¨å—æ£€å¼‚å¸¸ï¼Œå¯¹ç¼–ç¨‹é”™è¯¯ä½¿ç”¨è¿è¡Œæ—¶å¼‚å¸¸</h4><h4 id="ç¬¬71æ¡-é¿å…ä¸å¿…è¦åœ°ä½¿ç”¨å—æ£€å¼‚å¸¸"><a href="#ç¬¬71æ¡-é¿å…ä¸å¿…è¦åœ°ä½¿ç”¨å—æ£€å¼‚å¸¸" class="headerlink" title="ç¬¬71æ¡ é¿å…ä¸å¿…è¦åœ°ä½¿ç”¨å—æ£€å¼‚å¸¸"></a>ç¬¬71æ¡ é¿å…ä¸å¿…è¦åœ°ä½¿ç”¨å—æ£€å¼‚å¸¸</h4><h4 id="ç¬¬72æ¡-ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å¼‚å¸¸"><a href="#ç¬¬72æ¡-ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å¼‚å¸¸" class="headerlink" title="ç¬¬72æ¡ ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å¼‚å¸¸"></a>ç¬¬72æ¡ ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å¼‚å¸¸</h4><h4 id="ç¬¬73æ¡-æŠ›å‡ºä¸æŠ½è±¡ç›¸å¯¹åº”çš„å¼‚å¸¸"><a href="#ç¬¬73æ¡-æŠ›å‡ºä¸æŠ½è±¡ç›¸å¯¹åº”çš„å¼‚å¸¸" class="headerlink" title="ç¬¬73æ¡ æŠ›å‡ºä¸æŠ½è±¡ç›¸å¯¹åº”çš„å¼‚å¸¸"></a>ç¬¬73æ¡ æŠ›å‡ºä¸æŠ½è±¡ç›¸å¯¹åº”çš„å¼‚å¸¸</h4><h4 id="ç¬¬74æ¡-æ¯ä¸ªæ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸éƒ½è¦æœ‰æ–‡æ¡£"><a href="#ç¬¬74æ¡-æ¯ä¸ªæ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸éƒ½è¦æœ‰æ–‡æ¡£" class="headerlink" title="ç¬¬74æ¡ æ¯ä¸ªæ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸éƒ½è¦æœ‰æ–‡æ¡£"></a>ç¬¬74æ¡ æ¯ä¸ªæ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸éƒ½è¦æœ‰æ–‡æ¡£</h4><h4 id="ç¬¬75æ¡-åœ¨ç»†èŠ‚æ¶ˆæ¯ä¸­åŒ…å«èƒ½æ•è·å¤±è´¥çš„ä¿¡æ¯"><a href="#ç¬¬75æ¡-åœ¨ç»†èŠ‚æ¶ˆæ¯ä¸­åŒ…å«èƒ½æ•è·å¤±è´¥çš„ä¿¡æ¯" class="headerlink" title="ç¬¬75æ¡ åœ¨ç»†èŠ‚æ¶ˆæ¯ä¸­åŒ…å«èƒ½æ•è·å¤±è´¥çš„ä¿¡æ¯"></a>ç¬¬75æ¡ åœ¨ç»†èŠ‚æ¶ˆæ¯ä¸­åŒ…å«èƒ½æ•è·å¤±è´¥çš„ä¿¡æ¯</h4><h4 id="ç¬¬76æ¡-åŠªåŠ›ä½¿å¤±è´¥ä¿æŒåŸå­æ€§"><a href="#ç¬¬76æ¡-åŠªåŠ›ä½¿å¤±è´¥ä¿æŒåŸå­æ€§" class="headerlink" title="ç¬¬76æ¡ åŠªåŠ›ä½¿å¤±è´¥ä¿æŒåŸå­æ€§"></a>ç¬¬76æ¡ åŠªåŠ›ä½¿å¤±è´¥ä¿æŒåŸå­æ€§</h4><h4 id="ç¬¬77æ¡-ä¸è¦é¡¾ç•¥å¼‚å¸¸"><a href="#ç¬¬77æ¡-ä¸è¦é¡¾ç•¥å¼‚å¸¸" class="headerlink" title="ç¬¬77æ¡ ä¸è¦é¡¾ç•¥å¼‚å¸¸"></a>ç¬¬77æ¡ ä¸è¦é¡¾ç•¥å¼‚å¸¸</h4><h3 id="ç¬¬åä¸€ç« -å¹¶å‘"><a href="#ç¬¬åä¸€ç« -å¹¶å‘" class="headerlink" title="ç¬¬åä¸€ç«  å¹¶å‘"></a>ç¬¬åä¸€ç«  å¹¶å‘</h3><h4 id="ç¬¬78æ¡-åŒæ­¥è®¿é—®å…±äº«çš„å¯å˜æ•°æ®"><a href="#ç¬¬78æ¡-åŒæ­¥è®¿é—®å…±äº«çš„å¯å˜æ•°æ®" class="headerlink" title="ç¬¬78æ¡ åŒæ­¥è®¿é—®å…±äº«çš„å¯å˜æ•°æ®"></a>ç¬¬78æ¡ åŒæ­¥è®¿é—®å…±äº«çš„å¯å˜æ•°æ®</h4><h4 id="ç¬¬79æ¡-é¿å…è¿‡åº¦åŒæ­¥"><a href="#ç¬¬79æ¡-é¿å…è¿‡åº¦åŒæ­¥" class="headerlink" title="ç¬¬79æ¡ é¿å…è¿‡åº¦åŒæ­¥"></a>ç¬¬79æ¡ é¿å…è¿‡åº¦åŒæ­¥</h4><h4 id="ç¬¬80æ¡-executorsï¼Œtaskï¼Œstreamä¼˜å…ˆäºçº¿ç¨‹ï¼ˆJava7ï¼Œ8æ›´æ–°ï¼‰"><a href="#ç¬¬80æ¡-executorsï¼Œtaskï¼Œstreamä¼˜å…ˆäºçº¿ç¨‹ï¼ˆJava7ï¼Œ8æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬80æ¡ executorsï¼Œtaskï¼Œstreamä¼˜å…ˆäºçº¿ç¨‹ï¼ˆJava7ï¼Œ8æ›´æ–°ï¼‰"></a>ç¬¬80æ¡ executorsï¼Œtaskï¼Œstreamä¼˜å…ˆäºçº¿ç¨‹ï¼ˆJava7ï¼Œ8æ›´æ–°ï¼‰</h4><h4 id="ç¬¬81æ¡-å¹¶å‘å·¥å…·ä¼˜å…ˆäºwaitå’Œnotify"><a href="#ç¬¬81æ¡-å¹¶å‘å·¥å…·ä¼˜å…ˆäºwaitå’Œnotify" class="headerlink" title="ç¬¬81æ¡ å¹¶å‘å·¥å…·ä¼˜å…ˆäºwaitå’Œnotify"></a>ç¬¬81æ¡ å¹¶å‘å·¥å…·ä¼˜å…ˆäºwaitå’Œnotify</h4><h4 id="ç¬¬82æ¡-çº¿ç¨‹å®‰å…¨æ–‡æ¡£åŒ–"><a href="#ç¬¬82æ¡-çº¿ç¨‹å®‰å…¨æ–‡æ¡£åŒ–" class="headerlink" title="ç¬¬82æ¡ çº¿ç¨‹å®‰å…¨æ–‡æ¡£åŒ–"></a>ç¬¬82æ¡ çº¿ç¨‹å®‰å…¨æ–‡æ¡£åŒ–</h4><h4 id="ç¬¬83æ¡-æ…ç”¨å»¶è¿Ÿåˆå§‹åŒ–"><a href="#ç¬¬83æ¡-æ…ç”¨å»¶è¿Ÿåˆå§‹åŒ–" class="headerlink" title="ç¬¬83æ¡ æ…ç”¨å»¶è¿Ÿåˆå§‹åŒ–"></a>ç¬¬83æ¡ æ…ç”¨å»¶è¿Ÿåˆå§‹åŒ–</h4><h4 id="ç¬¬84æ¡-ä¸è¦ä¾èµ–çº¿ç¨‹è°ƒåº¦å™¨ï¼ˆJava7-æ›´æ–°ï¼‰"><a href="#ç¬¬84æ¡-ä¸è¦ä¾èµ–çº¿ç¨‹è°ƒåº¦å™¨ï¼ˆJava7-æ›´æ–°ï¼‰" class="headerlink" title="ç¬¬84æ¡ ä¸è¦ä¾èµ–çº¿ç¨‹è°ƒåº¦å™¨ï¼ˆJava7 æ›´æ–°ï¼‰"></a>ç¬¬84æ¡ ä¸è¦ä¾èµ–çº¿ç¨‹è°ƒåº¦å™¨ï¼ˆJava7 æ›´æ–°ï¼‰</h4><h3 id="ç¬¬åäºŒç« -åºåˆ—åŒ–"><a href="#ç¬¬åäºŒç« -åºåˆ—åŒ–" class="headerlink" title="ç¬¬åäºŒç«  åºåˆ—åŒ–"></a>ç¬¬åäºŒç«  åºåˆ—åŒ–</h3><h4 id="ç¬¬85æ¡-å…¶ä»–é€‰æ‹©ä¼˜å…ˆäºJavaåºåˆ—åŒ–ï¼ˆæ–°å¢ï¼‰"><a href="#ç¬¬85æ¡-å…¶ä»–é€‰æ‹©ä¼˜å…ˆäºJavaåºåˆ—åŒ–ï¼ˆæ–°å¢ï¼‰" class="headerlink" title="ç¬¬85æ¡ å…¶ä»–é€‰æ‹©ä¼˜å…ˆäºJavaåºåˆ—åŒ–ï¼ˆæ–°å¢ï¼‰"></a>ç¬¬85æ¡ å…¶ä»–é€‰æ‹©ä¼˜å…ˆäºJavaåºåˆ—åŒ–ï¼ˆæ–°å¢ï¼‰</h4><h4 id="ç¬¬86æ¡-è°¨æ…å®ç°Serializableæ¥å£"><a href="#ç¬¬86æ¡-è°¨æ…å®ç°Serializableæ¥å£" class="headerlink" title="ç¬¬86æ¡ è°¨æ…å®ç°Serializableæ¥å£"></a>ç¬¬86æ¡ è°¨æ…å®ç°Serializableæ¥å£</h4><h4 id="ç¬¬87æ¡-è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰çš„åºåˆ—åŒ–å½¢å¼"><a href="#ç¬¬87æ¡-è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰çš„åºåˆ—åŒ–å½¢å¼" class="headerlink" title="ç¬¬87æ¡ è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰çš„åºåˆ—åŒ–å½¢å¼"></a>ç¬¬87æ¡ è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰çš„åºåˆ—åŒ–å½¢å¼</h4><h4 id="ç¬¬88æ¡-ä¿æŠ¤æ€§ç¼–å†™readObjectæ–¹æ³•"><a href="#ç¬¬88æ¡-ä¿æŠ¤æ€§ç¼–å†™readObjectæ–¹æ³•" class="headerlink" title="ç¬¬88æ¡ ä¿æŠ¤æ€§ç¼–å†™readObjectæ–¹æ³•"></a>ç¬¬88æ¡ ä¿æŠ¤æ€§ç¼–å†™readObjectæ–¹æ³•</h4><h4 id="ç¬¬89æ¡-å¯¹äºå®ä¾‹æ§åˆ¶ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäºreadResolve"><a href="#ç¬¬89æ¡-å¯¹äºå®ä¾‹æ§åˆ¶ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäºreadResolve" class="headerlink" title="ç¬¬89æ¡ å¯¹äºå®ä¾‹æ§åˆ¶ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäºreadResolve"></a>ç¬¬89æ¡ å¯¹äºå®ä¾‹æ§åˆ¶ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäºreadResolve</h4><h4 id="ç¬¬90æ¡-è€ƒè™‘ç”¨åºåˆ—åŒ–ä»£ç†ä»£æ›¿åºåˆ—åŒ–å®ä¾‹"><a href="#ç¬¬90æ¡-è€ƒè™‘ç”¨åºåˆ—åŒ–ä»£ç†ä»£æ›¿åºåˆ—åŒ–å®ä¾‹" class="headerlink" title="ç¬¬90æ¡ è€ƒè™‘ç”¨åºåˆ—åŒ–ä»£ç†ä»£æ›¿åºåˆ—åŒ–å®ä¾‹"></a>ç¬¬90æ¡ è€ƒè™‘ç”¨åºåˆ—åŒ–ä»£ç†ä»£æ›¿åºåˆ—åŒ–å®ä¾‹</h4><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://my.oschina.net/u/2277632/blog/1618901" target="_blank" rel="external">Effective Java ç¬¬ä¸‰ç‰ˆæœ‰ä»€ä¹ˆæ–°æ–™ è¯‘</a></li>
<li><a href="https://www.jianshu.com/p/d29f85f0f93e" target="_blank" rel="external">ã€ŠEffective Java ç¬¬ä¸‰ç‰ˆã€‹æ–°æ¡ç›®ä»‹ç»</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šè¶Šå­¦è¶Šè¿·èŒ«ï¼Œæœ‰æ‰€è°“çš„é‡ç‚¹å—ï¼Ÿæˆ‘åæ­£ç°åœ¨è¿˜å¼„ä¸æ¸…æ¥šï¼Œæ—¢ç„¶å¼„ä¸æ¸…æ¥šï¼Œé‚£å°±å¥½å¥½ä¸“æ³¨äºè„šä¸‹å§ã€‚æˆ‘æ›¾ç»çœ‹è¿‡ä¸€éEffective Javaç¬¬äºŒç‰ˆï¼Œå¯èƒ½é‚£ä¸ªæ—¶å€™çš„ä»£ç é‡è¿˜ä¸å¤Ÿå§ï¼Œä¸èƒ½ç†è§£å…¶ç²¾é«“ï¼Œç°åœ¨çœ‹çœ‹æ‰èƒ½å›å‘³ä¸€ç‚¹ã€‚åˆšå¥½ä»Šå¹´å¹´åˆç¬¬ä¸‰ç‰ˆï¼ˆè‹±æ–‡ç‰ˆï¼‰ä¹Ÿå‡ºæ¥ï¼Œæ–°å¢äº†Java7ã€8ã€9çš„ä¸€äº›æ¡ç›®ï¼Œè¿™é‡Œä¹Ÿå°±æƒ³åˆ—ä¸€äº›ç¬¬ä¸‰ç‰ˆçš„ç›®å½•ï¼Œä¾›è‡ªå·±æŸ¥æ‰¾ä¸å®è·µï¼Œå¸Œæœ›è‡ªå·±èƒ½å¤Ÿçœ‹åˆ°æ¡ç›®å°±èƒ½è¯´å‡ºæ‰€ä»¥ç„¶æ¥ï¼Œä¹Ÿæƒ³ç¿»è¯‘ä¸€ä¸‹æ–°å¢çš„ä¸€äº›æ¡ç›®ã€‚å¤§å®¶ä¹Ÿå¯ä»¥äº’ç›¸äº¤æµã€‚
    
    </summary>
    
      <category term="æ‘†è„±çƒ‚ä»£ç " scheme="http://bestlixiang.site/categories/%E6%91%86%E8%84%B1%E7%83%82%E4%BB%A3%E7%A0%81/"/>
    
    
      <category term="Java" scheme="http://bestlixiang.site/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot+Git+Jenkins+Dockerå®ç°CI/CD</title>
    <link href="http://bestlixiang.site/2018/07/18/%E8%BF%90%E7%BB%B4/SpringBoot-Git-Jenkins-Docker%E5%AE%9E%E7%8E%B0CI-CD/"/>
    <id>http://bestlixiang.site/2018/07/18/è¿ç»´/SpringBoot-Git-Jenkins-Dockerå®ç°CI-CD/</id>
    <published>2018-07-18T01:03:46.000Z</published>
    <updated>2018-07-18T02:56:30.888Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šç°åœ¨DevOpsè¿™ä¹ˆè¿è¡Œï¼Œä½ æ²¡æœ‰ç†ç”±ä¸å»äº†è§£ï¼Œä¸å»å®è·µï¼Œè¿™æ¬¡å°±ä»¥Springbootä¸ºåº•ï¼Œåˆ©ç”¨Gitï¼Œjenkinsï¼ŒDockerå®ç°æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ï¼<a id="more"></a></p>
<h1 id="å¼€å‘æµç¨‹"><a href="#å¼€å‘æµç¨‹" class="headerlink" title="å¼€å‘æµç¨‹"></a>å¼€å‘æµç¨‹</h1><p>ä¸‹é¢æ˜¯å¸¸ç”¨çš„å¼€å‘æµç¨‹å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com//cicd/devops.jpg" alt="dev"></p>
<p>æˆ‘ä»¬ç®€å•è¯´è¯´è¿™å¼ å›¾ï¼šé¦–å…ˆæˆ‘ä»¬ä¼šå°†ä»£ç æ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ä»¥åŠDockerfileéƒ½å­˜åœ¨ä»£ç ä»“åº“é‡Œï¼Œç‰ˆæœ¬æ§åˆ¶åˆ©ç”¨gitï¼Œè¿™é‡Œä»£ç ä»“åº“æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”å¦‚githubã€ç äº‘(æœ¬æ¬¡ä½¿ç”¨)ã€Codingä»¥åŠè‡ªå·±æ­å»ºçš„gitlabã€‚ç„¶åç”±æŒç»­é›†æˆå·¥å…·è¿›è¡Œè‡ªåŠ¨åŒ–æ„å»ºï¼ŒåŒ…æ‹¬äº†æµ‹è¯•ã€ç¼–è¯‘ã€æ‰“åŒ…ã€æ„å»ºé•œåƒã€æ¨é€é•œåƒåˆ°ä»“åº“ï¼ˆæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚dockerå®˜æ–¹ä»“åº“ï¼Œæ—¶é€Ÿè¿ã€è‡ªå·±æ­å»ºçš„Registryï¼‰ã€å¯åŠ¨æœåŠ¡ç­‰æ“ä½œï¼ŒæŒç»­é›†æˆå·¥å…·ä¹Ÿæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”å¦‚Jenkins(è¿™æ¬¡ä½¿ç”¨)ã€Gitlab CIã€Trivas CIã€‚è¿™é‡Œä½¿ç”¨çš„å®¹å™¨æ˜¯Dockerï¼Œè¿™é‡ŒDockerçš„ç¼–æ’å·¥å…·å¯ä»¥é€‰æ‹©Swarmï¼Œä¹Ÿå¯ä»¥æ˜¯K8Sã€‚</p>
<p>æœ¬æ¬¡å®ç°æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>pushä»£ç åˆ°ç äº‘è§¦å‘WebHook</li>
<li>Jenkinsä»ç äº‘æ‹‰å–ä»£ç </li>
<li>mavenæ„å»ºä»£ç </li>
<li>buildé•œåƒ</li>
<li>pushé•œåƒåˆ°é•œåƒä»“åº“</li>
<li>éƒ¨ç½²æœåŠ¡</li>
</ol>
<h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><p>å…³äºJdkã€Gitã€Mavençš„é…ç½®è¿™é‡Œå°±ä¸è¯´ï¼Œè‡ªå·±é¢å‘æœç´¢å¼•æ“ã€‚è¿™é‡Œä¸»è¦è¯´Jenkinså’Œç äº‘çš„é…ç½®ã€‚</p>
<h2 id="Jenkinså®‰è£…é…ç½®"><a href="#Jenkinså®‰è£…é…ç½®" class="headerlink" title="Jenkinså®‰è£…é…ç½®"></a>Jenkinså®‰è£…é…ç½®</h2><ol>
<li><a href="https://jenkins.io/download/" target="_blank" rel="external">ä¸‹è½½Jenkins</a>ï¼ˆé‡‡ç”¨waråŒ…å®‰è£…ï¼‰</li>
<li>å°†waråŒ…æ”¾å…¥Tomcatçš„webappsç›®å½•ä¸‹</li>
<li>è¿›å…¥YourHostIp:8080/jenkinsè·¯å¾„ä¸‹è¿›è¡ŒJenkinsçš„åˆå§‹åŒ–ï¼Œæˆ‘ä»¬è¿›å…¥ <strong>ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶</strong> å®‰è£…ç•Œé¢ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„æ„å»ºæ–¹å¼é€‰æ‹©éœ€è¦å®‰è£…çš„æ’ä»¶ï¼Œæœ¬æ¬¡ä½¿ç”¨çš„Pipelinesæ–¹å¼è¿›è¡Œæ„å»ºï¼ŒPipelinesæ–¹å¼æ˜¯Jenkins2æ¨èçš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„å»ºPipelinesç›¸å…³çš„æ’ä»¶è¿›è¡Œå®‰è£…ï¼Œå½“ç„¶å¾…ä¼šè¿›å…¥Jenkinså®‰è£…ä¹Ÿè¡Œã€‚</li>
<li>é…ç½®ç”¨æˆ·åå’Œå¯†ç </li>
<li>å…¨å±€å·¥å…·é…ç½®ï¼ˆä»ç³»ç»Ÿç®¡ç†è¿›å…¥å…¨å±€å·¥å…·é…ç½®ï¼Œé…ç½®Jdkã€Gitã€Mavenï¼‰</li>
<li><p>å®‰å…¨é…ç½®ï¼ˆä»ç³»ç»Ÿç®¡ç†è¿›å…¥å…¨å±€å®‰å…¨é…ç½®ï¼‰,å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com//cici/jenkins_security.jpg" alt="jenkins_security"></p>
</li>
</ol>
<h2 id="Jenkinsæ„å»ºä»»åŠ¡"><a href="#Jenkinsæ„å»ºä»»åŠ¡" class="headerlink" title="Jenkinsæ„å»ºä»»åŠ¡"></a>Jenkinsæ„å»ºä»»åŠ¡</h2><ol>
<li>æ–°å»ºä»»åŠ¡ï¼Œæ„å»ºä¸€ä¸ªæµæ°´çº¿ä»»åŠ¡ï¼ˆPipelineï¼‰</li>
<li><p>åœ¨é…ç½®é‡Œæ„å»ºè§¦å‘å™¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p> <img src="http://o6plzvjf2.bkt.clouddn.com//cicd/jenkins_webhooks_url.jpg" alt="jenkins_webhooks_url"></p>
</li>
<li><p>æ„å»ºPipelineè„šæœ¬ï¼ˆPipelineè„šæœ¬å†™æ³•è§å‚è€ƒï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">  #!groovy</div><div class="line">  pipeline&#123;</div><div class="line">    agent any</div><div class="line">    //å®šä¹‰ä»“åº“åœ°å€</div><div class="line">    environment &#123;</div><div class="line">        REPOSITORY=&quot;https://gitee.com/todorex/springboot_docker_git_jenkins_demo.git&quot;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    stages &#123;</div><div class="line"></div><div class="line">        stage(&apos;è·å–ä»£ç &apos;)&#123;</div><div class="line">            steps &#123;</div><div class="line">                echo &quot;start fetch code from git:$&#123;REPOSITORY&#125;&quot;</div><div class="line">                // æ¸…ç©ºå½“å‰ç›®å½•</div><div class="line">                deleteDir()</div><div class="line">                // æ‹‰å–ä»£ç     </div><div class="line">                git &quot;$&#123;REPOSITORY&#125;&quot;</div><div class="line">                // æ¸…ç©ºä¹‹å‰çš„å®¹å™¨</div><div class="line">                sh &apos;docker stop $(docker ps -a -q)&apos;</div><div class="line">                sh &apos;docker rm $(docker ps -a -q)&apos;</div><div class="line">            &#125;</div><div class="line">        &#125;       </div><div class="line"></div><div class="line">        stage(&apos;Maven æ„å»º&apos;)&#123;</div><div class="line">            steps &#123;</div><div class="line">                echo &quot;start compile&quot;</div><div class="line">                // åˆ‡æ¢ç›®å½•</div><div class="line">                dir(&apos;demo&apos;) &#123;</div><div class="line">                    // é‡æ–°æ‰“åŒ…</div><div class="line">                    sh &apos;mvn -Dmaven.test.skip=true -U clean install&apos;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        stage(&apos;æ„å»ºé•œåƒ&apos;)&#123;</div><div class="line">            steps &#123;</div><div class="line">                echo &quot;start build image&quot;</div><div class="line">                dir(&apos;demo&apos;) &#123;</div><div class="line">                    // buildé•œåƒ</div><div class="line">                    sh &apos;docker build -t todorex/springboot_docker_git_jenkins_demo:1.0 .&apos;</div><div class="line">                    // ç™»å½•é•œåƒä»“åº“</div><div class="line">                    sh &apos;docker login -u your_username -p your_password&apos;</div><div class="line">                    // æ¨é€é•œåƒåˆ°é•œåƒä»“åº“</div><div class="line">                    sh &apos;docker push todorex/springboot_docker_git_jenkins_demo:1.0&apos;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        stage(&apos;å¯åŠ¨æœåŠ¡&apos;)&#123;</div><div class="line">            steps &#123;</div><div class="line">                echo &quot;start demo&quot;</div><div class="line">                // éƒ¨ç½²æœåŠ¡</div><div class="line">                sh &apos;docker run -d -p 8888:8888 --name=demo todorex/springboot_docker_git_jenkins_demo:1.0&apos;</div><div class="line">            &#125;</div><div class="line">        &#125;                </div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="SSHçš„é…ç½®"><a href="#SSHçš„é…ç½®" class="headerlink" title="SSHçš„é…ç½®"></a>SSHçš„é…ç½®</h2><p>ä¸ºäº†é¿å…jenkinsæ‹‰å–ä»£ç æ—¶éœ€è¦è¾“å…¥å¯†ç ï¼Œè¿™é‡Œéœ€è¦é…ç½®SSHå…å¯†ç æ‹‰å–ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com//cicd/gitee_ssh.jpg" alt="gitee_ssh"></p>
<h2 id="WebHooksé…ç½®"><a href="#WebHooksé…ç½®" class="headerlink" title="WebHooksé…ç½®"></a>WebHooksé…ç½®</h2><p>å½“ä½ æ¯æ¬¡å¯¹ä»£ç ä»“åº“è¿›è¡Œpushæ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨é€šçŸ¥jenkinsè¿›è¡Œæ„å»º<br><img src="http://o6plzvjf2.bkt.clouddn.com//cicd/gitee_webhooks.jpg" alt="gitee_webhooks"></p>
<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>è¿™æ¬¡é¡¹ç›®çš„ä»£ç ä»“åº“ä¸ºï¼š<a href="https://gitee.com/todorex/springboot_docker_git_jenkins_demo" target="_blank" rel="external">springboot_docker_git_jenkins_demo</a></p>
<p>å…³äºDockerfileä»¥åŠdocker-compose.ymlçš„ç¼–å†™ï¼Œè‡ªå·±ä¹Ÿå»é¢å‘æœç´¢å¼•æ“çœ‹çœ‹å§ã€‚</p>
<p>å½“æˆ‘ä»¬pushä»£ç ä¹‹åï¼Œjenkinså°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œæ„å»ºã€‚å¦‚ä¸‹å›¾ï¼š<br><img src="http://o6plzvjf2.bkt.clouddn.com//cicd/jenkins_test.jpg" alt="jenkins_test"></p>
<p>PSï¼šç¬¬ä¸€æ¬¡æ¯”è¾ƒæ…¢æ˜¯å› ä¸ºè¦å®‰è£…Mavenä¾èµ–ï¼Œåé¢å°±å¥½äº†ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™é‡Œåªæ˜¯å±•ç¤ºäº†ä¸€ä¸ªCI/CDçš„å¼€å‘æµç¨‹ï¼Œå…³äºå…·ä½“æŠ€æœ¯ç»†èŠ‚ï¼Œæ— è®ºæ˜¯Jenkinsè¿˜æ˜¯Dockeréƒ½éœ€è¦æ·±å…¥å­¦ä¹ ï¼ŒåŠ æ²¹ï¼Œéªšå¹´ï¼</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="http://niocoder.com/2018/04/22/SpringBoot+Docker+Git+Jenkins%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93%E7%9A%84%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%92%8C%E9%83%A8%E7%BD%B2/" target="_blank" rel="external">SpringBoot+Docker+Git+Jenkinså®ç°ç®€æ˜“çš„æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²</a></li>
<li><a href="http://www.cnblogs.com/fengjian2016/p/8227532.html" target="_blank" rel="external">Jenkins pipelineï¼špipeline è¯­æ³•è¯¦è§£</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šç°åœ¨DevOpsè¿™ä¹ˆè¿è¡Œï¼Œä½ æ²¡æœ‰ç†ç”±ä¸å»äº†è§£ï¼Œä¸å»å®è·µï¼Œè¿™æ¬¡å°±ä»¥Springbootä¸ºåº•ï¼Œåˆ©ç”¨Gitï¼Œjenkinsï¼ŒDockerå®ç°æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ï¼
    
    </summary>
    
      <category term="è¿ç»´" scheme="http://bestlixiang.site/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="SpringBoot" scheme="http://bestlixiang.site/tags/SpringBoot/"/>
    
      <category term="Git" scheme="http://bestlixiang.site/tags/Git/"/>
    
      <category term="Jenkins" scheme="http://bestlixiang.site/tags/Jenkins/"/>
    
      <category term="Docker" scheme="http://bestlixiang.site/tags/Docker/"/>
    
      <category term="CI" scheme="http://bestlixiang.site/tags/CI/"/>
    
      <category term="CD" scheme="http://bestlixiang.site/tags/CD/"/>
    
  </entry>
  
  <entry>
    <title>Mavenä½¿ç”¨æ•´ç†</title>
    <link href="http://bestlixiang.site/2018/07/06/%E5%B7%A5%E5%85%B7/Maven%E4%BD%BF%E7%94%A8%E6%95%B4%E7%90%86/"/>
    <id>http://bestlixiang.site/2018/07/06/å·¥å…·/Mavenä½¿ç”¨æ•´ç†/</id>
    <published>2018-07-06T14:03:35.000Z</published>
    <updated>2018-07-06T14:06:36.067Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šä½¿ç”¨Javaè¯­è¨€æ¥å¼€å‘ä½ çš„é¡¹ç›®ï¼ŒåŸºæœ¬ä¸Šéƒ½å°‘ä¸äº†Mavenï¼Œå› ä¸ºæœ‰äº†å®ƒçœŸæ˜¯å¤ªæ–¹ä¾¿äº†ï¼<a id="more"></a></p>
<h1 id="ä»€ä¹ˆæ˜¯Maven"><a href="#ä»€ä¹ˆæ˜¯Maven" class="headerlink" title="ä»€ä¹ˆæ˜¯Maven"></a>ä»€ä¹ˆæ˜¯Maven</h1><p><a href="https://maven.apache.org/" target="_blank" rel="external">Maven</a>æ˜¯ä¸€ç§ç”¨æ¥ç®¡ç†Javaé¡¹ç›®çš„å·¥å…·ã€ä½†ä¸æ˜¯é‚£ç§é‚£ç§ç”¨æ¥ç®¡ç†èµ„æºè§„åˆ’å’Œè°ƒåº¦çš„å·¥å…·ã€‚ç›¸åï¼Œå®ƒå¤„ç†çš„æ—¶ä¸€ä¸ªå…·ä½“çš„é¡¹ç›®æ‰€æ¶‰åŠçš„å„ç§ä»»åŠ¡ï¼Œå¦‚ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ä»¥åŠéƒ¨ç½²ã€‚</p>
<p>MavenåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><p>ä¸€ç»„ç”¨äºå¤„ç†ç®¡ç†ä¾èµ–(ä»<a href="http://mvnrepository.com/" target="_blank" rel="external">ä¸­å¤®ä»“åº“</a>æ‹‰å–çš„jaråŒ…)ã€<a href="http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html" target="_blank" rel="external">ç›®å½•ç»“æ„</a>ä»¥åŠæ„å»ºå·¥ä½œæµçš„<strong>çº¦å®š</strong>ã€‚</p>
<p>  åŸºäºè¿™äº›çº¦å®šå®ç°çš„æ ‡å‡†åŒ–å¯ä»¥æå¤§åœ°ç®€åŒ–å¼€å‘è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¸¸ç”¨çš„ç›®å½•ç»“æ„ä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´åŠ å®¹æ˜“è·Ÿä¸Šä¸ç†Ÿæ‚‰çš„é¡¹ç›®çš„èŠ‚å¥ã€‚</p>
</li>
<li><p>ä¸€ä¸ªç”¨äºé¡¹ç›®é…ç½®çš„<a href="http://maven.apache.org/guides/introduction/introduction-to-the-pom.html" target="_blank" rel="external">XML Schema</a>ï¼šé¡¹ç›®å¯¹è±¡æ¨¡å‹(Project Object Model)ï¼Œç®€ç§°POMã€‚</p>
<p>  æ¯ä¸€ä¸ªMavené¡¹ç›®éƒ½æ‹¥æœ‰ä¸€ä¸ªPOMæ–‡ä»¶ï¼Œå¹¶å‘½åä¸ºpom.xmlï¼ŒåŒ…å«Mavenç”¨äºç®¡ç†è¯¥é¡¹ç›®çš„æ‰€æœ‰çš„é…ç½®ä¿¡æ¯ã€‚</p>
</li>
<li><p>ä¸€ä¸ªå§”æ‰˜å¤–éƒ¨ç»„ä»¶æ¥æ‰§è¡Œé¡¹ç›®ä»»åŠ¡çš„<a href="https://maven.apache.org/plugins/index.html" target="_blank" rel="external">æ’ä»¶ç»“æ„</a>ã€‚</p>
<p>  è¿™ç®€åŒ–äº†æ›´æ–°ä¸€é›†æ‰©å±•Mavenèƒ½åŠ›çš„è¿‡ç¨‹ã€‚</p>
</li>
</ul>
<h1 id="Mavenå®‰è£…"><a href="#Mavenå®‰è£…" class="headerlink" title="Mavenå®‰è£…"></a>Mavenå®‰è£…</h1><p><strong>PSï¼š</strong> ä¸Šé¢æåˆ°äº†Mavenå¸®æˆ‘ä»¬ç®¡ç†ä¾èµ–ï¼Œæ˜¯é€šè¿‡ä»ä¸­å¤®ä»“åº“æ‹‰å–jaråŒ…(ä¾èµ–)æ¥å®ç°ï¼Œä½†æ˜¯ç”±äºMavençš„ä¸­å¤®ä»“åº“åœ¨å›½å¤–ï¼Œæ‹‰å–ä¼šæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šé€šè¿‡é…ç½®é˜¿é‡Œäº‘é•œåƒæ¥åŠ å¿«é€Ÿåº¦ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥<a href="https://blog.sonatype.com/" target="_blank" rel="external">Nexus</a>æ­å»ºè‡ªå·±çš„ç§æœ‰ä»“åº“ã€‚</p>
<ol>
<li><a href="https://blog.csdn.net/ck4438707/article/details/53377413" target="_blank" rel="external">Mavenå®‰è£…æ•™ç¨‹</a></li>
<li><a href="https://blog.csdn.net/u012424449/article/details/77853983" target="_blank" rel="external">é…ç½®é˜¿é‡Œäº‘é•œåƒä»“åº“</a></li>
</ol>
<h1 id="POM"><a href="#POM" class="headerlink" title="POM"></a>POM</h1><p>POMæ–‡ä»¶å¤§çº²å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;project&gt; // æ ¹å…ƒç´ </div><div class="line">    &lt;groupId/&gt;</div><div class="line">    &lt;artifactId/&gt;</div><div class="line">    &lt;version/&gt; // ä¸Šé¢ä¸‰ä¸ª(GAVåæ ‡)å”¯ä¸€åœ°å®šä¹‰Mavené¡¹ç›®çš„å€¼</div><div class="line">    &lt;packaging/&gt; // é¡¹ç›®æ‰“åŒ…æ–¹å¼ï¼Œé»˜è®¤å€¼æ˜¯jar</div><div class="line">    &lt;properties/&gt; // åœ¨POMä¸­å¼•ç”¨çš„å±æ€§ï¼Œä¸€èˆ¬ä¼šæ”¾ç‰ˆæœ¬ä¿¡æ¯</div><div class="line">    &lt;dependencies/&gt; //æ„å»ºå½“å‰é¡¹ç›®æ‰€éœ€è¦çš„å…¶ä»–Mavené¡¹ç›®</div><div class="line">    &lt;build/&gt; // æ„å»ºæ”¹é¡¹ç›®æ‰€éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡çš„é…ç½®</div><div class="line">    &lt;profiles/&gt; // ä¸ºä¸åŒçš„ç”¨ä¾‹è‡ªå®šä¹‰POMï¼Œä¸€èˆ¬ç”¨æ¥é…ç½®ç¯å¢ƒçš„åˆ‡æ¢</div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure></p>
<h2 id="Mavenæ„ä»¶"><a href="#Mavenæ„ä»¶" class="headerlink" title="Mavenæ„ä»¶"></a>Mavenæ„ä»¶</h2><p>ä»»ä½•å¯ä»¥è¢«Mavençš„åæ ‡ç³»ç»Ÿ(GAV)å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªMavenæ„ä»¶ã€‚</p>
<p>Mavenæ„ä»¶çš„ç±»å‹ç”±pomæ–‡ä»¶çš„<packaging>å…ƒç´ æŒ‡å®šã€‚æœ€å¸¸ç”¨çš„å€¼æ˜¯pomã€jarã€earã€warä»¥åŠmaven-pluginã€‚</packaging></p>
<h2 id="POMæ–‡ä»¶ä½¿ç”¨æ–¹å¼"><a href="#POMæ–‡ä»¶ä½¿ç”¨æ–¹å¼" class="headerlink" title="POMæ–‡ä»¶ä½¿ç”¨æ–¹å¼"></a>POMæ–‡ä»¶ä½¿ç”¨æ–¹å¼</h2><ol>
<li>é»˜è®¤çš„ï¼šç”¨äºæ„å»ºä¸€ä¸ªæ„ä»¶</li>
<li>çˆ¶POMï¼šæä¾›ä¸€ä¸ªç”±å­é¡¹ç›®ç»§æ‰¿çš„å•ä¸ªé…ç½®ä¿¡æ¯æºï¼Œå­é¡¹ç›®é€šè¿‡å£°æ˜è¿™ä¸ªpomæ–‡ä»¶ä½œä¸ºå®ƒä»¬çš„<parent>å…ƒç´ å€¼</parent></li>
<li>èšåˆå™¨ï¼šç”¨äºæ„å»ºä¸€ç»„å£°æ˜ä¸º<modules>çš„é¡¹ç›®ï¼Œè¿™äº›å­é¡¹ç›®ä½äºå…¶å½“å‰èšåˆå™¨é¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯ä¸ªéƒ½åŒ…å«æœ‰ä»–è‡ªå·±çš„pomæ–‡ä»¶</modules></li>
</ol>
<p><strong>PSï¼š</strong> ä½œä¸ºçˆ¶pomæˆ–è€…èšåˆå™¨çš„pomæ–‡ä»¶çš„<packaging>å…ƒç´ çš„å€¼å°†æ˜¯pomã€‚</packaging></p>
<h2 id="GAVåæ ‡"><a href="#GAVåæ ‡" class="headerlink" title="GAVåæ ‡"></a>GAVåæ ‡</h2><p>POMå®šä¹‰äº†5ç§ç§°ä¸ºåæ ‡çš„å…ƒç´ ï¼Œç”¨äºæ ‡è¯†Mavenæ„ä»¶ï¼Œé¦–å­—æ¯ç¼©å†™GAVæŒ‡çš„æ˜¯å¿…é¡»å§‹ç»ˆæŒ‡å®šçš„3ä¸ªåæ ‡<groupid>ã€<artifactid>ã€<version> çš„é¦–å­—æ¯ã€‚</version></artifactid></groupid></p>
<p>ä¸‹é¢çš„åæ ‡æ˜¯æŒ‰ç…§ä»–ä»¬åœ¨åæ ‡è¡¨è¾¾å¼ä¸­å‡ºç°çš„é¡ºåºåˆ—å‡ºï¼š</p>
<ol>
<li><groupid>æ˜¯é¡¹ç›®æˆ–è€…é¡¹ç›®ç»„çš„<strong>å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦</strong>ã€‚è¿™é€šå¸¸æ˜¯Javaæºä»£ç ä½¿å‘˜å·¥çš„å…¨é™å®šçš„JavaåŒ…åã€‚ä¾‹å¦‚ï¼Œio.nettyã€com.googleã€‚</groupid></li>
<li><artifactid>ç”¨äºæ ‡è¯†å’ŒæŸä¸ª<groupdid>ç›¸å…³çš„ä¸åŒçš„æ„ä»¶ã€‚ä¾‹å¦‚ï¼Œnetty-allã€netty-handlerã€‚</groupdid></artifactid></li>
<li><type>æ˜¯æŒ‡å’Œé¡¹ç›®ç›¸å…³çš„ä¸»è¦æ„ä»¶çš„ç±»å‹(å¯¹åº”äºæ„ä»¶çš„POMæ–‡ä»¶ä¸­çš„<packaging>å€¼)ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯jarï¼Œæ­¤å¤–è¿˜æœ‰pomã€earã€‚</packaging></type></li>
<li><version>æ ‡è¯†äº†æ„ä»¶çš„ç‰ˆæœ¬ã€ä¾‹å¦‚1.1ã€2.0-SNAPSHOTã€4.1.9.Finalã€‚</version></li>
<li><classifier>ç”¨äºåŒºåˆ†å±äºç›¸åŒçš„POMä½†æ˜¯å´è¢«ä»¥ä¸åŒæ–¹å¼æ„å»ºçš„æ„ä»¶ã€‚ä¾‹å¦‚ï¼Œjavadockã€sourcesã€jdk16ã€jdk17ã€‚</classifier></li>
</ol>
<p>ä¸€ä¸ªå®Œæ•´çš„åæ ‡è¡¨è¾¾å¼å…·æœ‰å¦‚ä¸‹æ ¼å¼ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">actifactId:groupId:packaging:version:classifier</div></pre></td></tr></table></figure></p>
<p>POMæ–‡ä»¶å¿…é¡»å£°æ˜å®ƒæ‰€ç®¡ç†çš„æ„ä»¶çš„åæ ‡ï¼Œä¸€ä¸ªå…·æœ‰å¦‚ä¸‹åæ ‡çš„é¡¹ç›®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;groupId&gt;io.netty&lt;/groupId&gt;</div><div class="line">&lt;artifactId&gt;netty-all&lt;/artifactId&gt;</div><div class="line">&lt;version&gt;4.1.9.Final&lt;/version&gt;</div><div class="line">&lt;packaging&gt;jar&lt;/packaging&gt;</div></pre></td></tr></table></figure></p>
<p>å°†ä¼šäº§ç”Ÿä¸€ä¸ªå…·æœ‰ä»¥ä¸‹æ ¼å¼çš„åç§°çš„æ„ä»¶ï¼š<br><code>artifactId-&lt;version&gt;.&lt;packaging&gt;</code></p>
<h1 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h1><h2 id="ä¾èµ–å¼•å…¥"><a href="#ä¾èµ–å¼•å…¥" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h2><p>é¡¹ç›®çš„ä¾èµ–æ˜¯æŒ‡ç¼–è¯‘å’Œæ‰§è¡Œå®ƒæ‰€éœ€è¦çš„å¤–éƒ¨æ„ä»¶ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ çš„é¡¹ç›®çš„ä¾èµ–é¡¹ä¹Ÿä¼šæœ‰å®ƒè‡ªå·±çš„ä¾èµ–ã€‚æˆ‘ä»¬ç§°è¿™äº›ä¾èµ–ä¸ºä½ çš„é¡¹ç›®çš„<strong>ä¼ é€’ä¾èµ–</strong>ã€‚ä¸€ä¸ªè´Ÿè´£çš„é¡¹ç›®å¯èƒ½ä¼šæœ‰ä¸€ä¸ªæ·±å±‚çº§çš„<strong>ä¾èµ–æ ‘</strong>ã€‚Maven æä¾›äº†å„ç§ç”¨äºå¸®åŠ©ç†è§£å’Œç®¡ç†å®ƒçš„å·¥å…·ï¼Œå¦‚æ‰§è¡Œ<code>mvn dependency:tree</code>ã€‚</p>
<p>Mavençš„<dependency>å£°æ˜åœ¨POMçš„<dependencies>å…ƒç´ ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;dependencies&gt;</div><div class="line">  &lt;dependency&gt;</div><div class="line">    &lt;groupId/&gt;</div><div class="line">    &lt;artifactId/&gt;</div><div class="line">    &lt;version/&gt;</div><div class="line">    &lt;type/&gt;</div><div class="line">    &lt;scope/&gt;</div><div class="line">    &lt;systemPath/&gt;</div><div class="line">  &lt;/dependency&gt;</div><div class="line">&lt;/dependencies&gt;</div></pre></td></tr></table></figure></dependencies></dependency></p>
<p>åœ¨<dependency>å£°æ˜ä¸­ï¼ŒGAVåæ ‡æ˜¯å¿…ä¸å¯å°‘çš„ã€‚typeå’Œscopeå…ƒç´ å¯¹äºé‚£äº›å€¼ä¸åˆ†åˆ«æ˜¯é»˜è®¤å€¼jarå’Œcompileçš„ä¾èµ–æ¥è¯´ä¹Ÿæ˜¯å¿…é¡»çš„ã€‚</dependency></p>
<p>å…³äºscopeæŒ‡çš„æ˜¯ä¾èµ–èŒƒå›´ï¼Œå³classpathï¼ŒMavené‡Œæœ‰3ç±»ä¾èµ–èŒƒå›´ï¼š</p>
<ul>
<li>ç¼–è¯‘</li>
<li>æµ‹è¯•</li>
<li>è¿è¡Œ</li>
</ul>
<p><scope>å…ƒç´ å…·æœ‰ä»¥ä¸‹å€¼ï¼ˆä¾èµ–èŒƒå›´ï¼‰ï¼š</scope></p>
<ul>
<li>compileï¼šç¼–è¯‘ï¼ˆé»˜è®¤ï¼‰</li>
<li>runtimeï¼šè¿è¡Œ</li>
<li>providedï¼šå¯¹äºç¼–è¯‘å’Œæµ‹è¯•æœ‰æ•ˆï¼Œè¿è¡Œæ—¶æ— æ•ˆ</li>
<li>testï¼šæµ‹è¯•</li>
<li>importï¼šä½¿ç”¨åœ¨<dependencymanagement>ä¸­ï¼Œå¯¼å…¥å…¶ä»–é¡¹ç›®çš„<dependencymanagement></dependencymanagement></dependencymanagement></li>
<li>systemPathï¼šä¸providedä¸€ç›´ï¼Œä½†æ˜¯éœ€è¦æŒ‡å®šä¾èµ–æ–‡ä»¶çš„ç»å¯¹ä½ç½®</li>
</ul>
<h2 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h2><p>POMçš„<dependencymanagement>å…ƒç´ å¯ä»¥åŒ…å«è¢«å…¶ä»–é¡¹ç›®ä½¿ç”¨çš„<dependency>å£°æ˜ï¼ˆä½†ä¸æ‹‰å–ï¼‰ï¼Œè¿™æ ·çš„POMçš„å­é¡¹ç›®ä¼šè‡ªåŠ¨ç»§æ‰¿è¿™äº›å£°æ˜ï¼Œå…¶ä»–é¡¹ç›®å¯ä»¥ç”¨è¿‡ä½¿ç”¨<scope>å…ƒç´ å€¼æ¥å¯¼å…¥ä»–ä»¬ã€‚</scope></dependency></dependencymanagement></p>
<p>å¼•ç”¨äº†<dependencymanagement>å…ƒç´ çš„é¡¹ç›®å¯ä»¥ä½¿ç”¨å®ƒæ‰€å£°æ˜çš„ä¾èµ–ï¼Œè€Œä¸éœ€è¦æŒ‡å®šä»–ä»¬çš„<version>åæ ‡ï¼Œå¦‚æœ<dependencymanagement>ä¸­çš„<version>åœ¨ç¨åæ”¹å˜ï¼Œåˆ™æ‰€æœ‰åº”ç”¨å®ƒçš„poméƒ½ä¼šæ”¹å˜ã€‚</version></dependencymanagement></version></dependencymanagement></p>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šåœ¨åŸPOMä¸­çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½åˆ©ç”¨<properties>å…ƒç´ æ§åˆ¶ã€‚</properties></p>
<h1 id="æ„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#æ„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>æ„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>Mavençš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸ºäº†å¯¹æ‰€æœ‰çš„æ„å»ºè¿‡ç¨‹è¿›è¡ŒæŠ½è±¡å’Œç»Ÿä¸€ã€‚è¿™ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…å«äº†é¡¹ç›®çš„æ¸…ç†ã€åˆå§‹åŒ–ã€ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€é›†æˆæµ‹è¯•ã€éªŒè¯ã€éƒ¨ç½²å’Œç«™ç‚¹ç”Ÿæˆç­‰å‡ ä¹æ‰€æœ‰æ„å»ºæ­¥éª¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ æ‰€æ‰€æœ‰çš„é¡¹ç›®çš„æ„å»ºï¼Œéƒ½èƒ½æ˜ å°„åˆ°è¿™æ ·ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸä¸Šã€‚</p>
<p>Mavenæ‹¥æœ‰ä¸‰å¥—ç›¸äº’ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸï¼Œä»–ä»¬åˆ†åˆ«ä¸ºcleanã€defaultå’Œsiteã€‚cleanç”Ÿå‘½å‘¨æœŸçš„ç›®çš„æ˜¯æ¸…ç†é¡¹ç›®ã€defaultç”Ÿå‘½å‘¨æœŸçš„ç›®çš„æ˜¯æ„å»ºé¡¹ç›®ã€siteç”Ÿå‘½å‘¨æœŸçš„ç›®çš„æ˜¯å»ºç«‹é¡¹ç›®ç«™ç‚¹ã€‚æ¯ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…å«ä¸€äº›é˜¶æ®µï¼Œè¿™äº›é˜¶æ®µæ˜¯æœ‰é¡ºåºçš„ï¼Œå¹¶ä¸”åé¢çš„é˜¶æ®µä¾èµ–äºå‰é¢çš„é˜¶æ®µã€‚ä½†æ˜¯ä¸‰å¥—ç”Ÿå‘½å‘¨æœŸæœ¬èº«æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚æˆ‘ä»¬æŒ‰ç…§æ—¥å¸¸çš„éœ€æ±‚ï¼Œæˆ‘ä»¬åªè¯´å‰ä¸¤ä¸ªã€‚</p>
<h2 id="cleanç”Ÿå‘½å‘¨æœŸ"><a href="#cleanç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="cleanç”Ÿå‘½å‘¨æœŸ"></a>cleanç”Ÿå‘½å‘¨æœŸ</h2><p>å®ƒåŒ…å«ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>pre-cleanï¼šæ‰§è¡Œæ¸…ç†å‰è¦å®Œæˆçš„å·¥ä½œã€‚</li>
<li>cleanï¼šæ¸…ç†ä¸Šä¸€æ¬¡æ„å»ºç”Ÿæˆçš„æ–‡ä»¶ã€‚</li>
<li>post-cleanï¼šæ‰§è¡Œä¸€äº›æ¸…ç†åéœ€è¦å®Œæˆçš„å·¥ä½œã€‚</li>
</ol>
<h2 id="defaultç”Ÿå‘½å‘¨æœŸ"><a href="#defaultç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="defaultç”Ÿå‘½å‘¨æœŸ"></a>defaultç”Ÿå‘½å‘¨æœŸ</h2><p>defaultç”Ÿå‘½å‘¨æœŸå®šä¹‰äº†çœŸæ­£æ„å»ºæ—¶æ‰€éœ€è¦æ‰§è¡Œçš„è€Œæ‰€æœ‰æ­¥éª¤ï¼Œè¿™é‡Œä¹Ÿåªæ˜¯åˆ—å‡ºé‡è¦çš„é˜¶æ®µï¼š</p>
<ol>
<li>validateï¼šæ£€æŸ¥é¡¹ç›®æ˜¯å¦æ­£ç¡®</li>
<li>compileï¼šç¼–è¯‘é¡¹ç›®çš„æºä»£ç </li>
<li>testï¼šä½¿ç”¨å•å…ƒæµ‹è¯•æ¡†æ¶è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•ä»£ç ä¸ä¼šè¢«æ‰“åŒ…éƒ¨ç½²</li>
<li>packageï¼šå°†ç¼–è¯‘çš„ä»£ç æ‰“åŒ…ä¸ºå¯å‘å¸ƒçš„æ ¼å¼ï¼Œå¦‚jar</li>
<li>verifyï¼šéªŒè¯è½¯ä»¶åŒ…æ˜¯å¦æœ‰æ•ˆ</li>
<li>installï¼šå°†åŒ…å®‰è£…åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œå¯ä»¥ä¾›æœ¬åœ°å…¶ä»–Mavené¡¹ç›®ä½¿ç”¨</li>
<li>deployï¼šå°†åŒ…å¤åˆ¶åˆ°è¿œç¨‹ä»“åº“ä¸­ï¼Œå¯ä»¥ä¾›å…¶ä»–å¼€å‘äººå‘˜ä½¿ç”¨</li>
</ol>
<h1 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h1><p>è™½ç„¶Mavenåè°ƒäº†æ‰€æœ‰æ„å»ºç”Ÿå‘½å‘¨æœŸé˜¶æ®µçš„æ‰§è¡Œï¼Œä½†æ˜¯ä»–å¹¶æ²¡æœ‰ç›´æ¥å®ç°å®ƒä»¬ï¼Œè€Œæ˜¯å°†ä»–ä»¬å§”æ‰˜ç»™äº†<strong>æ’ä»¶</strong>ã€‚è¿™äº›æ’ä»¶æ˜¯maven-pluginç±»å‹çš„æ„ä»¶(æ‰“åŒ…ä¸ºJARæ–‡ä»¶)ã€‚Mavenä¸ºæ ‡å‡†æ„ä»¶ç”Ÿå‘½å‘¨æœŸæ‰€å®šä¹‰çš„æ‰€æœ‰ä»»åŠ¡éƒ½æä¾›äº†æ’ä»¶ï¼Œä½†æ›´å¤šçš„æ˜¯ç”±ç¬¬ä¸‰æ–¹ç”Ÿäº§çš„ï¼Œç”¨äºå¤„ç†å„ç§è‡ªå®šä¹‰çš„ä»»åŠ¡ã€‚</p>
<h2 id="æ’ä»¶ç›®æ ‡"><a href="#æ’ä»¶ç›®æ ‡" class="headerlink" title="æ’ä»¶ç›®æ ‡"></a>æ’ä»¶ç›®æ ‡</h2><p>æ¯ä¸ªæ’ä»¶éƒ½æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œæ¯ä¸ªæ’ä»¶åŠŸèƒ½å¯¹åº”äº†æ’ä»¶ä¸€ä¸ªç›®æ ‡ã€‚å¦‚æˆ‘ä»¬ä¹‹å‰åˆ†æä¾èµ–çš„maven-dependency-pluginï¼Œå®ƒå°±æœ‰åå¤šä¸ªç›®æ ‡ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// å‘½ä»¤è¡Œå†’å·å‰é¢æ˜¯æ’ä»¶ï¼Œå†’å·åé¢æ˜¯ç›®æ ‡ï¼ˆåŠŸèƒ½ï¼‰</div><div class="line">mvn dependency:analyze</div><div class="line">mvn dependency:tree</div><div class="line">mvn dependency:list</div></pre></td></tr></table></figure></p>
<h2 id="æ’ä»¶ç»‘å®š"><a href="#æ’ä»¶ç»‘å®š" class="headerlink" title="æ’ä»¶ç»‘å®š"></a>æ’ä»¶ç»‘å®š</h2><p>Mavençš„ç”Ÿå‘½å‘¨æœŸä¸æ’ä»¶ç›¸äº’ç»‘å®šï¼Œç”¨ä»¥å®Œæˆå®é™…çš„æ„å»ºä»»åŠ¡ã€‚</p>
<h3 id="å†…ç½®ç»‘å®š"><a href="#å†…ç½®ç»‘å®š" class="headerlink" title="å†…ç½®ç»‘å®š"></a>å†…ç½®ç»‘å®š</h3><p>ä¸ºäº†è®©ç”¨æˆ·å‡ ä¹ä¸ç”¨ä»»ä½•é…ç½®å°±èƒ½æ„å»ºMavené¡¹ç›®ï¼ŒMavenä¸ºä¸€äº›ä¸»è¦çš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µç»‘å®šäº†å¾ˆå¤šæ’ä»¶çš„ç›®æ ‡ï¼Œå¦‚ï¼š</p>
<ol>
<li>maven-clean-plugin:cleanç»‘å®šäº†clean</li>
<li>maven-compiler-plugin:compileç»‘å®šäº†compile</li>
<li>maven-surefire-plugin:testç»‘å®šäº†test</li>
<li>maven-jar-plugin:jarç»‘å®špackageé»˜è®¤</li>
<li>maven-install-plugin:installç»‘å®šäº†install</li>
</ol>
<h3 id="è‡ªå®šä¹‰ç»‘å®š"><a href="#è‡ªå®šä¹‰ç»‘å®š" class="headerlink" title="è‡ªå®šä¹‰ç»‘å®š"></a>è‡ªå®šä¹‰ç»‘å®š</h3><p>é™¤äº†å†…ç½®ç»‘å®šä¹‹å¤–ï¼Œç”¨æˆ·è¿˜èƒ½å¤Ÿè‡ªå·±é€‰æ‹©å°†æŸä¸ªæ’ä»¶ç›®æ ‡ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸçš„æŸä¸ªé˜¶æ®µä¸Šã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;build&gt;</div><div class="line">    &lt;plugins&gt;</div><div class="line">        &lt;plugin&gt;</div><div class="line">           &lt;!--å¼•å…¥æ’ä»¶--&gt;</div><div class="line">           &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;3.0.1&lt;/version&gt;</div><div class="line">            &lt;!--æ„å»ºä»»åŠ¡--&gt;</div><div class="line">            &lt;executions&gt;</div><div class="line">                &lt;execution&gt;</div><div class="line">                    &lt;id&gt;attach-source&lt;/id&gt;</div><div class="line">                    &lt;!--ç»‘å®šé˜¶æ®µ--&gt;</div><div class="line">                    &lt;phase&gt;verify&lt;/phase&gt;</div><div class="line">                    &lt;!--ç»‘å®šç›®æ ‡--&gt;</div><div class="line">                    &lt;goals&gt;</div><div class="line">                        &lt;goal&gt;jar-no-fork&lt;/goal&gt;</div><div class="line">                    &lt;/goals&gt;</div><div class="line">                &lt;/execution&gt;</div><div class="line">            &lt;/executions&gt;</div><div class="line">        &lt;/plugin&gt;</div><div class="line">    &lt;/plugins&gt;</div><div class="line">&lt;/build&gt;</div></pre></td></tr></table></figure></p>
<p>å¾ˆå¤šæ’ä»¶çš„ç›®æ ‡åœ¨ç¼–å†™æ˜¯å°±å·²ç»å®šä¹‰äº†é»˜è®¤ç»‘å®šé˜¶æ®µï¼Œå¯ä»¥åˆ©ç”¨maven-help-pluginæŸ¥çœ‹æ’ä»¶è¯¦ç»†ä¿¡æ¯ï¼Œäº†è§£æ’ä»¶ç›®æ ‡çš„é»˜è®¤ç»‘å®šé˜¶æ®µã€‚è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn help:describe -Dplugin=org.apache.maven.plugins:maven-source-plugin:3.0.1</div></pre></td></tr></table></figure></p>
<p>å¦‚æœå¤šä¸ªç›®æ ‡è¢«ç»‘å®šåˆ°åŒä¸€ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œè¿™äº›æ’ä»¶å£°æ˜çš„å…ˆåé¡ºåºå†³å®šäº†ç›®æ ‡çš„æ‰§è¡Œé¡ºåºã€‚</p>
<h2 id="æ’ä»¶é…ç½®"><a href="#æ’ä»¶é…ç½®" class="headerlink" title="æ’ä»¶é…ç½®"></a>æ’ä»¶é…ç½®</h2><h3 id="å‘½ä»¤è¡Œæ’ä»¶é…ç½®"><a href="#å‘½ä»¤è¡Œæ’ä»¶é…ç½®" class="headerlink" title="å‘½ä»¤è¡Œæ’ä»¶é…ç½®"></a>å‘½ä»¤è¡Œæ’ä»¶é…ç½®</h3><p>å¾ˆå¤šæ’ä»¶ç›®æ ‡çš„å‚æ•°éƒ½æ˜¯æ”¯æŒå‘½ä»¤è¡Œé…ç½®çš„ï¼Œç”¨æˆ·å¯ä»¥åœ¨Mavenå‘½ä»¤ä¸­ä½¿ç”¨-Då‚æ•°ï¼Œå¹¶ä¼´éšå‚æ•°é”®=å‚æ•°å€¼çš„å½¢å¼æ¥é…ç½®æ’ä»¶ç›®æ ‡çš„å‚æ•°ï¼Œå¦‚ä¸Š<code>mvn help</code>ã€‚</p>
<h3 id="POMä¸­æ’ä»¶å…¨å±€é…ç½®"><a href="#POMä¸­æ’ä»¶å…¨å±€é…ç½®" class="headerlink" title="POMä¸­æ’ä»¶å…¨å±€é…ç½®"></a>POMä¸­æ’ä»¶å…¨å±€é…ç½®</h3><p>ä¸ºäº†é¿å…æ’ä»¶å‚æ•°é‡å¤ä¹¦å†™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨pomè¿›è¡Œå…¨å±€é…ç½®ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;plugin&gt;</div><div class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;3.0.1&lt;/version&gt;</div><div class="line">    &lt;configuration&gt;</div><div class="line">        &lt;!--ç¼–è¯‘Java1.8ç‰ˆæœ¬çš„æºæ–‡ä»¶--&gt;</div><div class="line">        &lt;source&gt;1.8&lt;/source&gt;</div><div class="line">        &lt;!--ç”Ÿæˆä¸JVM1.8å…¼å®¹çš„å­—èŠ‚ç æ–‡ä»¶--&gt;</div><div class="line">        &lt;target&gt;1.8&lt;/target&gt;</div><div class="line">    &lt;/configuration&gt;</div><div class="line">&lt;/plugin&gt;</div></pre></td></tr></table></figure></p>
<h2 id="æ’ä»¶ç®¡ç†"><a href="#æ’ä»¶ç®¡ç†" class="headerlink" title="æ’ä»¶ç®¡ç†"></a>æ’ä»¶ç®¡ç†</h2><p>POMçš„<pluginmanagement>å…ƒç´ å¯ä»¥åŒ…å«è¢«å…¶ä»–é¡¹ç›®ä½¿ç”¨çš„<plugin>å£°æ˜ï¼ˆä½†ä¸æ‹‰å–ï¼‰ï¼Œè¿™æ ·çš„POMçš„å­é¡¹ç›®ä¼šè‡ªåŠ¨ç»§æ‰¿è¿™äº›å£°æ˜ã€‚</plugin></pluginmanagement></p>
<p>å¼•ç”¨äº†<pluginmanagement>å…ƒç´ çš„é¡¹ç›®å¯ä»¥ä½¿ç”¨å®ƒæ‰€å£°æ˜çš„ä¾èµ–ï¼Œè€Œä¸éœ€è¦æŒ‡å®šä»–ä»¬çš„<version>åæ ‡ï¼Œå¦‚æœ<pluginmanagement>ä¸­çš„<version>åœ¨ç¨åæ”¹å˜ï¼Œåˆ™æ‰€æœ‰åº”ç”¨å®ƒçš„poméƒ½ä¼šæ”¹å˜ã€‚</version></pluginmanagement></version></pluginmanagement></p>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šåœ¨åŸPOMä¸­çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½åˆ©ç”¨<properties>å…ƒç´ æ§åˆ¶ã€‚</properties></p>
<h1 id="èšåˆå’Œç»§æ‰¿"><a href="#èšåˆå’Œç»§æ‰¿" class="headerlink" title="èšåˆå’Œç»§æ‰¿"></a>èšåˆå’Œç»§æ‰¿</h1><h2 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€æ¬¡æ„å»ºä¸¤ä¸ªé¡¹ç›®ï¼Œè€Œä¸æ˜¯åˆ°ä¸¤ä¸ªæ¨¡å—çš„ç›®å½•ä¸‹åˆ†åˆ«æ‰§è¡Œmvnå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>Mavenèšåˆ</strong>ã€‚</p>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªèšåˆæ„ä»¶ï¼ˆé™¤äº†pomæ–‡ä»¶ï¼ˆpackagingéœ€è¦ä¸ºpomï¼‰ï¼Œå…¶ä»–å¯ä»¥éƒ½ä¸è¦ï¼‰ï¼Œç„¶ååœ¨èšåˆæ„ä»¶ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªæ„ä»¶ï¼Œå¹¶åœ¨èšåˆæ„ä»¶ä¸‹åˆ©ç”¨<modules>æ¥å£°æ˜ï¼Œæ¯ä¸ªmoduleçš„å€¼éƒ½æ˜¯ä¸€ä¸ªå½“å‰ç›®å½•çš„ç›¸å¯¹ç›®å½•ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;modules&gt;</div><div class="line">    &lt;module&gt;email&lt;/module&gt;</div><div class="line">    &lt;module&gt;user&lt;/module&gt;</div><div class="line">&lt;/modules&gt;</div></pre></td></tr></table></figure></modules></p>
<h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>å¦‚æœä¸¤ä¸ªé¡¹ç›®æœ‰é‡å¤çš„ä¾èµ–æˆ–æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>ç»§æ‰¿</strong>ã€‚</p>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªçˆ¶æ„ä»¶ï¼ˆé™¤äº†pomæ–‡ä»¶ï¼ˆpackagingéœ€è¦ä¸ºpomï¼‰ï¼Œå…¶ä»–å¯ä»¥éƒ½ä¸è¦ï¼‰ï¼Œç„¶ååœ¨çˆ¶æ„ä»¶ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªå­æ„ä»¶ï¼Œå¹¶åœ¨å­æ„ä»¶ä¸‹åˆ©ç”¨<parent>æ¥å£°æ˜ç»§æ‰¿å…³ç³»ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;parent&gt;</div><div class="line">    &lt;groupId/&gt;</div><div class="line">    &lt;artifactId/&gt;</div><div class="line">    &lt;version/&gt;</div><div class="line">    &lt;relativePath&gt;çˆ¶pomçš„ç›¸å¯¹è·¯å¾„&lt;/relativePath&gt;</div><div class="line">&lt;/parent&gt;</div></pre></td></tr></table></figure></parent></p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://blog.csdn.net/ck4438707/article/details/53377413" target="_blank" rel="external">Mavenå®‰è£…æ•™ç¨‹</a></li>
<li><a href="https://blog.csdn.net/u012424449/article/details/77853983" target="_blank" rel="external">é…ç½®é˜¿é‡Œäº‘é•œåƒä»“åº“</a></li>
<li>ã€ŠMavenå®æˆ˜ã€‹</li>
<li><a href="https://www.cnblogs.com/dreamroute/p/6729147.html" target="_blank" rel="external">Maven <resource>æ ‡ç­¾</resource></a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šä½¿ç”¨Javaè¯­è¨€æ¥å¼€å‘ä½ çš„é¡¹ç›®ï¼ŒåŸºæœ¬ä¸Šéƒ½å°‘ä¸äº†Mavenï¼Œå› ä¸ºæœ‰äº†å®ƒçœŸæ˜¯å¤ªæ–¹ä¾¿äº†ï¼
    
    </summary>
    
      <category term="å·¥å…·" scheme="http://bestlixiang.site/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Java" scheme="http://bestlixiang.site/tags/Java/"/>
    
      <category term="Maven" scheme="http://bestlixiang.site/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>Gitä½¿ç”¨æ•´ç†</title>
    <link href="http://bestlixiang.site/2018/07/05/%E5%B7%A5%E5%85%B7/Git%E4%BD%BF%E7%94%A8%E6%95%B4%E7%90%86/"/>
    <id>http://bestlixiang.site/2018/07/05/å·¥å…·/Gitä½¿ç”¨æ•´ç†/</id>
    <published>2018-07-05T11:29:14.000Z</published>
    <updated>2018-07-10T13:29:20.198Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šè™½ç„¶æ—¥å¸¸ä½¿ç”¨gitï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æ€»æ˜¯ä¼šå¿˜è®°ä¸€äº›æ“ä½œï¼Œéš¾å…ä¼šé¢å‘æœç´¢å¼•æ“æŸ¥æ‰¾ã€‚æ‰€ä»¥è¿™é‡Œå°±æ€»ç»“ä¸€ä¸‹ã€‚<a id="more"></a></p>
<h1 id="ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ"><a href="#ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ" class="headerlink" title="ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ"></a>ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</h1><p>è°ˆåˆ°Gitï¼Œå°±éœ€è¦å…ˆè¯´è¯´ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚<strong>ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</strong>å°±æ˜¯èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬è®°å½•æ¯æ¬¡æ–‡ä»¶çš„æ”¹åŠ¨çš„ä¸€ä¸ªè½¯ä»¶ï¼Œè€ŒGitå°±æ˜¯å®ƒçš„ä¸€ç§å®ç°ã€‚æƒ³æƒ³æˆ‘ä»¬å†™è®ºæ–‡è¿˜æ˜¯å†™ä»£ç ï¼Œæ˜¯ä¸æ˜¯æœ‰äº†ä»–å°±å¾ˆæ–¹ä¾¿äº†ï¼Œå†ä¹Ÿä¸ç”¨è‡ªå·±æ‰‹åŠ¨å¤‡ä»½æ¯ä¸€æ¬¡ä¿®æ”¹äº†ã€‚ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿåˆåˆ†ä¸ºé›†ä¸­å¼å’Œåˆ†å¸ƒå¼ã€‚</p>
<h2 id="é›†ä¸­å¼ï¼ˆSVNï¼‰"><a href="#é›†ä¸­å¼ï¼ˆSVNï¼‰" class="headerlink" title="é›†ä¸­å¼ï¼ˆSVNï¼‰"></a>é›†ä¸­å¼ï¼ˆSVNï¼‰</h2><p><img src="http://o6plzvjf2.bkt.clouddn.com/tool/git/%E9%9B%86%E4%B8%AD%E5%BC%8F.jpg" alt="é›†ä¸­å¼"></p>
<p>é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ç‰ˆæœ¬åº“æ˜¯é›†ä¸­å­˜æ”¾åœ¨ä¸­å¤®æœåŠ¡å™¨çš„ï¼Œè€Œæˆ‘ä»¬åœ¨å¹²æ´»çš„æ—¶å€™ï¼Œç”¨çš„éƒ½æ˜¯è‡ªå·±çš„ç”µè„‘ï¼Œæ‰€ä»¥è¦å…ˆä»ä¸­å¤®æœåŠ¡å™¨å–å¾—æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶åå¼€å§‹å¹²æ´»ï¼Œå¹²å®Œæ´»äº†ï¼Œå†æŠŠè‡ªå·±çš„æ´»æ¨é€ç»™ä¸­å¤®æœåŠ¡å™¨ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šå¿…é¡»è”ç½‘æ‰èƒ½å·¥ä½œï¼›ä¸­å¤®æœåŠ¡å™¨è¦æ˜¯å‡ºäº†é—®é¢˜ï¼Œæ‰€æœ‰äººéƒ½æ²¡æ³•å¹²æ´»äº†</p>
<h2 id="åˆ†å¸ƒå¼ï¼ˆGitï¼‰"><a href="#åˆ†å¸ƒå¼ï¼ˆGitï¼‰" class="headerlink" title="åˆ†å¸ƒå¼ï¼ˆGitï¼‰"></a>åˆ†å¸ƒå¼ï¼ˆGitï¼‰</h2><p><img src="http://o6plzvjf2.bkt.clouddn.com/tool/git/%E5%88%86%E5%B8%83%E5%BC%8F.jpg" alt="ä»“åº“"></p>
<p>æ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œè¿™æ ·ï¼Œä½ å·¥ä½œçš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦è”ç½‘äº†ï¼Œå› ä¸ºç‰ˆæœ¬åº“å°±åœ¨ä½ è‡ªå·±çš„ç”µè„‘ä¸Šã€‚åœ¨åŒæ–¹åä½œçš„æ—¶å€™ï¼Œå¦‚æœä½ åœ¨è‡ªå·±ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶Aï¼Œä½ çš„åŒäº‹ä¹Ÿåœ¨ä»–çš„ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶Aï¼Œè¿™æ—¶ï¼Œä½ ä»¬ä¿©ä¹‹é—´åªéœ€æŠŠå„è‡ªçš„ä¿®æ”¹æ¨é€ç»™å¯¹æ–¹ï¼Œå°±å¯ä»¥äº’ç›¸çœ‹åˆ°å¯¹æ–¹çš„ä¿®æ”¹äº†ã€‚</p>
<p>åœ¨å®é™…ä½¿ç”¨åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ—¶å€™ï¼Œå…¶å®å¾ˆå°‘åœ¨ä¸¤äººä¹‹é—´çš„ç”µè„‘ä¸Šæ¨é€ç‰ˆæœ¬åº“çš„ä¿®æ”¹ï¼Œè€Œä¸”å¦‚æœä½ ä»¬ä¿©ä¸åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œä¸¤å°ç”µè„‘ä¹Ÿäº’ç›¸è®¿é—®ä¸äº†ã€‚æ‰€ä»¥åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé€šå¸¸ä¹Ÿæœ‰ä¸€å°å……å½“â€œä¸­å¤®æœåŠ¡å™¨â€çš„ç”µè„‘ï¼Œä½†è¿™ä¸ªæœåŠ¡å™¨çš„ä½œç”¨ä»…ä»…æ˜¯ç”¨æ¥æ–¹ä¾¿â€œäº¤æ¢â€å¤§å®¶çš„ä¿®æ”¹ï¼Œæ²¡æœ‰å®ƒå¤§å®¶ä¹Ÿä¸€æ ·å¹²æ´»ï¼Œåªæ˜¯äº¤æ¢ä¿®æ”¹ä¸æ–¹ä¾¿è€Œå·²ã€‚</p>
<h1 id="Gitä½¿ç”¨"><a href="#Gitä½¿ç”¨" class="headerlink" title="Gitä½¿ç”¨"></a>Gitä½¿ç”¨</h1><h2 id="Gitå®‰è£…"><a href="#Gitå®‰è£…" class="headerlink" title="Gitå®‰è£…"></a>Gitå®‰è£…</h2><p>è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œæ¨èå»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™<a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137396287703354d8c6c01c904c7d9ff056ae23da865a000" target="_blank" rel="external">å®‰è£…æ•™ç¨‹</a>ã€‚</p>
<h2 id="GitåŒºåŸŸ"><a href="#GitåŒºåŸŸ" class="headerlink" title="GitåŒºåŸŸ"></a>GitåŒºåŸŸ</h2><p><img src="http://o6plzvjf2.bkt.clouddn.com/tool/git/%E5%8C%BA%E5%9F%9F.png" alt="GitåŒºåŸŸ"></p>
<ul>
<li>å·¥ä½œåŒºï¼ˆWorkspaceï¼‰ï¼šåœ¨è®¡ç®—æœºèƒ½çœ‹åˆ°çš„ç›®å½•ã€‚</li>
<li>ç¼“å­˜åŒºï¼ˆIndex/Stageï¼‰ï¼šä¸´æ—¶ä¿å­˜æˆ‘ä»¬çš„æ”¹åŠ¨ã€‚</li>
<li>ç‰ˆæœ¬åº“ï¼ˆRepositoryï¼‰ï¼šå·¥ä½œåŒºæœ‰ä¸€ä¸ªéšè—çš„ç›®å½•.gitï¼Œå®ƒæ˜¯Gitçš„æœ¬åœ°ç‰ˆæœ¬åº“ã€‚</li>
<li>è¿œç¨‹ä»“åº“ï¼ˆRemoteï¼‰ï¼šâ€œGitä¸­å¤®æœåŠ¡å™¨â€ï¼Œæ‰˜ç®¡åœ¨ç½‘ç»œä¸­çš„é¡¹ç›®çš„ç‰ˆæœ¬åº“ï¼Œå¯ä¾›å¤šäººåä½œå¼€å‘ã€‚ï¼ˆå›½å¤–æœ‰<a href="https://gitee.com/" target="_blank" rel="external">åŸºä½¬ä¿±ä¹éƒ¨Github</a>ï¼Œå›½å†…æœ‰<a href="https://gitee.com/" target="_blank" rel="external">ç äº‘</a>ã€<a href="https://coding.net/" target="_blank" rel="external">Coding</a>ã€è¿˜æœ‰å¯ä¸ªäººæˆ–è€…å…¬å¸å®šåˆ¶çš„<a href="https://about.gitlab.com/" target="_blank" rel="external">GitLab</a>ï¼Œè¯·æŒ‰éœ€é€‰æ‹©ï¼‰</li>
</ul>
<h2 id="Gitä¸ªäººæ“ä½œ"><a href="#Gitä¸ªäººæ“ä½œ" class="headerlink" title="Gitä¸ªäººæ“ä½œ"></a>Gitä¸ªäººæ“ä½œ</h2><p>åœ¨ä¸Šé¢çš„åŒºåŸŸå›¾ä¸­ï¼Œå…¶å®æˆ‘ä»¬å·²ç»çœ‹åˆ°å¾ˆå¤šæ“ä½œï¼Œè¿™é‡Œæˆ‘å†æ€»ç»“ä¸€ä¸‹ï¼š</p>
<h3 id="æ–°å»ºä»“åº“"><a href="#æ–°å»ºä»“åº“" class="headerlink" title="æ–°å»ºä»“åº“"></a>æ–°å»ºä»“åº“</h3><ul>
<li><p>åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ªGitä»“åº“</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git init</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨å½“å‰ç›®å½•å…‹éš†ä¸€ä¸ªä»“åº“</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone [url]</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¢åŠ æ–‡ä»¶"><a href="#å¢åŠ æ–‡ä»¶" class="headerlink" title="å¢åŠ æ–‡ä»¶"></a>å¢åŠ æ–‡ä»¶</h3><ul>
<li><p>æ·»åŠ æŒ‡å®šæ–‡ä»¶/ç›®å½•åˆ°æš‚å­˜åŒº</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git add [file]/[dir]</div></pre></td></tr></table></figure>
</li>
<li><p>æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼ˆæ…ç”¨ï¼Œå°¤å…¶åœ¨IDEä¸­ï¼Œå› ä¸ºå®ƒä¼šåŒ…å«IDEçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚IDEAçš„.ideaå’Œimlæ–‡ä»¶ï¼‰</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git add .</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æäº¤æ–‡ä»¶"><a href="#æäº¤æ–‡ä»¶" class="headerlink" title="æäº¤æ–‡ä»¶"></a>æäº¤æ–‡ä»¶</h3><ul>
<li>æäº¤ç¼“å­˜åŒºçš„æ–‡ä»¶åˆ°ä»“åº“åŒº  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git commit -m [æ”¹å˜ä¿¡æ¯]</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æŸ¥çœ‹ä¿¡æ¯"><a href="#æŸ¥çœ‹ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ä¿¡æ¯"></a>æŸ¥çœ‹ä¿¡æ¯</h3><ul>
<li><p>æ˜¾ç¤ºæœ‰å˜æ›´çš„æ–‡ä»¶</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git status</div></pre></td></tr></table></figure>
</li>
<li><p>æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬å†å²</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git log</div></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®å…³é”®è¯æœç´¢æäº¤å†å²</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git log -S [keyword]</div></pre></td></tr></table></figure>
</li>
<li><p>æ˜¾ç¤ºæš‚å­˜åŒºä¸å·¥ä½œåŒºçš„å·®å¼‚</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git diff</div></pre></td></tr></table></figure>
</li>
<li><p>æ˜¾ç¤ºå·¥ä½œåŒºä¸å½“å‰åˆ†æ”¯æœ€æ–°çš„commitä¹‹é—´çš„å·®å¼‚<br>  <code>git diff HEAD(å½“å‰æœ€æ–°commit)</code></p>
</li>
<li>ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push [remote] [branch]</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="è¿œç¨‹åŒæ­¥"><a href="#è¿œç¨‹åŒæ­¥" class="headerlink" title="è¿œç¨‹åŒæ­¥"></a>è¿œç¨‹åŒæ­¥</h3><ul>
<li><p>ä¸‹è½½è¿œç¨‹ä»“åº“çš„<strong>å˜åŠ¨</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git fetch [remoteè¿œç¨‹ä»“åº“å] [åˆ†æ”¯]:[æœ¬åœ°æ–°åˆ†æ”¯]</div></pre></td></tr></table></figure>
</li>
<li><p>æ˜¾ç¤ºæ‰€æœ‰è¿œç¨‹ä»“åº“</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git remote -v</div></pre></td></tr></table></figure>
</li>
<li><p>æ˜¾ç¤ºæŸä¸ªè¿œç¨‹ä»“åº“çš„ä¿¡æ¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git remote show [branch]</div></pre></td></tr></table></figure>
</li>
<li><p>å¢åŠ ä¸€ä¸ªè¿œç¨‹ä»“åº“å¹¶å‘½å</p>
<p>  <code>git remote add [shortname=remote] [url]</code></p>
</li>
<li><p>ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push [remote] [branch]</div></pre></td></tr></table></figure>
</li>
<li><p>å¼ºè¡Œæ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ï¼Œå³ä½¿æœ‰å†²çª<br>  <code>git push [remote] --force</code></p>
</li>
<li>æ¨é€æ‰€æœ‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“<br>  <code>git push [remote] -all</code></li>
</ul>
<h3 id="æ’¤é”€"><a href="#æ’¤é”€" class="headerlink" title="æ’¤é”€"></a>æ’¤é”€</h3><ul>
<li><p>æ¢å¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒº</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout [file]</div></pre></td></tr></table></figure>
</li>
<li><p>æ¢å¤æŸä¸ªcommitçš„æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºä¸å·¥ä½œåŒº</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout [commit] [file]</div></pre></td></tr></table></figure>
</li>
<li><p>æ¢å¤æš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒº</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout .</div></pre></td></tr></table></figure>
</li>
<li><p>é‡ç½®æš‚å­˜åŒºä¸å·¥ä½œåŒºï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´<br>  <code>git reset --hard</code></p>
</li>
<li><p>é‡ç½®å½“å‰åˆ†æ”¯çš„HEADï¼ˆæŒ‡é’ˆï¼ŒæŒ‡å‘commit-idï¼‰ä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œä¸æŒ‡å®šcommitä¸€è‡´<br>  <code>git reset --hard [commit]</code></p>
</li>
<li><p>åè€…çš„æ‰€æœ‰å˜åŒ–éƒ½å°†è¢«å‰è€…æŠµæ¶ˆï¼Œå¹¶åº”ç”¨å½“å‰åˆ†æ”¯<br>  <code>git revert [commit]</code></p>
</li>
<li><p>æš‚æ—¶å°†æœªæäº¤çš„å˜åŒ–ç§»é™¤ï¼Œç¨åå†ç§»å…¥<br>  <code>git stash</code><br>  <code>git stash pop</code> </p>
</li>
</ul>
<h2 id="Gitå¤šäººåä½œ"><a href="#Gitå¤šäººåä½œ" class="headerlink" title="Gitå¤šäººåä½œ"></a>Gitå¤šäººåä½œ</h2><p>å¤šäººåä½œå°±ä¼šæ¶‰åŠåˆ°åˆ†æ”¯çš„æ¦‚å¿µï¼ˆå…¶å®å•äººå¼€å‘ä¹Ÿä¼šé‡åˆ°ï¼Œåªæ˜¯å¤šäººä¼šæ›´å¸¸è§ï¼‰</p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸‹é¢çš„å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/tool/git/%E5%88%86%E6%94%AF.jpg" alt="å¤šäººåä½œ"></p>
<p>è¿™å¼ å›¾å¯ä»¥å¾ˆæ¸…æ¥šè®©æˆ‘ä»¬è®¤è¯†åˆ°åœ¨å·¥ä½œä¸­ä½¿ç”¨gitå·¥ä½œæµçš„å¼€å‘æµç¨‹ã€‚Masteråˆ†æ”¯æ˜¯çº¿ä¸Šåˆ†æ”¯ï¼Œæˆ‘ä»¬åœ¨å¼€å‘æ–°åŠŸèƒ½çš„æ—¶å€™ä¸ä¼šå»åŠ¨å®ƒï¼ŒHotfixåˆ†æ”¯æ˜¯å¦‚æœå‡ºäº†bugå°±æ‹‰ä¸€æ¡bugåˆ†æ”¯å¿«é€Ÿä¿®å¤åˆå¹¶åˆ°masteråˆ†æ”¯é‡Œã€‚æˆ‘ä»¬å¹³æ—¶å¼€å‘éƒ½æ˜¯å…ˆä»Masteråˆ†æ”¯æ‹‰å‡ºä¸€æ¡Developåˆ†æ”¯ï¼Œåœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ã€‚æ¯ä¸ªäººä¸€èˆ¬éƒ½ä¼šè´Ÿè´£é¡¹ç›®çš„ä¸€ä¸ªç‰¹æ€§åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆä¼šä»Developåˆ†æ”¯æ‹‰å‡ºå‡ ä¸ªFeatureåˆ†æ”¯ã€‚åœ¨å¼€å‘æµ‹è¯•å®Œæˆåæˆ‘ä»¬å½¢æˆReleaseåˆ†æ”¯ï¼Œå†æ¬¡æ£€éªŒåå°†å®ƒä¸Masteråˆ†æ”¯åˆå¹¶ï¼Œç„¶åæˆ‘ä»¬ä¹‹åReleaseåˆ†æ”¯æ‹‰å‡ºDevelopåˆ†æ”¯è¿›è¡Œæ–°ä¸€è½®çš„å¼€å‘ã€‚</p>
<h3 id="Gitåˆ†æ”¯"><a href="#Gitåˆ†æ”¯" class="headerlink" title="Gitåˆ†æ”¯"></a>Gitåˆ†æ”¯</h3><ul>
<li><p>åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch</div></pre></td></tr></table></figure>
</li>
<li><p>åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -r</div></pre></td></tr></table></figure>
</li>
<li><p>åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -a</div></pre></td></tr></table></figure>
</li>
<li><p>æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch [branch-name]</div></pre></td></tr></table></figure>
</li>
<li><p>æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -b [branch]</div></pre></td></tr></table></figure>
</li>
<li><p>åˆ‡æ¢åˆ°å½“å‰æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶æŒ‡å®šå·¥ä½œåŒº</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout [branch-name]</div></pre></td></tr></table></figure>
</li>
<li><p>åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -</div></pre></td></tr></table></figure>
</li>
<li><p>å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch --set-upstream [branch] [remote-branch]</div></pre></td></tr></table></figure>
</li>
<li><p>åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git merge [branch]</div></pre></td></tr></table></figure>
</li>
<li><p>åˆ é™¤è¿œç¨‹åˆ†æ”¯</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -d [branch-name]</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="åä½œå†²çª"><a href="#åä½œå†²çª" class="headerlink" title="åä½œå†²çª"></a>åä½œå†²çª</h3><p>åœ¨å¤šäººåä½œçš„è¿‡ç¨‹ä¸­è‚¯å®šä¼šç¢°åˆ°è¿™æ ·çš„<strong>é—®é¢˜</strong>ï¼šå¦‚æœä½ çš„å°ä¼™ä¼´å·²ç»å‘ä¸€ä¸ªåˆ†æ”¯æ¨é€äº†ä»–çš„æäº¤ï¼Œè€Œç¢°å·§ä½ ä¹Ÿå¯¹åŒä¸ªåˆ†æ”¯çš„åŒæ ·çš„æ–‡ä»¶ä½œäº†ä¿®æ”¹ï¼Œå¹¶è¯•å›¾æ¨é€ï¼Œé‚£ä¹ˆå°±ä¼šæäº¤è¢«æ‹’ç»ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å…ˆï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git pull</div></pre></td></tr></table></figure></p>
<p>ç­‰ä»·äºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git fetch temp(ä¸´æ—¶åˆ†æ”¯)</div><div class="line">git merge temp</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ—¶å€™åˆgitä¼šå°†ä½ ä»¬ä¸¤ä¸ªäººå¯¹æ–‡ä»¶çš„ä¿®æ”¹éƒ½å‘ˆç°åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ éœ€è¦åœ¨ä¸ä½ çš„å°ä¼™ä¼´å•†é‡å‡ºä¸€ä¸ªæœ€ç»ˆç‰ˆï¼Œä¿®æ”¹ä¹‹åå†æäº¤ä¸Šå»ã€‚</p>
<h1 id="IDEAä¸Git"><a href="#IDEAä¸Git" class="headerlink" title="IDEAä¸Git"></a>IDEAä¸Git</h1><p>å¯èƒ½å¤§å®¶å¯¹ä½¿ç”¨å‘½ä»¤è¡Œå¹¶ä¸æ„Ÿå†’ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸ºå¤§å®¶æ‰¾äº†ä¸€ä»½<a href="https://blog.csdn.net/lovecarpenter/article/details/54290045" target="_blank" rel="external">IDEAçš„gitä½¿ç”¨æ•™ç¨‹</a>ï¼Œè‡³æ­¤å¤§å®¶åªè¦ç‚¹ç‚¹ç‚¹å°±å¥½äº†ã€‚å½“ç„¶è¿™é‡Œè¿˜ä¼šæœ‰å¾ˆå¤šæˆ‘æ²¡æœ‰æ¶‰åŠåˆ°çš„åœ°æ–¹ï¼Œå°±éœ€è¦å¹³æ—¶å¤šç§¯ç´¯äº†ã€‚</p>
<p>åˆ«æ€¥ï¼Œåˆ«æ€¥ï¼ï¼è¿˜è¦æœ€åä¸€ç‚¹å°±æ˜¯ <strong>.gitignore</strong> äº†ï¼</p>
<p>æˆ‘ä»¬å‘ç°åœ¨ä½¿ç”¨IDEAçš„æ—¶å€™ï¼Œä»–é»˜è®¤ä¼šè¦æ±‚æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ–‡ä»¶åŠ å…¥åˆ°gitæ§åˆ¶é‡Œï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¾ˆå¤šIDEAçš„è‡ªå¸¦é…ç½®æ–‡ä»¶æ˜¯ä¸ç”¨ä¹Ÿæ²¡æœ‰å¿…è¦åŠ å…¥gitï¼ˆä¹‹å‰åœ¨è¯´git add . çš„æ—¶å€™ä¹Ÿè¯´è¿‡ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨IDEAçš„.gitignoreæ’ä»¶æ¥å¸®åŠ©æˆ‘ä»¬å¿½ç•¥è¿™äº›æ²¡æœ‰å¿…è¦çš„æ’ä»¶ï¼Œè¿™é‡Œä¹Ÿæ”¾ä¸€ä¸ª<a href="https://blog.csdn.net/qq_34590097/article/details/56284935" target="_blank" rel="external">.gitignoreæ•™ç¨‹</a>ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external">å»–é›ªå³°çš„gitæ•™ç¨‹</a></li>
<li><a href="https://blog.csdn.net/riddle1981/article/details/74938111" target="_blank" rel="external">è¯¦è§£git fetchä¸git pullçš„åŒºåˆ«</a></li>
<li><a href="https://blog.csdn.net/lovecarpenter/article/details/54290045" target="_blank" rel="external">ç‰ˆæœ¬æ§åˆ¶ä¹‹IDEAä½¿ç”¨Git</a></li>
<li><a href="https://blog.csdn.net/qq_34590097/article/details/56284935/" target="_blank" rel="external">å¦‚ä½•åœ¨IntelliJ IDEAä¸­ä½¿ç”¨.ignoreæ’ä»¶å¿½ç•¥ä¸å¿…è¦æäº¤çš„æ–‡ä»¶</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šè™½ç„¶æ—¥å¸¸ä½¿ç”¨gitï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æ€»æ˜¯ä¼šå¿˜è®°ä¸€äº›æ“ä½œï¼Œéš¾å…ä¼šé¢å‘æœç´¢å¼•æ“æŸ¥æ‰¾ã€‚æ‰€ä»¥è¿™é‡Œå°±æ€»ç»“ä¸€ä¸‹ã€‚
    
    </summary>
    
      <category term="å·¥å…·" scheme="http://bestlixiang.site/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="IDEA" scheme="http://bestlixiang.site/tags/IDEA/"/>
    
      <category term="Git" scheme="http://bestlixiang.site/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>ä½ ä¸çŸ¥é“çš„Java ç½‘ç»œIO</title>
    <link href="http://bestlixiang.site/2018/05/21/Java%E5%9F%BA%E7%A1%80/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84Java-%E7%BD%91%E7%BB%9CIO/"/>
    <id>http://bestlixiang.site/2018/05/21/JavaåŸºç¡€/ä½ ä¸çŸ¥é“çš„Java-ç½‘ç»œIO/</id>
    <published>2018-05-21T04:53:19.000Z</published>
    <updated>2018-05-21T04:54:17.420Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šå¯èƒ½å¾ˆå¤šåŒå­¦ä¸€çœ‹Java Java ç½‘ç»œIOï¼Œå¿ƒé‡Œè‚¯å®šä¼šè§‰å¾—è¿™ä¸ªæœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œä¸å°±æ˜¯Socketå—ï¼Œè¯´å¯¹ä¹Ÿå¯¹ï¼Œå› ä¸ºä»–è®²åˆ°äº†BIO(åŒæ­¥é˜»å¡IO)ï¼Œä½†æ˜¯å´ä¸çŸ¥è¿˜æœ‰NIO(åŒæ­¥éé˜»å¡IO)ï¼ŒAIO(å¼‚æ­¥éé˜»å¡IO)ï¼<a id="more"></a></p>
<h1 id="é¡¹ç›®æºç "><a href="#é¡¹ç›®æºç " class="headerlink" title="é¡¹ç›®æºç "></a>é¡¹ç›®æºç </h1><p>å…³äºBIOã€NIOä»¥åŠAIOçš„ä»£ç éƒ½æ”¾åœ¨githubä¸Šäº†ï¼Œæ³¨é‡Šåº”è¯¥å¾ˆè¯¦ç»†äº†ï¼Œå¤§å®¶æœ‰éœ€è¦çš„å¯ä»¥çœ‹ä¸€ä¸‹ï¼š<a href="https://github.com/todorex/Java_IO" target="_blank" rel="external">ä½ ä¸çŸ¥é“çš„é‚£äº›Javaç½‘ç»œIOï¼ˆBIOã€NIOã€AIOï¼‰</a></p>
<h1 id="åŒæ­¥orå¼‚æ­¥-é˜»å¡oréé˜»å¡"><a href="#åŒæ­¥orå¼‚æ­¥-é˜»å¡oréé˜»å¡" class="headerlink" title="åŒæ­¥orå¼‚æ­¥ é˜»å¡oréé˜»å¡"></a>åŒæ­¥orå¼‚æ­¥ é˜»å¡oréé˜»å¡</h1><p>åœ¨è°ˆåˆ°IOçš„æ—¶å€™ï¼Œé¿å…ä¸äº†å¬åˆ°åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡è¿™å‡ ä¸ªåè¯æˆ–è€…æ˜¯ä»–ä»¬çš„ç»„åˆè¯ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæ„Ÿåˆ°è¿·æƒ‘ä¸è§£ã€‚</p>
<h2 id="åŒæ­¥orå¼‚æ­¥"><a href="#åŒæ­¥orå¼‚æ­¥" class="headerlink" title="åŒæ­¥orå¼‚æ­¥"></a>åŒæ­¥orå¼‚æ­¥</h2><p>åŒæ­¥å’Œå¼‚æ­¥æ˜¯ç›¸å¯¹äºIOäº‹ä»¶(è¯»å†™æ“ä½œ)è€Œè¨€çš„</p>
<ul>
<li>åŒæ­¥ï¼šåœ¨è¿›è¡ŒIOæ“ä½œæ—¶ï¼Œç¨‹åºä¸èƒ½å¹²åˆ«çš„äº‹æƒ…ï¼Œç­‰ç€IOäº‹ä»¶å®Œæˆä¹‹åæ‰èƒ½å»åšåˆ«çš„äº‹æƒ…</li>
<li>å¼‚æ­¥ï¼šä¸å…³å¿ƒIOå¤„ç†æ“ä½œ(å› ä¸ºæŠŠIOæ“ä½œäº¤ç»™æ“ä½œç³»ç»Ÿå¹²äº†)ï¼Œåœ¨å¤„ç†IOçš„æ—¶å€™ï¼Œå¯ä»¥å»åšåˆ«çš„äº‹æƒ…ï¼Œç„¶åç­‰å¾…IOäº‹ä»¶å¤„ç†å®Œæˆçš„é€šçŸ¥</li>
</ul>
<h2 id="é˜»å¡oréé˜»å¡"><a href="#é˜»å¡oréé˜»å¡" class="headerlink" title="é˜»å¡oréé˜»å¡"></a>é˜»å¡oréé˜»å¡</h2><p>é˜»å¡å’Œéé˜»å¡æ˜¯ç›¸å¯¹äºæ•°æ®è€Œè¨€çš„</p>
<ul>
<li>é˜»å¡ï¼šå¦‚æœæ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œç¨‹åºå°±ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ•°æ®å‡†å¤‡å¥½äº†æ‰å¾€ä¸‹æ‰§è¡Œ</li>
<li>éé˜»å¡ï¼šä¸ç®¡æ•°æ®æœ‰æ²¡æœ‰å‡†å¤‡å¥½ï¼Œç¨‹åºéƒ½å¾€ä¸‹è¿›è¡Œ</li>
</ul>
<p>è¿™é‡Œæ˜¯è‡ªå·±çœ‹åˆ°çš„ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥ç»“åˆèµ·æ¥ç†è§£ï¼š</p>
<p>å¦‚æœä½ æƒ³åƒä¸€ä»½å®«ä¿é¸¡ä¸ç›–é¥­ï¼š</p>
<p><strong>åŒæ­¥é˜»å¡</strong>ï¼šä½ åˆ°é¥­é¦†ç‚¹é¤ï¼Œç„¶ååœ¨é‚£ç­‰ç€ï¼Œè¿˜è¦ä¸€è¾¹å–Šï¼šå¥½äº†æ²¡å•Šï¼ï¼ˆIOæ“ä½œ[æ‹¿é¥­]æ²¡æœ‰å¹²å¥½ï¼Œé¢„æƒ³ä¹‹å¤–çš„äº‹éƒ½ä¸èƒ½å¹²ï¼Œæ•°æ®[é¥­]æ²¡æœ‰å¥½ï¼Œå°±ä¸€ç›´ç­‰ç€ï¼‰</p>
<p><strong>åŒæ­¥éé˜»å¡</strong>ï¼šåœ¨é¥­é¦†ç‚¹å®Œé¤ï¼Œå°±å»é›ç‹—äº†ã€‚ä¸è¿‡æºœä¸€ä¼šå„¿ï¼Œå°±å›é¥­é¦†å–Šä¸€å£°ï¼šå¥½äº†æ²¡å•Šï¼ï¼ˆIOæ“ä½œ[æ‹¿é¥­]æ²¡æœ‰å¹²å¥½ï¼Œé¢„æƒ³ä¹‹å¤–çš„äº‹éƒ½ä¸èƒ½å¹²ï¼Œæ•°æ®[é¥­]æ²¡æœ‰å¥½ï¼Œä½†æ˜¯ä¸ç”¨ä¸€ç›´ç­‰ç€ï¼Œå¯ä»¥ç»§ç»­å¹²é¢„å…ˆå®‰æ’çš„äº‹[é›ç‹—]ï¼Œä½†æ˜¯éœ€è¦æ—¶ä¸æ—¶å»é—®ä¸€ä¸‹é¥­æœ‰æ²¡æœ‰å¥½ï¼‰</p>
<p><strong>å¼‚æ­¥é˜»å¡</strong>ï¼šé›ç‹—çš„æ—¶å€™ï¼Œæ¥åˆ°é¥­é¦†ç”µè¯ï¼Œè¯´é¥­åšå¥½äº†ï¼Œè®©æ‚¨äº²è‡ªå»æ‹¿ã€‚ï¼ˆIOæ“ä½œ[æ‹¿é¥­]æ²¡æœ‰å¹²å¥½ï¼Œä½†æ˜¯æˆ‘æƒ³å¹²å•¥å°±å¹²å•¥ï¼Œç­‰ç€é€šçŸ¥å°±å¥½ï¼Œæ•°æ®[é¥­]æ²¡æœ‰å¥½ï¼Œå°±ä¸€ç›´ç­‰ç€å»æ‹¿é¥­ï¼‰</p>
<p><strong>å¼‚æ­¥éé˜»å¡</strong>ï¼šé¥­é¦†æ‰“ç”µè¯è¯´ï¼Œæˆ‘ä»¬çŸ¥é“æ‚¨çš„ä½ç½®ï¼Œä¸€ä¼šç»™ä½ é€è¿‡æ¥ï¼Œå®‰å¿ƒé›ç‹—å°±å¯ä»¥äº†ã€‚ï¼ˆIOæ“ä½œ[æ‹¿é¥­]æ²¡æœ‰å¹²å¥½ï¼Œä½†æ˜¯æˆ‘æƒ³å¹²å•¥å°±å¹²å•¥ï¼Œç­‰ç€é€šçŸ¥å°±å¥½ï¼Œæ•°æ®[é¥­]æ²¡æœ‰å¥½ï¼Œä½†æ˜¯ä¸ç”¨ä¸€ç›´ç­‰ç€ï¼Œå¯ä»¥ç»§ç»­å¹²é¢„å…ˆå®‰æ’çš„äº‹ï¼‰</p>
<h1 id="I-Oæ¨¡å‹"><a href="#I-Oæ¨¡å‹" class="headerlink" title="I/Oæ¨¡å‹"></a>I/Oæ¨¡å‹</h1><p>Unixå®šä¹‰äº†äº”ç§I/Oæ¨¡å‹ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>é˜»å¡I/O</li>
<li>éé˜»å¡I/O</li>
<li>I/Oå¤ç”¨ï¼ˆselectã€pollã€linux 2.6ç§æ”¹è¿›çš„epollï¼‰</li>
<li>ä¿¡å·é©±åŠ¨IOï¼ˆSIGIOï¼‰</li>
<li>å¼‚æ­¥I/Oï¼ˆPOSIXçš„aio_ç³»åˆ—å‡½æ•°ï¼‰</li>
</ul>
<p>ä¸‹å›¾æ˜¯äº”ç§I/Oæ¨¡å‹çš„æ¯”è¾ƒï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/javaCore/jpg/unix_io_model.jpg" alt="unix_io_model"></p>
<p>POSIXæŠŠI/Oæ“ä½œåˆ’åˆ†æˆä¸¤ç±»ï¼š</p>
<ul>
<li>åŒæ­¥I/O: åŒæ­¥I/Oæ“ä½œ<strong>å¯¼è‡´è¯·æ±‚é˜»å¡</strong>ï¼Œç›´è‡³æ“ä½œå®Œæˆ</li>
<li>å¼‚æ­¥I/O: å¼‚æ­¥I/Oæ“ä½œ<strong>ä¸å¯¼è‡´è¯·æ±‚é˜»å¡</strong></li>
</ul>
<p>ä»ä¸Šé¢çš„å›¾ä¸­å¯ä»¥çœ‹å‡ºUnixçš„å‰å››ç§I/Oæ¨¡å‹éƒ½æ˜¯åŒæ­¥I/O, åªæœ‰æœ€åä¸€ç§æ‰æ˜¯å¼‚æ­¥I/Oã€‚</p>
<p>æˆ‘ä»¬åœ¨çœ‹çœ‹Javaä¸­çš„IOåˆ†ç±»ï¼š</p>
<ul>
<li>ä¼ ç»Ÿçš„Java BIO (blocking I/O)æ˜¯Unix I/Oæ¨¡å‹ä¸­çš„ç¬¬ä¸€ç§ã€‚</li>
<li>Java NIOä¸­å¦‚æœä¸ä½¿ç”¨selectæ¨¡å¼ï¼Œè€ŒåªæŠŠchannelé…ç½®æˆnonblockingåˆ™æ˜¯ç¬¬äºŒç§æ¨¡å‹ã€‚</li>
<li>Java NIO selectå®ç°çš„æ˜¯ä¸€ç§å¤šè·¯å¤ç”¨I/Oã€‚åº•å±‚ä½¿ç”¨epollæˆ–è€…ç›¸åº”çš„pollç³»ç»Ÿè°ƒç”¨ã€‚</li>
<li>ç¬¬å››ç§æ¨¡å‹JDKåº”è¯¥æ˜¯æ²¡æœ‰å®ç°ã€‚</li>
<li>Java NIO2å¢åŠ äº†å¯¹ç¬¬äº”ç§æ¨¡å‹çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯AIOã€‚</li>
</ul>
<h1 id="BIOç½‘ç»œç¼–ç¨‹"><a href="#BIOç½‘ç»œç¼–ç¨‹" class="headerlink" title="BIOç½‘ç»œç¼–ç¨‹"></a>BIOç½‘ç»œç¼–ç¨‹</h1><p>ä¼ ç»Ÿçš„åŒæ­¥é˜»å¡æ¨¡å‹(BIO)å¼€å‘ä¸­ï¼ŒServerSocketè´Ÿè´£ç»‘å®šIPåœ°å€ï¼Œå¯åŠ¨ç›‘å¬ç«¯å£ï¼›Socketè´Ÿè´£å‘èµ·è¿æ¥æ“ä½œã€‚è¿æ¥æˆåŠŸåï¼ŒåŒæ–¹é€šè¿‡è¾“å…¥å’Œè¾“å‡ºæµè¿›è¡ŒåŒæ­¥é˜»å¡å¼é€šä¿¡ã€‚</p>
<p>ç®€å•çš„æè¿°ä¸€ä¸‹BIOçš„æœåŠ¡ç«¯é€šä¿¡æ¨¡å‹ï¼šé‡‡ç”¨BIOé€šä¿¡æ¨¡å‹çš„æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”±ä¸€ä¸ªç‹¬ç«‹çš„Acceptorçº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå®ƒæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ä¹‹åä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œé“¾è·¯å¤„ç†æ²¡å¤„ç†å®Œæˆåï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ï¼Œçº¿ç¨‹é”€æ¯ã€‚å³å…¸å‹çš„ä¸€è¯·æ±‚ä¸€åº”ç­”é€šä¿¡æ¨¡å‹ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/javaCore/jpg/bio.png" alt="bio"></p>
<p>è¯¥æ¨¡å‹æœ€å¤§çš„é—®é¢˜å°±æ˜¯ç¼ºä¹å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›ï¼Œå½“å®¢æˆ·ç«¯å¹¶å‘è®¿é—®é‡å¢åŠ åï¼ŒæœåŠ¡ç«¯çš„çº¿ç¨‹ä¸ªæ•°å’Œå®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°å‘ˆ1:1çš„æ­£æ¯”å…³ç³»ï¼ŒJavaä¸­çš„çº¿ç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒå®è´µçš„ç³»ç»Ÿèµ„æºï¼Œçº¿ç¨‹æ•°é‡å¿«é€Ÿè†¨èƒ€åï¼Œç³»ç»Ÿçš„æ€§èƒ½å°†æ€¥å‰§ä¸‹é™ï¼Œéšç€è®¿é—®é‡çš„ç»§ç»­å¢å¤§ï¼Œç³»ç»Ÿæœ€ç»ˆå°±<strong>æ­»æ‰äº†</strong>ã€‚</p>
<p> <strong>ä¸ºäº†æ”¹è¿›è¿™ç§ä¸€è¿æ¥ä¸€çº¿ç¨‹çš„æ¨¡å‹</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>çº¿ç¨‹æ± </strong>æ¥ç®¡ç†è¿™äº›çº¿ç¨‹ï¼ˆéœ€è¦äº†è§£æ›´å¤šè¯·å‚è€ƒå‰é¢æä¾›çš„æ–‡ç« ï¼‰ï¼Œå®ç°1ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹å¤„ç†Nä¸ªå®¢æˆ·ç«¯çš„æ¨¡å‹ï¼ˆä½†æ˜¯åº•å±‚è¿˜æ˜¯ä½¿ç”¨çš„åŒæ­¥é˜»å¡I/Oï¼‰ï¼Œé€šå¸¸è¢«ç§°ä¸ºâ€œä¼ªå¼‚æ­¥I/Oæ¨¡å‹â€œã€‚ä¼ªå¼‚æ­¥I/Oæ¨¡å‹å›¾å¦‚ä¸‹ï¼š</p>
<p> <img src="http://o6plzvjf2.bkt.clouddn.com/javaCore/png/fake_aio.png" alt="fake_aio"></p>
<p> æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä½¿ç”¨CachedThreadPoolçº¿ç¨‹æ± ï¼Œå…¶å®é™¤äº†èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬ç®¡ç†çº¿ç¨‹ï¼ˆå¤ç”¨ï¼‰ï¼Œçœ‹èµ·æ¥ä¹Ÿå°±åƒæ˜¯1:1çš„å®¢æˆ·ç«¯ï¼šçº¿ç¨‹æ•°æ¨¡å‹ï¼Œè€Œä½¿ç”¨FixedThreadPoolæˆ‘ä»¬å°±æœ‰æ•ˆçš„æ§åˆ¶äº†çº¿ç¨‹çš„æœ€å¤§æ•°é‡ï¼Œä¿è¯äº†ç³»ç»Ÿæœ‰é™çš„èµ„æºçš„æ§åˆ¶ï¼Œå®ç°äº†N:Mçš„ä¼ªå¼‚æ­¥I/Oæ¨¡å‹ã€‚ä½†æ˜¯ï¼Œæ­£å› ä¸ºé™åˆ¶äº†çº¿ç¨‹æ•°é‡ï¼Œå¦‚æœå‘ç”Ÿå¤§é‡å¹¶å‘è¯·æ±‚ï¼Œè¶…è¿‡æœ€å¤§æ•°é‡çš„çº¿ç¨‹å°±åªèƒ½ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„æœ‰ç©ºé—²çš„çº¿ç¨‹å¯ä»¥è¢«å¤ç”¨ã€‚è€Œå¯¹Socketçš„è¾“å…¥æµå°±è¡Œè¯»å–æ—¶ï¼Œä¼šä¸€ç›´é˜»å¡ã€‚  æ‰€ä»¥åœ¨è¯»å–æ•°æ®è¾ƒæ…¢æ—¶ï¼ˆæ¯”å¦‚æ•°æ®é‡å¤§ã€ç½‘ç»œä¼ è¾“æ…¢ç­‰ï¼‰ï¼Œå¤§é‡å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå…¶ä»–æ¥å…¥çš„æ¶ˆæ¯ï¼Œ<strong>åªèƒ½ä¸€ç›´ç­‰å¾…</strong>ï¼Œè¿™å°±æ˜¯æœ€å¤§çš„å¼Šç«¯ã€‚</p>
<p> <strong>PSï¼š</strong> æºç éƒ½åœ¨githubä¸Šã€‚</p>
<h1 id="NIOç½‘ç»œç¼–ç¨‹"><a href="#NIOç½‘ç»œç¼–ç¨‹" class="headerlink" title="NIOç½‘ç»œç¼–ç¨‹"></a>NIOç½‘ç»œç¼–ç¨‹</h1><p>NIO(åŒæ­¥éé˜»å¡IO)æä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„Socketå’ŒServerSocketç›¸å¯¹åº”çš„SocketChannelå’ŒServerSocketChannelä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°ã€‚<strong>æ–°å¢çš„ç€ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼</strong>ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡I/Oæ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨NIOçš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚</p>
<p>åœ¨ç”¨NIOè¿›è¡Œå¼€å‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹NIOçš„å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p>
<h2 id="ç¼“å†²åŒº-Buffer"><a href="#ç¼“å†²åŒº-Buffer" class="headerlink" title="ç¼“å†²åŒº Buffer"></a>ç¼“å†²åŒº Buffer</h2><p>Bufferæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¯»å‡ºçš„æ•°æ®ã€‚åœ¨NIOåº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ï¼›åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯å†™å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚ä»»ä½•æ—¶å€™è®¿é—®NIOä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºè¿›è¡Œæ“ä½œã€‚</p>
<p>ç¼“å†²åŒºå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶æä¾›äº†å¯¹æ•°æ®ç»“æ„åŒ–è®¿é—®ä»¥åŠç»´æŠ¤è¯»å†™ä½ç½®ç­‰ä¿¡æ¯ã€‚å…·ä½“çš„ç¼“å­˜åŒºæœ‰è¿™äº›ï¼šByteBuffeã€CharBufferã€ ShortBufferã€IntBufferã€LongBufferã€FloatBufferã€DoubleBufferã€‚ä»–ä»¬å®ç°äº†ç›¸åŒçš„æ¥å£ï¼šBufferã€‚</p>
<h2 id="é€šé“-Channel"><a href="#é€šé“-Channel" class="headerlink" title="é€šé“ Channel"></a>é€šé“ Channel</h2><p>æˆ‘ä»¬å¯¹æ•°æ®çš„è¯»å–å’Œå†™å…¥è¦é€šè¿‡Channelï¼Œå®ƒå°±åƒæ°´ç®¡ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªé€šé“ã€‚é€šé“ä¸åŒäºæµçš„åœ°æ–¹å°±æ˜¯é€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»ã€å†™å’ŒåŒæ—¶è¯»å†™æ“ä½œã€‚åº•å±‚çš„æ“ä½œç³»ç»Ÿçš„é€šé“ä¸€èˆ¬éƒ½æ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥å…¨åŒå·¥çš„Channelæ¯”æµèƒ½æ›´å¥½çš„æ˜ å°„åº•å±‚æ“ä½œç³»ç»Ÿçš„APIã€‚</p>
<p>Channelä¸»è¦åˆ†ä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>SelectableChannelï¼šç”¨æˆ·ç½‘ç»œè¯»å†™</li>
<li>FileChannelï¼šç”¨äºæ–‡ä»¶æ“ä½œ</li>
</ul>
<p>ç½‘ç»œç¼–ç¨‹ä¸­æ¶‰åŠçš„ServerSocketChannelå’ŒSocketChanneléƒ½æ˜¯SelectableChannelçš„å­ç±»ã€‚</p>
<h2 id="å¤šè·¯å¤ç”¨å™¨-Selector"><a href="#å¤šè·¯å¤ç”¨å™¨-Selector" class="headerlink" title="å¤šè·¯å¤ç”¨å™¨ Selector"></a>å¤šè·¯å¤ç”¨å™¨ Selector</h2><p>Selectoræä¾›é€‰æ‹©å·²ç»å°±ç»ªçš„ä»»åŠ¡çš„èƒ½åŠ›ï¼šSelectorä¼šä¸æ–­è½®è¯¢æ³¨å†Œåœ¨å…¶ä¸Šçš„Channelï¼Œå¦‚æœæŸä¸ªChannelä¸Šé¢å‘ç”Ÿè¯»æˆ–è€…å†™äº‹ä»¶ï¼Œè¿™ä¸ªChannelå°±å¤„äºå°±ç»ªçŠ¶æ€ï¼Œä¼šè¢«Selectorè½®è¯¢å‡ºæ¥ï¼Œç„¶åé€šè¿‡SelectionKeyå¯ä»¥è·å–å°±ç»ªChannelçš„é›†åˆï¼Œè¿›è¡Œåç»­çš„I/Oæ“ä½œã€‚</p>
<p>ä¸€ä¸ªSelectorå¯ä»¥åŒæ—¶è½®è¯¢å¤šä¸ªChannel(<strong>æ‰€ä»¥æ˜¯éé˜»å¡çš„</strong>)ï¼Œå› ä¸ºJDKä½¿ç”¨äº†epoll()ä»£æ›¿ä¼ ç»Ÿçš„selectå®ç°ï¼Œæ‰€ä»¥æ²¡æœ‰æœ€å¤§è¿æ¥å¥æŸ„1024/2048çš„é™åˆ¶ã€‚æ‰€ä»¥ï¼Œåªéœ€è¦ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£Selectorçš„è½®è¯¢ï¼Œå°±å¯ä»¥æ¥å…¥æˆåƒä¸Šä¸‡çš„å®¢æˆ·ç«¯ã€‚</p>
<h2 id="åˆ›å»ºNIOæœåŠ¡ç«¯çš„é€šä¿¡æµç¨‹"><a href="#åˆ›å»ºNIOæœåŠ¡ç«¯çš„é€šä¿¡æµç¨‹" class="headerlink" title="åˆ›å»ºNIOæœåŠ¡ç«¯çš„é€šä¿¡æµç¨‹"></a>åˆ›å»ºNIOæœåŠ¡ç«¯çš„é€šä¿¡æµç¨‹</h2><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢è¿™ç§é€šä¿¡åºåˆ—å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/javaCore/png/nioServer.png" alt="nioServer"></p>
<p><strong>PSï¼š</strong> æºç éƒ½åœ¨githubä¸Šã€‚</p>
<h1 id="AIOç½‘ç»œç¼–ç¨‹"><a href="#AIOç½‘ç»œç¼–ç¨‹" class="headerlink" title="AIOç½‘ç»œç¼–ç¨‹"></a>AIOç½‘ç»œç¼–ç¨‹</h1><p>å¼‚æ­¥çš„å¥—æ¥å­—é€šé“æ˜¯çœŸæ­£çš„å¼‚æ­¥éé˜»å¡I/Oï¼Œå¯¹åº”äºUNIXç½‘ç»œç¼–ç¨‹ä¸­çš„äº‹ä»¶é©±åŠ¨I/Oï¼ˆAIOï¼‰ã€‚ä»–ä¸éœ€è¦è¿‡å¤šçš„Selectorå¯¹æ³¨å†Œçš„é€šé“è¿›è¡Œè½®è¯¢å³å¯å®ç°å¼‚æ­¥è¯»å†™ï¼Œä»è€Œç®€åŒ–äº†NIOçš„ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<p>AIO(å¼‚æ­¥éé˜»å¡IO)æä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„Socketå’ŒServerSocketç›¸å¯¹åº”çš„AsynchronousSocketChannelå’ŒAsynchronousServerSocketChannelä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°ã€‚</p>
<h2 id="å¼‚æ­¥çš„å¤„ç†"><a href="#å¼‚æ­¥çš„å¤„ç†" class="headerlink" title="å¼‚æ­¥çš„å¤„ç†"></a>å¼‚æ­¥çš„å¤„ç†</h2><p>å¼‚æ­¥æ— éæ˜¯é€šçŸ¥ç³»ç»Ÿåšä¸€ä»¶äº‹æƒ…ã€‚ç„¶åå¿˜æ‰å®ƒï¼Œè‡ªå·±åšå…¶ä»–äº‹æƒ…å»äº†ã€‚å¾ˆå¤šæ—¶å€™ç³»ç»Ÿåšå®ŒæŸä¸€ä»¶äº‹æƒ…åéœ€è¦ä¸€äº›åç»­çš„æ“ä½œã€‚æ€ä¹ˆåŠï¼Ÿè¿™æ—¶å€™å°±æ˜¯å‘Šè¯‰å¼‚æ­¥è°ƒç”¨å¦‚ä½•åšåç»­å¤„ç†ã€‚é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>å°†æ¥å¼: å½“ä½ å¸Œæœ›ä¸»çº¿ç¨‹å‘èµ·å¼‚æ­¥è°ƒç”¨ï¼Œå¹¶è½®è¯¢ç­‰å¾…ç»“æœçš„æ—¶å€™ä½¿ç”¨å°†æ¥å¼;</li>
<li>å›è°ƒå¼: å¸¸è¯´çš„å¼‚æ­¥å›è°ƒå°±æ˜¯å®ƒã€‚</li>
</ul>
<p><strong>PSï¼š</strong> AIOçš„ä»£ç ä¸»è¦åŸºäºå›è°ƒå¼ï¼Œæºç éƒ½åœ¨githubä¸Šã€‚</p>
<h1 id="BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯åˆ†æ"><a href="#BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯åˆ†æ" class="headerlink" title="BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯åˆ†æ:"></a>BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯åˆ†æ:</h1><ul>
<li>BIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ç¨‹åºç›´è§‚ç®€å•æ˜“ç†è§£ã€‚</li>
<li>NIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK1.4å¼€å§‹æ”¯æŒã€‚</li>
<li>AIOæ–¹å¼ä½¿ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OSå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7å¼€å§‹æ”¯æŒã€‚</li>
</ul>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://blog.csdn.net/itismelzp/article/details/50886009" target="_blank" rel="external">Javaä¸­BIO,NIO,AIOçš„ç†è§£</a></li>
<li><a href="https://blog.csdn.net/mcgrady_tracy/article/details/47424149" target="_blank" rel="external">Linux selectå’Œpollç³»ç»Ÿè°ƒç”¨</a></li>
<li><a href="http://colobu.com/2014/11/13/java-aio-introduction/" target="_blank" rel="external">java aio ç¼–ç¨‹</a></li>
<li><a href="https://blog.csdn.net/anxpp/article/details/51512200" target="_blank" rel="external">Java ç½‘ç»œIOç¼–ç¨‹æ€»ç»“ï¼ˆBIOã€NIOã€AIOå‡å«å®Œæ•´å®ä¾‹ä»£ç ï¼‰</a></li>
<li><a href="https://blog.csdn.net/huangwenyi1010/article/details/75577091?ref=myread" target="_blank" rel="external">Javaä¹‹IO,BIO,NIO,AIOçŸ¥å¤šå°‘ï¼Ÿ</a></li>
<li><a href="https://blog.csdn.net/an_tao/article/details/45914841" target="_blank" rel="external">ServerSocketChannelçš„ç”¨æ³•è¯¦è§£</a></li>
<li><a href="https://www.jianshu.com/p/c5e16460047b" target="_blank" rel="external">(001)javaä¸­çš„AIO</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šå¯èƒ½å¾ˆå¤šåŒå­¦ä¸€çœ‹Java Java ç½‘ç»œIOï¼Œå¿ƒé‡Œè‚¯å®šä¼šè§‰å¾—è¿™ä¸ªæœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œä¸å°±æ˜¯Socketå—ï¼Œè¯´å¯¹ä¹Ÿå¯¹ï¼Œå› ä¸ºä»–è®²åˆ°äº†BIO(åŒæ­¥é˜»å¡IO)ï¼Œä½†æ˜¯å´ä¸çŸ¥è¿˜æœ‰NIO(åŒæ­¥éé˜»å¡IO)ï¼ŒAIO(å¼‚æ­¥éé˜»å¡IO)ï¼
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://bestlixiang.site/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="BIO" scheme="http://bestlixiang.site/tags/BIO/"/>
    
      <category term="NIO" scheme="http://bestlixiang.site/tags/NIO/"/>
    
      <category term="AIO" scheme="http://bestlixiang.site/tags/AIO/"/>
    
  </entry>
  
  <entry>
    <title>HTTPåè®®</title>
    <link href="http://bestlixiang.site/2018/05/20/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/HTTP%E5%8D%8F%E8%AE%AE/"/>
    <id>http://bestlixiang.site/2018/05/20/è®¡ç®—æœºç½‘ç»œ/HTTPåè®®/</id>
    <published>2018-05-20T06:55:48.000Z</published>
    <updated>2018-05-20T06:59:29.325Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šä½œä¸ºWebå¼€å‘äººå‘˜ï¼Œå¯èƒ½ä½ æœ€éœ€è¦æ·±å…¥å­¦ä¹ çš„å°±æ˜¯<strong>HTTPåè®®</strong>äº†å§ï¼<a id="more"></a></p>
<h1 id="HTTPè®¤è¯†"><a href="#HTTPè®¤è¯†" class="headerlink" title="HTTPè®¤è¯†"></a>HTTPè®¤è¯†</h1><p><strong>HTTPåè®®</strong>æ˜¯Hyper Text TransferProtocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ç¼©å†™,<br>å®ƒæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®ï¼ˆHTML æ–‡ä»¶, å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ï¼‰çš„åº”ç”¨å±‚åè®®ã€‚å®ƒå·¥ä½œäºå®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¶æ„ä¹‹ä¸Šã€‚æµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚WebæœåŠ¡å™¨æ ¹æ®æ¥æ”¶åˆ°çš„è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯ã€‚</p>
<h1 id="HTTPç‰¹ç‚¹"><a href="#HTTPç‰¹ç‚¹" class="headerlink" title="HTTPç‰¹ç‚¹"></a>HTTPç‰¹ç‚¹</h1><ol>
<li>ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚è¯·æ±‚æ–¹æ³•å¸¸ç”¨çš„æœ‰GETã€HEADã€POSTã€‚æ¯ç§æ–¹æ³•è§„å®šäº†å®¢æˆ·ä¸æœåŠ¡å™¨è”ç³»çš„ç±»å‹ä¸åŒã€‚ç”±äºHTTPåè®®ç®€å•ï¼Œä½¿å¾—HTTPæœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚</li>
<li>çµæ´»ï¼šHTTPå…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”±Content-TypeåŠ ä»¥æ ‡è®°ã€‚</li>
<li>HTTP 0.9å’Œ1.0ä½¿ç”¨éæŒç»­è¿æ¥ï¼šé™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚HTTP 1.1ä½¿ç”¨æŒç»­è¿æ¥ï¼šä¸å¿…ä¸ºæ¯ä¸ªwebå¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œä¸€ä¸ªè¿æ¥å¯ä»¥ä¼ é€å¤šä¸ªå¯¹è±¡ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ã€‚</li>
<li>æ— çŠ¶æ€ï¼šHTTPåè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿«ã€‚</li>
</ol>
<p><strong>PSï¼š</strong> HTTPåè®®æ˜¯æ— çŠ¶æ€çš„å’ŒConnection: keep-aliveçš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆçŠ¶æ€ã€‚ä»å¦ä¸€æ–¹é¢è®²ï¼Œæ‰“å¼€ä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ç½‘é¡µå’Œä½ ä¹‹å‰æ‰“å¼€è¿™ä¸ªæœåŠ¡å™¨ä¸Šçš„ç½‘é¡µä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ã€‚<br>HTTPæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„é¢å‘è¿æ¥çš„åè®®ï¼Œæ— çŠ¶æ€ä¸ä»£è¡¨HTTPä¸èƒ½ä¿æŒTCPè¿æ¥ï¼Œæ›´ä¸èƒ½ä»£è¡¨HTTPä½¿ç”¨çš„æ˜¯UDPåè®®ï¼ˆæ— è¿æ¥ï¼‰ã€‚</p>
</li>
<li><p>ä»HTTP/1.1èµ·ï¼Œé»˜è®¤éƒ½å¼€å¯äº†Keep-Aliveï¼Œä¿æŒè¿æ¥ç‰¹æ€§ï¼Œç®€å•åœ°è¯´ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå¦‚æœå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨ä¸Šçš„ç½‘é¡µï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚<br>Keep-Aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚</p>
</li>
</ul>
<h1 id="HTTPå·¥ä½œåŸç†"><a href="#HTTPå·¥ä½œåŸç†" class="headerlink" title="HTTPå·¥ä½œåŸç†"></a>HTTPå·¥ä½œåŸç†</h1><p>HTTPåè®®å®šä¹‰Webå®¢æˆ·ç«¯å¦‚ä½•ä»WebæœåŠ¡å™¨è¯·æ±‚Webé¡µé¢ï¼Œä»¥åŠæœåŠ¡å™¨å¦‚ä½•æŠŠWebé¡µé¢ä¼ é€ç»™å®¢æˆ·ç«¯ã€‚HTTPåè®®é‡‡ç”¨äº†<strong>è¯·æ±‚/å“åº”æ¨¡å‹</strong>ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª<strong>è¯·æ±‚æŠ¥æ–‡</strong>ï¼ŒæœåŠ¡å™¨å°†è¿”å›ä¸€ä¸ª<strong>å“åº”æŠ¥æ–‡</strong>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ HTTP è¯·æ±‚æ­¥éª¤ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯è¿æ¥åˆ°WebæœåŠ¡å™¨ï¼š<br>ä¸€ä¸ªHTTPå®¢æˆ·ç«¯ï¼Œé€šå¸¸æ˜¯æµè§ˆå™¨ï¼Œä¸WebæœåŠ¡å™¨çš„HTTPç«¯å£ï¼ˆé»˜è®¤ä¸º80ï¼‰å»ºç«‹ä¸€ä¸ªTCPå¥—æ¥å­—è¿æ¥ã€‚ä¾‹å¦‚ï¼š<a href="http://www.todorex.comã€‚" target="_blank" rel="external">http://www.todorex.comã€‚</a></li>
<li>å‘é€HTTPè¯·æ±‚ï¼š<br>é€šè¿‡TCPå¥—æ¥å­—ï¼Œå®¢æˆ·ç«¯å‘WebæœåŠ¡å™¨å‘é€ä¸€ä¸ªæ–‡æœ¬çš„è¯·æ±‚æŠ¥æ–‡ã€‚</li>
<li>æœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶è¿”å›HTTPå“åº”<br>WebæœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå®šä½è¯·æ±‚èµ„æºã€‚æœåŠ¡å™¨å°†èµ„æºå¤æœ¬å†™åˆ°TCPå¥—æ¥å­—ï¼Œç”±å®¢æˆ·ç«¯è¯»å–ã€‚</li>
<li>é‡Šæ”¾è¿æ¥TCPè¿æ¥ï¼š<br>è‹¥è¯·æ±‚æŠ¥æ–‡é¦–éƒ¨çš„connection æ¨¡å¼ä¸ºcloseï¼Œåˆ™æœåŠ¡å™¨ä¸»åŠ¨å…³é—­TCPè¿æ¥ï¼Œå®¢æˆ·ç«¯è¢«åŠ¨å…³é—­è¿æ¥ï¼Œé‡Šæ”¾TCPè¿æ¥;è‹¥connection æ¨¡å¼ä¸ºkeepaliveï¼Œåˆ™è¯¥è¿æ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´å†…å¯ä»¥ç»§ç»­æ¥æ”¶è¯·æ±‚ã€‚</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£æHTMLå†…å®¹<br>å®¢æˆ·ç«¯æµè§ˆå™¨é¦–å…ˆè§£æå“åº”æŠ¥æ–‡ï¼Œç„¶åå®¢æˆ·ç«¯æµè§ˆå™¨è¯»å–å“åº”æ•°æ®HTMLï¼Œæ ¹æ®HTMLçš„è¯­æ³•å¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶åœ¨æµè§ˆå™¨çª—å£ä¸­æ˜¾ç¤ºã€‚</li>
</ol>
<h1 id="HTTPæŠ¥æ–‡ä¹‹è¯·æ±‚æŠ¥æ–‡"><a href="#HTTPæŠ¥æ–‡ä¹‹è¯·æ±‚æŠ¥æ–‡" class="headerlink" title="HTTPæŠ¥æ–‡ä¹‹è¯·æ±‚æŠ¥æ–‡"></a>HTTPæŠ¥æ–‡ä¹‹è¯·æ±‚æŠ¥æ–‡</h1><p>è¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œ(è¯·æ±‚æ–¹æ³•ã€URLã€åè®®ç‰ˆæœ¬)ã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œ(å›è½¦+æ¢è¡Œ)å’Œè¯·æ±‚æ•°æ®(ä¸»ä½“)å››ä¸ªéƒ¨åˆ†ç»„æˆã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/httpRequest.png" alt="httpRequest"></p>
<p>å®ƒçš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/httpRequestDemo.png" alt="httpReponseDemo"></p>
<h2 id="è¯·æ±‚æŠ¥æ–‡ä¹‹URL"><a href="#è¯·æ±‚æŠ¥æ–‡ä¹‹URL" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡ä¹‹URL"></a>è¯·æ±‚æŠ¥æ–‡ä¹‹URL</h2><p>HTTPä½¿ç”¨ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifiers, URIï¼‰æ¥ä¼ è¾“æ•°æ®å’Œå»ºç«‹è¿æ¥ã€‚URIåŒ…å«äº†ç”¨äºæŸ¥æ‰¾æŸä¸ªèµ„æºçš„è¶³å¤Ÿçš„ä¿¡æ¯ã€‚</p>
<p>ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locator, URLï¼‰æ˜¯äº’è”ç½‘ä¸Šç”¨æ¥æ ‡è¯†æŸä¸€å¤„èµ„æºçš„åœ°ç‚¹ï¼Œæ‰€ä»¥å¯è§URLæ˜¯URIçš„å­é›†ã€‚ä»¥ä¸‹é¢è¿™ä¸ªURLä¸ºä¾‹ï¼Œä»‹ç»ä¸‹æ™®é€šURLçš„å„éƒ¨åˆ†ç»„æˆï¼š</p>
<blockquote>
<p><a href="http://www.aspxfans.com:8080/news/index.asp?boardID=5&amp;ID=24618&amp;page=1#name" target="_blank" rel="external">http://www.aspxfans.com:8080/news/index.asp?boardID=5&amp;ID=24618&amp;page=1#name</a></p>
</blockquote>
<p>ä»ä¸Šé¢çš„URLå¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªå®Œæ•´çš„URLåŒ…æ‹¬ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p>
<ol>
<li>åè®®éƒ¨åˆ†ï¼šè¯¥URLçš„åè®®éƒ¨åˆ†ä¸ºâ€œhttp:â€ï¼Œè¿™ä»£è¡¨ç½‘é¡µä½¿ç”¨çš„æ˜¯HTTPåè®®ã€‚åœ¨Internetä¸­å¯ä»¥ä½¿ç”¨å¤šç§åè®®ï¼Œå¦‚HTTPï¼ŒFTPç­‰ç­‰æœ¬ä¾‹ä¸­ä½¿ç”¨çš„æ˜¯HTTPåè®®ã€‚åœ¨â€HTTPâ€åé¢çš„â€œ//â€ä¸ºåˆ†éš”ç¬¦ã€‚</li>
<li>åŸŸåéƒ¨åˆ†ï¼šè¯¥URLçš„åŸŸåéƒ¨åˆ†ä¸ºâ€œwww.aspxfans.comâ€ã€‚ä¸€ä¸ªURLä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨IPåœ°å€ä½œä¸ºåŸŸåä½¿ç”¨ã€‚åœ¨å»ºç«‹TCPè¿æ¥çš„æ—¶å€™ç”¨çš„å°±æ˜¯IPåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŸŸåæ˜¯å› ä¸ºæœ‰äº†DNSåŸŸåè§£æã€‚</li>
<li>ç«¯å£éƒ¨åˆ†ï¼šè·Ÿåœ¨åŸŸååé¢çš„æ˜¯ç«¯å£ï¼ŒåŸŸåå’Œç«¯å£ä¹‹é—´ä½¿ç”¨â€œ:â€ä½œä¸ºåˆ†éš”ç¬¦ã€‚ç«¯å£ä¸æ˜¯ä¸€ä¸ªURLå¿…é¡»çš„éƒ¨åˆ†ï¼Œå¦‚æœçœç•¥ç«¯å£éƒ¨åˆ†ï¼Œå°†é‡‡ç”¨é»˜è®¤ç«¯å£ï¼ŒHTTPé»˜è®¤çš„ç«¯å£å·ä¸º80ï¼ŒHTTPSçš„ç«¯å£å·ä¸º443ã€‚</li>
<li>è™šæ‹Ÿç›®å½•éƒ¨åˆ†ï¼šä»åŸŸååçš„ç¬¬ä¸€ä¸ªâ€œ/â€å¼€å§‹åˆ°æœ€åä¸€ä¸ªâ€œ/â€ä¸ºæ­¢ï¼Œæ˜¯è™šæ‹Ÿç›®å½•éƒ¨åˆ†ã€‚è™šæ‹Ÿç›®å½•ä¹Ÿä¸æ˜¯ä¸€ä¸ªURLå¿…é¡»çš„éƒ¨åˆ†ã€‚æœ¬ä¾‹ä¸­çš„è™šæ‹Ÿç›®å½•æ˜¯â€œ/news/â€ã€‚</li>
<li>æ–‡ä»¶åéƒ¨åˆ†ï¼šä»åŸŸååçš„æœ€åä¸€ä¸ªâ€œ/â€å¼€å§‹åˆ°â€œ?â€ä¸ºæ­¢ï¼Œæ˜¯æ–‡ä»¶åéƒ¨åˆ†ï¼Œå¦‚æœæ²¡æœ‰â€œ?â€,åˆ™æ˜¯ä»åŸŸååçš„æœ€åä¸€ä¸ªâ€œ/â€å¼€å§‹åˆ°â€œ#â€ä¸ºæ­¢ï¼Œæ˜¯æ–‡ä»¶éƒ¨åˆ†ï¼Œå¦‚æœæ²¡æœ‰â€œï¼Ÿâ€å’Œâ€œ#â€ï¼Œé‚£ä¹ˆä»åŸŸååçš„æœ€åä¸€ä¸ªâ€œ/â€å¼€å§‹åˆ°ç»“æŸï¼Œéƒ½æ˜¯æ–‡ä»¶åéƒ¨åˆ†ã€‚æœ¬ä¾‹ä¸­çš„æ–‡ä»¶åæ˜¯â€œindex.aspâ€ã€‚æ–‡ä»¶åéƒ¨åˆ†ä¹Ÿä¸æ˜¯ä¸€ä¸ªURLå¿…é¡»çš„éƒ¨åˆ†ï¼Œå¦‚æœçœç•¥è¯¥éƒ¨åˆ†ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶åï¼Œä¸€èˆ¬ä¸ºindex.htmlã€‚</li>
<li>é”šéƒ¨åˆ†ï¼šä»â€œ#â€å¼€å§‹åˆ°æœ€åï¼Œéƒ½æ˜¯é”šéƒ¨åˆ†(HTMLçš„èŠ‚ç‚¹)ã€‚æœ¬ä¾‹ä¸­çš„é”šéƒ¨åˆ†æ˜¯â€œnameâ€ã€‚é”šéƒ¨åˆ†ä¹Ÿä¸æ˜¯ä¸€ä¸ªURLå¿…é¡»çš„éƒ¨åˆ†ã€‚</li>
<li>å‚æ•°éƒ¨åˆ†ï¼šä»â€œï¼Ÿâ€å¼€å§‹åˆ°â€œ#â€ä¸ºæ­¢ä¹‹é—´çš„éƒ¨åˆ†ä¸ºå‚æ•°éƒ¨åˆ†ï¼Œåˆç§°æœç´¢éƒ¨åˆ†ã€æŸ¥è¯¢éƒ¨åˆ†ã€‚æœ¬ä¾‹ä¸­çš„å‚æ•°éƒ¨åˆ†ä¸ºâ€œboardID=5&amp;ID=24618&amp;page=1â€ã€‚å‚æ•°å¯ä»¥å…è®¸æœ‰å¤šä¸ªå‚æ•°ï¼Œå‚æ•°ä¸å‚æ•°ä¹‹é—´ç”¨â€œ&amp;â€ä½œä¸ºåˆ†éš”ç¬¦ã€‚</li>
</ol>
<h2 id="è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚æ–¹æ³•"><a href="#è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚æ–¹æ³•" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚æ–¹æ³•"></a>è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚æ–¹æ³•</h2><p>æ ¹æ®HTTPæ ‡å‡†ï¼ŒHTTPè¯·æ±‚å¯ä»¥ä½¿ç”¨å¤šç§è¯·æ±‚æ–¹æ³•ã€‚<br>HTTP1.0å®šä¹‰äº†ä¸‰ç§è¯·æ±‚æ–¹æ³•ï¼š GET, POST å’Œ HEADæ–¹æ³•ã€‚<br>HTTP1.1æ–°å¢äº†å…­ç§è¯·æ±‚æ–¹æ³•ï¼šOPTIONS, PUT, DELETE, TRACEï¼ŒCONNECTå’ŒPATCH æ–¹æ³•ã€‚</p>
<p>è¿™å…«ç§æ–¹æ³•(åŠ¨ä½œ)è¡¨æ˜äº†è¯·æ±‚çš„URLæŒ‡å®šçš„èµ„æºçš„æ“ä½œæ–¹å¼ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ“ä½œæ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><strong>è¯·æ±‚</strong>æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›å®ä½“ä¸»ä½“</td>
</tr>
<tr>
<td>HEAD</td>
<td>ç±»ä¼¼äºgetè¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´</td>
</tr>
<tr>
<td>POST</td>
<td>å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POSTè¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„<strong>å»ºç«‹</strong>å’Œ/æˆ–å·²æœ‰èµ„æºçš„<strong>ä¿®æ”¹</strong></td>
</tr>
<tr>
<td>PUT</td>
<td>ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®<strong>å–ä»£</strong>æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹</td>
</tr>
<tr>
<td>DELETE</td>
<td>è¯·æ±‚æœåŠ¡å™¨<strong>åˆ é™¤</strong>æŒ‡å®šçš„é¡µé¢</td>
</tr>
<tr>
<td>CONNECT</td>
<td>HTTP/1.1åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½</td>
</tr>
<tr>
<td>TRACE</td>
<td>å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­</td>
</tr>
<tr>
<td>PATCH</td>
<td>ç”¨æ¥å°†<strong>å±€éƒ¨ä¿®æ”¹</strong>åº”ç”¨äºæŸä¸€èµ„æº</td>
</tr>
</tbody>
</table>
<p><strong>PSï¼š</strong> GETå’ŒPOSTçš„åŒºåˆ«ï¼š</p>
<ul>
<li>GETæäº¤çš„æ•°æ®ä¼šæ”¾åœ¨URLä¹‹åï¼Œä»¥?åˆ†å‰²URLå’Œä¼ è¾“æ•°æ®ï¼Œå‚æ•°ä¹‹é—´ä»¥&amp;ç›¸è¿ï¼Œå¦‚EditPosts.aspx?name=test1&amp;id=123456. POSTæ–¹æ³•æ˜¯æŠŠæäº¤çš„æ•°æ®æ”¾åœ¨HTTPåŒ…çš„Bodyä¸­ã€‚</li>
<li>GETæäº¤çš„æ•°æ®å¤§å°æœ‰é™åˆ¶ï¼Œæœ€å¤šåªèƒ½æœ‰1024å­—èŠ‚ï¼ˆå› ä¸ºæµè§ˆå™¨å¯¹URLçš„é•¿åº¦æœ‰é™åˆ¶ï¼‰ï¼Œè€ŒPOSTæ–¹æ³•æäº¤çš„æ•°æ®æ²¡æœ‰é™åˆ¶ã€‚</li>
<li>GETæ–¹å¼æäº¤æ•°æ®ï¼Œä¼šå¸¦æ¥å®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œé€šè¿‡GETæ–¹å¼æäº¤æ•°æ®æ—¶ï¼Œç”¨æˆ·åå’Œå¯†ç å°†å‡ºç°åœ¨URLä¸Šï¼Œå¦‚æœé¡µé¢å¯ä»¥è¢«ç¼“å­˜æˆ–è€…å…¶ä»–äººå¯ä»¥è®¿é—®è¿™å°æœºå™¨ï¼Œå°±å¯ä»¥ä»å†å²è®°å½•è·å¾—è¯¥ç”¨æˆ·çš„è´¦å·å’Œå¯†ç ã€‚</li>
</ul>
<h2 id="è¯·æ±‚æŠ¥æ–‡ä¹‹é€šç”¨é¦–éƒ¨"><a href="#è¯·æ±‚æŠ¥æ–‡ä¹‹é€šç”¨é¦–éƒ¨" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡ä¹‹é€šç”¨é¦–éƒ¨"></a>è¯·æ±‚æŠ¥æ–‡ä¹‹é€šç”¨é¦–éƒ¨</h2><p>å¸¸è§çš„é€šç”¨é¦–éƒ¨å¦‚ä¸‹ï¼š</p>
<ol>
<li>Pragmaï¼šæŒ‡å®šâ€œno-cacheâ€å€¼è¡¨ç¤ºæœåŠ¡å™¨å¿…é¡»è¿”å›ä¸€ä¸ªåˆ·æ–°åçš„æ–‡æ¡£ï¼Œå³ä½¿å®ƒæ˜¯ä»£ç†æœåŠ¡å™¨è€Œä¸”å·²ç»æœ‰äº†é¡µé¢çš„æœ¬åœ°æ‹·è´ï¼›åœ¨HTTP/1.1ç‰ˆæœ¬ä¸­ï¼Œå®ƒå’ŒCache-Control:no-cacheä½œç”¨ä¸€æ¨¡ä¸€æ ·ã€‚Pargmaåªæœ‰ä¸€ä¸ªç”¨æ³•ï¼Œ ä¾‹å¦‚ï¼š Pragma: no-cache<br>æ³¨æ„: åœ¨HTTP/1.0ç‰ˆæœ¬ä¸­ï¼Œåªå®ç°äº†Pragema:no-cache, æ²¡æœ‰å®ç°Cache-Control</li>
<li>Cache-Controlï¼šæŒ‡å®šè¯·æ±‚å’Œå“åº”éµå¾ªçš„ç¼“å­˜æœºåˆ¶ã€‚ç¼“å­˜æŒ‡ä»¤æ˜¯å•å‘çš„ï¼ˆå“åº”ä¸­å‡ºç°çš„ç¼“å­˜æŒ‡ä»¤åœ¨è¯·æ±‚ä¸­æœªå¿…ä¼šå‡ºç°ï¼‰ï¼Œä¸”æ˜¯ç‹¬ç«‹çš„ï¼ˆåœ¨è¯·æ±‚æ¶ˆæ¯æˆ–å“åº”æ¶ˆæ¯ä¸­è®¾ç½®Cache-Controlå¹¶ä¸ä¼šä¿®æ”¹å¦ä¸€ä¸ªæ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­çš„ç¼“å­˜å¤„ç†è¿‡ç¨‹ï¼‰ã€‚è¯·æ±‚æ—¶çš„ç¼“å­˜æŒ‡ä»¤åŒ…æ‹¬no-cacheã€no-storeã€max-ageã€max-staleã€min-freshã€only-if-cachedï¼Œå“åº”æ¶ˆæ¯ä¸­çš„æŒ‡ä»¤åŒ…æ‹¬public(å¯ä»¥è¢«ä»»ä½•ç¼“å­˜æ‰€ç¼“å­˜)ã€private(å†…å®¹åªç¼“å­˜åˆ°ç§æœ‰ç¼“å­˜ä¸­)ã€no-cache(æ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šè¢«ç¼“å­˜)ã€no-storeã€no-transformã€must-revalidateã€proxy-revalidateã€max-ageã€s-maxageã€‚</li>
<li>Connectionï¼šä¹‹å‰å·²ç»è¯´è¿‡ï¼Œä¸»è¦æ˜¯æ§åˆ¶TCPè¿æ¥æ˜¯å¦åœ¨è¯·æ±‚å®Œé©¬ä¸Šç«¯å¼€ã€‚</li>
<li>Dateï¼šè¡¨ç¤ºæ¶ˆæ¯å‘é€çš„æ—¶é—´ã€‚</li>
</ol>
<h2 id="è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚é¦–éƒ¨"><a href="#è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚é¦–éƒ¨" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚é¦–éƒ¨"></a>è¯·æ±‚æŠ¥æ–‡ä¹‹è¯·æ±‚é¦–éƒ¨</h2><p>å¸¸è§çš„è¯·æ±‚é¦–éƒ¨å¦‚ä¸‹ï¼š</p>
<ol>
<li>If-Modified-Sinceï¼šæŠŠæµè§ˆå™¨ç«¯ç¼“å­˜é¡µé¢çš„æœ€åä¿®æ”¹æ—¶é—´å‘é€åˆ°æœåŠ¡å™¨å»ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¿™ä¸ªæ—¶é—´ä¸æœåŠ¡å™¨ä¸Šå®é™…æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœæ—¶é—´ä¸€è‡´ï¼Œé‚£ä¹ˆè¿”å›304ï¼Œå®¢æˆ·ç«¯å°±ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ–‡ä»¶ã€‚å¦‚æœæ—¶é—´ä¸ä¸€è‡´ï¼Œå°±ä¼šè¿”å›200å’Œæ–°çš„æ–‡ä»¶å†…å®¹ã€‚å®¢æˆ·ç«¯æ¥åˆ°ä¹‹åï¼Œä¼šä¸¢å¼ƒæ—§æ–‡ä»¶ï¼ŒæŠŠæ–°æ–‡ä»¶ç¼“å­˜èµ·æ¥ï¼Œå¹¶æ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸­ã€‚</li>
<li>If-None-Matchï¼šIf-None-Matchå’ŒETagä¸€èµ·å·¥ä½œï¼Œå·¥ä½œåŸç†æ˜¯åœ¨HTTP Responseä¸­æ·»åŠ ETagä¿¡æ¯ã€‚ å½“ç”¨æˆ·å†æ¬¡è¯·æ±‚è¯¥èµ„æºæ—¶ï¼Œå°†åœ¨HTTP Request ä¸­åŠ å…¥If-None-Matchä¿¡æ¯(ETagçš„å€¼)ã€‚å¦‚æœæœåŠ¡å™¨éªŒè¯èµ„æºçš„ETagæ²¡æœ‰æ”¹å˜ï¼ˆè¯¥èµ„æºæ²¡æœ‰æ›´æ–°ï¼‰ï¼Œå°†è¿”å›ä¸€ä¸ª304çŠ¶æ€å‘Šè¯‰å®¢æˆ·ç«¯ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ–‡ä»¶ã€‚å¦åˆ™å°†è¿”å›200çŠ¶æ€å’Œæ–°çš„èµ„æºå’ŒEtagã€‚</li>
<li>Acceptï¼šæµè§ˆå™¨ç«¯å¯ä»¥æ¥å—çš„MIMEç±»å‹ã€‚ä¾‹å¦‚ï¼šAccept: text/html ä»£è¡¨æµè§ˆå™¨å¯ä»¥æ¥å—æœåŠ¡å™¨å›å‘çš„ç±»å‹ä¸º text/html ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„htmlæ–‡æ¡£ï¼Œå¦‚æœæœåŠ¡å™¨æ— æ³•è¿”å›text/htmlç±»å‹çš„æ•°æ®ï¼ŒæœåŠ¡å™¨åº”è¯¥è¿”å›ä¸€ä¸ª406é”™è¯¯(non acceptable)ã€‚é€šé…ç¬¦ * ä»£è¡¨ä»»æ„ç±»å‹ï¼Œä¾‹å¦‚ Accept: */* ä»£è¡¨æµè§ˆå™¨å¯ä»¥å¤„ç†æ‰€æœ‰ç±»å‹ï¼Œ(ä¸€èˆ¬æµè§ˆå™¨å‘ç»™æœåŠ¡å™¨éƒ½æ˜¯å‘è¿™ä¸ª)ã€‚</li>
<li>Accept-Encodingï¼šæµè§ˆå™¨ç”³æ˜è‡ªå·±å¯æ¥æ”¶çš„ç¼–ç æ–¹æ³•ï¼Œé€šå¸¸æŒ‡å®šå‹ç¼©æ–¹æ³•ï¼Œæ˜¯å¦æ”¯æŒå‹ç¼©ï¼Œæ”¯æŒä»€ä¹ˆå‹ç¼©æ–¹æ³•ï¼ˆgzipï¼Œdeflateï¼‰;Servletèƒ½å¤Ÿå‘æ”¯æŒgzipçš„æµè§ˆå™¨è¿”å›ç»gzipç¼–ç çš„HTMLé¡µé¢ã€‚è®¸å¤šæƒ…å½¢ä¸‹è¿™å¯ä»¥å‡å°‘5åˆ°10å€çš„ä¸‹è½½æ—¶é—´ã€‚ä¾‹å¦‚ï¼š Accept-Encoding: gzip, deflateã€‚å¦‚æœè¯·æ±‚æ¶ˆæ¯ä¸­æ²¡æœ‰è®¾ç½®è¿™ä¸ªåŸŸï¼ŒæœåŠ¡å™¨å‡å®šå®¢æˆ·ç«¯å¯¹å„ç§å†…å®¹ç¼–ç éƒ½å¯ä»¥æ¥å—ã€‚</li>
<li>Accept-Languageï¼šæµè§ˆå™¨ç”³æ˜è‡ªå·±æ¥æ”¶çš„è¯­è¨€ã€‚è¯­è¨€è·Ÿå­—ç¬¦é›†çš„åŒºåˆ«ï¼šä¸­æ–‡æ˜¯è¯­è¨€ï¼Œä¸­æ–‡æœ‰å¤šç§å­—ç¬¦é›†ï¼Œæ¯”å¦‚big5ï¼Œgb2312ï¼Œgbkç­‰ç­‰ï¼›ä¾‹å¦‚ï¼šAccept-Language: en-usã€‚å¦‚æœè¯·æ±‚æ¶ˆæ¯ä¸­æ²¡æœ‰è®¾ç½®è¿™ä¸ªæŠ¥å¤´åŸŸï¼ŒæœåŠ¡å™¨å‡å®šå®¢æˆ·ç«¯å¯¹å„ç§è¯­è¨€éƒ½å¯ä»¥æ¥å—ã€‚</li>
<li>Accept-Charsetï¼šæµè§ˆå™¨å¯æ¥å—çš„å­—ç¬¦é›†ã€‚å¦‚æœåœ¨è¯·æ±‚æ¶ˆæ¯ä¸­æ²¡æœ‰è®¾ç½®è¿™ä¸ªåŸŸï¼Œç¼ºçœè¡¨ç¤ºä»»ä½•å­—ç¬¦é›†éƒ½å¯ä»¥æ¥å—ã€‚</li>
<li>User-Agentï¼šå‘Šè¯‰HTTPæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨çš„åç§°å’Œç‰ˆæœ¬</li>
<li>Refererï¼šåŒ…å«ä¸€ä¸ªURLï¼Œç”¨æˆ·ä»è¯¥URLä»£è¡¨çš„é¡µé¢å‡ºå‘è®¿é—®å½“å‰è¯·æ±‚çš„é¡µé¢ã€‚æä¾›äº†Requestçš„ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æœåŠ¡å™¨ï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘æ˜¯ä»å“ªä¸ªé“¾æ¥è¿‡æ¥çš„ï¼Œæ¯”å¦‚ä»æˆ‘ä¸»é¡µä¸Šé“¾æ¥åˆ°ä¸€ä¸ªæœ‹å‹é‚£é‡Œï¼Œä»–çš„æœåŠ¡å™¨å°±èƒ½å¤Ÿä»HTTP Refererä¸­ç»Ÿè®¡å‡ºæ¯å¤©æœ‰å¤šå°‘ç”¨æˆ·ç‚¹å‡»æˆ‘ä¸»é¡µä¸Šçš„é“¾æ¥è®¿é—®ä»–çš„ç½‘ç«™ã€‚</li>
<li>Hostï¼šï¼ˆå‘é€è¯·æ±‚æ—¶ï¼Œè¯¥å¤´åŸŸæ˜¯å¿…éœ€çš„ï¼‰ä¸»è¦ç”¨äºæŒ‡å®šè¢«è¯·æ±‚èµ„æºçš„Internetä¸»æœºå’Œç«¯å£å·ï¼Œå®ƒé€šå¸¸ä»HTTP URLä¸­æå–å‡ºæ¥çš„ã€‚HTTP/1.1è¯·æ±‚å¿…é¡»åŒ…å«ä¸»æœºå¤´åŸŸï¼Œå¦åˆ™ç³»ç»Ÿä¼šä»¥400çŠ¶æ€ç è¿”å›ã€‚</li>
<li>Authorizationï¼šæˆæƒä¿¡æ¯ï¼Œé€šå¸¸å‡ºç°åœ¨å¯¹æœåŠ¡å™¨å‘é€çš„WWW-Authenticateå¤´çš„åº”ç­”ä¸­ã€‚ä¸»è¦ç”¨äºè¯æ˜å®¢æˆ·ç«¯æœ‰æƒæŸ¥çœ‹æŸä¸ªèµ„æºã€‚å½“æµè§ˆå™¨è®¿é—®ä¸€ä¸ªé¡µé¢æ—¶ï¼Œå¦‚æœæ”¶åˆ°æœåŠ¡å™¨çš„å“åº”ä»£ç ä¸º401ï¼ˆæœªæˆæƒï¼‰ï¼Œå¯ä»¥å‘é€ä¸€ä¸ªåŒ…å«Authorizationè¯·æ±‚æŠ¥å¤´åŸŸçš„è¯·æ±‚ï¼Œè¦æ±‚æœåŠ¡å™¨å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚</li>
<li>Rangeï¼šå¯ä»¥è¯·æ±‚å®ä½“çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­èŒƒå›´ã€‚</li>
<li>Cookieï¼šæœ€é‡è¦çš„è¯·æ±‚å¤´ä¹‹ä¸€, å°†cookieçš„å€¼å‘é€ç»™HTTPæœåŠ¡å™¨ã€‚</li>
</ol>
<h2 id="è¯·æ±‚æŠ¥æ–‡ä¹‹å®ä½“é¦–éƒ¨"><a href="#è¯·æ±‚æŠ¥æ–‡ä¹‹å®ä½“é¦–éƒ¨" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡ä¹‹å®ä½“é¦–éƒ¨"></a>è¯·æ±‚æŠ¥æ–‡ä¹‹å®ä½“é¦–éƒ¨</h2><p>å¸¸è§çš„å®ä½“é¦–éƒ¨å¦‚ä¸‹ï¼š</p>
<ol>
<li>Content-Typeï¼šè¯´æ˜äº†å®ä½“ä¸»ä½“å†…å¯¹è±¡çš„åª’ä½“ç±»å‹ã€‚</li>
<li>Content-Lengthï¼šè¡¨ç¤ºè¯·æ±‚æ¶ˆæ¯æ­£æ–‡çš„é•¿åº¦ã€‚</li>
<li>Content-Rangeï¼šç”¨äºæŒ‡å®šæ•´ä¸ªå®ä½“ä¸­çš„ä¸€éƒ¨åˆ†çš„æ’å…¥ä½ç½®ï¼Œä»–ä¹ŸæŒ‡ç¤ºäº†æ•´ä¸ªå®ä½“çš„é•¿åº¦ã€‚åœ¨æœåŠ¡å™¨å‘å®¢æˆ·è¿”å›ä¸€ä¸ªéƒ¨åˆ†å“åº”ï¼Œå®ƒå¿…é¡»æè¿°å“åº”è¦†ç›–çš„èŒƒå›´å’Œæ•´ä¸ªå®ä½“é•¿åº¦ã€‚ä¸€èˆ¬æ ¼å¼ï¼šContent-Range:bytes-unitSPfirst-byte-pos-last-byte-pos/entity-lengthã€‚</li>
<li>Content-Encodingï¼šWEBæœåŠ¡å™¨è¡¨æ˜è‡ªå·±ä½¿ç”¨äº†ä»€ä¹ˆå‹ç¼©æ–¹æ³•ï¼ˆgzipï¼Œdeflateï¼‰å‹ç¼©å“åº”ä¸­çš„å¯¹è±¡ã€‚åªæœ‰åœ¨è§£ç ä¹‹åæ‰å¯ä»¥å¾—åˆ°Content-Typeå¤´æŒ‡å®šçš„å†…å®¹ç±»å‹ã€‚</li>
<li>Content-Languageï¼šWEBæœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è‡ªå·±å“åº”çš„å¯¹è±¡æ‰€ç”¨çš„è‡ªç„¶è¯­è¨€ã€‚</li>
</ol>
<h2 id="è¯·æ±‚æŠ¥æ–‡ä¹‹å…¶ä»–é¦–éƒ¨"><a href="#è¯·æ±‚æŠ¥æ–‡ä¹‹å…¶ä»–é¦–éƒ¨" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡ä¹‹å…¶ä»–é¦–éƒ¨"></a>è¯·æ±‚æŠ¥æ–‡ä¹‹å…¶ä»–é¦–éƒ¨</h2><ol>
<li>P3Pï¼šç”¨äºè·¨åŸŸè®¾ç½®Cookie, è¿™æ ·å¯ä»¥è§£å†³iframeè·¨åŸŸè®¿é—®cookieçš„é—®é¢˜ã€‚</li>
</ol>
<h1 id="HTTPæŠ¥æ–‡ä¹‹å“åº”æŠ¥æ–‡"><a href="#HTTPæŠ¥æ–‡ä¹‹å“åº”æŠ¥æ–‡" class="headerlink" title="HTTPæŠ¥æ–‡ä¹‹å“åº”æŠ¥æ–‡"></a>HTTPæŠ¥æ–‡ä¹‹å“åº”æŠ¥æ–‡</h1><p>å“åº”æŠ¥æ–‡ç”±çŠ¶æ€è¡Œ(åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ã€æ¶ˆæ¯çŠ¶æ€)ã€å“åº”å¤´éƒ¨ã€ç©ºè¡Œ(å›è½¦+æ¢è¡Œ)å’Œå“åº”æ•°æ®(ä¸»ä½“)å››ä¸ªéƒ¨åˆ†ç»„æˆã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/httpResponse.png" alt="httpResponse"></p>
<p>å®ƒçš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/httpReponseDemo.png" alt="httpReponseDemo"></p>
<p>å“åº”æŠ¥æ–‡çš„é€šç”¨é¦–éƒ¨å’Œå®ä½“é¦–éƒ¨ä»¥åŠå…¶ä»–é¦–éƒ¨éƒ½å’Œè¯·æ±‚æŠ¥æ–‡å·®ä¸å¤šï¼Œæˆ‘ä»¬ä¸»è¦è®²è§£å“åº”é¦–éƒ¨ã€‚</p>
<h2 id="å“åº”æŠ¥æ–‡ä¹‹å“åº”é¦–éƒ¨"><a href="#å“åº”æŠ¥æ–‡ä¹‹å“åº”é¦–éƒ¨" class="headerlink" title="å“åº”æŠ¥æ–‡ä¹‹å“åº”é¦–éƒ¨"></a>å“åº”æŠ¥æ–‡ä¹‹å“åº”é¦–éƒ¨</h2><ol>
<li>Allowï¼šæœåŠ¡å™¨æ”¯æŒå“ªäº›è¯·æ±‚æ–¹æ³•</li>
<li>Expiresï¼šæŒ‡æ˜åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™è®¤ä¸ºæ–‡æ¡£å·²ç»è¿‡æœŸï¼Œä»è€Œä¸å†ç¼“å­˜å®ƒï¼Œé‡æ–°ä»æœåŠ¡å™¨è·å–ï¼Œä¼šæ›´æ–°ç¼“å­˜ã€‚è¿‡æœŸä¹‹å‰ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚HTTP1.1çš„å®¢æˆ·ç«¯å’Œç¼“å­˜ä¼šå°†éæ³•çš„æ—¥æœŸæ ¼å¼ï¼ˆåŒ…æ‹¬0ï¼‰çœ‹ä½œå·²ç»è¿‡æœŸã€‚egï¼šä¸ºäº†è®©æµè§ˆå™¨ä¸è¦ç¼“å­˜é¡µé¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†Expireså®ä½“æŠ¥å¤´åŸŸï¼Œè®¾ç½®ä¸º0ã€‚</li>
<li>Set-Cookieï¼šéå¸¸é‡è¦çš„header, ç”¨äºæŠŠcookieå‘é€åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œæ¯ä¸€ä¸ªå†™å…¥cookieéƒ½ä¼šç”Ÿæˆä¸€ä¸ªSet-Cookieã€‚</li>
<li>Last-Modifiedï¼šç”¨äºæŒ‡ç¤ºèµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸå’Œæ—¶é—´ã€‚Last-Modifiedä¹Ÿå¯ç”¨setDateHeaderæ–¹æ³•æ¥è®¾ç½®ã€‚</li>
<li>Serverï¼šæŒ‡æ˜HTTPæœåŠ¡å™¨ç”¨æ¥å¤„ç†è¯·æ±‚çš„è½¯ä»¶ä¿¡æ¯ã€‚</li>
<li>Locationï¼šç”¨äºé‡å®šå‘ä¸€ä¸ªæ–°çš„ä½ç½®ï¼ŒåŒ…å«æ–°çš„URLåœ°å€ã€‚è¡¨ç¤ºå®¢æˆ·åº”å½“åˆ°å“ªé‡Œå»æå–æ–‡æ¡£ã€‚Locationé€šå¸¸ä¸æ˜¯ç›´æ¥è®¾ç½®çš„ï¼Œè€Œæ˜¯é€šè¿‡HttpServletResponseçš„sendRedirectæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒæ—¶è®¾ç½®çŠ¶æ€ä»£ç ä¸º302ã€‚Locationå“åº”æŠ¥å¤´åŸŸå¸¸ç”¨åœ¨æ›´æ¢åŸŸåçš„æ—¶å€™ã€‚</li>
<li>WWW-Authenticateï¼šè¯¥å“åº”æŠ¥å¤´åŸŸå¿…é¡»è¢«åŒ…å«åœ¨401ï¼ˆæœªæˆæƒçš„ï¼‰å“åº”æ¶ˆæ¯ä¸­ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°401å“åº”æ¶ˆæ¯æ—¶å€™ï¼Œå¹¶å‘é€AuthorizationæŠ¥å¤´åŸŸè¯·æ±‚æœåŠ¡å™¨å¯¹å…¶è¿›è¡ŒéªŒè¯æ—¶ï¼ŒæœåŠ¡ç«¯å“åº”æŠ¥å¤´å°±åŒ…å«è¯¥æŠ¥å¤´åŸŸã€‚</li>
</ol>
<h2 id="HTTPä¹‹çŠ¶æ€ç "><a href="#HTTPä¹‹çŠ¶æ€ç " class="headerlink" title="HTTPä¹‹çŠ¶æ€ç "></a>HTTPä¹‹çŠ¶æ€ç </h2><p>çŠ¶æ€ä»£ç æœ‰ä¸‰ä½æ•°å­—ç»„æˆï¼Œç¬¬ä¸€ä¸ªæ•°å­—å®šä¹‰äº†å“åº”çš„ç±»åˆ«ï¼Œå…±åˆ†äº”ç§ç±»åˆ«:</p>
<table>
<thead>
<tr>
<th>çŠ¶æ€ç </th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>1xx</td>
<td>æŒ‡ç¤ºä¿¡æ¯â€“è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</td>
</tr>
<tr>
<td>2xx</td>
<td>æˆåŠŸâ€“è¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å—</td>
</tr>
<tr>
<td>3xx</td>
<td>é‡å®šå‘â€“è¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œ</td>
</tr>
<tr>
<td>4xx</td>
<td>å®¢æˆ·ç«¯é”™è¯¯â€“è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è¯·æ±‚æ— æ³•å®ç°</td>
</tr>
<tr>
<td>5xx</td>
<td>æœåŠ¡å™¨ç«¯é”™è¯¯â€“æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚</td>
</tr>
</tbody>
</table>
<p>å¸¸ç”¨çš„çŠ¶æ€ç å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>çŠ¶æ€ç </th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 OK</td>
<td>å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸ</td>
</tr>
<tr>
<td>400 Bad Request</td>
<td>å®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£</td>
</tr>
<tr>
<td>401 Unauthorized</td>
<td>è¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å¿…é¡»å’ŒWWW-AuthenticateæŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨</td>
</tr>
<tr>
<td>403 Forbidden</td>
<td>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡</td>
</tr>
<tr>
<td>404 Not Found</td>
<td>è¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œegï¼šè¾“å…¥äº†é”™è¯¯çš„URL</td>
</tr>
<tr>
<td>500 Internal Server Error</td>
<td>æœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯</td>
</tr>
<tr>
<td>503 Server Unavailable</td>
<td>æœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸</td>
</tr>
</tbody>
</table>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li>ã€Šå›¾è§£HTTPã€‹</li>
<li><a href="https://www.jianshu.com/p/80e25cb1d81a" target="_blank" rel="external">å…³äºHTTPåè®®ï¼Œä¸€ç¯‡å°±å¤Ÿäº†</a></li>
<li><a href="https://www.cnblogs.com/EricaMIN1987_IT/p/3837436.html" target="_blank" rel="external">HTTPåè®®è¯¦è§£</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šä½œä¸ºWebå¼€å‘äººå‘˜ï¼Œå¯èƒ½ä½ æœ€éœ€è¦æ·±å…¥å­¦ä¹ çš„å°±æ˜¯&lt;strong&gt;HTTPåè®®&lt;/strong&gt;äº†å§ï¼
    
    </summary>
    
      <category term="è®¡ç®—æœºç½‘ç»œ" scheme="http://bestlixiang.site/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="HTTP" scheme="http://bestlixiang.site/tags/HTTP/"/>
    
  </entry>
  
  <entry>
    <title>TCPåè®®</title>
    <link href="http://bestlixiang.site/2018/05/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP%E5%8D%8F%E8%AE%AE/"/>
    <id>http://bestlixiang.site/2018/05/18/è®¡ç®—æœºç½‘ç»œ/TCPåè®®/</id>
    <published>2018-05-18T06:58:34.000Z</published>
    <updated>2018-05-18T07:31:18.419Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šTCPä½œä¸ºä¼ è¾“å±‚çš„ä¸€å¤§åè®®ï¼Œè™½ç„¶æ²¡æœ‰UDPç®€å•ï¼Œä½†æ˜¯èƒœåœ¨å¯é ã€‚<a id="more"></a></p>
<h1 id="TCPè®¤è¯†"><a href="#TCPè®¤è¯†" class="headerlink" title="TCPè®¤è¯†"></a>TCPè®¤è¯†</h1><p><strong>TCP(ä¼ è¾“æ§åˆ¶åè®®)</strong> æ˜¯ä¸€ç§é¢å‘è¿æ¥ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚åè®®ã€‚TCPåœ¨ä¼ é€æ•°æ®ä¹‹å‰ä¼šå…ˆç›¸äº’å‘é€ä¸€äº›é¢„å¤‡æŠ¥æ–‡æ®µåå•†ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚åºå·ç­‰ç­‰ï¼ŒTCPå°†ç”¨æˆ·æ•°æ®æ‰“åŒ…æˆæŠ¥æ–‡æ®µï¼Œå‘é€æ•°æ®åå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦ä¸€ç«¯å¯¹æ”¶åˆ°çš„æ•°æ®è¿›è¡Œç¡®è®¤ï¼Œå¯¹å¤±åºçš„æ•°æ®é‡æ–°æ’åºï¼Œä¸¢å¼ƒé‡å¤æ•°æ®ï¼ŒTCPæä¾›ç«¯åˆ°ç«¯çš„æµé‡æ§åˆ¶ï¼Œå¹¶è®¡ç®—å’ŒéªŒè¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„ç«¯åˆ°ç«¯æ ¡éªŒå’Œã€‚</p>
<h1 id="TCPç‰¹ç‚¹"><a href="#TCPç‰¹ç‚¹" class="headerlink" title="TCPç‰¹ç‚¹"></a>TCPç‰¹ç‚¹</h1><ol>
<li>TCPæ˜¯é¢å‘è¿æ¥çš„ï¼Œé€šä¿¡å‰éœ€è¦å»ºç«‹è¿æ¥ï¼Œé€šä¿¡ç»“æŸéœ€è¦é‡Šæ”¾è¿æ¥ã€‚</li>
<li>TCPæä¾›å¯é äº¤ä»˜æœåŠ¡ï¼Œå¯é æŒ‡çš„æ˜¯ï¼šTCPå‘é€çš„æ•°æ®æ— é‡å¤ã€æ— ä¸¢å¤±ã€æ— é”™è¯¯ã€ä¸å‘é€ç«¯é¡ºåºä¸€è‡´ã€‚</li>
<li>TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œé¢å‘å­—èŠ‚æµæŒ‡çš„æ˜¯ï¼šTCPä»¥å­—èŠ‚ä¸ºå•ä½ã€‚è™½ç„¶ä¼ è¾“çš„è¿‡ç¨‹ä¸­æ•°æ®è¢«åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ•°æ®æŠ¥ï¼Œä½†è¿™åªæ˜¯ä¸ºäº†æ–¹ä¾¿ä¼ è¾“ï¼Œæ¥æ”¶ç«¯æœ€ç»ˆæ¥å—åˆ°çš„æ•°æ®å°†ä¸å‘é€ç«¯çš„æ•°æ®ä¸€æ¨¡ä¸€æ ·ã€‚</li>
<li>TCPæä¾›å…¨åŒå·¥é€šä¿¡ï¼Œå…¨åŒå·¥é€šä¿¡æŒ‡çš„æ˜¯ï¼šTCPçš„ä¸¤ç«¯æ—¢å¯ä»¥ä½œä¸ºå‘é€ç«¯ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ¥æ”¶ç«¯ã€‚</li>
<li>ä¸€æ¡TCPè¿æ¥çš„ä¸¤ç«¯åªèƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼ŒTCPåªèƒ½æä¾›ç‚¹åˆ°ç‚¹çš„é€šä¿¡ï¼Œè€ŒUDPå¯ä»¥ä»»æ„æ–¹å¼çš„é€šä¿¡ã€‚</li>
</ol>
<h1 id="TCPé¦–éƒ¨"><a href="#TCPé¦–éƒ¨" class="headerlink" title="TCPé¦–éƒ¨"></a>TCPé¦–éƒ¨</h1><p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/tcp.png" alt="tcp"></p>
<ol>
<li>16ä½ç«¯å£å·:åŒ…å«æºç«¯å£å’Œç›®çš„ç«¯å£ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©çš„ä¸´æ—¶ç«¯å£å·ï¼Œè€ŒæœåŠ¡å™¨åˆ™ä½¿ç”¨è‡ªä¸»å®šä¹‰ç«¯å£å·.</li>
<li>32ä½åºå·:ä¸€æ¬¡TCPé€šä¿¡è¿‡ç¨‹ä¸­ä¸€ä¸ªä¼ è¾“æ–¹å‘ä¸Šçš„å­—èŠ‚æµçš„æ¯ä¸ªå­—èŠ‚çš„ç¼–å·ï¼Œä¾‹å¦‚:Aå‘é€ç»™Bçš„ç¬¬ä¸€ä¸ªTCPæŠ¥æ–‡æ®µä¸­ï¼Œåºå·å€¼è¢«ç³»ç»Ÿåˆå§‹åŒ–ä¸ºæŸä¸ªéšæœºå€¼ISNï¼Œé‚£ä¹ˆåœ¨è¯¥ä¼ è¾“æ–¹å‘ä¸Šï¼Œåç»­çš„TCPæŠ¥æ–‡æ®µä¸­åºå·å€¼å°†è¢«ç³»ç»Ÿè®¾ç½®ä¸ºISNåŠ ä¸Šè¯¥æŠ¥æ–‡æ®µæ‰€æºå¸¦æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨æ•´ä¸ªå­—èŠ‚æµä¸­çš„åç§»ã€‚</li>
<li>32ä½çš„ç¡®è®¤å·: ç”¨ä½œå¯¹å¦å¤–ä¸€æ–¹å‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„å“åº”ï¼Œå…¶å€¼æ˜¯æ”¶åˆ°çš„TCPæŠ¥æ–‡æ®µçš„åºå·å€¼åŠ 1ã€‚</li>
<li>4ä½å¤´éƒ¨é•¿åº¦: æ ‡è¯†TCPå¤´éƒ¨æœ‰å¤šå°‘ä¸ª32bit(4å­—èŠ‚)ï¼Œæœ€å¤§60å­—èŠ‚.</li>
<li>6ä½æ ‡å¿—ä½:<ul>
<li>URG:è¡¨ç¤ºç´§æ€¥æŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆ.</li>
<li>ACK:è¡¨ç¤ºç¡®è®¤å·æ˜¯å¦æœ‰æ•ˆï¼Œæˆ‘ä»¬ç§°æºå¸¦ACKæ ‡å¿—çš„TCPæŠ¥æ–‡æ®µä¸ºç¡®è®¤æŠ¥æ–‡æ®µ.</li>
<li>PSH:æç¤ºæ¥æ”¶ç«¯åº”ç”¨ç¨‹åºåº”è¯¥ç«‹å³ä»TCPæ¥æ”¶ç¼“å†²åŒºä¸­è¯»èµ°æ•°æ®,ä¸ºæ¥æ”¶æ•°æ®è…¾å‡ºç©ºé—´.</li>
<li>RST:è¡¨ç¤ºè¦æ±‚å¯¹æ–¹é‡æ–°å»ºç«‹è¿æ¥(å¤ä½æŠ¥æ–‡æ®µ)</li>
<li>SYN:è¡¨ç¤ºè¯·æ±‚å»ºç«‹ä¸€ä¸ªè¿æ¥(åŒæ­¥æŠ¥æ–‡æ®µ);</li>
<li>FIN:è¡¨ç¤ºé€šçŸ¥å¯¹æ–¹æœ¬ç«¯è¦å…³é—­è¿æ¥äº†(ç»“æŸæŠ¥æ–‡æ®µ);</li>
</ul>
</li>
<li>16ä½çª—å£å¤§å°:TCPæµé‡çš„ä¸€ä¸ªæ§åˆ¶æ‰‹æ®µ,,å®ƒå‘ŠçŸ¥æ˜¯å¯¹æ–¹æœ¬ç«¯çš„TCPæ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦.</li>
<li>16ä½æ ¡éªŒå’Œ:ç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹TCPæŠ¥æ–‡æ®µæ‰§è¡ŒCRCç®—æ³•ï¼ˆå¾ªç¯å†—ä½™ç æ£€éªŒï¼Œä¸UDPä¸€æ ·ï¼‰ï¼Œæ£€éªŒTCPå¤´éƒ¨åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåï¼Œä¸ä»…åŒ…æ‹¬TCPå¤´éƒ¨ï¼Œä¹ŸåŒ…æ‹¬æ•°æ®éƒ¨åˆ†ã€‚</li>
<li>16ä½ç´§æ€¥æŒ‡é’ˆ:æ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡.å®ƒå’Œåºå·å­—æ®µçš„å€¼ç›¸åŠ è¡¨ç¤ºæœ€åä¸€ä¸ªç´§æ€¥æ•°æ®çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºå·.</li>
<li>é€‰é¡¹å­—æ®µï¼Œä¸Šè¿°å­—æ®µéƒ½æ˜¯æ¯ä¸ªTCPå¤´éƒ¨å¿…é¡»è¦æœ‰çš„ï¼Œè€Œé€‰é¡¹å­—æ®µæ˜¯å¯é€‰çš„ï¼Œä¸”é•¿åº¦å¯å˜ï¼Œæœ€é•¿40å­—èŠ‚ã€‚ æœ€å¸¸ç”¨çš„é€‰é¡¹å­—æ®µä¸ºMMSï¼šæœ€å¤§æŠ¥æ–‡é•¿åº¦ã€‚</li>
</ol>
<h1 id="TCPè¿æ¥å»ºç«‹-ä¸‰æ¬¡æ¡æ‰‹"><a href="#TCPè¿æ¥å»ºç«‹-ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCPè¿æ¥å»ºç«‹(ä¸‰æ¬¡æ¡æ‰‹)"></a>TCPè¿æ¥å»ºç«‹(ä¸‰æ¬¡æ¡æ‰‹)</h1><p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/tcpBuild.png" alt="tcpBuild"></p>
<p>TCPåè®®ä¸­ï¼Œä¸»åŠ¨å‘èµ·è¯·æ±‚çš„ä¸€ç«¯ç§°ä¸º<strong>å®¢æˆ·ç«¯</strong>ï¼Œè¢«åŠ¨è¿æ¥çš„ä¸€ç«¯ç§°ä¸º<strong>æœåŠ¡ç«¯</strong>ã€‚ä¸ç®¡æ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼ŒTCPè¿æ¥å»ºç«‹å®Œåéƒ½èƒ½å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p>
<ol>
<li><strong>æ¡æ‰‹å‰</strong>ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½ä¸ºCLOSEDçŠ¶æ€ï¼Œåœ¨é€šä¿¡å¼€å§‹å‰ï¼ŒåŒæ–¹éƒ½å¾—åˆ›å»ºå„è‡ªçš„ä¼ è¾“æ§åˆ¶å—ï¼ˆTCBï¼‰ã€‚æœåŠ¡å™¨åˆ›å»ºå®ŒTCBåéè¿›å…¥LISTENçŠ¶æ€ï¼Œæ­¤æ—¶å‡†å¤‡æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„è¿æ¥è¯·æ±‚ã€‚</li>
<li><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è¯¥æŠ¥æ–‡æ®µçš„å¤´éƒ¨ä¸­SYN=1ï¼ŒACK=0ï¼Œ(è¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µä¸ºè¿æ¥è¯·æ±‚æŠ¥æ–‡) seq=x(xä¸ºæœ¬æ¬¡TCPé€šä¿¡çš„å­—èŠ‚æµçš„åˆå§‹åºå·)ã€‚è¯·æ±‚å‘é€åï¼Œå®¢æˆ·ç«¯ä¾¿è¿›å…¥SYN-SENTçŠ¶æ€ã€‚</li>
<li><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong> ï¼šæœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªåº”ç­”ï¼šSYN=1ï¼ŒACK=1ï¼Œ(è¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µä¸ºè¿æ¥åŒæ„çš„åº”ç­”æŠ¥æ–‡) seq=yï¼Œ(è¡¨ç¤ºæœåŠ¡ç«¯ä½œä¸ºå‘é€è€…æ—¶ï¼Œå‘é€å­—èŠ‚æµçš„åˆå§‹åºå·) ack=x+1(è¡¨ç¤ºæœåŠ¡ç«¯å¸Œæœ›ä¸‹ä¸€ä¸ªæ•°æ®æŠ¥å‘é€åºå·ä»x+1å¼€å§‹çš„å­—èŠ‚)ã€‚<br>è¯¥åº”ç­”å‘é€å®Œæˆåä¾¿è¿›å…¥SYN-RCVDçŠ¶æ€ã€‚</li>
<li><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong> ï¼šå½“å®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥åŒæ„çš„åº”ç­”åï¼Œè¿˜è¦å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡æ®µï¼Œè¡¨ç¤ºï¼šæœåŠ¡ç«¯å‘æ¥çš„è¿æ¥åŒæ„åº”ç­”å·²ç»æˆåŠŸæ”¶åˆ°ã€‚<br>è¯¥æŠ¥æ–‡æ®µçš„å¤´éƒ¨ä¸ºï¼šACK=1ï¼Œseq=x+1ï¼Œack=y+1ã€‚<br>å®¢æˆ·ç«¯å‘å®Œè¿™ä¸ªæŠ¥æ–‡æ®µåä¾¿è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªåº”ç­”åä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œæ­¤æ—¶è¿æ¥çš„å»ºç«‹å®Œæˆï¼</li>
</ol>
<p><strong>PSï¼šä¸ºä»€ä¹ˆè¿æ¥å»ºç«‹éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿ</strong></p>
<p>é˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µè¢«æœåŠ¡ç«¯æ¥æ”¶ï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ï¼Œå¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŒ‡çš„æ˜¯ï¼šè‹¥å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€çš„è¿æ¥è¯·æ±‚ä¸¢å¤±ï¼Œå®¢æˆ·ç«¯ç­‰å¾…åº”ç­”è¶…æ—¶åå°±ä¼šå†æ¬¡å‘é€è¿æ¥è¯·æ±‚ï¼Œæ­¤æ—¶ï¼Œä¸Šä¸€ä¸ªè¿æ¥è¯·æ±‚å°±æ˜¯å¤±æ•ˆçš„ã€‚</p>
<p>è‹¥å»ºç«‹è¿æ¥åªéœ€ä¸¤æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¿æ¥è¯·æ±‚åå°±è¿›å…¥ESTABLISHEDçŠ¶æ€ã€‚æ­¤æ—¶å¦‚æœç½‘ç»œæ‹¥å¡ï¼Œå®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚è¿Ÿè¿Ÿåˆ°ä¸äº†æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ä¾¿è¶…æ—¶é‡å‘è¯·æ±‚ï¼Œæ­¤æ—¶ï¼Œå¦‚æœé‚£ä¸ªå¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠµè¾¾äº†æœåŠ¡ç«¯ï¼Œä½†æ­¤æ—¶çš„å®¢æˆ·ç«¯æ—©å·²è¿›å…¥CLOSEDçŠ¶æ€ï¼ŒæœåŠ¡ç«¯å°†ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè¿™æ ·æµªè´¹æœåŠ¡ç«¯è¿æ¥èµ„æºã€‚</p>
<h1 id="TCPè¿æ¥é‡Šæ”¾-å››æ¬¡æ¡æ‰‹"><a href="#TCPè¿æ¥é‡Šæ”¾-å››æ¬¡æ¡æ‰‹" class="headerlink" title="TCPè¿æ¥é‡Šæ”¾(å››æ¬¡æ¡æ‰‹)"></a>TCPè¿æ¥é‡Šæ”¾(å››æ¬¡æ¡æ‰‹)</h1><p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/tcpRelease.png" alt="tcpRelease"><br><strong>TCPè¿æ¥å‘é€æ•°æ®</strong>æ˜¯åŒå‘çš„ï¼Œå› æ­¤åœ¨å››æ¬¡æŒ¥æ‰‹ä¸­ï¼Œå‰ä¸¤æ¬¡æŒ¥æ‰‹ç”¨äºæ–­å¼€ä¸€ä¸ªæ–¹å‘çš„è¿æ¥ï¼Œåä¸¤æ¬¡æŒ¥æ‰‹ç”¨äºæ–­å¼€å¦ä¸€æ–¹å‘çš„è¿æ¥ã€‚</p>
<ol>
<li><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong> ï¼šè‹¥Aè®¤ä¸ºæ•°æ®å‘é€å®Œæˆï¼Œåˆ™å®ƒéœ€è¦å‘Bå‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ã€‚è¯¥è¯·æ±‚åªæœ‰æŠ¥æ–‡å¤´ï¼Œå¤´ä¸­æºå¸¦çš„ä¸»è¦å‚æ•°ä¸ºï¼šFIN=1ï¼Œ(è¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µæ˜¯ä¸€ä¸ªè¿æ¥é‡Šæ”¾è¯·æ±‚) seq=u(u-1æ˜¯Aå‘Bå‘é€çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·)ã€‚æ­¤æ—¶ï¼ŒAå°†è¿›å…¥FIN-WAIT-1çŠ¶æ€ã€‚</li>
<li><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong> ï¼šBæ”¶åˆ°è¿æ¥é‡Šæ”¾è¯·æ±‚åï¼Œä¼šé€šçŸ¥ç›¸åº”çš„åº”ç”¨ç¨‹åºï¼Œå‘Šè¯‰å®ƒAå‘Bè¿™ä¸ªæ–¹å‘çš„è¿æ¥å·²ç»é‡Šæ”¾ã€‚æ­¤æ—¶Bè¿›å…¥CLOSE-WAITçŠ¶æ€ï¼Œå¹¶å‘Aå‘é€è¿æ¥é‡Šæ”¾çš„åº”ç­”ï¼Œå…¶æŠ¥æ–‡å¤´åŒ…å«ï¼š ACK=1ï¼Œ(è¡¨ç¤ºåº”ç­”) seq=v (v-1æ˜¯Bå‘Aå‘é€çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·)ï¼Œack=u+1(è¡¨ç¤ºå¸Œæœ›æ”¶åˆ°ä»ç¬¬u+1ä¸ªå­—èŠ‚å¼€å§‹çš„æŠ¥æ–‡æ®µï¼Œå¹¶ä¸”å·²ç»æˆåŠŸæ¥æ”¶äº†å‰uä¸ªå­—èŠ‚)ã€‚Aæ”¶åˆ°è¯¥åº”ç­”ï¼Œè¿›å…¥FIN-WAIT-2çŠ¶æ€ï¼Œç­‰å¾…Bå‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ã€‚<strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹å®Œæˆåï¼ŒAåˆ°Bæ–¹å‘çš„è¿æ¥å·²ç»é‡Šæ”¾ï¼ŒBä¸ä¼šå†æ¥æ”¶æ•°æ®ï¼ŒAä¹Ÿä¸ä¼šå†å‘é€æ•°æ®ã€‚ä½†Båˆ°Aæ–¹å‘çš„è¿æ¥ä»ç„¶å­˜åœ¨ï¼ŒBå¯ä»¥ç»§ç»­å‘Aå‘é€æ•°æ®ã€‚</strong></li>
<li><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong> ï¼šå½“Bå‘Aå‘å®Œæ‰€æœ‰æ•°æ®åï¼Œå‘Aå‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ï¼Œè¯·æ±‚å¤´ï¼šFIN=1ï¼ŒACK=1ï¼Œseq=wï¼Œack=u+1ã€‚Bä¾¿è¿›å…¥LAST-ACKçŠ¶æ€ã€‚</li>
<li><strong>ç¬¬å››æ¬¡æ¡æ‰‹</strong> ï¼šAæ”¶åˆ°é‡Šæ”¾è¯·æ±‚åï¼Œå‘Bå‘é€ç¡®è®¤åº”ç­”ï¼Œæ­¤æ—¶Aè¿›å…¥TIME-WAITçŠ¶æ€ã€‚è¯¥çŠ¶æ€ä¼šæŒç»­2MSL(æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´)æ—¶é—´ï¼Œè‹¥è¯¥æ—¶é—´æ®µå†…æ²¡æœ‰Bçš„é‡å‘è¯·æ±‚çš„è¯ï¼Œå°±è¿›å…¥CLOSEDçŠ¶æ€ï¼Œæ’¤é”€TCBã€‚å½“Bæ”¶åˆ°ç¡®è®¤åº”ç­”åï¼Œä¹Ÿä¾¿è¿›å…¥CLOSEDçŠ¶æ€ï¼Œæ’¤é”€TCBã€‚</li>
</ol>
<h1 id="TCPçš„å¯é ä¼ è¾“"><a href="#TCPçš„å¯é ä¼ è¾“" class="headerlink" title="TCPçš„å¯é ä¼ è¾“"></a>TCPçš„å¯é ä¼ è¾“</h1><p>TCPé‡‡ç”¨äº†æ ¡éªŒå’Œã€è¿æ¥ç®¡ç†ã€åºåˆ—å·ã€ç¡®è®¤åº”ç­”ï¼Œé‡å‘æ§åˆ¶ã€æ»‘åŠ¨çª—å£åè®®ï¼ˆè¿ç»­ARQåè®®ã€æµæ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼‰ç­‰æœºåˆ¶æ¥ä¿è¯å®ƒçš„å¯é æ€§ã€‚</p>
<h2 id="æ ¡éªŒå’Œ"><a href="#æ ¡éªŒå’Œ" class="headerlink" title="æ ¡éªŒå’Œ"></a>æ ¡éªŒå’Œ</h2><p>TCPå’ŒUDPæ ¡éªŒå’Œçš„æ–¹å¼ä¸€è‡´ï¼Œå¯ä»¥å‚ç…§å¦ä¸€ç¯‡åšå®¢â€”â€”<a href="http://todorex.com/2018/05/17/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/UDP%E5%8D%8F%E8%AE%AE/" target="_blank" rel="external">UDPåè®®</a></p>
<h2 id="è¿æ¥ç®¡ç†"><a href="#è¿æ¥ç®¡ç†" class="headerlink" title="è¿æ¥ç®¡ç†"></a>è¿æ¥ç®¡ç†</h2><p>å…¶å®å°±æ˜¯åˆ©ç”¨å»ºç«‹è¿æ¥æ—¶çš„ä¸‰æ¬¡æ¡æ‰‹æ¥æé«˜å¯é æ€§ã€‚</p>
<h2 id="é€šè¿‡åºåˆ—å·ä¸ç¡®è®¤åº”ç­”"><a href="#é€šè¿‡åºåˆ—å·ä¸ç¡®è®¤åº”ç­”" class="headerlink" title="é€šè¿‡åºåˆ—å·ä¸ç¡®è®¤åº”ç­”"></a>é€šè¿‡åºåˆ—å·ä¸ç¡®è®¤åº”ç­”</h2><p>åœ¨TCPä¸­ï¼Œå½“å‘é€ç«¯çš„æ•°æ®åˆ°è¾¾æ¥æ”¶ä¸»æœºæ—¶ï¼Œæ¥æ”¶ç«¯ä¸»æœºä¼šè¿”å›ä¸€ä¸ªæ”¶åˆ°æ¶ˆæ¯çš„é€šçŸ¥ï¼Œè¿™ä¸ªæ¶ˆæ¯å«åš<strong>ç¡®è®¤åº”ç­”(ACK)</strong>ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯å‘é€[æ•°æ®(1-1000)]ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°†ä¼šå›åº”[ç¡®è®¤åº”ç­”(ä¸‹ä¸€ä¸ªæ•°1001)]ã€‚åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰ç­‰åˆ°ç¡®è®¤åº”ç­”ï¼Œå‘é€ç«¯ä¼šè®¤ä¸ºæ•°æ®å·²ç»ä¸¢å¤±ï¼Œå¹¶è¿›è¡Œé‡å‘ã€‚</p>
<h2 id="æ»‘åŠ¨çª—å£åè®®-è¿ç»­ARQåè®®"><a href="#æ»‘åŠ¨çª—å£åè®®-è¿ç»­ARQåè®®" class="headerlink" title="æ»‘åŠ¨çª—å£åè®®(è¿ç»­ARQåè®®)"></a>æ»‘åŠ¨çª—å£åè®®(è¿ç»­ARQåè®®)</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>å…ˆç®€å•è¯´è¯´ARQ(Automatic Repeat reQuest)åè®®(è‡ªåŠ¨é‡ä¼ è¯·æ±‚åè®®)ï¼š å½“è¯·æ±‚å¤±è´¥æ—¶å®ƒä¼šè‡ªåŠ¨é‡ä¼ ï¼Œç›´åˆ°è¯·æ±‚è¢«æ­£ç¡®æ¥æ”¶ä¸ºæ­¢ã€‚è¿™ç§æœºåˆ¶ä¿è¯äº†æ¯ä¸ªåˆ†ç»„éƒ½èƒ½è¢«æ­£ç¡®æ¥æ”¶ã€‚</p>
<p>å†çœ‹è¿ç»­ARQåè®®ï¼šåœ¨ARQåè®®å‘é€è€…æ¯æ¬¡åªèƒ½å‘é€ä¸€ä¸ªåˆ†ç»„ï¼Œåœ¨åº”ç­”åˆ°æ¥å‰å¿…é¡»ç­‰å¾…ã€‚è€Œè¿ç»­ARQåè®®çš„å‘é€è€…æ‹¥æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œå‘é€è€…å¯ä»¥åœ¨æ²¡æœ‰å¾—åˆ°åº”ç­”çš„æƒ…å†µä¸‹è¿ç»­å‘é€çª—å£ä¸­çš„åˆ†ç»„ã€‚</p>
<h3 id="å‘é€çª—å£"><a href="#å‘é€çª—å£" class="headerlink" title="å‘é€çª—å£"></a>å‘é€çª—å£</h3><p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/sendWindow.png" alt="sendWindow"></p>
<p>å‘é€çª—å£çš„å¤§å°ç”±æ¥æ”¶çª—å£çš„å‰©ä½™å¤§å°å†³å®šã€‚æ¥æ”¶è€…ä¼šæŠŠå½“å‰æ¥æ”¶çª—å£çš„å‰©ä½™å¤§å°å†™å…¥åº”ç­”TCPæŠ¥æ–‡æ®µçš„å¤´éƒ¨ï¼Œå‘é€è€…æ”¶åˆ°åº”ç­”åæ ¹æ®è¯¥å€¼å’Œå½“å‰ç½‘ç»œæ‹¥å¡æƒ…å†µè®¾ç½®å‘é€çª—å£çš„å¤§å°ã€‚å‘é€çª—å£çš„å¤§å°æ˜¯ä¸æ–­å˜åŒ–çš„ã€‚</p>
<p>å‘é€çª—å£(p1-p3)ç”±ä¸‰ä¸ªæŒ‡é’ˆæ„æˆï¼š</p>
<ul>
<li>p1ï¼šp1æŒ‡å‘å‘é€çª—å£çš„åæ²¿ï¼Œå®ƒåé¢çš„å­—èŠ‚è¡¨ç¤ºå·²ç»å‘é€ä¸”å·²æ”¶åˆ°åº”ç­”ã€‚</li>
<li>p2ï¼šp2æŒ‡å‘å°šæœªå‘é€çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚<br>p1-p2é—´çš„å­—èŠ‚è¡¨ç¤ºå·²ç»å‘é€ï¼Œä½†è¿˜æ²¡æ”¶åˆ°ç¡®è®¤åº”ç­”ã€‚è¿™éƒ¨åˆ†çš„å­—èŠ‚ä»éœ€ä¿ç•™ï¼Œå› ä¸ºå¯èƒ½è¿˜è¦è¶…æ—¶é‡å‘ã€‚<br>p2-p3é—´çš„å­—èŠ‚è¡¨ç¤ºå¯ä»¥å‘é€ï¼Œä½†è¿˜æ²¡æœ‰å‘é€çš„å­—èŠ‚ã€‚</li>
<li>p3ï¼šp3æŒ‡å‘å‘é€çª—å£çš„å‰æ²¿ï¼Œå®ƒå‰é¢çš„å­—èŠ‚å°šæœªå‘é€ï¼Œä¸”ä¸å…è®¸å‘é€ã€‚</li>
</ul>
<p>å‘é€è€…æ¯æ”¶åˆ°ä¸€ä¸ªåº”ç­”ï¼Œåæ²¿å°±å¯ä»¥å‘å‰ç§»åŠ¨æŒ‡å®šçš„å­—èŠ‚ã€‚æ­¤æ—¶è‹¥çª—å£å¤§å°ä»ç„¶æ²¡å˜ï¼Œå‰æ²¿ä¹Ÿå¯ä»¥å‘å‰ç§»åŠ¨æŒ‡å®šå­—èŠ‚ã€‚<br>å½“p2å’Œå‰æ²¿é‡åˆæ—¶ï¼Œå‘é€è€…å¿…é¡»ç­‰å¾…ç¡®è®¤åº”ç­”ã€‚</p>
<h3 id="æ¥æ”¶çª—å£"><a href="#æ¥æ”¶çª—å£" class="headerlink" title="æ¥æ”¶çª—å£"></a>æ¥æ”¶çª—å£</h3><p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/receiverWindow.png" alt="receiverWindow"></p>
<p>æ¥æ”¶è€…æ”¶åˆ°çš„å­—èŠ‚ä¼šå­˜å…¥æ¥æ”¶çª—å£ï¼Œæ¥æ”¶è€…ä¼šå¯¹å·²ç»æ­£ç¡®æ¥æ”¶çš„æœ‰åºå­—èŠ‚è¿›è¡Œç´¯è®¡ç¡®è®¤ï¼Œå‘é€å®Œç¡®è®¤åº”ç­”åï¼Œæ¥æ”¶çª—å£å°±å¯ä»¥å‘å‰ç§»åŠ¨æŒ‡å®šå­—èŠ‚ã€‚<br>å¦‚æœæŸäº›å­—èŠ‚å¹¶æœªæŒ‰åºæ”¶åˆ°ï¼Œæ¥æ”¶è€…<strong>åªä¼š</strong>ç¡®è®¤æœ€åä¸€ä¸ªæœ‰åºçš„å­—èŠ‚ï¼Œä»è€Œä¹±åºçš„å­—èŠ‚å°±ä¼šè¢«é‡æ–°å‘é€ã€‚</p>
<h2 id="æµæ§åˆ¶"><a href="#æµæ§åˆ¶" class="headerlink" title="æµæ§åˆ¶"></a>æµæ§åˆ¶</h2><h3 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>è®©å‘é€ç«¯æ ¹æ®æ¥æ”¶ç«¯çš„å®é™…æ¥æ”¶èƒ½åŠ›æ§åˆ¶å‘é€çš„æ•°æ®é‡ã€‚</p>
<h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h3><p>é˜²æ­¢æ¥æ”¶ç«¯åœ¨é«˜è´Ÿè·çš„æƒ…å†µä¸‹æ¥æ”¶æ•°æ®ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™å¦‚æœæ¥æ”¶ç«¯ä¼šå°†æœ¬åº”è¯¥æ¥æ”¶çš„æ•°æ®ä¸¢å¼ƒï¼Œå°±åˆä¼šè§¦å‘é‡å‘æœºåˆ¶ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæµé‡çš„æ— ç«¯æµªè´¹ã€‚</p>
<h3 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h3><p>æ¥æ”¶ç«¯ä¸»åŠ¨å‘å‘é€ç«¯ä¸»æœºé€šçŸ¥è‡ªå·±å¯ä»¥æ¥å—æ•°æ®çš„å¤§å°ï¼Œäºæ˜¯å‘é€ç«¯ä¼šå‘é€ä¸è¶…è¿‡è¿™ä¸ªé™åº¦çš„æ•°æ®ã€‚è¿™ä¸ªå¤§å°é™åº¦å°±æ˜¯æ¥æ”¶çª—å£å¤§å°ï¼Œæ‰€ä»¥æµæ§åˆ¶å°±æ˜¯åˆ©ç”¨æ»‘åŠ¨çª—å£åè®®å®ç°çš„ã€‚</p>
<h3 id="æ­»é”é—®é¢˜"><a href="#æ­»é”é—®é¢˜" class="headerlink" title="æ­»é”é—®é¢˜"></a>æ­»é”é—®é¢˜</h3><p>å½“å‘é€è€…æ”¶åˆ°äº†ä¸€ä¸ªçª—å£ä¸º0çš„åº”ç­”ï¼Œå‘é€è€…ä¾¿åœæ­¢å‘é€ï¼Œç­‰å¾…æ¥æ”¶è€…çš„ä¸‹ä¸€ä¸ªåº”ç­”ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ªçª—å£ä¸ä¸º0çš„åº”ç­”åœ¨ä¼ è¾“è¿‡ç¨‹ä¸¢å¤±ï¼Œå‘é€è€…ä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè€Œæ¥æ”¶è€…ä»¥ä¸ºå‘é€è€…å·²ç»æ”¶åˆ°è¯¥åº”ç­”ï¼Œç­‰å¾…æ¥æ”¶æ–°æ•°æ®ï¼Œè¿™æ ·åŒæ–¹å°±ç›¸äº’ç­‰å¾…ï¼Œä»è€Œäº§ç”Ÿæ­»é”ã€‚ä¸ºäº†é¿å…æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿï¼Œå‘é€ç«¯ä¸»æœºä¼šæ—¶ä¸æ—¶å‘é€ä¸€ä¸ªå«åšçª—å£æ¢æµ‹çš„æ•°æ®æ®µï¼Œæ­¤æ•°æ®æ®µä»…å«ä¸€ä¸ªä»¥è·å–æœ€æ–°çª—å£çš„å¤§å°ä¿¡æ¯ã€‚</p>
<h2 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h2><h3 id="æ‹¥å¡æ§åˆ¶å’Œæµæ§åˆ¶çš„åŒºåˆ«ï¼Ÿ"><a href="#æ‹¥å¡æ§åˆ¶å’Œæµæ§åˆ¶çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="æ‹¥å¡æ§åˆ¶å’Œæµæ§åˆ¶çš„åŒºåˆ«ï¼Ÿ"></a>æ‹¥å¡æ§åˆ¶å’Œæµæ§åˆ¶çš„åŒºåˆ«ï¼Ÿ</h3><ol>
<li>æ‹¥å¡æ§åˆ¶ï¼šæ‹¥å¡æ§åˆ¶æ˜¯ä½œç”¨äºç½‘ç»œçš„ï¼Œå®ƒæ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œé¿å…å‡ºç°ç½‘ç»œè´Ÿè½½è¿‡å¤§çš„æƒ…å†µ</li>
<li>æµæ§åˆ¶ï¼šæµæ§åˆ¶æ˜¯ä½œç”¨äºæ¥æ”¶è€…çš„ï¼Œå®ƒæ˜¯æ§åˆ¶å‘é€è€…çš„å‘é€é€Ÿåº¦ä»è€Œä½¿æ¥æ”¶è€…æ¥å¾—åŠæ¥æ”¶</li>
</ol>
<h3 id="æ‹¥å¡æƒ…å†µ"><a href="#æ‹¥å¡æƒ…å†µ" class="headerlink" title="æ‹¥å¡æƒ…å†µ"></a>æ‹¥å¡æƒ…å†µ</h3><p>è§‚å¯Ÿæ‹¥å¡çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€æ˜¯è¶…æ—¶ï¼ŒäºŒæ˜¯è¿ç»­æ¥æ”¶åˆ°3ä¸ªé‡å¤ACKã€‚</p>
<p><strong>PSï¼šä¸ºä»€ä¹ˆæ˜¯3ä¸ªè¿ç»­çš„ACK</strong>ï¼šç”±äºæˆ‘ä»¬ä¸çŸ¥é“ä¸€ä¸ªé‡å¤çš„ACKæ˜¯ç”±ä¸€ä¸ªä¸¢å¤±çš„æŠ¥æ–‡å¼•èµ·çš„ï¼Œè¿˜æ˜¯ç”±äºä»…ä»…å‡ºç°äº†å‡ ä¸ªæŠ¥æ–‡æ®µçš„é‡æ–°æ’åºå¼•èµ·çš„ï¼Œå› æ­¤æˆ‘ä»¬ç­‰å¾…å°‘é‡çš„é‡å¤çš„ACKåˆ°æ¥ã€‚å› ä¸ºè‹¥åªæ˜¯ä¸€äº›æŠ¥æ–‡æ®µçš„é‡æ–°æ’åºå¼•èµ·çš„ï¼Œä¸€èˆ¬åœ¨é‡æ–°æ’åºæŠ¥æ–‡æ®µå®Œæˆå¹¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ACKä¹‹å‰åªå¯èƒ½äº§ç”Ÿ1-2ä¸ªé‡å¤çš„ACKã€‚</p>
<h3 id="æ‹¥å¡çš„ä¸åŒå¤„ç†æ–¹å¼"><a href="#æ‹¥å¡çš„ä¸åŒå¤„ç†æ–¹å¼" class="headerlink" title="æ‹¥å¡çš„ä¸åŒå¤„ç†æ–¹å¼"></a>æ‹¥å¡çš„ä¸åŒå¤„ç†æ–¹å¼</h3><p>å¯¹äºç”±äºè¶…æ—¶é‡ä¼ è®¤ä¸ºçš„æ‹¥å¡ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯é‡ä¼ æŠ¥æ–‡æ®µï¼Œç„¶åè¿›å…¥<strong>æ…¢å¯åŠ¨ç®—æ³•</strong>(ä¸‹æ–¹)ï¼›å¯¹äºç”±äºæ¥æ”¶åˆ°3ä¸ªé‡å¤çš„ACKè®¤ä¸ºçš„æ‹¥å¡ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯<strong>ç«‹å³é‡ä¼ æŠ¥æ–‡æ®µ</strong>ï¼Œç„¶åè¿›å…¥<strong>æ‹¥å¡é¿å…ç®—æ³•</strong>(ä¸‹æ–¹)ã€‚è¿™æ ·å¤„ç†çš„åŸå› æ˜¯å› ä¸ºå½“å› ä¸ºå®šæ—¶å™¨è¶…æ—¶ï¼Œæ­¤æ—¶ç½‘ç»œä¸­å¯èƒ½å·²ç»å¾ˆæ‹¥å¡ï¼Œæ•°æ®ç¡®è®¤çš„ACKå·²ç»æ— æ³•å‘é€å›æ¥ï¼Œå› æ­¤æˆ‘ä»¬ç«‹å³å‡å°‘æ³¨å…¥ç½‘ç»œä¸­çš„æ•°æ®ï¼Œä½¿ç”¨æ…¢å¯åŠ¨æ‹¥å¡çª—å£å‡å°ä¸º1ï¼›è€Œå¯¹äºæ”¶åˆ°,3ä¸ªé‡å¤çš„ACKè¯´æ˜è¿˜æœ‰å…¶ä»–çš„æŠ¥æ–‡æ®µåˆ°è¾¾äº†ç›®çš„åœ°(å› ä¸ºæ¥æ”¶æ–¹åªæœ‰åœ¨æ”¶åˆ°å¤±åºçš„æŠ¥æ–‡æ®µæ—¶æ‰ä¼šäº§ç”Ÿé‡å¤çš„ACKè€Œä¸”è¿˜æœ‰é‡å¤çš„ACKå‘é€å›æ¥)ï¼Œä¹Ÿå³æ”¶å‘ä¸¤ç«¯è¿˜æœ‰æ•°æ®çš„æµåŠ¨ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…ä½¿ç”¨æ…¢å¯åŠ¨çªç„¶å‡å°‘æ³¨å…¥ç½‘ç»œçš„æ•°æ®ã€‚</p>
<h3 id="æ…¢å¯åŠ¨ç®—æ³•-å’Œ-æ‹¥å¡é¿å…ç®—æ³•"><a href="#æ…¢å¯åŠ¨ç®—æ³•-å’Œ-æ‹¥å¡é¿å…ç®—æ³•" class="headerlink" title="æ…¢å¯åŠ¨ç®—æ³• å’Œ æ‹¥å¡é¿å…ç®—æ³•"></a>æ…¢å¯åŠ¨ç®—æ³• å’Œ æ‹¥å¡é¿å…ç®—æ³•</h3><p>å‘é€æ–¹ç»´æŠ¤ä¸€ä¸ªå‘é€çª—å£ï¼Œå‘é€çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡æƒ…å†µ(æ‹¥å¡çª—å£)ï¼Œå‘é€çª—å£æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚<br>å‘é€æ–¹è¿˜ç»´æŠ¤ä¸€ä¸ªæ…¢å¯åŠ¨é˜ˆå€¼ã€‚</p>
<ul>
<li>å‘é€çª—å£ &lt; æ…¢å¯åŠ¨é˜ˆå€¼ï¼šä½¿ç”¨æ…¢å¯åŠ¨ç®—æ³•(æŒ‡æ•°çº§)</li>
<li>å‘é€çª—å£ &gt; æ…¢å¯åŠ¨é˜ˆå€¼ï¼šä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•(çº¿æ€§åŠ ä¸€)</li>
<li>å‘é€çª—å£ = æ…¢å¯åŠ¨é˜ˆå€¼ï¼šä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•æˆ–æ‹¥å¡é¿å…ç®—æ³•</li>
</ul>
<p>ç®—æ³•çš„å…·ä½“è¿‡ç¨‹ï¼š</p>
<ol>
<li>é€šä¿¡å¼€å§‹æ—¶ï¼Œä½¿ç”¨æ…¢å¯åŠ¨ç®—æ³•ï¼Œå‘é€æ–¹çš„å‘é€çª—å£è®¾ä¸º1ï¼Œå¹¶å‘é€ç¬¬ä¸€ä¸ªåˆ†ç»„M1ï¼›</li>
<li>æ¥æ”¶æ–¹æ”¶åˆ°M1åï¼Œè¿”å›ç¡®è®¤åº”ç­”ï¼Œæ­¤æ—¶å‘é€æ–¹å‘é€çª—å£æ‰©å¤§ä¸¤å€ï¼Œå¹¶å‘é€M2ã€M3ï¼›ï¼ˆå³ï¼Œå‘é€æ–¹æ¯æ¬¡æ”¶åˆ°ç¡®è®¤åº”ç­”åï¼Œéƒ½å°†å‘é€çª—å£è®¾ä¸ºå½“å‰å€¼çš„ä¸¤å€ï¼‰</li>
<li>è‹¥å‘é€çª—å£&gt;æ…¢å¯åŠ¨é˜ˆå€¼ï¼Œåˆ™ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•ï¼Œæ¯æ¬¡æ”¶åˆ°ç¡®è®¤åº”ç­”åéƒ½å°†å‘é€çª—å£+1ï¼›</li>
<li>è‹¥å‘é€æ–¹å‡ºç°äº†è¶…æ—¶é‡ä¼ ï¼Œåˆ™è¡¨æ˜ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œæ­¤æ—¶ï¼š<ol>
<li>æ…¢å¯åŠ¨é˜ˆå€¼è®¾ä¸ºå½“å‰å‘é€çª—å£çš„ä¸€åŠï¼›</li>
<li>å‘é€çª—å£è®¾ä¸º1ï¼›</li>
<li>å¯ç”¨æ‹¥å¡é¿å…ç®—æ³•ï¼›</li>
</ol>
</li>
</ol>
<p>PSï¼šå‘é€è¶…æ—¶é‡ä¼ æ—¶ï¼Œå‘é€çª—å£æœ‰å¯èƒ½å·²ç»è¶…è¿‡äº†æ…¢å¼€å§‹é—¨é™ï¼Œä¹Ÿæœ‰å¯èƒ½è¿˜æ²¡è¶…è¿‡ï¼›æ­¤æ—¶ä¸ç®¡ä½•ç§æƒ…å†µï¼Œéƒ½ä¸€å¾‹å¯ç”¨æ‹¥å¡é¿å…ç®—æ³•ï¼Œå¹¶æ‰§è¡Œä¸Šè¿°ä¸‰æ­¥æ“ä½œï¼</p>
<p><strong>æ…¢å¼€å§‹ç®—æ³•çš„ä½œç”¨</strong>ï¼šæ…¢å¼€å§‹ç®—æ³•å°†å‘é€çª—å£ä»å°æ‰©å¤§ï¼Œè€Œä¸”æŒ‰æŒ‡æ•°çº§æ‰©å¤§ï¼Œä»è€Œé¿å…ä¸€å¼€å§‹å°±å¾€ç½‘ç»œä¸­æ³¨å…¥è¿‡å¤šçš„åˆ†ç»„ä»è€Œå¯¼è‡´æ‹¥å¡ï¼›å®ƒå°†çª—å£æ…¢æ…¢æ‰©å¤§çš„è¿‡ç¨‹å…¶å®ä¹Ÿåœ¨æ¢æµ‹ç½‘ç»œæ‹¥å¡æƒ…å†µçš„è¿‡ç¨‹ï¼Œå½“å‘ç°å‡ºç°æ‹¥å¡æ—¶ï¼ŒåŠæ—¶é™ä½å‘é€é€Ÿåº¦ï¼Œä»è€Œå‡ç¼“ç½‘ç»œæ‹¥å¡ã€‚</p>
<p><strong>æ‹¥å¡é¿å…ç®—æ³•çš„ä½œç”¨</strong>ï¼šæ‹¥å¡é¿å…ç®—æ³•ä½¿å‘é€çª—å£ä»¥çº¿æ€§æ–¹å¼å¢é•¿ï¼Œè€ŒéæŒ‡æ•°çº§å¢é•¿ï¼Œä»è€Œä½¿ç½‘ç»œæ›´åŠ ä¸å®¹æ˜“å‘ç”Ÿæ‹¥å¡ã€‚</p>
<h3 id="å¿«é‡ä¼ å’Œå¿«æ¢å¤"><a href="#å¿«é‡ä¼ å’Œå¿«æ¢å¤" class="headerlink" title="å¿«é‡ä¼ å’Œå¿«æ¢å¤"></a>å¿«é‡ä¼ å’Œå¿«æ¢å¤</h3><p>å½“å› æ”¶åˆ°ä¸‰ä¸ªåŠä¸‰ä¸ªä»¥ä¸Šçš„é‡å¤ACKæ—¶ï¼Œä½¿ç”¨å¦‚ä¸‹æ‹¥å¡æ§åˆ¶æ–¹æ³•ï¼š</p>
<ol>
<li>æ”¶åˆ°3ä¸ªé‡å¤çš„ACKï¼Œå°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ä¸ºå½“å‰æ‹¥å¡çª—å£å¤§å°çš„ä¸€åŠ</li>
<li>æ­¤æ—¶ç«‹å³é‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡ä¸ç”¨ç­‰åˆ°å®šæ—¶å™¨è¶…æ—¶(è¶…æ—¶é‡ä¼ )ï¼Œæ­¤ä¸ºå¿«é‡ä¼ ã€‚</li>
<li>æ­¤åå¼€å§‹æ‰§è¡Œæ‹¥å¡é¿å…è€Œä¸æ˜¯æ…¢å¯åŠ¨ï¼Œæ­¤ä¸ºå¿«æ¢å¤ã€‚</li>
</ol>
<h1 id="TCPçš„åº”ç”¨"><a href="#TCPçš„åº”ç”¨" class="headerlink" title="TCPçš„åº”ç”¨"></a>TCPçš„åº”ç”¨</h1><p>å½“å¯¹ç½‘ç»œé€šè®¯è´¨é‡æœ‰è¦æ±‚çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼šæ•´ä¸ªæ•°æ®è¦å‡†ç¡®æ— è¯¯çš„ä¼ é€’ç»™å¯¹æ–¹ï¼Œè¿™å¾€å¾€ç”¨äºä¸€äº›è¦æ±‚å¯é çš„åº”ç”¨ã€‚å¸¸è§çš„ä½¿ç”¨UDPåè®®çš„åº”ç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li>HTTP(è¶…æ–‡æœ¬ä¼ è¾“åè®®)</li>
<li>FTP(æ–‡ä»¶ä¼ è¾“åè®®)</li>
<li>POPã€SMTP(é‚®ä»¶ä¼ è¾“åè®®)</li>
<li>Telnetã€Telnet(è¿œç¨‹è¿æ¥åè®®)</li>
<li>QQæ–‡ä»¶ä¼ è¾“</li>
</ul>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://blog.csdn.net/u010425776/article/details/55006347?locationNum=2&amp;fps=1" target="_blank" rel="external">è®¡ç®—æœºç½‘ç»œä¼ è¾“å±‚çŸ¥è¯†ç‚¹å…¨è¦†ç›–</a></li>
<li><a href="https://blog.csdn.net/whoamiyang/article/details/50890801" target="_blank" rel="external">TCPåè®®è¯¦è§£â€”å­¦ä¹ ç¬”è®°</a></li>
<li><a href="https://blog.csdn.net/corcplusplusorjava/article/details/46954433" target="_blank" rel="external">TCPåè®®</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šTCPä½œä¸ºä¼ è¾“å±‚çš„ä¸€å¤§åè®®ï¼Œè™½ç„¶æ²¡æœ‰UDPç®€å•ï¼Œä½†æ˜¯èƒœåœ¨å¯é ã€‚
    
    </summary>
    
      <category term="è®¡ç®—æœºç½‘ç»œ" scheme="http://bestlixiang.site/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="TCP" scheme="http://bestlixiang.site/tags/TCP/"/>
    
  </entry>
  
  <entry>
    <title>UDPåè®®</title>
    <link href="http://bestlixiang.site/2018/05/17/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/UDP%E5%8D%8F%E8%AE%AE/"/>
    <id>http://bestlixiang.site/2018/05/17/è®¡ç®—æœºç½‘ç»œ/UDPåè®®/</id>
    <published>2018-05-17T07:03:18.000Z</published>
    <updated>2018-05-17T07:09:07.421Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šUDPä½œä¸ºä¼ è¾“å±‚çš„ä¸€å¤§åè®®ï¼Œè™½ç„¶æ²¡æœ‰TCPå¯é ï¼Œä½†æ˜¯å´èƒœåœ¨ç®€å•ã€‚<a id="more"></a></p>
<h1 id="UDPè®¤è¯†"><a href="#UDPè®¤è¯†" class="headerlink" title="UDPè®¤è¯†"></a>UDPè®¤è¯†</h1><p><strong>UDP(ç”¨æˆ·æ•°æ®æŠ¥åè®®)</strong> æ˜¯ä¸€ç§ç®€å•çš„é¢å‘æ•°æ®æŠ¥ã€æ— è¿æ¥ã€ä¼ è¾“å±‚åè®®ï¼Œå¹¶ä¸”ä¿ç•™äº†ä¿¡æ¯è¾¹ç•Œã€‚UDPä¸æä¾›é”™è¯¯æ ¡æ­£ï¼Œä¸ä¿è¯æœ‰åºï¼Œæ— æ³•å»é‡å¤ï¼Œæ²¡æœ‰æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Œä¸èƒ½ä¿è¯æ•°æ®ä¸€å®šåˆ°è¾¾ç›®çš„åœ°ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ ¡éªŒå’Œæä¾›é”™è¯¯ä¾¦æµ‹ã€‚UDPæä¾›çš„çš„æ˜¯ä¸å¯é ä¼ è¾“ï¼Œ<strong>å› æ­¤è¦æœ‰åº”ç”¨å±‚æ¥æä¾›è¿™äº›åŠŸèƒ½</strong>ã€‚</p>
<h1 id="UDPç‰¹ç‚¹"><a href="#UDPç‰¹ç‚¹" class="headerlink" title="UDPç‰¹ç‚¹"></a>UDPç‰¹ç‚¹</h1><ol>
<li>UDPåªåœ¨IPæ•°æ®æŠ¥æœåŠ¡çš„åŸºç¡€ä¸Šå¢åŠ äº†å°‘é‡çš„åŠŸèƒ½ï¼šåˆ©ç”¨ç«¯å£å·æ˜¯å®ç°åˆ†ç”¨ã€å¯¹æ•´ä¸ªæŠ¥æ–‡çš„å·®é”™æ£€æµ‹ã€‚</li>
<li>UDPæ˜¯æ— è¿æ¥çš„ï¼Œé€šä¿¡å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œé€šä¿¡ç»“æŸä¹Ÿæ— éœ€é‡Šæ”¾è¿æ¥ã€‚</li>
<li>UDPæ˜¯ä¸å¯é çš„ å®ƒæ˜¯<strong>å°½åŠ›è€Œä¸º</strong>äº¤ä»˜ï¼Œä¸èƒ½ç¡®ä¿æ¯ä¸€ä¸ªæ•°æ®æŠ¥éƒ½é€è¾¾ã€‚</li>
<li>UDPæ˜¯<strong>é¢å‘æŠ¥æ–‡</strong>çš„ï¼Œé¢å‘æŠ¥æ–‡å°±æ˜¯æŒ‡ï¼šUDPæ•°æ®ä¼ è¾“çš„å•ä½æ˜¯æŠ¥æ–‡ï¼Œä¸”ä¸ä¼šå¯¹æ•°æ®ä½œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥ æ“ä½œã€‚åœ¨å‘é€ç«¯ï¼Œåº”ç”¨ç¨‹åºç»™ä¼ è¾“å±‚çš„UDPä»€ä¹ˆæ ·çš„æ•°æ®ï¼ŒUDPä¸ä¼šå¯¹æ•°æ®è¿›è¡Œåˆ‡åˆ†ï¼Œåªå¢åŠ ä¸€ä¸ªUDPå¤´å¹¶äº¤ç»™ç½‘ç»œå±‚ã€‚åœ¨æ¥æ”¶ç«¯ï¼ŒUDPæ”¶åˆ°ç½‘ç»œå±‚çš„æ•°æ®æŠ¥åï¼Œå»é™¤IPæ•°æ®æŠ¥å¤´éƒ¨åéäº¤ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä½œä»»ä½•æ‹¼æ¥æ“ä½œã€‚</li>
<li>ç›¸æ¯”äºTCPï¼ŒUDPæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼ŒUDPå§‹ç»ˆä»¥æ’å®šçš„é€Ÿç‡å‘é€æ•°æ®ï¼Œå¹¶ä¸ä¼šæ ¹æ®ç½‘ç»œæ‹¥å¡æƒ…å†µå¯¹å‘é€é€Ÿç‡ä½œè°ƒæ•´ã€‚è¿™ç§æ–¹å¼æœ‰åˆ©æœ‰å¼Šã€‚å¼Šç«¯ï¼šç½‘ç»œæ‹¥å¡æ—¶æœ‰äº›æŠ¥æ–‡å¯èƒ½ä¼šä¸¢å¤±ï¼Œå› æ­¤UDPä¸å¯é ã€‚ä¼˜ç‚¹ï¼šæœ‰äº›ä½¿ç”¨åœºæ™¯å…è®¸æŠ¥æ–‡ä¸¢å¤±ï¼Œå¦‚ï¼šç›´æ’­ã€è¯­éŸ³é€šè¯ï¼Œä½†å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜ï¼Œæ­¤æ—¶UDPè¿˜æ˜¯å¾ˆæœ‰ç”¨æ­¦ä¹‹åœ°çš„ã€‚</li>
<li>UDPæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€å¤šå¯¹ä¸€é€šä¿¡ï¼›è€ŒTCPåªæ”¯æŒä¸€å¯¹ä¸€é€šä¿¡ã€‚</li>
<li>UDPé¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰8å­—èŠ‚ã€‚è€ŒTCPå¤´éƒ¨è‡³å°‘ç”±20å­—èŠ‚ï¼Œç›¸æ¯”äºTCPè¦é«˜æ•ˆå¾ˆå¤šã€‚</li>
</ol>
<h1 id="UDPæ•°æ®åŒ…é¦–éƒ¨"><a href="#UDPæ•°æ®åŒ…é¦–éƒ¨" class="headerlink" title="UDPæ•°æ®åŒ…é¦–éƒ¨"></a>UDPæ•°æ®åŒ…é¦–éƒ¨</h1><p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/udp.png" alt="udp"></p>
<h2 id="UDPæ•°æ®åŒ…é¦–éƒ¨è§£æ"><a href="#UDPæ•°æ®åŒ…é¦–éƒ¨è§£æ" class="headerlink" title="UDPæ•°æ®åŒ…é¦–éƒ¨è§£æ"></a>UDPæ•°æ®åŒ…é¦–éƒ¨è§£æ</h2><ol>
<li>16ä½æºç«¯å£å·ï¼šå‘é€ç«¯åº”ç”¨ç¨‹åºä½¿ç”¨çš„ç«¯å£å·ï¼Œç”¨äºåŒºåˆ†æ•°æ®æŠ¥æ¥è‡ªå“ªä¸ªè¿›ç¨‹ï¼Œå¤šè·¯å¤ç”¨ä¸€ä¸ªä¼ è¾“å±‚ï¼ˆå¤ç”¨ï¼šåœ¨å‘é€ç«¯ï¼Œå¤šä¸ªåº”ç”¨è¿›ç¨‹å…¬ç”¨ä¸€ä¸ªä¼ è¾“å±‚ï¼‰ã€‚</li>
<li>16ä½ç›®çš„ç«¯å£å·ï¼šæ•°æ®é€å¾€æ¥æ”¶ç«¯å“ªä¸ªåº”ç”¨ç¨‹åºï¼Œåˆ©ç”¨ç«¯å£å·å®ç°å¤šè·¯åˆ†ç”¨ï¼ˆåˆ†ç”¨ï¼šåœ¨æ¥æ”¶ç«¯ï¼Œä¼ è¾“å±‚ä¼šæ ¹æ®ç«¯å£å·å°†æ•°æ®åˆ†æ´¾ç»™ä¸åŒçš„åº”ç”¨è¿›ç¨‹ï¼‰ã€‚</li>
<li>16ä½UDPé•¿åº¦ï¼šUDPæ•°æ®æŠ¥é¦–éƒ¨å’ŒUDPæ•°æ®æŠ¥æ•°æ®éƒ¨åˆ†æ€»å­—èŠ‚æ•°ï¼Œæœ€å°å€¼ä¸º8å­—èŠ‚(ä»…æœ‰é¦–éƒ¨)ï¼Œæœ€å¤§å€¼ä¸º65535å­—èŠ‚ã€‚</li>
<li>16ä½UDPæ£€éªŒå’Œï¼šUDPçš„æ ¡éªŒå’Œæ˜¯å¯é€‰çš„ï¼ŒTCPæ˜¯å¿…éœ€çš„ã€‚UDPçš„æ ¡éªŒå’Œè¦†ç›–é¦–éƒ¨åŠæ•°æ®éƒ¨åˆ†ã€‚åœ¨ä¸‹ä¸€èŠ‚ã€‚</li>
<li>æ•°æ®ï¼šè¦å‘é€çš„æ•°æ®ï¼Œå¯ä»¥ä¸ºç©º(0å­—èŠ‚)ã€‚</li>
</ol>
<h2 id="UDPæ£€éªŒå’Œ"><a href="#UDPæ£€éªŒå’Œ" class="headerlink" title="UDPæ£€éªŒå’Œ"></a>UDPæ£€éªŒå’Œ</h2><p>UDPæ ¡éªŒå’Œçš„å†…å®¹è¶…å‡ºäº†UDPæ•°æ®æŠ¥æ–‡æœ¬èº«çš„èŒƒå›´ï¼Œå®é™…ä¸Šï¼Œå®ƒçš„å€¼æ˜¯é€šè¿‡è®¡ç®—UDPæ•°æ®æŠ¥åŠä¸€ä¸ªä¼ªåŒ…å¤´è€Œå¾—åˆ°çš„ã€‚æ ¡éªŒå’Œçš„è®¡ç®—æ–¹æ³•ä¸é€šç”¨çš„ä¸€æ ·ï¼Œéƒ½æ˜¯ç´¯åŠ æ±‚å’Œã€‚<br>å®ƒçš„æ ¡éªŒå’Œçš„æ£€éªŒèŒƒå›´å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://o6plzvjf2.bkt.clouddn.com/computerNetwork/png/checksum.png" alt="checksum"></p>
<p>ä¼ªé¦–éƒ¨å¹¶éUDPæ•°æ®æŠ¥ä¸­å®é™…çš„æœ‰æ•ˆæˆåˆ†ã€‚ä¼ªé¦–éƒ¨æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­çš„ä¿¡æ¯æ˜¯ä»æ•°æ®æŠ¥æ‰€åœ¨IPåˆ†ç»„å¤´çš„åˆ†ç»„å¤´ä¸­æå–çš„ï¼Œæ—¢ä¸å‘ä¸‹ä¼ é€ä¹Ÿä¸å‘ä¸Šé€’äº¤ï¼Œè€Œä»…ä»…æ˜¯ä¸ºè®¡ç®—æ ¡éªŒå’Œã€‚è¿™æ ·çš„æ ¡éªŒå’Œï¼Œæ—¢æ ¡éªŒäº†UDPç”¨æˆ·æ•°æ®çš„æºç«¯å£å·å’Œç›®çš„ç«¯å£å·ä»¥åŠUDPç”¨æˆ·æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†ï¼Œåˆæ£€éªŒäº†IPæ•°æ®æŠ¥çš„æºIPåœ°å€å’Œç›®çš„IP<br>åœ°å€ã€‚<strong>ä¼ªæŠ¥å¤´ä¿è¯UDPæ•°æ®å•å…ƒåˆ°è¾¾æ­£ç¡®çš„ç›®çš„åœ°å€</strong>ã€‚</p>
<p>æ ¡éªŒæ–¹å¼ï¼š</p>
<ol>
<li><p>ã€ŠTCP/IP è¯¦è§£ã€‹å·ä¸€ ç¬¬ä¸€ç‰ˆä¸­å¦‚ä¸‹è®¡ç®—æ£€éªŒå’Œå­—æ®µçš„å€¼ï¼š</p>
<ul>
<li>å‘é€æ–¹è®¡ç®—UDPæ£€éªŒå’Œï¼š<br>é¦–å…ˆæŠŠæ£€éªŒå’Œå­—æ®µç½®ä¸º0ï¼ŒæŠŠä¸Šå›¾ä¸­,å„éƒ¨åˆ†æ•°æ®(åŒ…æ‹¬UDPä¼ªé¦–éƒ¨åŠå¡«å……å­—æ®µ)æŒ‰æ¯16bitè¿›è¡ŒäºŒè¿›åˆ¶åç æ±‚å’Œ(è‹¥æœ€é«˜ä½äº§ç”Ÿè¿›ä½å°±åŠ åˆ°æœ€ä½ä½ä¸Šå»)ï¼Œæ‰€æ±‚ç»“æœå°±æ˜¯16bitUDPæ£€éªŒå’Œå­—æ®µçš„å€¼ã€‚</li>
<li>æ¥æ”¶æ–¹è®¡ç®—UDPæ£€éªŒå’Œï¼š<br>å¯¹æ”¶åˆ°çš„UDPæ•°æ®æŠ¥(åŠ ä¸Šäº†UDPé¦–éƒ¨å’Œå¡«å……å­—èŠ‚)æŒ‰æ¯16bitè¿›è¡ŒäºŒè¿›åˆ¶åç æ±‚å’Œ(è‹¥æœ€é«˜ä½äº§ç”Ÿè¿›ä½å°±åŠ åˆ°æœ€ä½ä½ä¸Šå»)ï¼Œè‹¥ç»“æœä¸ºå…¨1ï¼Œåˆ™UDPæ•°æ®æŠ¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰å‡ºç°å·®é”™ï¼Œå¦åˆ™æ•°æ®æŠ¥æœ‰å·®é”™ã€‚</li>
</ul>
</li>
<li>ã€ŠTCP/IP è¯¦è§£ã€‹å·ä¸€ ç¬¬äºŒç‰ˆä¸­å¦‚ä¸‹è®¡ç®—æ£€éªŒå’Œå­—æ®µçš„å€¼ï¼š<ul>
<li>å‘é€æ–¹è®¡ç®—UDPæ£€éªŒå’Œï¼š<br>é¦–å…ˆæŠŠæ£€éªŒå’Œå­—æ®µç½®ä¸º0ï¼ŒæŠŠä¸Šå›¾ä¸­,å„éƒ¨åˆ†æ•°æ®(åŒ…æ‹¬UDPä¼ªé¦–éƒ¨åŠå¡«å……å­—æ®µ)æŒ‰æ¯16bitè¿›è¡ŒäºŒè¿›åˆ¶åç æ±‚å’Œ(è‹¥æœ€é«˜ä½äº§ç”Ÿè¿›ä½å°±åŠ åˆ°æœ€ä½ä½ä¸Šå»)ï¼Œæœ€åç»“æœå†æŒ‰ä½å–åï¼Œæ‰€å¾—ç»“æœå°±æ˜¯16bitUDPæ£€éªŒå’Œå­—æ®µçš„å€¼ã€‚</li>
<li>æ¥æ”¶æ–¹è®¡ç®—UDPæ£€éªŒå’Œï¼š<br>å¯¹æ”¶åˆ°çš„UDPæ•°æ®æŠ¥(åŠ ä¸Šäº†UDPé¦–éƒ¨å’Œå¡«å……å­—èŠ‚)æŒ‰æ¯16bitè¿›è¡ŒäºŒè¿›åˆ¶åç æ±‚å’Œ(è‹¥æœ€é«˜ä½äº§ç”Ÿè¿›ä½å°±åŠ åˆ°æœ€ä½ä½ä¸Šå»)ï¼Œå†æŒ‰ä½å–åï¼Œè‹¥ç»“æœä¸ºå…¨0ï¼Œåˆ™UDPæ•°æ®æŠ¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰å‡ºç°å·®é”™ï¼Œå¦åˆ™æ•°æ®æŠ¥æœ‰å·®é”™ã€‚<strong>å› ä¸ºæ£€éªŒå’Œçš„å€¼ä»ä¸ä¸º0xFFFF</strong></li>
</ul>
</li>
</ol>
<h1 id="UDPæœåŠ¡å™¨ä¸‰ç±»åœ°å€ç»‘å®š"><a href="#UDPæœåŠ¡å™¨ä¸‰ç±»åœ°å€ç»‘å®š" class="headerlink" title="UDPæœåŠ¡å™¨ä¸‰ç±»åœ°å€ç»‘å®š"></a>UDPæœåŠ¡å™¨ä¸‰ç±»åœ°å€ç»‘å®š</h1><table>
<thead>
<tr>
<th>æœ¬åœ°åœ°å€</th>
<th>è¿œç«¯åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>LocalIP:Lport</td>
<td>ForeignIP:Fport</td>
<td>åªé™äºä¸€ä¸ªå®¢æˆ·</td>
</tr>
<tr>
<td>LocalIP:Lport</td>
<td>*:*</td>
<td>åªé™äºä¸€ä¸ªæœ¬åœ°IPå’Œç«¯å£çš„æ•°æ®åŒ…</td>
</tr>
<tr>
<td>*:port</td>
<td>*:*</td>
<td>æ¥æ”¶å‘é€åˆ°Lportçš„æ‰€æœ‰æ•°æ®åŒ…</td>
</tr>
</tbody>
</table>
<ol>
<li>ç¬¬ä¸€è¡Œä¸­æœåŠ¡å™¨é™å®šäº†åªä»æœ¬åœ°Localè¿™ä¸ªIPåœ°å€çš„Lportç«¯å£æ¥æ”¶æ•°æ®æŠ¥ï¼Œè€Œä¸”åªæ¥æ”¶æ¥è‡ªIPä¸ºForeignä¸”ç«¯å£ä¸ºFportå‘æ¥çš„æ•°æ®ã€‚</li>
<li>ç¬¬äºŒè¡Œä¸­æœåŠ¡å™¨é™å®šäº†åªä»æœ¬åœ°LocalIPè¿™ä¸ªIPåœ°å€çš„Lportç«¯å£æ¥æ”¶æ•°æ®æŠ¥ï¼Œä½†å¯ä»¥æ¥æ”¶ä»»ä½•ä¸»æœºå‘é€çš„æ•°æ®ã€‚</li>
<li>ç¬¬ä¸‰è¡Œä¸­æœåŠ¡å™¨åªé™å®šäº†æ¥æ”¶æ•°æ®çš„ç«¯å£å·ï¼Œå› æ­¤ä»»ä½•ä¸€ä¸ªæœ¬åœ°æ¥å£IPéƒ½å¯ä»¥æ¥æ”¶å®ƒï¼Œè€Œä¸”æ•°æ®å¯ä»¥æ¥è‡ªä»»ä½•ä¸»æœºå‘é€çš„æ•°æ®ã€‚</li>
</ol>
<h1 id="UDPçš„åº”ç”¨"><a href="#UDPçš„åº”ç”¨" class="headerlink" title="UDPçš„åº”ç”¨"></a>UDPçš„åº”ç”¨</h1><p>å½“å¯¹ç½‘ç»œé€šè®¯è´¨é‡è¦æ±‚ä¸é«˜çš„æ—¶å€™ï¼Œè¦æ±‚ç½‘ç»œé€šè®¯é€Ÿåº¦èƒ½å°½é‡çš„å¿«ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨UDPã€‚å¸¸è§çš„ä½¿ç”¨UDPåè®®çš„åº”ç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li>QQè¯­è¨€å’Œè§†é¢‘</li>
<li>DNS(åŸŸåæœåŠ¡å™¨)</li>
<li>NFS(ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ)</li>
<li>TFTP(æ™®é€šæ–‡ä»¶ä¼ è¾“åè®®)</li>
</ul>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://blog.csdn.net/CorCplusplusorjava/article/details/47164875" target="_blank" rel="external">UDPåè®®</a></li>
<li><a href="https://blog.csdn.net/sinat_30270011/article/details/51980160" target="_blank" rel="external">UDPåè®®çš„åº”ç”¨</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šUDPä½œä¸ºä¼ è¾“å±‚çš„ä¸€å¤§åè®®ï¼Œè™½ç„¶æ²¡æœ‰TCPå¯é ï¼Œä½†æ˜¯å´èƒœåœ¨ç®€å•ã€‚
    
    </summary>
    
      <category term="è®¡ç®—æœºç½‘ç»œ" scheme="http://bestlixiang.site/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="UDP" scheme="http://bestlixiang.site/tags/UDP/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“äº‹åŠ¡</title>
    <link href="http://bestlixiang.site/2018/05/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/"/>
    <id>http://bestlixiang.site/2018/05/11/æ•°æ®åº“/æ•°æ®åº“äº‹åŠ¡/</id>
    <published>2018-05-11T07:10:33.000Z</published>
    <updated>2018-05-11T07:17:04.678Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šæ•°æ®åº“äº‹åŠ¡åœ¨æ•°æ®åº“æ“ä½œä¸­æ˜¯ååˆ†é‡è¦çš„ï¼Œå› ä¸ºå®ƒè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®åº“çš„æ•°æ®çš„å®Œæ•´æ€§ä¸ä¸€è‡´æ€§ã€‚<a id="more"></a></p>
<h1 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡</h1><p>æ„æˆå•ä¸€é€»è¾‘å·¥ä½œå•å…ƒçš„æ“ä½œé›†åˆã€‚</p>
<p>äº‹åŠ¡æ˜¯è®¿é—®å¹¶å¯èƒ½æ›´æ–°å„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªç¨‹åºæ‰§è¡Œå•å…ƒï¼Œäº‹åŠ¡é€šå¸¸ç”¨å½¢å¦‚begin transaction å’Œ end transactionæ¥ç•Œå®šï¼Œäº‹åŠ¡ç”±å®ƒä»¬ä¹‹é—´æ‰§è¡Œçš„å…¨ä½“æ“ä½œç»„æˆã€‚</p>
<p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼šå°†é’±ä»ä¸€ä¸ªè´¦æˆ·è½¬åˆ°å¦ä¸€ä¸ªè´¦æˆ·å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œè¯¥äº‹åŠ¡åŒ…æ‹¬åˆ†åˆ«å¯¹ä¸¤ä¸ªè´¦æˆ·çš„æ›´æ–°ã€‚</p>
<h1 id="ACIDç‰¹æ€§"><a href="#ACIDç‰¹æ€§" class="headerlink" title="ACIDç‰¹æ€§"></a>ACIDç‰¹æ€§</h1><ol>
<li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ½æ­£ç¡®æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚</li>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¼€å§‹å‰å’Œäº‹åŠ¡ç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚æ¯”å¦‚ä¸Šé¢è½¬è´¦ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªè´¦æˆ·çš„æ€»é‡‘é¢å°±æ˜¯å®Œæ•´æ€§çº¦æŸï¼Œå› ä¸ºä»–ä»¬çš„æ€»é‡‘é¢æ˜¯ä¸å˜çš„ã€‚ä½†æ˜¯åœ¨å¹¶å‘äº‹åŠ¡ä¸­ï¼Œä¸€è‡´æ€§å¾ˆå®¹æ˜“è¢«ç ´åï¼Œéœ€è¦æˆ‘ä»¬ç‰¹åˆ«æ³¨æ„ã€‚</li>
<li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šäº‹åŠ¡çš„æ‰§è¡Œæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸ä¼šçœ‹åˆ°å¦ä¸€ä¸ªæ­£åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„äº‹åŠ¡çš„æ•°æ®ã€‚</li>
<li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ç»“æŸåï¼Œäº‹åŠ¡çš„ç»“æœå¿…é¡»æ˜¯æ°¸ä¹…ä¿å­˜çš„ã€‚å³ä½¿æ•°æ®åº“å‘ç”Ÿå´©æºƒï¼Œåœ¨æ•°æ®åº“æ¢å¤åäº‹åŠ¡æäº¤çš„ç»“æœä»ç„¶ä¸ä¼šä¸¢å¤±ã€‚</li>
</ol>
<p>ç¡®ä¿éš”ç¦»æ€§æœ‰å¯èƒ½å¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆè¾ƒå¤§çš„ä¸åˆ©å½±å“ï¼Œç”±äºè¿™ä¸ªåŸå› ï¼Œä¸€äº›åº”ç”¨åœ¨éš”ç¦»æ€§ä¸Šé‡‡å–ä¸€äº›å¦¥åã€‚</p>
<h1 id="äº‹åŠ¡çš„åˆ†ç±»"><a href="#äº‹åŠ¡çš„åˆ†ç±»" class="headerlink" title="äº‹åŠ¡çš„åˆ†ç±»"></a>äº‹åŠ¡çš„åˆ†ç±»</h1><ol>
<li>æ‰å¹³äº‹åŠ¡(Flat Transactions)ï¼šå®ƒæ˜¯å®é™…ç”Ÿäº§ç¯å¢ƒä¸­æœ€å¸¸ç”¨ã€æœ€ç®€å•çš„äº‹åŠ¡ç±»å‹ã€‚åœ¨æ‰å¹³äº‹åŠ¡ä¸­ï¼Œæ‰€æœ‰æ“ä½œéƒ½å¤„äºåŒä¸€å±‚æ¬¡ï¼Œå…¶ç”±begin transactionå¼€å§‹ï¼Œcommitæˆ–rollbackç»“æŸï¼Œå…¶é—´çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½å›æ»šï¼Œå› æ­¤æ‰å¹³äº‹åŠ¡æ˜¯åº”ç”¨ç¨‹åºç§°ä¸ºåŸå­æ“ä½œçš„çš„åŸºæœ¬ç»„æˆæ¨¡å—ã€‚ä½†æ˜¯å‘ç”Ÿé”™è¯¯æ—¶éƒ½éœ€è¦å›æ»šåˆ°äº‹åŠ¡çš„èµ·å§‹ä½ç½®ï¼Œæ— æ³•å›æ»šéƒ¨åˆ†æ“ä½œï¼Œæ‰€ä»¥å›æ»šå¼€é”€å¤ªå¤§ã€‚</li>
<li>å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡(Flat Transactions with Savepoints)ï¼š é™¤äº†æ”¯æŒæ‰å¹³äº‹åŠ¡æ”¯æŒçš„æ“ä½œå¤–ï¼Œå…è®¸åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å›æ»šåŒä¸€äº‹åŠ¡ä¸­è¾ƒæ—©çš„ä¸€ä¸ªçŠ¶æ€ã€‚è¿™æ˜¯å› ä¸ºæŸäº›äº‹åŠ¡å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„é”™è¯¯å¹¶ä¸ä¼šå¯¼è‡´æ‰€æœ‰çš„æ“ä½œéƒ½æ— æ•ˆï¼Œæ”¾å¼ƒæ•´ä¸ªäº‹åŠ¡ä¸åˆä¹è¦æ±‚ï¼Œå¼€é”€å¤ªå¤§ï¼Œä¿å­˜ç‚¹ç”¨æ¥é€šçŸ¥äº‹åŠ¡ç³»ç»Ÿåº”è¯¥è®°ä½äº‹åŠ¡å½“å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿å½“ä¹‹åå‘ç”Ÿé”™è¯¯æ—¶ï¼Œäº‹åŠ¡èƒ½å›åˆ°ä¿å­˜ç‚¹å½“æ—¶çš„çŠ¶æ€ã€‚</li>
<li>é“¾äº‹åŠ¡(Chained Transactions)ï¼šåœ¨æäº¤ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œé‡Šæ”¾ä¸éœ€è¦çš„æ•°æ®å¯¹è±¡ï¼Œå°†å¿…è¦çš„å¤„ç†ä¸Šä¸‹æ–‡éšå¼åœ°ä¼ ç»™ä¸‹ä¸€ä¸ªè¦å¼€å§‹çš„äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡æ“ä½œå’Œå¼€å§‹ä¸‹ä¸€ä¸ªäº‹åŠ¡æ“ä½œ å°†åˆå¹¶ä¸ºä¸€ä¸ªåŸå­æ“ä½œï¼Œè¿™æ„å‘³ç€ä¸‹ä¸€ä¸ªäº‹åŠ¡å°†çœ‹åˆ°ä¸Šä¸€ä¸ªäº‹åŠ¡çš„ç»“æœï¼Œå°±å¥½åƒä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡Œçš„ä¸€æ ·ã€‚å’Œå¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡ä¸åŒçš„æ˜¯ï¼Œå¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡èƒ½å›æ»šåˆ°ä»»æ„æ­£ç¡®çš„ä¿å­˜ç‚¹ï¼Œè€Œé“¾äº‹åŠ¡ä¸­çš„å›æ»šä»…é™å½“å‰äº‹åŠ¡ï¼Œå³åªèƒ½æ¢å¤åˆ°æœ€è¿‘çš„ä¸€ä¸ªä¿å­˜ç‚¹ã€‚</li>
<li><p>åµŒå¥—äº‹åŠ¡(Nested Transactions)ï¼šç”±ä¸€ä¸ªé¡¶å±‚äº‹åŠ¡(top-level transaction)æ§åˆ¶ç€å„ä¸ªå±‚æ¬¡çš„äº‹åŠ¡ï¼Œé¡¶å±‚äº‹åŠ¡ä¹‹ä¸‹åµŒå¥—çš„äº‹åŠ¡è¢«ç§°ä¸ºå­äº‹åŠ¡ã€‚åµŒå¥—äº‹åŠ¡æ˜¯ç”±è‹¥å¹²äº‹åŠ¡ç»„æˆçš„ä¸€æ£µæ ‘ï¼Œå­æ ‘æ—¢å¯ä»¥æ˜¯åµŒå¥—äº‹åŠ¡ä¹Ÿå¯ä»¥æ˜¯æ‰å¹³äº‹åŠ¡ï¼Œå¤„åœ¨å¶èŠ‚ç‚¹çš„äº‹åŠ¡æ˜¯æ‰å¹³äº‹åŠ¡ï¼Œä½†æ˜¯æ¯ä¸ªäº‹åŠ¡ä»æ ¹åˆ°å¶èŠ‚ç‚¹çš„è·ç¦»å¯ä»¥è¯´æ˜¯ä¸åŒçš„ã€‚å­äº‹åŠ¡æ—¢å¯ä»¥æäº¤ä¹Ÿå¯ä»¥å›æ»šã€‚ä½†æ˜¯å®ƒçš„æäº¤æ“ä½œå¹¶ä¸é©¬ä¸Šç”Ÿæ•ˆã€‚é™¤éå…¶çˆ¶äº‹åŠ¡å·²ç»æäº¤ã€‚æ ‘ä¸­çš„ä»»æ„äº‹åŠ¡å›æ»šä¼šå¼•èµ·å®ƒçš„æ‰€æœ‰å­äº‹åŠ¡ä¸€åŒå›æ»šï¼Œæ•…å­äº‹åŠ¡ä»…ä¿ç•™ACIç‰¹æ€§è€Œä¸å…·æœ‰Dç‰¹æ€§ã€‚</p>
</li>
<li><p>åˆ†å¸ƒå¼äº‹åŠ¡(Distributed Transactions)ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹è¿è¡Œçš„æ‰å¹³äº‹åŠ¡ï¼Œå› æ­¤éœ€è¦æ ¹æ®æ•°æ®æ‰€åœ¨ä½ç½®è®¿é—®ç½‘ç»œä¸­çš„ä¸åŒèŠ‚ç‚¹ã€‚</p>
</li>
</ol>
<h1 id="æ•°æ®åº“å¹¶å‘è®¿é—®ä¼šå‡ºç°çš„é—®é¢˜"><a href="#æ•°æ®åº“å¹¶å‘è®¿é—®ä¼šå‡ºç°çš„é—®é¢˜" class="headerlink" title="æ•°æ®åº“å¹¶å‘è®¿é—®ä¼šå‡ºç°çš„é—®é¢˜"></a>æ•°æ®åº“å¹¶å‘è®¿é—®ä¼šå‡ºç°çš„é—®é¢˜</h1><h2 id="è¯»é—®é¢˜"><a href="#è¯»é—®é¢˜" class="headerlink" title="è¯»é—®é¢˜"></a>è¯»é—®é¢˜</h2><ol>
<li>è„è¯»ï¼šAäº‹åŠ¡è¯»å–Bäº‹åŠ¡å°šæœªæäº¤çš„æ›´æ”¹æ•°æ®ï¼Œå¹¶åœ¨è¿™ä¸ªæ•°æ®çš„åŸºç¡€ä¸Šè¿›è¡Œæ“ä½œï¼Œè¿™æ—¶å€™å¦‚æœäº‹åŠ¡Bå›æ»šï¼Œé‚£ä¹ˆAäº‹åŠ¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸è¢«æ‰¿è®¤çš„ã€‚</li>
<li>è™šåº¦ï¼ˆä¸å¯é‡å¤è¯»ï¼‰ï¼šAäº‹åŠ¡è¯»å–äº†Bäº‹åŠ¡å·²ç»æäº¤çš„<strong>æ›´æ”¹æ•°æ®</strong>ã€‚å‡å¦‚Aåœ¨å–æ¬¾äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼ŒBå¾€è¯¥è´¦æˆ·è½¬è´¦100ï¼ŒAä¸¤æ¬¡è¯»å–çš„ä½™é¢å‘ç”Ÿä¸ä¸€è‡´ã€‚é˜²æ­¢è¯»åˆ°æ›´æ”¹æ•°æ®ï¼Œéœ€è¦å¯¹æ“ä½œçš„æ•°æ®æ·»åŠ è¡Œçº§é”ã€‚</li>
<li>å¹»è¯»ï¼šAäº‹åŠ¡è¯»å–Bäº‹åŠ¡æäº¤çš„<strong>æ–°å¢æ•°æ®</strong>ã€‚ä¾‹å¦‚é“¶è¡Œç³»ç»Ÿåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ä¸¤æ¬¡ç»Ÿè®¡å­˜æ¬¾è´¦æˆ·çš„æ€»é‡‘é¢ï¼Œåœ¨ä¸¤æ¬¡ç»Ÿè®¡ä¸­ï¼Œåˆšå¥½æ–°å¢äº†ä¸€ä¸ªå­˜æ¬¾è´¦æˆ·ï¼Œå­˜å…¥äº†100ï¼Œè¿™æ—¶å€™ä¸¤æ¬¡ç»Ÿè®¡çš„æ€»é‡‘é¢ä¸ä¸€è‡´ã€‚ é˜²æ­¢è¯»åˆ°æ–°å¢æ•°æ®ï¼Œéœ€è¦å¯¹æ“ä½œçš„æ•°æ®æ·»åŠ è¡¨çº§é”ã€‚</li>
</ol>
<h2 id="æ›´æ–°é—®é¢˜"><a href="#æ›´æ–°é—®é¢˜" class="headerlink" title="æ›´æ–°é—®é¢˜"></a>æ›´æ–°é—®é¢˜</h2><ol>
<li>ç¬¬ä¸€ç±»ä¸¢å¤±æ›´æ–°ï¼šAäº‹åŠ¡æ’¤é”€æ—¶ï¼ŒæŠŠå·²ç»æäº¤çš„Bäº‹åŠ¡çš„æ›´æ–°æ•°æ®è¦†ç›–äº†ã€‚</li>
<li>ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°ï¼šAäº‹åŠ¡è¦†ç›–Bäº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œé€ æˆBäº‹åŠ¡æ‰€åšçš„æ“ä½œä¸¢å¤±ã€‚</li>
</ol>
<h1 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h1><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæ•°æ®åº“é€šè¿‡å¤šç§<strong>å¹¶å‘æ§åˆ¶æœºåˆ¶</strong>ï¼ˆå¸¸ç”¨çš„æœ‰ä¸¤é˜¶æ®µå°é”å’Œå¿«ç…§éš”ç¦»ï¼‰è§£å†³å¹¶å‘è®¿é—®çš„é—®é¢˜ã€‚ä½†æ˜¯ç›´æ¥ä½¿ç”¨å¹¶å‘æ§åˆ¶æœºåˆ¶æ˜¯å¾ˆå¤æ‚çš„ï¼Œæ•°æ®åº“ç»™ç”¨æˆ·æä¾›äº†ä¸åŒçš„<strong>äº‹åŠ¡éš”ç¦»çº§åˆ«</strong>ï¼Œåªè¦è®¾ç½®äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“å°±ä¼šåˆ†æäº‹åŠ¡ä¸­çš„sqlè¯­å¥ç„¶åè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚</p>
<p>å››ç§éš”ç¦»çº§åˆ«å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯ä¸²è¡ŒåŒ–(SERIALIZABLE)ï¼šä¿è¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ï¼Œä¸å…è®¸å‡ºç°ä»»ä½•é—®é¢˜ã€‚</li>
<li>å¯é‡å¤è¯»(REPEATABLE READ) ï¼šåªå…è®¸è¯»å–å·²æäº¤çš„æ•°æ®ï¼Œè€Œä¸”åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–ä¸€ä¸ªæ•°æ®é¡¹æœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½æ›´æ–°è¯¥æ•°ï¼Œå•ä¸è¦æ±‚è¯¥äº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡å¯ä¸²è¡ŒåŒ–ã€‚</li>
<li>å·²æäº¤è¯»(READ COMMITTED)ï¼šåªå…è®¸è¯»å–å·²æäº¤çš„æ•°æ®ï¼Œä½†ä¸è¦æ±‚å¯é‡å¤è¯»ã€‚</li>
<li>æœªæäº¤è¯»(READ UNCOMMITTED)ï¼šå…è®¸è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œè¿™æ˜¯SQLå…è®¸çš„æœ€ä½ä¸€è‡´æ€§çº§åˆ«ã€‚</li>
</ol>
<p>ä¸åŒçš„éš”ç¦»çº§åˆ«å¯¹å¹¶å‘é—®é¢˜çš„è§£å†³æƒ…å†µå¦‚ä¸‹å›¾ï¼š</p>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>è„è¯»</th>
<th>è™šè¯»</th>
<th>å¹»è¯»</th>
<th>ç¬¬ä¸€åˆ—ä¸¢å€¼æ›´æ–°</th>
<th>ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯ä¸²è¡ŒåŒ–(SERIALIZABLE)</td>
<td>ä¸å…è®¸</td>
<td>ä¸å…è®¸</td>
<td>ä¸å…è®¸</td>
<td>ä¸å…è®¸</td>
<td>ä¸å…è®¸</td>
</tr>
<tr>
<td>å¯é‡å¤è¯»(REPEATABLE READ)</td>
<td>ä¸å…è®¸</td>
<td>ä¸å…è®¸</td>
<td>å…è®¸</td>
<td>ä¸å…è®¸</td>
<td>ä¸å…è®¸</td>
</tr>
<tr>
<td>å·²æäº¤è¯»(READ COMMITTED)</td>
<td>ä¸å…è®¸</td>
<td>å…è®¸</td>
<td>å…è®¸</td>
<td>ä¸å…è®¸</td>
<td>å…è®¸</td>
</tr>
<tr>
<td>æœªæäº¤è¯»(READ UNCOMMITTED)</td>
<td>å…è®¸</td>
<td>å…è®¸</td>
<td>å…è®¸</td>
<td>ä¸å…è®¸</td>
<td>å…è®¸</td>
</tr>
</tbody>
</table>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li>ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚å¿µã€‹</li>
<li><a href="https://blog.csdn.net/u010425776/article/details/60968283" target="_blank" rel="external">æ•°æ®åº“äº‹åŠ¡è¯¦è§£</a></li>
<li><a href="https://blog.csdn.net/starlh35/article/details/76445267" target="_blank" rel="external">æ•°æ®åº“å¹¶å‘äº‹åŠ¡å­˜åœ¨çš„é—®é¢˜ï¼ˆè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰ï¼‰</a></li>
<li><a href="http://ihenu.iteye.com/blog/2276576" target="_blank" rel="external">æ•°æ®åº“çš„äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶</a></li>
<li><a href="http://blog.itpub.net/26736162/viewspace-2144050" target="_blank" rel="external">MySQLä¸­äº‹åŠ¡çš„åˆ†ç±»</a></li>
<li><a href="https://www.cnblogs.com/wajika/p/6680200.html" target="_blank" rel="external">æ•°æ®åº“éš”ç¦»çº§åˆ«åŠå…¶å®ç°åŸç†</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šæ•°æ®åº“äº‹åŠ¡åœ¨æ•°æ®åº“æ“ä½œä¸­æ˜¯ååˆ†é‡è¦çš„ï¼Œå› ä¸ºå®ƒè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®åº“çš„æ•°æ®çš„å®Œæ•´æ€§ä¸ä¸€è‡´æ€§ã€‚
    
    </summary>
    
      <category term="æ•°æ®åº“" scheme="http://bestlixiang.site/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="æ•°æ®åº“" scheme="http://bestlixiang.site/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“èŒƒå¼</title>
    <link href="http://bestlixiang.site/2018/05/10/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F/"/>
    <id>http://bestlixiang.site/2018/05/10/æ•°æ®åº“/æ•°æ®åº“èŒƒå¼/</id>
    <published>2018-05-10T13:13:04.000Z</published>
    <updated>2018-05-10T13:13:22.509Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ï¼šè®¾è®¡å¥½æ•°æ®åº“çš„è¡¨çš„å‰æå°±æ˜¯è¦æ»¡è¶³æ›´é«˜çº§åˆ«æ•°æ®åº“çš„èŒƒå¼ï¼Œå½“ç„¶çº§åˆ«ä¸æ˜¯è¶Šé«˜è¶Šå¥½ï¼Œä½†æ˜¯è‡³å°‘ä¸å·®ï¼<a id="more"></a></p>
<h1 id="æ•°æ®åº“èŒƒå¼çš„ä¼˜ç¼ºç‚¹"><a href="#æ•°æ®åº“èŒƒå¼çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="æ•°æ®åº“èŒƒå¼çš„ä¼˜ç¼ºç‚¹"></a>æ•°æ®åº“èŒƒå¼çš„ä¼˜ç¼ºç‚¹</h1><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ol>
<li>å‡å°‘æ•°æ®å†—ä½™</li>
<li>æ¶ˆé™¤å¼‚å¸¸ï¼ˆæ’å…¥å¼‚å¸¸ï¼Œæ›´æ–°å¼‚å¸¸ï¼Œåˆ é™¤å¼‚å¸¸ï¼‰</li>
</ol>
<h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ol>
<li>æŸ¥è¯¢æ—¶è¦è”ç»“å¤šä¸ªè¡¨ï¼Œå¢åŠ äº†æŸ¥è¯¢çš„å¤æ‚åº¦</li>
<li>æŸ¥è¯¢æ—¶éœ€è¦è”ç»“å¤šä¸ªè¡¨ï¼Œé™ä½äº†æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½</li>
</ol>
<h1 id="ä»€ä¹ˆæ˜¯èŒƒå¼-NF-Normal-Form"><a href="#ä»€ä¹ˆæ˜¯èŒƒå¼-NF-Normal-Form" class="headerlink" title="ä»€ä¹ˆæ˜¯èŒƒå¼(NF Normal Form)"></a>ä»€ä¹ˆæ˜¯èŒƒå¼(NF Normal Form)</h1><p><strong>èŒƒå¼</strong>æ˜¯ä¸€å¼ æ•°æ®è¡¨çš„è¡¨ç»“æ„æ‰€ç¬¦åˆçš„æŸç§<strong>è®¾è®¡æ ‡å‡†</strong>ï¼Œæ»¡è¶³é«˜ç­‰çº§çš„èŒƒå¼çš„å…ˆå†³æ¡ä»¶æ˜¯æ»¡è¶³ä½ç­‰çº§èŒƒå¼ã€‚</p>
<h1 id="äº”å¤§èŒƒå¼"><a href="#äº”å¤§èŒƒå¼" class="headerlink" title="äº”å¤§èŒƒå¼"></a>äº”å¤§èŒƒå¼</h1><p>ä»¥ä¸‹èŒƒå¼çš„åŸºæœ¬æ¦‚å¿µå¯ä»¥å‚ç…§æˆ‘çš„å¦ä¸€ç¯‡åšæ–‡ï¼š<a href="http://todorex.com/2018/05/10/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" target="_blank" rel="external">å…³ç³»å‹æ•°æ®åº“çš„åŸºç¡€æ¦‚å¿µ</a>ï¼›å…·ä½“æ¡ˆä¾‹å¯ä»¥å‚ç…§è¿™ç¯‡åšæ–‡ï¼š<a href="http://www.cnblogs.com/CareySon/archive/2010/02/16/1668803.html" target="_blank" rel="external">æ•°æ®åº“èŒƒå¼é‚£äº›äº‹</a></p>
<h2 id="ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰"><a href="#ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰" class="headerlink" title="ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰"></a>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰</h2><ol>
<li>å¦‚æœä¸€ä¸ªå…³ç³»æ¨¡å¼Rçš„æ‰€æœ‰å±æ€§éƒ½æ˜¯<strong>ä¸å¯åˆ†</strong>çš„åŸºæœ¬æ•°æ®é¡¹ï¼Œåˆ™Râˆˆ1NF</li>
<li>ç¬¬ä¸€èŒƒå¼å°±æ˜¯æ¯ä¸€ä¸ªå±æ€§éƒ½ä¸å¯å†åˆ†ã€‚ä¸ç¬¦åˆç¬¬ä¸€èŒƒå¼åˆ™â€œä¸èƒ½â€ç§°ä¸ºå…³ç³»æ•°æ®åº“ï¼Œå› ä¸ºä½ å¯ä»¥ä¸€å¼ è¡¨æå®šæ‰€æœ‰ï¼Œè€Œä¸ç”¨äº§ç”Ÿå…³ç³»ã€‚</li>
</ol>
<h2 id="ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰"><a href="#ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰" class="headerlink" title="ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰"></a>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰</h2><ol>
<li>è‹¥å…³ç³»æ¨¡å¼Râˆˆ1NFï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªéä¸»å±æ€§éƒ½<strong>å®Œå…¨å‡½æ•°</strong>ä¾èµ–äºRçš„ç ï¼Œåˆ™Râˆˆ2NF</li>
<li>è¡¨ä¸­çš„å±æ€§å¿…é¡»å®Œå…¨ä¾èµ–äºå…¨éƒ¨ä¸»é”®ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†ä¸»é”®ã€‚æ‰€ä»¥åªæœ‰ä¸€ä¸ªä¸»é”®çš„è¡¨å¦‚æœç¬¦åˆç¬¬ä¸€èŒƒå¼ï¼Œé‚£ä¸€å®šæ˜¯ç¬¬äºŒèŒƒå¼</li>
<li>å‡å°‘æ•°æ®å®¹å†—ä½™å’Œå‡å°‘æ›´æ–°å¼‚å¸¸</li>
</ol>
<h2 id="ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰"><a href="#ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰" class="headerlink" title="ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰"></a>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰</h2><ol>
<li>è‹¥å…³ç³»æ¨¡å¼Râˆˆ2NFï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªéä¸»å±æ€§å¯¹äºç éƒ½<strong>ä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–</strong>ï¼Œåˆ™Râˆˆ3NF</li>
<li>æ¶ˆé™¤äº†éä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ–</li>
<li>å‡å°‘æ•°æ®å®¹å†—ä½™å’Œå‡å°‘å¸¸æ’å…¥å¼‚å¸¸ï¼Œæ›´æ–°å¼‚å¸¸ï¼Œåˆ é™¤å¼‚å¸¸</li>
</ol>
<h2 id="å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰"><a href="#å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰" class="headerlink" title="å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰"></a>å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰</h2><ol>
<li>è‹¥å…³ç³»æ¨¡å¼Râˆˆ3NFï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªä¸»å±æ€§å¯¹äºç éƒ½<strong>ä¸å­˜åœ¨éƒ¨åˆ†ä¸ä¼ é€’å‡½æ•°ä¾èµ–</strong>ï¼Œåˆ™RâˆˆBCNF</li>
<li>æ¶ˆé™¤ä¸»å±æ€§å¯¹äºç çš„éƒ¨åˆ†ä¸ä¼ é€’å‡½æ•°ä¾èµ–ï¼ŒBCNFæ˜¯åœ¨ç¬¬ä¸‰èŒƒå¼çš„åŸºç¡€ä¸Šçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œæ—¢æ¯ä¸ªè¡¨ä¸­åªæœ‰ä¸€ä¸ªå€™é€‰é”®ã€‚</li>
<li>å‡å°‘æ’å…¥å¼‚å¸¸ï¼Œæ›´æ–°å¼‚å¸¸ä¸åˆ é™¤å¼‚å¸¸</li>
</ol>
<h2 id="ç¬¬å››èŒƒå¼ï¼ˆ4NFï¼‰"><a href="#ç¬¬å››èŒƒå¼ï¼ˆ4NFï¼‰" class="headerlink" title="ç¬¬å››èŒƒå¼ï¼ˆ4NFï¼‰"></a>ç¬¬å››èŒƒå¼ï¼ˆ4NFï¼‰</h2><ol>
<li>è‹¥å…³ç³»æ¨¡å¼Râˆˆ1NFï¼Œå¹¶ä¸”åªå…è®¸çš„éå¹³å‡¡å¤šå€¼ä¾èµ–æ˜¯å‡½æ•°ä¾èµ–ï¼Œä¸å…è®¸å­˜åœ¨å…¶ä»–éå¹³å‡¡ä¸”éå‡½æ•°ä¾èµ–çš„å¤šå€¼ä¾èµ–ï¼Œåˆ™Râˆˆ4NFã€‚</li>
<li>å¹³å‡¡çš„å¤šå€¼ä¾èµ–å±äºç¬¬å››èŒƒå¼</li>
<li>å‡å°‘æ•°æ®å®¹å†—ä½™å’Œå‡å°‘å¸¸æ’å…¥å¼‚å¸¸ï¼Œæ›´æ–°å¼‚å¸¸ï¼Œåˆ é™¤å¼‚å¸¸</li>
</ol>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ•°æ®åº“è®¾è®¡åº”ç”¨çš„èŒƒå¼ä¸æ˜¯è¶Šé«˜è¶Šå¥½ï¼Œè¦çœ‹å®é™…æƒ…å†µè€Œå®šã€‚ç¬¬ä¸‰èŒƒå¼å·²ç»å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†æ•°æ®å†—ä½™ï¼Œå¹¶ä¸”å‡å°‘äº†é€ æˆæ’å…¥å¼‚å¸¸ï¼Œæ›´æ–°å¼‚å¸¸ï¼Œå’Œåˆ é™¤å¼‚å¸¸äº†ã€‚å¤§å¤šæ•°æƒ…å†µåº”ç”¨åˆ°ç¬¬ä¸‰èŒƒå¼å·²ç»è¶³å¤Ÿï¼Œåœ¨ä¸€å®šæƒ…å†µä¸‹ç¬¬äºŒèŒƒå¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.zhihu.com/question/24696366" target="_blank" rel="external">è§£é‡Šä¸€ä¸‹å…³ç³»æ•°æ®åº“çš„ç¬¬ä¸€ç¬¬äºŒç¬¬ä¸‰èŒƒå¼</a></li>
<li><a href="http://www.cnblogs.com/CareySon/archive/2010/02/16/1668803.html" target="_blank" rel="external">æ•°æ®åº“èŒƒå¼é‚£äº›äº‹</a></li>
<li><a href="https://blog.csdn.net/legendaryhaha/article/details/80032808" target="_blank" rel="external">æ•°æ®åº“ä¸­çš„èŒƒå¼å’Œå¤šå€¼ä¾èµ–</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ï¼šè®¾è®¡å¥½æ•°æ®åº“çš„è¡¨çš„å‰æå°±æ˜¯è¦æ»¡è¶³æ›´é«˜çº§åˆ«æ•°æ®åº“çš„èŒƒå¼ï¼Œå½“ç„¶çº§åˆ«ä¸æ˜¯è¶Šé«˜è¶Šå¥½ï¼Œä½†æ˜¯è‡³å°‘ä¸å·®ï¼
    
    </summary>
    
      <category term="æ•°æ®åº“" scheme="http://bestlixiang.site/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="æ•°æ®åº“" scheme="http://bestlixiang.site/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
</feed>
